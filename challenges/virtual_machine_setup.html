

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.1. Virtual Machine Setup &mdash; South Bay WASP 1.0.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="South Bay WASP 1.0.2 documentation" href="../index.html"/>
        <link rel="up" title="3. Pentest Challenges" href="../pentest_challenges.html"/>
        <link rel="next" title="3.2. OwlNest" href="owlnest.html"/>
        <link rel="prev" title="3. Pentest Challenges" href="../pentest_challenges.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> South Bay WASP
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pentest_intro.html">1. South Bay WASP Meetup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_kali.html">2. Kali Linux</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../pentest_challenges.html">3. Pentest Challenges</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.1. Virtual Machine Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#iso-vmware-and-virtualbox">3.1.1. ISO, VMware, and VirtualBox</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#iso">3.1.1.1. ISO</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vmware-vm">3.1.1.2. VMware VM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#virtualbox-vm">3.1.1.3. VirtualBox VM</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#metasploitable2-setup-vmware-vmdk-to-virtualbox-and-kvm">3.1.2. Metasploitable2 Setup - VMware vmdk to VirtualBox and KVM</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="owlnest.html">3.2. OwlNest</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice6.html">3.3. De-ICE Level 6</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice5.html">3.4. De-ICE Level 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice4.html">3.5. De-ICE Level 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice3.html">3.6. De-ICE Level 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice2.html">3.7. De-ICE Level 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice1.html">3.8. De-ICE Level 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="underdist3.html">3.9. Underdist: 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix5.html">3.10. Kioptrix Level 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix4.html">3.11. Kioptrix Level 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix3.html">3.12. Kioptrix Level 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix2.html">3.13. Kioptrix Level 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix1.html">3.14. Kioptrix Level 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="security_shepherd.html">3.15. Security Shepherd Web App Levels</a></li>
<li class="toctree-l2"><a class="reference internal" href="holynix2.html">3.16. Holynix2</a></li>
<li class="toctree-l2"><a class="reference internal" href="holynix1.html">3.17. Holynix1</a></li>
<li class="toctree-l2"><a class="reference internal" href="freshly.html">3.18. Freshly</a></li>
<li class="toctree-l2"><a class="reference internal" href="zorz.html">3.19. ZorZ</a></li>
<li class="toctree-l2"><a class="reference internal" href="vulnix.html">3.20. Vulnix</a></li>
<li class="toctree-l2"><a class="reference internal" href="googles_xss_game.html">3.21. Google’s XSS Game</a></li>
<li class="toctree-l2"><a class="reference internal" href="owning_database_with_sqlmap.html">3.22. Owning the Database with SQLMap</a></li>
<li class="toctree-l2"><a class="reference internal" href="from_sql_injection_to_shell_II.html">3.23. PentesterLab From SQL injection to Shell II</a></li>
<li class="toctree-l2"><a class="reference internal" href="from_sql_injection_to_shell.html">3.24. PentesterLab From SQL injection to Shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="skytower1.html">3.25. SkyTower1</a></li>
<li class="toctree-l2"><a class="reference internal" href="nebula.html">3.26. Exploit Exercises Nebula</a></li>
<li class="toctree-l2"><a class="reference internal" href="natas.html">3.27. Natas</a></li>
<li class="toctree-l2"><a class="reference internal" href="try2hack.nl.html">3.28. try2hack.nl</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_encryption.html">4. Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_html.html">5. HTML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_network_tools.html">6. Pentest Network Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_recon.html">7. Pentest Reconnaisance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_study.html">8. Pentest Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_buffer_overflow.html">9. Pentest Buffer Overflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_scripting.html">10. Pentest scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_presentations.html">11. Pentest Presentations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">South Bay WASP</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../pentest_challenges.html">3. Pentest Challenges</a> &raquo;</li>
        
      <li>3.1. Virtual Machine Setup</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/challenges/virtual_machine_setup.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="virtual-machine-setup">
<span id="vmsetup"></span><h1>3.1. Virtual Machine Setup<a class="headerlink" href="#virtual-machine-setup" title="Permalink to this headline">¶</a></h1>
<div class="section" id="iso-vmware-and-virtualbox">
<h2>3.1.1. ISO, VMware, and VirtualBox<a class="headerlink" href="#iso-vmware-and-virtualbox" title="Permalink to this headline">¶</a></h2>
<p>Many of the challenges provide a VM as either an ISO image, a VMware VM, or a VirtualBox VM. How can these be run on <a class="reference external" href="https://my.vmware.com/web/vmware/free#desktop_end_user_computing/vmware_workstation_player/12_0">VMware Player</a>, <a class="reference external" href="https://www.virtualbox.org/wiki/Downloads">VirtualBox</a>, and <a class="reference external" href="http://libvirt.org/">libvirt</a>/<a class="reference external" href="http://www.linux-kvm.org/page/Main_Page">KVM</a>?</p>
<div class="section" id="iso">
<h3>3.1.1.1. ISO<a class="headerlink" href="#iso" title="Permalink to this headline">¶</a></h3>
<p>The easiest is an ISO image: using any of VMware, VirtualBox, or KVM, create a VM like you normally would using an ISO (specifying the OS type). The VM will boot into the vulnerable target host much like if you were running a “live” ISO directly on your PC. That’s it.</p>
</div>
<div class="section" id="vmware-vm">
<h3>3.1.1.2. VMware VM<a class="headerlink" href="#vmware-vm" title="Permalink to this headline">¶</a></h3>
<p>Next consider the VMware VM. Of course it should run easily using VMware.</p>
<p>Using the VMware VM’s vmdk file in VirtualBox is quite easy: create a new VM with the option “Use an existing virtual hard drive file” using the vmdk file. Alternatively, you can convert the VMware vmdk to a VirtualBox vdi file one of two ways: (1) use the VirtualBox utility <code class="docutils literal"><span class="pre">VBoxManage</span></code> via <code class="docutils literal"><span class="pre">VBoxManage</span> <span class="pre">clonehd</span> <span class="pre">--format</span> <span class="pre">VDI</span> <span class="pre">target.vmdk</span> <span class="pre">target.vdi</span></code>; (2) use <code class="docutils literal"><span class="pre">qemu-img</span></code> via <code class="docutils literal"><span class="pre">qemu-img</span> <span class="pre">convert</span> <span class="pre">-f</span> <span class="pre">vmdk</span> <span class="pre">target.vmdk</span> <span class="pre">-O</span> <span class="pre">vdi</span> <span class="pre">target.vdi</span></code>.</p>
<p>KVM can directly use the vmdk file or convert it to qemu format via <code class="docutils literal"><span class="pre">qemu-img</span> <span class="pre">convert</span> <span class="pre">-f</span> <span class="pre">vmdk</span> <span class="pre">target.vmdk</span> <span class="pre">-O</span> <span class="pre">qcow2</span> <span class="pre">target.qcow2</span></code>. Then create a new VM importing an exising disk image; use either of 2 disk images (vmdk or qcow2).</p>
<p>If you’d like to use a backing store to allow easy rollback to the original, you can use the vmdk or it’s converted qcow2/raw image as the backing store as follows:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">USE_VMDK</span><span class="o">=</span><span class="m">1</span>
<span class="nv">VM_DISK</span><span class="o">=</span>vm-changes.qcow2

<span class="c1"># Use vmdk or create a qcow2 backing file</span>
<span class="nv">BACKING</span><span class="o">=</span>target.vmdk
<span class="k">if</span> <span class="o">[[</span> <span class="nv">$USE_VMDK</span> !<span class="o">=</span> <span class="s2">&quot;1&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
  sudo qemu-img convert -f vmdk target.vmdk -O qcow2 target.qcow2
  <span class="nv">BACKING</span><span class="o">=</span>target.qcow2
<span class="k">fi</span>

<span class="c1"># Create disk for VM backed by backing file</span>
sudo qemu-img create -f qcow2 -o <span class="nv">backing_file</span><span class="o">=</span><span class="nv">$BACKING</span>  <span class="nv">$VM_DISK</span>
sudo qemu-img info <span class="nv">$BACKING</span>
sudo qemu-img info <span class="nv">$VM_DISK</span>
</pre></div>
</div>
<p>Then you can create a new VM as above, selecting the VM_DISK image. To revert to the original target, the VM_DISK image can simply be recreated.</p>
</div>
<div class="section" id="virtualbox-vm">
<h3>3.1.1.3. VirtualBox VM<a class="headerlink" href="#virtualbox-vm" title="Permalink to this headline">¶</a></h3>
<p>Next consider the VirtualBox VM. Of course it should run easily using VirtualBox.</p>
<p>Using the VirtualBox VM’s vdi file in VMware is quite easy: convert the VirtualBox vdi to a VMware vmdk file using <code class="docutils literal"><span class="pre">qemu-img</span></code> via <code class="docutils literal"><span class="pre">qemu-img</span> <span class="pre">convert</span> <span class="pre">-f</span> <span class="pre">vdi</span> <span class="pre">target.vdi</span> <span class="pre">-O</span> <span class="pre">vmdk</span> <span class="pre">target.vmdk</span></code>.</p>
<p>KVM can directly use the vmdk file or convert it to qemu format via <code class="docutils literal"><span class="pre">qemu-img</span> <span class="pre">convert</span> <span class="pre">-f</span> <span class="pre">vdi</span> <span class="pre">target.vdi</span> <span class="pre">-O</span> <span class="pre">qcow2</span> <span class="pre">target.qcow2</span></code>. Then create a new VM importing an exising disk image; use either of 2 disk images (vdi or qcow2).</p>
</div>
</div>
<div class="section" id="metasploitable2-setup-vmware-vmdk-to-virtualbox-and-kvm">
<span id="metasploitable2setup"></span><h2>3.1.2. Metasploitable2 Setup - VMware vmdk to VirtualBox and KVM<a class="headerlink" href="#metasploitable2-setup-vmware-vmdk-to-virtualbox-and-kvm" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://sourceforge.net/projects/metasploitable/files/Metasploitable2/">Metasploitable</a>’s 64-bit Ubuntu 8.04 LTS (Hardy Heron) intentionally insecure VMware VM. <a class="reference external" href="http://r-7.co/Metasploitable2">Metasploitable 2 Exploitability Guide</a> describes the vulnerable services. Remember you can login using msfadmin/msfadmin, then <code class="docutils literal"><span class="pre">sudo</span> <span class="pre">-i</span></code> to become root. The DVWA Security page at <a class="reference external" href="http://VULNERABLE/dvwa/security.php">http://VULNERABLE/dvwa/security.php</a> can set the security level to one of low (no protection), medium (inadequate protection), or high (secure).</p>
<p>From the above you can see that no conversion of the VMware vmdk file is necessary to run the vmdk in all three of VMware (obviously), VirtualBox, or KVM. But we can use <code class="docutils literal"><span class="pre">qemu-img</span></code> to convert if we’d like to: <code class="docutils literal"><span class="pre">qemu-img</span></code> via <code class="docutils literal"><span class="pre">qemu-img</span> <span class="pre">convert</span> <span class="pre">-f</span> <span class="pre">vmdk</span> <span class="pre">Metasploitable2.vmdk</span> <span class="pre">-O</span> <span class="pre">vdi</span> <span class="pre">Metasploitable2.vdi</span></code> or <code class="docutils literal"><span class="pre">qemu-img</span> <span class="pre">convert</span> <span class="pre">-f</span> <span class="pre">vmdk</span> <span class="pre">Metasploitable2.vmdk</span> <span class="pre">-O</span> <span class="pre">qcow2</span> <span class="pre">Metasploitable2.qcow2</span></code>.</p>
<p>We’ll illustrate the conversion to KVM using a backing store (keeping the original disk image intact and recording changes to a separate, erasable disk), and solving a powerdown problem. First convert the VMware VM to a qcow2 backing file, then create the writable main disk:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo qemu-img convert -f vmdk Metasploitable.vmdk -O qcow2 Metasploitable.qcow2
sudo qemu-img create -f qcow2 -o <span class="nv">backing_file</span><span class="o">=</span>Metasploitable.qcow2 meta-changes.qcow2
sudo qemu-img info Metasploitable.qcow2
sudo qemu-img info meta-changes.qcow2
</pre></div>
</div>
<p>Next create a new 64-bit VM importing an exising disk image; use the disk meta-changes.qcow2, OS type Linux, Version “Show all OS options”, again select OS type Linux, then Version Ubuntu 8.04 LTS (Hardy Heron); take default memory &amp; CPU; customize configuration before install, making sure the “Disk bus” is SCSI. The KVM VM does not completely power off; to fix this, boot up the VM and as root execute <code class="docutils literal"><span class="pre">echo</span> <span class="pre">&quot;apm</span> <span class="pre">power_off=1&quot;</span> <span class="pre">&gt;&gt;</span> <span class="pre">/etc/modules;</span> <span class="pre">modprobe</span> <span class="pre">apm</span> <span class="pre">power_off=1</span></code>.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="owlnest.html" class="btn btn-neutral float-right" title="3.2. OwlNest" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../pentest_challenges.html" class="btn btn-neutral" title="3. Pentest Challenges" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, bitbender.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>