

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta content="default-src 'none'; script-src 'self' https://cdnjs.cloudflare.com 'unsafe-inline'; connect-src 'self'; img-src 'self'; style-src 'self'; font-src 'self'; form-action 'self'; frame-ancestors 'none'; base-uri 'self'" http-equiv="Content-Security-Policy" />
<meta content="nosniff" http-equiv="X-Content-Type-Options" />
<meta content="deny" http-equiv="X-Frame-Options" />
<meta content="1; mode=block" http-equiv="X-XSS-Protection" />
<meta content="strict-origin" http-equiv="Referrer-Policy" />
<meta content="max-age=31536000; includeSubDomains" http-equiv="Strict-Transport-Security" />
<meta content="'*'" http-equiv="Access-Control-Allow-Origin" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2.4. Kali virtualization &mdash; South Bay WASP 1.0.3 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3. Pentest Challenges" href="../pentest_challenges.html" />
    <link rel="prev" title="2.3. Kali Networking" href="networking.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> South Bay WASP
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pentest_intro.html">1. South Bay WASP Meetup</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../pentest_kali.html">2. Kali Linux</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="debian.html">2.1. Kali is Based on Debian Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">2.2. Kali Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="networking.html">2.3. Kali Networking</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">2.4. Kali virtualization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#no-virtualization-on-an-older-laptop">2.4.1. no virtualization on an older laptop</a></li>
<li class="toctree-l3"><a class="reference internal" href="#linux-lacks-support-for-bridging-wlan0">2.4.2. linux lacks support for bridging wlan0</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#wired-bridging-for-wired-networks">2.4.2.1. wired bridging for wired networks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#problems-adding-wlan0-to-bridge-br0">2.4.2.2. problems adding wlan0 to bridge br0</a></li>
<li class="toctree-l4"><a class="reference internal" href="#there-be-dragons-with-the-4addr-workaround">2.4.2.3. there be dragons with the <code class="docutils literal notranslate"><span class="pre">4addr</span></code> “workaround”</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#so-now-we-re-left-with">2.4.3. so now we’re left with ?</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_challenges.html">3. Pentest Challenges</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_encryption.html">4. Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_html.html">5. HTML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_network_tools.html">6. Pentest Network Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_recon.html">7. Pentest Reconnaisance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_study.html">8. Pentest Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_buffer_overflow.html">9. Pentest Buffer Overflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_scripting.html">10. Pentest scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_presentations.html">11. Pentest Presentations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">South Bay WASP</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../pentest_kali.html">2. Kali Linux</a> &raquo;</li>
        
      <li>2.4. Kali virtualization</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/kali/virtualization.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="kali-virtualization">
<h1>2.4. Kali virtualization<a class="headerlink" href="#kali-virtualization" title="Permalink to this headline">¶</a></h1>
<div class="section" id="no-virtualization-on-an-older-laptop">
<h2>2.4.1. no virtualization on an older laptop<a class="headerlink" href="#no-virtualization-on-an-older-laptop" title="Permalink to this headline">¶</a></h2>
<p>We want to use an older 64-bit Intel-based laptop (without hardware assisted virtualization) to support running VMs at the meetup. The common choices are Xen, VirtualBox, and VMware virtualization. Unfortunately, from <a class="reference external" href="https://en.wikipedia.org/wiki/X86_virtualization#Software-based_virtualization">x86 virtualization - Software-based virtualization</a>:</p>
<blockquote>
<div>Intel did not add segmentation support to its x86-64 implementation (Intel 64), making 64-bit software-only virtualization impossible on Intel CPUs, but Intel VT-x support makes 64-bit hardware assisted virtualization possible on the Intel platform.</div></blockquote>
<p>So running 64-bit VMs is not possible with any of the solutions.</p>
</div>
<div class="section" id="linux-lacks-support-for-bridging-wlan0">
<h2>2.4.2. linux lacks support for bridging wlan0<a class="headerlink" href="#linux-lacks-support-for-bridging-wlan0" title="Permalink to this headline">¶</a></h2>
<p>Since the meetup runs exclusively via wifi, we’d like to run bridged VMs so their IP is on the same wifi subnet as the attendees laptops. With a bridge, attendees would need to configure special route statements during the meetup.</p>
<p>Unfortunately, bridging wiring interfaces is not well-supported in linux.</p>
<div class="section" id="wired-bridging-for-wired-networks">
<h3>2.4.2.1. wired bridging for wired networks<a class="headerlink" href="#wired-bridging-for-wired-networks" title="Permalink to this headline">¶</a></h3>
<p>Debian’s <a class="reference external" href="https://wiki.debian.org/BridgeNetworkConnections">BridgeNetworkConnections</a> describes how to manually set up a bridge using <code class="file docutils literal notranslate"><span class="pre">/etc/network/interfaces</span></code> (taking the interfaces out of Network Manager’s control).</p>
</div>
<div class="section" id="problems-adding-wlan0-to-bridge-br0">
<h3>2.4.2.2. problems adding wlan0 to bridge br0<a class="headerlink" href="#problems-adding-wlan0-to-bridge-br0" title="Permalink to this headline">¶</a></h3>
<p>However, since linux kernel 2.6.33, trying to add a wireless interface to a bridge (<code class="docutils literal notranslate"><span class="pre">brctl</span> <span class="pre">addif</span> <span class="pre">br0</span> <span class="pre">wlan0</span></code>) will get the error message <code class="docutils literal notranslate"><span class="pre">can't</span> <span class="pre">add</span> <span class="pre">wlan0</span> <span class="pre">to</span> <span class="pre">bridge</span> <span class="pre">br0:</span> <span class="pre">Operation</span> <span class="pre">not</span> <span class="pre">supported</span></code>.</p>
</div>
<div class="section" id="there-be-dragons-with-the-4addr-workaround">
<h3>2.4.2.3. there be dragons with the <code class="docutils literal notranslate"><span class="pre">4addr</span></code> “workaround”<a class="headerlink" href="#there-be-dragons-with-the-4addr-workaround" title="Permalink to this headline">¶</a></h3>
<p>Now there’s a potential workaround that mostly doesn’t work: set the wlan0 <code class="docutils literal notranslate"><span class="pre">4addr</span></code> option on via <code class="docutils literal notranslate"><span class="pre">iw</span> <span class="pre">dev</span> <span class="pre">wlan0</span> <span class="pre">set</span> <span class="pre">4addr</span> <span class="pre">on</span></code> then <code class="docutils literal notranslate"><span class="pre">brctl</span> <span class="pre">addif</span> <span class="pre">br0</span> <span class="pre">wlan0</span></code>. From <a class="reference external" href="http://nullroute.eu.org/~grawity/journal.html">VirtualBox bridged network and WLAN</a> (scroll down - you’ll find it):</p>
<blockquote>
<div><p>Bridging wlan0 is a pain. You normally cannot add it to a bridge interface (brctl returns “Operation not permitted”), and using VirtualBox “bridged” filter results in a big mess of ARP and DHCP conflicts. The cause of this is that 802.11 frames contain only three addresses by default: the MAC addresses of both wireless devices (laptop and AP) and of the final recipient (as in Ethernet). It is always assumed that there is only one possible originator.</p>
<p>802.11 can carry the fourth, originator’s MAC address, and this is used in WDS mode by repeaters. This feature can be enabled on Linux too, using iw, and enabling this mode will allow wlan0 to be used in bridge interfaces, as well as with VirtualBox bridged networking:</p>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>iw dev wlan0 <span class="nb">set</span> 4addr on
</pre></div>
</div>
<p>Sounds good, right? Well this author did that at home and turning on <code class="docutils literal notranslate"><span class="pre">4addr</span></code> not only killed the wireless network, the wired network stopped working (not sending the 4’th MAC address). And the post <a class="reference external" href="http://askubuntu.com/questions/155041/bridging-loosing-wlan-network-connection-with-4addr-on-option-why">Bridging: Loosing WLAN network connection with 4addr on option - Why?</a> demonstrates this is not uncommon. Just what the meetup needs - inadvertently doing a denial-of-service attack on our hosts wireless network.</p>
<p>Continuing on from <a class="reference external" href="http://nullroute.eu.org/~grawity/journal.html">VirtualBox bridged network and WLAN</a>:</p>
<blockquote>
<div><p>However, with 4addr enabled, you’re likely to get completely ignored by the AP: association succeeds but all data frames disappear into the ether. This could be for security reasons (because it’s damn hard to spoof the source MAC address. Yeah.) In my router (running OpenRG), it’s necessary to enable “WDS” mode for the wireless AP interface, add a WDS device restricted to my laptop’s MAC address, and add it to the LAN bridge. 4addr packets now work.</p>
<p>There’s another problem with this, though – the router now rejects three-address packets from the laptop, which can be rather inconvenient (having to toggle 4addr every time the WLAN network is changed). The workaround is to add, on the laptop, a second wireless interface linked to the same device, but with a different MAC address. First undo the earlier configuration:</p>
<p>iw dev wlan0 set 4addr off</p>
<p>Then, add a second interface – the name was chosen arbitrarily – with a different MAC address:</p>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>iw dev wlan0 interface add wds.wlan0 <span class="nb">type</span> managed 4addr on
ip link <span class="nb">set</span> dev wds.wlan0 addr &lt;addr&gt;
ip link <span class="nb">set</span> dev wds.wlan0 up

Here &lt;addr&gt; must match the WDS device address configured in the router<span class="p">;</span> other than that, it can be any valid MAC address. The original MAC of wlan0 <span class="k">then</span> remains <span class="k">for</span> <span class="s2">&quot;normal&quot;</span> usage.

It<span class="s1">&#39;s possible to use both wlan0 and wds.wlan0 at the same time – although I&#39;</span>ve only tested associating to the same AP twice, not to different APs. I<span class="s1">&#39;m guessing they would need to at least be on the same channel.</span>

<span class="s1">(Update: Some people have asked me why I wrote this when VirtualBox can bridge WiFi &quot;just fine&quot;. The answer is that VirtualBox does not send the virtual machines&#39;</span> MAC addresses<span class="p">;</span> rather, it performs NAT at the MAC layer too. – <span class="m">2014</span>-08-22<span class="o">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="so-now-we-re-left-with">
<h2>2.4.3. so now we’re left with ?<a class="headerlink" href="#so-now-we-re-left-with" title="Permalink to this headline">¶</a></h2>
<p>The above problem is a Linux issue that neither KVM nor Xen will solve. Eventually we may attempt to see if a workaround using a second interface (outlined above) might work, but we just want to run VMs, not set up a networking project.</p>
<p>For now, VirtualBox running just 1 VM on a modern laptop with hardware virtualization support is being used.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../pentest_challenges.html" class="btn btn-neutral float-right" title="3. Pentest Challenges" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="networking.html" class="btn btn-neutral" title="2.3. Kali Networking" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, bitbender.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.3',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>