

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta content="default-src 'none'; script-src 'self' https://cdnjs.cloudflare.com 'unsafe-inline'; connect-src 'self'; img-src 'self'; style-src 'self'; font-src 'self'; form-action 'self'; frame-ancestors 'none'; base-uri 'self'" http-equiv="Content-Security-Policy" />
<meta content="nosniff" http-equiv="X-Content-Type-Options" />
<meta content="deny" http-equiv="X-Frame-Options" />
<meta content="1; mode=block" http-equiv="X-XSS-Protection" />
<meta content="strict-origin" http-equiv="Referrer-Policy" />
<meta content="max-age=31536000; includeSubDomains" http-equiv="Strict-Transport-Security" />
<meta content="'*'" http-equiv="Access-Control-Allow-Origin" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>10.2. Python &mdash; South Bay WASP 1.0.3 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="10.3. Scraping with Beautiful Soup" href="scraping_soup.html" />
    <link rel="prev" title="10.1. bash" href="bash.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> South Bay WASP
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pentest_intro.html">1. South Bay WASP Meetup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_kali.html">2. Kali Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_challenges.html">3. Pentest Challenges</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_encryption.html">4. Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_html.html">5. HTML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_network_tools.html">6. Pentest Network Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_recon.html">7. Pentest Reconnaisance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_study.html">8. Pentest Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_buffer_overflow.html">9. Pentest Buffer Overflow</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../pentest_scripting.html">10. Pentest scripting</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="bash.html">10.1. <code class="docutils literal notranslate"><span class="pre">bash</span></code></a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">10.2. Python</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#documentation">10.2.1. Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-python-for-virtual-environments">10.2.2. Setting up Python for virtual environments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#virtual-environments">10.2.2.1. Virtual environments</a></li>
<li class="toctree-l4"><a class="reference internal" href="#virtual-environments-via-pip-and-venv">10.2.2.2. Virtual environments via <code class="docutils literal notranslate"><span class="pre">pip</span></code> and <code class="docutils literal notranslate"><span class="pre">venv</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#virtual-environments-via-anaconda-and-conda">10.2.2.3. Virtual environments via Anaconda and <code class="docutils literal notranslate"><span class="pre">conda</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#virtual-environments-via-miniconda-and-conda">10.2.2.4. Virtual environments via Miniconda and <code class="docutils literal notranslate"><span class="pre">conda</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#pip-requirements-txt-vs-conda-environment-yml">10.2.2.5. <code class="docutils literal notranslate"><span class="pre">pip</span></code> <code class="file docutils literal notranslate"><span class="pre">requirements.txt</span></code> vs <code class="docutils literal notranslate"><span class="pre">conda</span></code> <code class="file docutils literal notranslate"><span class="pre">environment.yml</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#language-basics">10.2.3. Language basics</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pep-394-attempt-for-portability-of-python-across-nix">10.2.3.1. PEP 394 attempt for portability of Python across *nix</a></li>
<li class="toctree-l4"><a class="reference internal" href="#command-line-arguments">10.2.3.2. Command line arguments</a></li>
<li class="toctree-l4"><a class="reference internal" href="#unicode">10.2.3.3. unicode</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#csv-processing">10.2.4. CSV processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#logging-howto">10.2.5. Logging HOWTO</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="scraping_soup.html">10.3. Scraping with Beautiful Soup</a></li>
<li class="toctree-l2"><a class="reference internal" href="scraping_scrapy.html">10.4. Scraping with Scrapy</a></li>
<li class="toctree-l2"><a class="reference internal" href="internet_data.html">10.5. Internet data</a></li>
<li class="toctree-l2"><a class="reference internal" href="networking.html">10.6. Networking</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_presentations.html">11. Pentest Presentations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">South Bay WASP</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../pentest_scripting.html">10. Pentest scripting</a> &raquo;</li>
        
      <li>10.2. Python</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/scripting/python.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id21">
<h1>10.2. Python<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h1>
<p>This is for Python language-specific topics; actual use of Python to parse data, … is covered in other sections.</p>
<div class="section" id="documentation">
<h2>10.2.1. Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h2>
<p>Start with <a class="reference external" href="https://docs.python.org/3/">Python</a>.</p>
<p>Then setup virtual environments either via pure Python (<a class="reference internal" href="#setup-venv"><span class="std std-ref">Virtual environments via pip and venv</span></a>) or Miniconda/conda (<a class="reference internal" href="#setup-miniconda"><span class="std std-ref">Virtual environments via Miniconda and conda</span></a>).</p>
<p>Then use some of the <a class="reference external" href="https://github.com/dloss/python-pentest-tools">Python tools for penetration testers</a>.</p>
</div>
<div class="section" id="setting-up-python-for-virtual-environments">
<h2>10.2.2. Setting up Python for virtual environments<a class="headerlink" href="#setting-up-python-for-virtual-environments" title="Permalink to this headline">¶</a></h2>
<div class="section" id="virtual-environments">
<h3>10.2.2.1. Virtual environments<a class="headerlink" href="#virtual-environments" title="Permalink to this headline">¶</a></h3>
<div class="section" id="two-python-problems">
<h4>10.2.2.1.1. Two Python problems<a class="headerlink" href="#two-python-problems" title="Permalink to this headline">¶</a></h4>
<p>If you use enough different Python-based tools you’ll run into these 2 problems:</p>
<ul>
<li><p class="first">Python 2 vs Python 3</p>
<p>Some Python requires the use of Python 2, some Python 3. For example, publishing this website uses Python 2 for running a local Google App Engine Standard Environment while the Sphinx authoring software is run using Python 3.</p>
<p>And slowly, the Python world is <a class="reference external" href="http://www.python3statement.org/">Moving to require Python 3</a>:</p>
<blockquote>
<div><p>The developers of the Python language extended support of Python 2.7 from 2015 to 2020, recognising that many people were still using Python 2. We believe that the extra 5 years is sufficient to transition off of Python 2, and our projects plan to stop supporting Python 2 when upstream support ends in 2020, if not before.</p>
</div></blockquote>
</li>
<li><p class="first">Python package version incompatibilities</p>
<p>Even within Python 2 or 3, there are backward-incompatible modules. If you are running Linux the official packages should be internally compatible, but often not the latest. For example, Debian 9 has Scrapy version 1.0.3-2 but the latest samples from the Scrapy website uses 1.4. This leads to the sample Scrapy programs failing on Debian 9 due to the old Scrapy version.</p>
</li>
</ul>
<p>These problems can be solved with a virtual environment. From <a class="reference external" href="https://uoa-eresearch.github.io/eresearch-cookbook/recipe/2014/11/20/conda/">Create virtual environments for python with conda</a>:</p>
<blockquote>
<div>A virtual environment is a named, isolated, working copy of Python that maintains its own files, directories, and paths so that you can work with specific versions of libraries or Python itself without affecting other Python projects. Virtual environments make it easy to cleanly separate different projects and avoid problems with different dependencies and version requirements across components.</div></blockquote>
</div>
<div class="section" id="virtual-environment-options">
<h4>10.2.2.1.2. Virtual environment options<a class="headerlink" href="#virtual-environment-options" title="Permalink to this headline">¶</a></h4>
<p>So how to create virtual environments?</p>
<p>We’ll ignore the OS-specific and heavier virtualization options like LXC (Linux containters), Docker, and OS virtualization (VMware, VirtualBox, KVM, Xen, …).</p>
<p>Here are 3 lightweight virtual environment options (of which Miniconda/conda is the the author’s personal favorite):</p>
<ul>
<li><p class="first">The pure Python way</p>
<p><code class="docutils literal notranslate"><span class="pre">pip</span></code> is used to install packages and <cite>python -m venv PATH4ENVIRONMENT</cite> to create environments. See <a class="reference external" href="https://docs.python.org/3/library/venv.html">28.3. venv — Creation of virtual environments</a> for an introduction.</p>
<ul>
<li><p class="first">Advantages</p>
<p>Pure Python with no external dependencies. <code class="docutils literal notranslate"><span class="pre">pip</span></code> and <code class="docutils literal notranslate"><span class="pre">venv</span></code> are built into all modern Python releases: <code class="docutils literal notranslate"><span class="pre">pip</span></code> is Python 2 &gt;= 2.7.9 and Python 3 &gt;= 3.4; <code class="docutils literal notranslate"><span class="pre">venv</span></code> is Python &gt;= 3.3.</p>
</li>
<li><p class="first">Disadvantages</p>
<p><code class="docutils literal notranslate"><span class="pre">venv</span></code> cannot default to Python 2, a serious shortcoming.</p>
<p>Some <code class="docutils literal notranslate"><span class="pre">pip</span></code> package installs require a C compiler and 3rd party libraries. That is undesirable on servers and burdensome on Windows. (However, Christoph Gohike’s <a class="reference external" href="http://www.lfd.uci.edu/~gohlke/pythonlibs/">Unofficial Windows Binaries for Python Extension Packages</a> provides many pre-compiled packages.)</p>
<p>No management of virtual environments: try getting a list of them. They’re just a bunch of directories spread throughout the filesystem.</p>
</li>
</ul>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">pip</span></code> with <cite>virtualenv</cite> and <cite>virtualenvwrapper</cite> (instead of <code class="docutils literal notranslate"><span class="pre">venv</span></code>)</p>
<p>For an introduction to this approach see <a class="reference external" href="http://python-guide-pt-br.readthedocs.io/en/latest/dev/virtualenvs/">Virtual Environments</a> and/or <a class="reference external" href="https://realpython.com/blog/python/python-virtual-environments-a-primer/">Python Virtual Environments - a Primer</a>.</p>
<ul>
<li><p class="first">Advantages</p>
<p>Python 2 environments are supported.</p>
<p><cite>virtualenvwrapper</cite> manages virtual environments.</p>
</li>
<li><p class="first">Disadvantages</p>
<p>The <code class="docutils literal notranslate"><span class="pre">pip</span></code>-related issues still remain.</p>
<p>Windows-specific support required for <cite>virtualenvwrapper</cite>: <a class="reference external" href="https://github.com/davidmarble/virtualenvwrapper-win">virtualenvwrapper-win</a> allows <cite>virtualenvwrapper</cite> to run in a regular command prompt. There are other solutions for running in Windows PowerShell.</p>
</li>
</ul>
</li>
<li><p class="first">Using <code class="docutils literal notranslate"><span class="pre">conda</span></code> either via Anaconda or Miniconda.</p>
<p><code class="docutils literal notranslate"><span class="pre">conda</span></code> replaces <code class="docutils literal notranslate"><span class="pre">pip</span></code>, <cite>virtualenv</cite>, and <cite>virtualenvwrapper</cite> (plus it’s not limited to Python). For choosing between Anaconda for Miniconda, see <a class="reference external" href="https://conda.io/docs/download.html#should-i-download-anaconda-or-miniconda">Should I download Anaconda or Miniconda?</a>.</p>
<p>See <a class="reference external" href="https://conda.io/docs/get-started.html">Conda Get started</a> for more information. For a simple how-to see <a class="reference external" href="https://uoa-eresearch.github.io/eresearch-cookbook/recipe/2014/11/20/conda/">Create virtual environments for python with conda</a>. For an extensive introduction see <a class="reference external" href="https://www.continuum.io/blog/developer-blog/python-packages-and-environments-conda">PYTHON PACKAGES AND ENVIRONMENTS WITH CONDA</a>. Also see <a class="reference external" href="https://jakevdp.github.io/blog/2016/08/25/conda-myths-and-misconceptions/">Conda: Myths and Misconceptions</a>.</p>
<ul>
<li><p class="first">Advantages</p>
<p>Easiest option, especially on Windows.</p>
<p>Package installation does not require compilation.</p>
<p>Can still use <code class="docutils literal notranslate"><span class="pre">pip</span></code> where required via <cite>conda install pip</cite> in your conda environment.</p>
</li>
<li><p class="first">Disadvantages</p>
<p>Not pure Python.</p>
</li>
</ul>
</li>
</ul>
<p>All of the above are viable options, but the author prefers <code class="docutils literal notranslate"><span class="pre">conda</span></code> via Miniconda (or Anaconda if you have the disk space). The pure Python approach for systems you don’t want to install Anaconda/Miniconda. (However, you can install <code class="docutils literal notranslate"><span class="pre">conda</span></code> without adding it to the default path. That way it only impacts the system when a virtual environment is activated.)</p>
<p>For a short comparison of commands, see <a class="reference external" href="https://conda.io/docs/_downloads/conda-pip-virtualenv-translator.html">conda vs. pip vs. virtualenv</a>.</p>
</div>
</div>
<div class="section" id="virtual-environments-via-pip-and-venv">
<span id="setup-venv"></span><h3>10.2.2.2. Virtual environments via <code class="docutils literal notranslate"><span class="pre">pip</span></code> and <code class="docutils literal notranslate"><span class="pre">venv</span></code><a class="headerlink" href="#virtual-environments-via-pip-and-venv" title="Permalink to this headline">¶</a></h3>
<p>In a Debian 9 install the following was required to use pip and venv:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># The wheel package must be compiled so needs the following packages.</span>
sudo apt install build-essential libssl-dev libffi-dev python-dev python3-venv -y
<span class="c1"># You might want to sudo the following commands (if for all users).</span>
sudo pip install -U pip setuptools wheel
<span class="c1"># sudo pip3 install -U pip setuptools wheel</span>
</pre></div>
</div>
<p>To use pip and venv to set up a virtual environment (for example, one with Scrapy):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span>
python3 -m venv ~/scraping
<span class="nb">cd</span> scraping
<span class="nb">source</span> bin/activate
pip install -U pip setuptools wheel
pip install -U Scrapy

<span class="c1"># Do lots of Scrapy stuff.</span>
<span class="c1"># When done ...</span>
deactivate

<span class="c1"># To delete the venv - assuming no files needed there anymore</span>
<span class="c1"># cd</span>
<span class="c1"># rm -rf ~/scraping</span>
</pre></div>
</div>
</div>
<div class="section" id="virtual-environments-via-anaconda-and-conda">
<h3>10.2.2.3. Virtual environments via Anaconda and <code class="docutils literal notranslate"><span class="pre">conda</span></code><a class="headerlink" href="#virtual-environments-via-anaconda-and-conda" title="Permalink to this headline">¶</a></h3>
<p>Here is how to use Anaconda in Debian 9.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Per-user one-time installation</span>
<span class="nb">cd</span>
mkdir -p setup
<span class="nb">cd</span> setup
curl -L -o Anaconda3-4.4.0-Linux-x86_64.sh  https://repo.continuum.io/archive/Anaconda3-4.4.0-Linux-x86_64.sh
bash Anaconda3-4.4.0-Linux-x86_64.sh
<span class="c1"># Enter</span>
<span class="c1"># q</span>
<span class="c1"># yes</span>
<span class="c1"># Enter</span>
<span class="c1"># ...</span>
<span class="c1"># yes</span>
<span class="nb">exit</span>  <span class="c1"># and login again to get ~/.bashrc with anaconda in path</span>

<span class="c1"># To uninstall anaconda</span>
<span class="c1"># rm -rf ~/anaconda</span>
<span class="c1"># rm -rf ~/.condarc ~/.conda ~/.continuum</span>
<span class="c1"># sed -i &#39;/[Aa]naconda/d&#39; ~/.bashrc</span>

<span class="c1"># Periodic updates</span>
conda update conda

<span class="c1"># For each environment to create:</span>
<span class="c1"># List environments, then add one for Scrapy and another for</span>
conda env list
conda create --name scraping <span class="nv">python</span><span class="o">=</span><span class="m">3</span> scrapy -y

<span class="c1"># To use an environment</span>
<span class="nb">source</span> activate scraping
<span class="c1"># If you need to install more packages in the environment:</span>
conda install sphinx
<span class="c1"># Do lots of scrapy stuff ...</span>

<span class="c1"># To deactivate an active environment</span>
<span class="nb">source</span> deactivate
<span class="c1"># If the environment is not longer needed</span>
<span class="c1"># conda remove --name scraping --all</span>
</pre></div>
</div>
</div>
<div class="section" id="virtual-environments-via-miniconda-and-conda">
<span id="setup-miniconda"></span><h3>10.2.2.4. Virtual environments via Miniconda and <code class="docutils literal notranslate"><span class="pre">conda</span></code><a class="headerlink" href="#virtual-environments-via-miniconda-and-conda" title="Permalink to this headline">¶</a></h3>
<p>Here is how to use Miniconda in Debian 9. Note that conda-forge had to be manually added via <cite>conda config –add channels conda-forge</cite> but not in Anaconda.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Installation</span>
<span class="nb">cd</span>
mkdir -p setup
<span class="nb">cd</span> setup
curl -L -o Miniconda3-latest-Linux-x86_64.sh  https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh
bash Miniconda3-latest-Linux-x86_64.sh
<span class="c1"># Enter</span>
<span class="c1"># q</span>
<span class="c1"># yes</span>
<span class="c1"># Enter</span>
<span class="c1"># ...</span>
<span class="c1"># yes</span>
<span class="nb">exit</span>  <span class="c1"># and login again to get ~/.bashrc with anaconda in path</span>

<span class="c1"># To uninstall Miniconda</span>
<span class="c1"># rm -rf ~/miniconda3</span>
<span class="c1"># rm -rf ~/.condarc ~/.conda ~/.continuum</span>
<span class="c1"># sed -i &#39;/[Mm]iniconda3/d&#39; ~/.bashrc</span>

<span class="c1"># Ensure conda-forge added to channels</span>
conda config --add channels conda-forge
<span class="c1"># Periodic updates</span>
conda update conda

<span class="c1"># For each environment to create:</span>
<span class="c1"># List environments, then add one for Scrapy and another for</span>
conda env list
conda create --name scraping <span class="nv">python</span><span class="o">=</span><span class="m">3</span> scrapy -y

<span class="c1"># To use an environment</span>
<span class="nb">source</span> activate scraping
<span class="c1"># If you need to install more packages in the environment:</span>
conda install sphinx
<span class="c1"># Do lots of scrapy stuff ...</span>

<span class="c1"># To deactivate an active environment</span>
<span class="nb">source</span> deactivate
<span class="c1"># If the environment is not longer needed</span>
<span class="c1"># conda remove --name scraping --all</span>
</pre></div>
</div>
<div class="section" id="usr-bin-python-breaks-environments">
<h4>10.2.2.4.1. <code class="docutils literal notranslate"><span class="pre">#!/usr/bin/python</span></code> breaks environments<a class="headerlink" href="#usr-bin-python-breaks-environments" title="Permalink to this headline">¶</a></h4>
<p>Of course <code class="docutils literal notranslate"><span class="pre">#!/usr/bin/python</span></code> (but not <code class="docutils literal notranslate"><span class="pre">#!/usr/bin/env</span> <span class="pre">python</span></code>) breaks environments.</p>
<p>First a demo using <code class="docutils literal notranslate"><span class="pre">conda</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Python versions w/o virtual env</span>
python -V
python2 -V
python3 -V
/usr/bin/python -V
/usr/bin/python2 -V
/usr/bin/python3 -V

<span class="c1"># Create python3 virtual env</span>
conda create --name pytest <span class="nv">python</span><span class="o">=</span><span class="m">3</span> -y
<span class="nb">source</span> activate pytest

<span class="c1"># Python versions with virtual env</span>
python -V
python2 -V
python3 -V
/usr/bin/python -V
/usr/bin/python2 -V
/usr/bin/python3 -V

<span class="c1"># #! override of Python</span>
cat &gt;changepy1.py <span class="s">&lt;&lt;&#39;EOF&#39;</span>
<span class="s">#!/usr/bin/python</span>
<span class="s">import sys</span>
<span class="s">print(&#39;Python version:&#39;, sys.version_info)</span>
<span class="s">EOF</span>
cat &gt;changepy2.py <span class="s">&lt;&lt;&#39;EOF&#39;</span>
<span class="s">#!/usr/bin/env python</span>
<span class="s">import sys</span>
<span class="s">print(&#39;Python version:&#39;, sys.version_info)</span>
<span class="s">EOF</span>

<span class="c1"># #! is ignored</span>
python changepy1.py
python changepy2.py

<span class="c1"># #!/usr/bin/python force to OS version of Python</span>
chmod +x changepy1.py
./changepy1.py
<span class="c1"># #!/usr/bin/env python uses virtual env version of Python</span>
chmod +x changepy2.py
./changepy2.py

<span class="c1"># Get rid of virt env</span>
<span class="nb">source</span> deactivate
conda remove --name pytest --all -y
rm changepy<span class="o">[</span><span class="m">12</span><span class="o">]</span>.py
</pre></div>
</div>
<p>Next a demo using pure Python:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Python versions w/o virtual env</span>
python -V
python2 -V
python3 -V
/usr/bin/python -V
/usr/bin/python2 -V
/usr/bin/python3 -V

<span class="c1"># Create python3 virtual env</span>
python3 -m venv pytest
<span class="nb">cd</span> pytest
<span class="nb">source</span> bin/activate

<span class="c1"># Python versions with virtual env</span>
python -V
python2 -V
python3 -V
/usr/bin/python -V
/usr/bin/python2 -V
/usr/bin/python3 -V

<span class="c1"># #! override of Python</span>
cat &gt;changepy1.py <span class="s">&lt;&lt;&#39;EOF&#39;</span>
<span class="s">#!/usr/bin/python</span>
<span class="s">import sys</span>
<span class="s">print(&#39;Python version:&#39;, sys.version_info)</span>
<span class="s">EOF</span>
cat &gt;changepy2.py <span class="s">&lt;&lt;&#39;EOF&#39;</span>
<span class="s">#!/usr/bin/env python</span>
<span class="s">import sys</span>
<span class="s">print(&#39;Python version:&#39;, sys.version_info)</span>
<span class="s">EOF</span>

<span class="c1"># #! is ignored</span>
python changepy1.py
python changepy2.py

<span class="c1"># #!/usr/bin/python force to OS version of Python</span>
chmod +x changepy1.py
./changepy1.py
<span class="c1"># #!/usr/bin/env python uses virtual env version of Python</span>
chmod +x changepy2.py
./changepy2.py

<span class="c1"># Get rid of virt env</span>
<span class="nb">cd</span> ..
deactivate
rm -rf pytest
</pre></div>
</div>
</div>
</div>
<div class="section" id="pip-requirements-txt-vs-conda-environment-yml">
<h3>10.2.2.5. <code class="docutils literal notranslate"><span class="pre">pip</span></code> <code class="file docutils literal notranslate"><span class="pre">requirements.txt</span></code> vs <code class="docutils literal notranslate"><span class="pre">conda</span></code> <code class="file docutils literal notranslate"><span class="pre">environment.yml</span></code><a class="headerlink" href="#pip-requirements-txt-vs-conda-environment-yml" title="Permalink to this headline">¶</a></h3>
<p>Both <code class="docutils literal notranslate"><span class="pre">pip</span></code> and <code class="docutils literal notranslate"><span class="pre">conda</span></code> allow capturing and reproducing environments easily.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">pip</span></code>, read the short sections <a class="reference external" href="https://pip.pypa.io/en/stable/user_guide/#requirements-files">Requirements Files</a> and <a class="reference external" href="https://pip.pypa.io/en/stable/user_guide/#constraints-files">Constraints Files</a>.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">conda</span></code> read <a class="reference external" href="https://conda.io/docs/using/envs.html#share-an-environment">Share an environment</a>. <a class="reference external" href="http://tdhopper.com/blog/2015/Nov/24/my-python-environment-workflow-with-conda/">My Python Environment Workflow with Conda</a> is an example of someone’s workflow using <cite>environment.yml</cite>.</p>
</div>
</div>
<div class="section" id="language-basics">
<h2>10.2.3. Language basics<a class="headerlink" href="#language-basics" title="Permalink to this headline">¶</a></h2>
<div class="section" id="pep-394-attempt-for-portability-of-python-across-nix">
<h3>10.2.3.1. PEP 394 attempt for portability of Python across *nix<a class="headerlink" href="#pep-394-attempt-for-portability-of-python-across-nix" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://www.python.org/dev/peps/pep-0394/">PEP 394 – The “python” Command on Unix-Like Systems</a> attempts to allow portability of Python across *nix systems:</p>
<blockquote>
<div><ul class="simple">
<li>python2 will refer to some version of Python 2.x.</li>
<li>python3 will refer to some version of Python 3.x.</li>
<li>for the time being, all distributions should ensure that python refers to the same target as python2.</li>
<li>however, end users should be aware that python refers to python3 on at least Arch Linux (that change is what prompted the creation of this PEP), so python should be used in the shebang line only for scripts that are source compatible with both Python 2 and 3.</li>
<li>in preparation for an eventual change in the default version of Python, Python 2 only scripts should either be updated to be source compatible with Python 3 or else to use python2 in the shebang line.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="command-line-arguments">
<h3>10.2.3.2. Command line arguments<a class="headerlink" href="#command-line-arguments" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference external" href="https://docs.python.org/3/library/argparse.html">16.4. argparse — Parser for command-line options, arguments and sub-commands</a> and the <a class="reference external" href="https://docs.python.org/3/howto/argparse.html">Argparse Tutorial</a></p>
</div>
<div class="section" id="unicode">
<h3>10.2.3.3. unicode<a class="headerlink" href="#unicode" title="Permalink to this headline">¶</a></h3>
<p>Read <a class="reference external" href="https://docs.python.org/3/howto/unicode.html">Unicode HOWTO</a>. Also <a class="reference external" href="http://www.unicode.org/reports/tr17/">Unicode Technical Report #17 UNICODE CHARACTER ENCODING MODEL</a> is useful, especially <a class="reference external" href="http://www.unicode.org/reports/tr17/#CharactersVsGlyphs">2.2 Characters versus Glyphs</a>, <a class="reference external" href="http://www.unicode.org/reports/tr17/#CodeSpaces">3.2 Code Spaces</a>, <a class="reference external" href="http://www.unicode.org/reports/tr17/#CharacterEncodingForm">4 Character Encoding Form (CEF)</a>, and <a class="reference external" href="http://www.unicode.org/reports/tr17/#CharacterEncodingScheme">5 Character Encoding Scheme (CES)</a>.</p>
<p>To convert between <strong>character</strong>/<strong>glyph</strong>, <strong>code point</strong>, and <strong>encoding</strong> we’ll run the following (reproduced here so you can cut-and-paste them easily for your own run). <code class="docutils literal notranslate"><span class="pre">ord</span></code> gets the unicode code point for a character; <code class="docutils literal notranslate"><span class="pre">hex</span></code> converts an integer to a hex string; <code class="docutils literal notranslate"><span class="pre">chr</span></code> converts an integer code point to a character; and <code class="docutils literal notranslate"><span class="pre">map</span></code> allows you to apply a function to an interable item like a string (so <code class="docutils literal notranslate"><span class="pre">map(ord,s)</span></code> applys <code class="docutils literal notranslate"><span class="pre">ord</span></code> to get the code point for each character in the string <cite>s</cite>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span>
<span class="c1"># Define a unicode string including 2 non-latin1 characters.</span>
<span class="c1">#   To display the characters a particular glyph must be used.</span>
<span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;abc 123 ¾ ¶&quot;</span>

<span class="c1"># Get list of code points for string s</span>
<span class="n">cp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">ord</span><span class="p">,</span><span class="n">s</span><span class="p">))</span>
<span class="c1"># Look at the hex values</span>
<span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">hex</span><span class="p">,</span> <span class="n">cp</span><span class="p">))</span>
<span class="c1"># Convert them back to characters as a check</span>
<span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">chr</span><span class="p">,</span> <span class="n">cp</span><span class="p">))</span>

<span class="c1"># Convert to utf-8 and back again</span>
<span class="n">e8</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf_8&quot;</span><span class="p">)</span>
<span class="n">e8</span>
<span class="n">e8</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf_8&quot;</span><span class="p">)</span>

<span class="c1"># Convert to utf-16 and back again</span>
<span class="c1">#   Encoding adds  U+FEFF byte order mark (BOM)</span>
<span class="c1">#   Little endian order shows as 0xFF followed by 0xFE (Intel)</span>
<span class="c1">#   Big endian order shows as 0xFE followed by 0xFF</span>
<span class="c1">#</span>
<span class="n">e16</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf_16&quot;</span><span class="p">)</span>
<span class="n">e16</span>
<span class="n">e16</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf_16&quot;</span><span class="p">)</span>
<span class="c1"># See what happens when decode using the wrong encoding</span>
<span class="n">e16</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf_8&quot;</span><span class="p">)</span>
<span class="n">quit</span><span class="p">()</span>
</pre></div>
</div>
<p>Running these gives:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="go">hacker@kali:~$ python3</span>
<span class="go">###################### SNIP ######################</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Define a unicode string including 2 non-latin1 characters</span>
<span class="gp">... </span><span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;abc 123 ¾ ¶&quot;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Get list of code points for string s</span>
<span class="gp">... </span><span class="n">cp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">ord</span><span class="p">,</span><span class="n">s</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Look at the hex values</span>
<span class="gp">... </span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">hex</span><span class="p">,</span> <span class="n">cp</span><span class="p">))</span>
<span class="go">[&#39;0x61&#39;, &#39;0x62&#39;, &#39;0x63&#39;, &#39;0x20&#39;, &#39;0x31&#39;, &#39;0x32&#39;, &#39;0x33&#39;, &#39;0x20&#39;, &#39;0xbe&#39;, &#39;0x20&#39;, &#39;0xb6&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Convert them back to characters as a check</span>
<span class="gp">... </span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">chr</span><span class="p">,</span> <span class="n">cp</span><span class="p">))</span>
<span class="go">&#39;abc 123 ¾ ¶&#39;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Convert to utf-8 and back again</span>
<span class="gp">... </span><span class="n">e8</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf_8&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e8</span>
<span class="go">b&#39;abc 123 \xc2\xbe \xc2\xb6&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e8</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf_8&quot;</span><span class="p">)</span>
<span class="go">&#39;abc 123 ¾ ¶&#39;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Convert to utf-16 and back again</span>
<span class="gp">... </span><span class="c1">#   Encoding adds  U+FEFF byte order mark (BOM)</span>
<span class="gp">... </span><span class="c1">#   Little endian order shows as 0xFF followed by 0xFE (Intel)</span>
<span class="gp">... </span><span class="c1">#   Big endian order shows as 0xFE followed by 0xFF</span>
<span class="gp">... </span><span class="c1">#</span>
<span class="gp">... </span><span class="n">e16</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf_16&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e16</span>
<span class="go">b&#39;\xff\xfea\x00b\x00c\x00 \x001\x002\x003\x00 \x00\xbe\x00 \x00\xb6\x00&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e16</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf_16&quot;</span><span class="p">)</span>
<span class="go">&#39;abc 123 ¾ ¶&#39;</span>
<span class="go"># See what happens when decode using the wrong encoding</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e16</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf_8&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">UnicodeDecodeError</span>: <span class="n">&#39;utf-8&#39; codec can&#39;t decode byte 0xff in position 0: invalid start byte</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">quit</span><span class="p">()</span>
<span class="go">hacker@kali:~$</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="csv-processing">
<h2>10.2.4. CSV processing<a class="headerlink" href="#csv-processing" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://docs.python.org/3/library/csv.html">csv</a> simplifies reading &amp; writing spreadsheet-like files. Here is writing then reading a spreadsheet:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">csv</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Demo to create tab-separated file then read it in&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;tsv&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;tsv file to create&quot;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="c1"># create tab-separated file, csv.excel_tab has \r\n line endings</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">tsv</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
    <span class="n">csv_writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">dialect</span><span class="o">=</span><span class="n">csv</span><span class="o">.</span><span class="n">excel_tab</span><span class="p">,</span> <span class="n">escapechar</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span>
                              <span class="n">quoting</span><span class="o">=</span><span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_NONE</span><span class="p">)</span>
    <span class="n">csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">((</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">))</span>
    <span class="n">csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">((</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">))</span>
<span class="c1"># read/print the created file</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">tsv</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
    <span class="n">csv_reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">dialect</span><span class="o">=</span><span class="n">csv</span><span class="o">.</span><span class="n">excel_tab</span><span class="p">,</span> <span class="n">escapechar</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">csv_reader</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
<p>Be sure to review “Dialects and Formatting Parameters”.</p>
</div>
<div class="section" id="logging-howto">
<h2>10.2.5. Logging HOWTO<a class="headerlink" href="#logging-howto" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://docs.python.org/3/howto/logging.html">Logging HOWTO</a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="scraping_soup.html" class="btn btn-neutral float-right" title="10.3. Scraping with Beautiful Soup" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="bash.html" class="btn btn-neutral" title="10.1. bash" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, bitbender.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.3',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>