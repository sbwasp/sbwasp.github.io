

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>11.6. 2017-09-02 Adding IPv6 on the EdgeRouter Lite &mdash; South Bay WASP 1.0.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="South Bay WASP 1.0.2 documentation" href="../index.html"/>
        <link rel="up" title="11. Pentest Presentations" href="../pentest_presentations.html"/>
        <link rel="prev" title="11.5. 2017-08-26 Complexity, Cookies vs Tokens" href="20170826_presentation.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> South Bay WASP
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pentest_intro.html">1. South Bay WASP Meetup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_kali.html">2. Kali Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_challenges.html">3. Pentest Challenges</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_encryption.html">4. Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_html.html">5. HTML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_network_tools.html">6. Pentest Network Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_recon.html">7. Pentest Reconnaisance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_study.html">8. Pentest Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_buffer_overflow.html">9. Pentest Buffer Overflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_scripting.html">10. Pentest scripting</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../pentest_presentations.html">11. Pentest Presentations</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="mitm.html">11.1. MitM Presentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="http_headers.html">11.2. 2017-08-05 Attacking via HTTP Headers</a></li>
<li class="toctree-l2"><a class="reference internal" href="20170812_presentation.html">11.3. 2017-08-12 VRT, cryptography, TLS 1.3, Broadpwn, cURL, and phishing</a></li>
<li class="toctree-l2"><a class="reference internal" href="20170819_presentation.html">11.4. 2017-08-19 Forcing HTTPS, HTTP forwarding</a></li>
<li class="toctree-l2"><a class="reference internal" href="20170826_presentation.html">11.5. 2017-08-26 Complexity, Cookies vs Tokens</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">11.6. 2017-09-02 Adding IPv6 on the EdgeRouter Lite</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">11.6.1. Adding IPv6 on the EdgeRouter Lite</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ipv6">11.6.1.1. IPv6</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pre-firewall-setup">11.6.1.2. Pre-firewall setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#firewall-overview">11.6.1.3. Firewall overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#firewall-rulesets">11.6.1.4. Firewall rulesets</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">South Bay WASP</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../pentest_presentations.html">11. Pentest Presentations</a> &raquo;</li>
        
      <li>11.6. 2017-09-02 Adding IPv6 on the EdgeRouter Lite</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/presentations/20170902_presentation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="adding-ipv6-on-the-edgerouter-lite">
<h1>11.6. 2017-09-02 Adding IPv6 on the EdgeRouter Lite<a class="headerlink" href="#adding-ipv6-on-the-edgerouter-lite" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id1">
<h2>11.6.1. Adding IPv6 on the EdgeRouter Lite<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Want to implement IPv6? From a server perspective, a <a class="reference external" href="https://www.ubnt.com/edgemax/edgerouter-lite/">Ubiquiti EdgeRouter Lite</a> firewall is configured to accept a /56 IPv6 <a class="reference external" href="https://en.wikipedia.org/wiki/Prefix_delegation">Prefix delegation</a> from Spectrum Internet and distribute the addresses across 2 internal networks using SLAAC. <a class="reference external" href="http://www.thekelleys.org.uk/dnsmasq/doc.html">dnsmasq</a> (a caching DNS/DHCP server) is configured to provide DHCPv6 options via stateless DHCPv6. From a client perspective, IPv6-capable clients automatically get IPv6 addresses via SLAAC, and get DNS/NTP server options from stateless DHCPv6 via dnsmasq.</p>
<div class="section" id="ipv6">
<h3>11.6.1.1. IPv6<a class="headerlink" href="#ipv6" title="Permalink to this headline">¶</a></h3>
<p>Review and understand <a class="reference external" href="https://en.wikipedia.org/wiki/IPv6">IPv6 address</a> prior to digging in the details below.</p>
<div class="section" id="adding-ipv6-not-replacing-ipv4">
<h4>11.6.1.1.1. Adding IPv6, not replacing IPv4<a class="headerlink" href="#adding-ipv6-not-replacing-ipv4" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">IPv4 is not going away anytime soon.</p>
<p>IPv6 has an extensive <a class="reference external" href="https://en.wikipedia.org/wiki/IPv6_transition_mechanisms">IPv6 transition mechanism</a> allowing IPv6 and IPv4 to interoperate. The massive IPv4 network infrastructure will provide a financial incentive to allow IPv4 hosts to access content for a long time to come.</p>
</li>
<li><p class="first">IPv6 is not ready everywhere:</p>
<p>Even if you wanted to go IPv6 only that’s not possible in all cases. Google Compute Engine comes with IPv6 disabled by default and IPv6 is not currently supported.</p>
</li>
<li><p class="first">IPv4 is not available everywhere.</p>
<ul>
<li><p class="first">From <a class="reference external" href="https://www.arin.net/resources/request/ipv4_countdown.html">IPv4 Address Status at ARIN</a>:</p>
<blockquote>
<div><p>ARIN’s free pool of IPv4 address space was depleted on 24 September 2015. As a result, we no longer can fulfill requests for IPv4 addresses unless you meet certain policy requirements that reserved blocks of IPv4 addresses for special cases …</p>
<p><a class="reference external" href="https://www.arin.net/resources/request.html">Submit an IPv4 request</a> and go on the <a class="reference external" href="https://www.arin.net/resources/request/waiting_list.html">Waiting List for Unmet Requests</a>. Requests on the waiting list can only be filled when ARIN adds IPv4 address space to its available IPv4 inventory. This usually occurs after: a registrant returns IPv4 address; a revocation by ARIN (typically for non-payment of annual fees); IPv4 address space distribution to ARIN by Internet Assigned Numbers Authority (IANA); or otherwise made available to be re-issued.</p>
</div></blockquote>
</li>
<li><p class="first"><a class="reference external" href="https://www.reddit.com/r/networking/comments/5y92le/psa_verizon_wireless_to_stop_issuing_public/">PSA: Verizon Wireless to stop issuing Public Static IPv4 addresses</a>:</p>
<blockquote>
<div><p>On June 30, 2017, Verizon will stop issuing new Public Static IPv4 addresses due to a shortage of available addresses. Customers that currently have active Public Static IPv4 addresses will retain those addresses, and Verizon will continue to fully support existing Public Static IPv4 addresses. In order to reserve new IP addresses, your company will need to convert to the Persistent Prefix IPv6 requirements and implement new Verizon-certified IPv6 devices.</p>
</div></blockquote>
</li>
</ul>
</li>
<li><p class="first">See <a class="reference external" href="https://www.google.com/intl/en/ipv6/statistics.html#tab=per-country-ipv6-adoption&amp;tab=per-country-ipv6-adoption">Google IPv6 Per-Country IPv6 adoption</a> for a glimpse into IPv6 adoption worldwide.</p>
</li>
</ul>
</div>
<div class="section" id="ipv6-differences">
<h4>11.6.1.1.2. IPv6 differences<a class="headerlink" href="#ipv6-differences" title="Permalink to this headline">¶</a></h4>
<p>You need to understand a few key IPv6 differences to successfully implement IPv6.</p>
<ul>
<li><p class="first">Review <a class="reference external" href="https://en.wikipedia.org/wiki/IPv6">IPv6 address</a> to get a basic understanding.</p>
</li>
<li><p class="first">IPv6 has unicast, anycast, and multicast addresses like IPv4. However “IPv6 does not implement broadcast addressing. Broadcast’s traditional role is subsumed by multicast addressing to the all-nodes link-local multicast group ff02::1.”</p>
</li>
<li><p class="first">IPv6 discourages NAT</p>
<p>From <a class="reference external" href="https://tools.ietf.org/html/rfc4864">RFC 4864</a> Local Network Protection for IPv6:</p>
<blockquote>
<div><p>IPv6 was designed with the intention of making NAT unnecessary, and this document shows how Local Network Protection (LNP) using IPv6 can provide the same or more benefits without the need for address translation.</p>
</div></blockquote>
</li>
<li><p class="first">ULA <a class="reference external" href="https://en.wikipedia.org/wiki/Unique_local_address">Unique local addresses</a> (see <a class="reference external" href="https://tools.ietf.org/html/rfc4193">RFC 4193</a> Unique Local IPv6 Unicast Addresses)</p>
<p>From <a class="reference external" href="https://en.wikipedia.org/wiki/IPv6">IPv6 address</a>:</p>
<blockquote>
<div><p>All interfaces of IPv6 hosts require a link-local address. A link-local address is derived from the MAC address of the interface and the prefix fe80::/10.</p>
</div></blockquote>
<p>If for some reason you cannot obtain IPv6 addresses from your ISP, <a class="reference external" href="http://simpledns.com/private-ipv6.aspx">Simple DNS Plus</a> generates unique private IPv6 address ranges for testing.</p>
</li>
<li><p class="first">ICMPv6 messages are critical to the proper functioning of IPv6</p>
<p>From <a class="reference external" href="https://en.wikipedia.org/wiki/IPv6">IPv6 address</a>:</p>
<blockquote>
<div><p>The assignment of a unicast IPv6 address to an interface involves an internal test for the uniqueness of that address using <em>Neighbor Solicitation</em> and <em>Neighbor Advertisement</em> (ICMPv6 type 135 and 136) messages. … The node joins the solicited-node multicast address for the tentative address (if not already done so) and sends neighbor solicitations, with the tentative address as target address and the unspecified address (::/128) as source address. The node also joins the all-hosts multicast address ff02::1, so it will be able to receive <em>Neighbor Advertisements</em>.</p>
</div></blockquote>
<p>See <a class="reference external" href="https://en.wikipedia.org/wiki/Neighbor_Discovery_Protocol">Neighbor Discovery Protocol</a> (NDP) for the ICMPv6 packet types: Router Solicitation (Type 133), Router Advertisement (Type 134), Neighbor Solicitation (Type 135), Neighbor Advertisement (Type 136), and Redirect (Type 137).</p>
</li>
<li><p class="first">General unicast address format</p>
<table border="1" class="colwidths-given docutils align-center" id="id5">
<caption><span class="caption-text">IPv6 Address</span><a class="headerlink" href="#id5" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="15%" />
<col width="30%" />
<col width="13%" />
<col width="43%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><th class="stub">bits (128)</th>
<td>48 - 64</td>
<td>0 - 16</td>
<td>64</td>
</tr>
<tr class="row-even"><th class="stub">field</th>
<td>routing prefix</td>
<td>subnet id</td>
<td>interface identifier</td>
</tr>
</tbody>
</table>
</li>
<li><p class="first">From <a class="reference external" href="https://en.wikipedia.org/wiki/IPv6">IPv6 address</a>: “The addresses are typically distributed in /48 to /56 sized blocks to the end users.”</p>
<p>Spectrum (formerly TWC) allocates either /56 or /64 blocks depending on the geographic location. This author is fortunate in getting a /56 block with 8 subnet bits available (or 256 /64 blocks to distribute internally), while a /64 block leaves 0 subnet bits (or 1 /64 block to allocate).</p>
</li>
<li><p class="first">Options for getting IPv6 addresses</p>
<p>From <a class="reference external" href="https://thenetworkway.wordpress.com/2014/07/02/ipv6-address-assignment-stateless-stateful-dhcp-oh-my/">IPv6 address assignment – stateless, stateful, DHCP… oh my!</a>:</p>
<blockquote>
<div><dl class="docutils">
<dt>Static (manual) address assignment</dt>
<dd><p class="first last">exactly like with IPv4, you can go on and apply the address yourself.</p>
</dd>
<dt>Stateless Address Auto Configuration (SLAAC)</dt>
<dd><p class="first last">nodes listen for ICMPv6 Router Advertisements (RA) messages periodically sent out by routers on the local link, or requested by the node using an RA solicitation message. … By default, SLAAC does not provide anything to the client outside of an IPv6 address and a default gateway.</p>
</dd>
<dt>Stateless DHCPv6</dt>
<dd><p class="first last">with this option SLAAC is still used to get the IP address, but DHCP is used to obtain “other” configuration options, usually things like DNS, NTP, etc.</p>
</dd>
<dt>Stateful DHCPv6</dt>
<dd><p class="first last">functions exactly the same as IPv4 DHCP in which hosts receive both their IPv6 address and additional parameters from the DHCP server. … <strong>NOTE: The only way to get a default gateway in IPv6 is via a RA message. DHCPv6 does not carry default route information at this time.</strong></p>
</dd>
</dl>
</div></blockquote>
</li>
<li><p class="first"><a class="reference external" href="https://en.wikipedia.org/wiki/IPv6#Stateless_address_autoconfiguration_.28SLAAC.29">Stateless address autoconfiguration (SLAAC)</a>.</p>
<p>IPv6 hosts can coubntnfigure themselves automatically when connected to an IPv6 network using the <a class="reference external" href="https://en.wikipedia.org/wiki/Neighbor_Discovery_Protocol">Neighbor Discovery Protocol</a> via <a class="reference external" href="https://en.wikipedia.org/wiki/Internet_Control_Message_Protocol_version_6">Internet Control Message Protocol version 6</a> (ICMPv6) router discovery messages. When first connected to a network, a host sends a link-local router solicitation multicast request for its configuration parameters; routers respond to such a request with a router advertisement packet that contains Internet Layer configuration parameters.</p>
<p>If IPv6 stateless address auto-configuration is unsuitable for an application, a network may use stateful configuration with the <a class="reference external" href="https://en.wikipedia.org/wiki/DHCPv6">Dynamic Host Configuration Protocol version 6</a> (DHCPv6) or hosts may be configured manually using static methods.</p>
</li>
<li><p class="first">Lots of (IPv6) addresses per interface:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@meetup:~$</span> ip addr show dev enp5s0
<span class="go">2: enp5s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span>
<span class="go">    link/ether 00:30:67:bc:41:d0 brd ff:ff:ff:ff:ff:ff</span>
<span class="hll"><span class="go">    inet 192.168.1.117/24 brd 192.168.1.255 scope global dynamic enp5s0</span>
</span><span class="go">       valid_lft 64823sec preferred_lft 64823sec</span>
<span class="hll"><span class="go">    inet6 2605:e000:9343:8400:7175:9e30:84a4:2682/64 scope global temporary dynamic</span>
</span><span class="go">       valid_lft 85883sec preferred_lft 13883sec</span>
<span class="hll"><span class="go">    inet6 2605:e000:9343:8400:230:67ff:febc:41d0/64 scope global mngtmpaddr noprefixroute dynamic</span>
</span><span class="go">       valid_lft 85883sec preferred_lft 13883sec</span>
<span class="hll"><span class="go">    inet6 fe80::230:67ff:febc:41d0/64 scope link</span>
</span><span class="go">       valid_lft forever preferred_lft forever</span>
</pre></div>
</div>
<ul>
<li><p class="first">192.168.1.117/24 scope global dynamic enp5s0</p>
<p>This is an IPv4 <a class="reference external" href="https://tools.ietf.org/html/rfc1918">RFC 1918</a> address (Address Allocation for Private Internets).</p>
</li>
<li><p class="first">2605:e000:9343:8400:7175:9e30:84a4:2682/64 scope global temporary dynamic</p>
<p>This is the currently valid <a class="reference external" href="https://tools.ietf.org/html/rfc4941">RFC 4941</a> address (Privacy Extensions for Stateless Address Autoconfiguration in IPv6). These addresses are regenerated at configurable intervals, deprecating the previous address. The non-deprecated addresses are used for new outgoing connections and provide some security with the ever-changing address drawn from a /64 block.</p>
</li>
<li><p class="first">2605:e000:9343:8400:230:67ff:febc:41d0/64 scope global mngtmpaddr noprefixroute dynamic</p>
<p>This is an <a class="reference external" href="https://tools.ietf.org/html/rfc7217">RFC 7217</a> address (A Method for Generating Semantically Opaque Interface Identifiers with IPv6 Stateless Address Autoconfiguration (SLAAC)). These addresses are published in global DNS and used for incoming connections. They are random but remain that same for a given IPv6 prefix, only changing when the host it moved to a different IPv6 prefix. But when moving back to the original prefix the address reverts back.</p>
</li>
<li><p class="first">fe80::230:67ff:febc:41d0/64 scope link</p>
<p>This is the link-local address (not routable).</p>
</li>
</ul>
</li>
<li><p class="first">Using <a class="reference external" href="http://www.thekelleys.org.uk/dnsmasq/doc.html">dnsmasq</a> so SLAAC-addressed hosts are in DNS (access hosts by name)</p>
<p>If you read and follow <a class="reference external" href="https://weirdfellow.wordpress.com/2014/09/05/dhcpv6-and-ra-with-dnsmasq/">DHCPv6 and RA with dnsmasq</a> you’ll get the idea that using “ra-stateless,ra-names” will register DNS names for SLAAC clients. Except for Chromebooks and Windows. Chromebooks don’t have a name and this is a security feature.</p>
<p>To fix this on Windows 10, not only must <code class="docutils literal"><span class="pre">netsh</span> <span class="pre">interface</span> <span class="pre">ipv6</span> <span class="pre">set</span> <span class="pre">privacy</span> <span class="pre">state=disabled</span></code> be run as an Administrator on Windows, but the Windows firewall should allow ICMP v4 and ICMP v6 ECHO (<a class="reference external" href="http://lists.thekelleys.org.uk/pipermail/dnsmasq-discuss/2016q4/011026.html">[Dnsmasq-discuss] Windows ipv6 hostname</a>):</p>
<div class="highlight-bat"><div class="highlight"><pre><span></span>netsh interface ipv6 set privacy state=disabled
netsh advfirewall firewall add rule name=<span class="s2">&quot;ICMP Allow incoming V4 echo request&quot;</span> protocol=icmpv4:8,any dir=in action=allow
netsh advfirewall firewall add rule name=<span class="s2">&quot;ICMP Allow incoming V6 echo request&quot;</span> protocol=icmpv6:8,any dir=in action=allow
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="pre-firewall-setup">
<h3>11.6.1.2. Pre-firewall setup<a class="headerlink" href="#pre-firewall-setup" title="Permalink to this headline">¶</a></h3>
<div class="section" id="ipv6-client-setup">
<h4>11.6.1.2.1. IPv6 client setup<a class="headerlink" href="#ipv6-client-setup" title="Permalink to this headline">¶</a></h4>
<p>Most operating systems support IPv6 SLAAC and stateless DHCPv6 out of the box. The author’s Android 7.1.2, Chromebook, Chromebox, Kali Linux, Debian Linux (insure NetworkManager IPv6 address is set to “Automatic”), and Windows 10 all successfully obtain an IPv6 address and IPv6 DNS server. They all successfully connected to <a class="reference external" href="http://test-ipv6.com">http://test-ipv6.com</a> and <a class="reference external" href="https://ipv6.google.com">https://ipv6.google.com</a>.</p>
</div>
<div class="section" id="isp-setup">
<h4>11.6.1.2.2. ISP setup<a class="headerlink" href="#isp-setup" title="Permalink to this headline">¶</a></h4>
<p>Spectrum Internet in the authors area provided IPv6 /56 <a class="reference external" href="https://en.wikipedia.org/wiki/Prefix_delegation">Prefix delegation</a>, the preferred delegation from <a class="reference external" href="https://tools.ietf.org/html/rfc6177">RFC 6177</a> IPv6 Address Assignment to End Sites:</p>
<blockquote>
<div><p>… APNIC [APNIC-ENDSITE], ARIN [ARIN-ENDSITE], and RIPE [RIPE-ENDSITE] have revised the end site assignment policy to encourage the assignment of smaller (i.e., /56) blocks to end sites.</p>
<p>It is no longer recommended that /128s be given out. While there may be some cases where assigning only a single address may be justified, a site, by definition, implies multiple subnets and multiple devices.</p>
<p>In practice, that means at least one /64, and in most cases significantly more.</p>
<p>The above-mentioned goals of RFC 3177 can easily be met by giving home users a default assignment of less than /48, such as a /56.</p>
<p>At the same time, it might be tempting to give home sites a single /64, since that is already significantly more address space compared with today’s IPv4 practice. However, this precludes the expectation that even home sites will grow to support multiple subnets going forward.  Hence, it is strongly intended that even home sites be given multiple subnets</p>
</div></blockquote>
</div>
</div>
<div class="section" id="firewall-overview">
<h3>11.6.1.3. Firewall overview<a class="headerlink" href="#firewall-overview" title="Permalink to this headline">¶</a></h3>
<div class="section" id="erlite-3-firewall">
<h4>11.6.1.3.1. ERLite-3 firewall<a class="headerlink" href="#erlite-3-firewall" title="Permalink to this headline">¶</a></h4>
<p>The ERL3 runs <a class="reference external" href="https://dl.ubnt.com/guides/edgemax/EdgeOS_UG.pdf">EdgeOS</a> which supports Cavium Octeon and MIPs chips. Both EdgeOS and <a class="reference external" href="https://wiki.vyos.net/wiki/Main_Page">VyOS</a> were forked from <a class="reference external" href="https://wiki.vyos.net/wiki/Vyatta">Vyatta</a>. The OS is currently based on Debian 7 (Wheezy) running a Linux 3.x kernel. The current Debian release is Debian 9 (Stretch) with Linux kernel 4.9.</p>
<p>For more information consult the <a class="reference external" href="https://help.ubnt.com/hc/en-us/categories/200321064-EdgeMAX">EdgeMAX Help Center</a>, a 6-part series starting with <a class="reference external" href="http://www.forshee.me/2016/03/01/ubiquiti-edgerouter-lite-setup-part-1-the-basics.html">Ubiquiti EdgeRouter Lite Setup Part 1: The Basics</a>  (especially the Key-Based SSH Login instructions), and another multi-part series starting with <a class="reference external" href="https://networkjutsu.com/my-home-router-edgerouter-lite/">My Home Router – EdgeRouter Lite</a>.</p>
<p>The command line has 2 modes: normal mode (“$” prompt) and configuration mode (“#” prompt), entered via the <code class="docutils literal"><span class="pre">configure</span></code> command and exited via the <code class="docutils literal"><span class="pre">exit</span></code> command.</p>
<p>There are 2 versions of the configuration: running and boot. After <code class="docutils literal"><span class="pre">configure</span></code> and typing in some configuration commands, the configuration changes can be saved to the running configuration via <code class="docutils literal"><span class="pre">commit</span></code> (or <code class="docutils literal"><span class="pre">discard</span></code> to not save). To make those changes persist after boot issue the <code class="docutils literal"><span class="pre">save</span></code> command.</p>
</div>
<div class="section" id="zone-vs-interface-based-firewall">
<h4>11.6.1.3.2. Zone vs interface-based firewall<a class="headerlink" href="#zone-vs-interface-based-firewall" title="Permalink to this headline">¶</a></h4>
<p>Our example will be a zone-based firewall and we explain the difference with the more popular interface-based firewall rulesets.</p>
<p>EdgeOS supports both the traditional per-interface (ACL-based in EdgeOS documentation) and zone-based firewalls. See <a class="reference external" href="https://www.nnbfn.net/2011/06/per-interface-vs-zone-based-firewall/">Per Interface vs. Zone Based Firewall</a>. The EdgeOS GUI only supports per-interface firewall, and thus most organizations use per-interface. However, there are some configuration options that are only available via the CLI. In many cases the CLI can be used alongside the GUI, but in the case of zones only the CLI can be used for configuration.</p>
<p>To make clear the difference, if you have 3 interfaces eth0, eth1, and eth2 then you have 4 zones: WAN (eth0), LAN (eth1), GUEST (eth2) (or call it DMZ or WIFI or …), and LOCAL (the firewall itself). For each pair, say WAN=&gt;GUEST, 2 rulesets (IPv4 and IPv6) are created for the allowed traffic from the WAN zone to the GUEST zone. This makes it very easy to determine the traffic permitted between zones. The ERL has 2x4x3 = 24 zone rulesets.</p>
<p>In contrast, an interface-based firewall has 4 rulesets per interface, actually 2 IPv4 and 2 IPv6. Take the WAN interface, then 1 ruleset WAN_LOCAL lists the traffic allowed from the WAN to the firewall itself. The ruleset WAN_IN lists the traffic allowed from the WAN to the other interfaces (LAN and GUEST). That means 2x2x3 = 12 rulesets. It’s a little harder to determine what traffic goes from WAN=&gt;LAN as the WAN_IN ruleset lists both WAN=&gt;LAN and WAN=&gt;GUEST traffic.</p>
</div>
<div class="section" id="firewall-backup">
<h4>11.6.1.3.3. Firewall backup<a class="headerlink" href="#firewall-backup" title="Permalink to this headline">¶</a></h4>
<p>While it’s best to save the configuration, you can also save the commands required to create that configuration. Having the commands makes it easier to explore modification (and learning) of the EdgeOS configuration. Here’s the backup for both the configuration (which can be restored) and the commands (which can be re-executed).</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># /config/user-data persists between boots</span>
<span class="nv">CONFIG</span><span class="o">=</span><span class="sb">`</span>date +%Y%m%d%H%M<span class="sb">`</span>-firewall-config.eos
<span class="nv">COMMANDS</span><span class="o">=</span><span class="si">${</span><span class="nv">CONFIG</span><span class="p">/config/commands</span><span class="si">}</span>
<span class="hll">show configuration all &gt; /config/user-data/<span class="nv">$CONFIG</span>
</span><span class="hll">show configuration commands &gt; /config/user-data/<span class="nv">$COMMANDS</span>
</span><span class="c1">## To load a saved config:</span>
<span class="c1"># configure</span>
<span class="c1"># load /config/user-data/$CONFIG</span>
</pre></div>
</div>
<p>The backups can easily be <code class="docutils literal"><span class="pre">scp</span></code> copied to/from another host.</p>
</div>
</div>
<div class="section" id="firewall-rulesets">
<h3>11.6.1.4. Firewall rulesets<a class="headerlink" href="#firewall-rulesets" title="Permalink to this headline">¶</a></h3>
<div class="section" id="isp-prefix-delegation">
<h4>11.6.1.4.1. ISP prefix delegation<a class="headerlink" href="#isp-prefix-delegation" title="Permalink to this headline">¶</a></h4>
<p>We’ll start with commands for ISP prefix delegation (the heart of IPv6 address allocation).</p>
<p><a class="reference external" href="https://tools.ietf.org/html/rfc3633">RFC 3633</a> IPv6 Prefix Options for Dynamic Host Configuration Protocol (DHCP) version 6 defines a mechanism by which <a class="reference external" href="https://en.wikipedia.org/wiki/DHCPv6">DHCPv6</a> can be used to delegate a network address prefix to a network. This is known as <a class="reference external" href="https://en.wikipedia.org/wiki/Prefix_delegation">prefix delegation</a>. The router can then assign addresses to clients within the network using either DHCPv6 or <a class="reference external" href="https://en.wikipedia.org/wiki/IPv6_address#Stateless_address_autoconfiguration">stateless address autoconfiguraton</a> (SLAAC). With SLAAC the router advertises a prefix to clients, and clients pick their own address within that network. This example will use SLAAC.</p>
<div class="highlight-text"><div class="highlight"><pre><span></span># Configure all interfaces for IPv6 automatic configuration.
# Use only 1 NS (neighbor solicitation) message for DAD (duplicate address detection).

<span class="hll">set interfaces ethernet eth0 ipv6 address autoconf
</span><span class="hll">set interfaces ethernet eth0 ipv6 dup-addr-detect-transmits 1
</span>
<span class="hll">set interfaces ethernet eth1 ipv6 address autoconf
</span><span class="hll">set interfaces ethernet eth1 ipv6 dup-addr-detect-transmits 1
</span>
<span class="hll">set interfaces ethernet eth2 ipv6 address autoconf
</span><span class="hll">set interfaces ethernet eth2 ipv6 dup-addr-detect-transmits 1
</span>

# Use SLAAC with /56 PD (prefix delegation) on eth0
<span class="hll">set interfaces ethernet eth0 dhcpv6-pd pd 0 prefix-length 56
</span># DHCPv6 option 14 = Rapid Commit (DHCPv6 client uses a 2 message exchange, not 4).
<span class="hll">set interfaces ethernet eth0 dhcpv6-pd rapid-commit enable
</span>
# For eth1, eth2: create subnet, give i/f the &#39;::1&#39; address, turn on SLAAC.
<span class="hll">set interfaces ethernet eth0 dhcpv6-pd pd 0 interface eth1 prefix-id &#39;:0&#39;
</span><span class="hll">set interfaces ethernet eth0 dhcpv6-pd pd 0 interface eth1 host-address &#39;::1&#39;
</span><span class="hll">set interfaces ethernet eth0 dhcpv6-pd pd 0 interface eth1 service slaac
</span>
<span class="hll">set interfaces ethernet eth0 dhcpv6-pd pd 0 interface eth2 prefix-id &#39;:1&#39;
</span><span class="hll">set interfaces ethernet eth0 dhcpv6-pd pd 0 interface eth2 host-address &#39;::1&#39;
</span><span class="hll">set interfaces ethernet eth0 dhcpv6-pd pd 0 interface eth2 service slaac
</span></pre></div>
</div>
</div>
<div class="section" id="firewall-dns-ipv4-dhcp">
<h4>11.6.1.4.2. Firewall DNS &amp; IPv4 DHCP<a class="headerlink" href="#firewall-dns-ipv4-dhcp" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="https://www.isc.org/downloads/dhcp/">ISC DHCP</a> is the default DHCP server with <a class="reference external" href="http://www.thekelleys.org.uk/dnsmasq/doc.html">dnsmasq</a> being a relatively new alternative. (See <a class="reference external" href="https://help.ubnt.com/hc/en-us/articles/115002673188-EdgeRouter-Using-dnsmasq-for-DHCP-Server">EdgeRouter - Using dnsmasq for DHCP Server</a>.) dnsmasq combines both caching DNS and DHCP allowing DHCP client names to appear in DNS.</p>
<div class="section" id="id3">
<h5>11.6.1.4.2.1. ISC DHCP<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h5>
<p>Here’s the configuration for ISC DHCP:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span># Set hostname and domain for firewall
<span class="hll">set system host-name fw
</span><span class="hll">set system domain-name bitbender.org
</span># Make firewall DNS lookup return the address from the client&#39;s interface.
<span class="hll">set service dns forwarding options localise-queries
</span><span class="hll">set system ip override-hostname-ip 192.168.1.1
</span><span class="hll">set system static-host-mapping host-name fw inet 192.168.2.1
</span>
# DNSMASQ not enabled by default (ISC DHCPD default, but doesn&#39;t update DNS)
<span class="hll">set service dhcp-server use-dnsmasq disable
</span>
# Set system name-server to itself, which will cache and forward to list below
<span class="hll">set system name-server 127.0.0.1
</span><span class="hll">set system name-server ::1
</span># Forwarding for system name-server (it&#39;s a caching server so needs real DNS)
<span class="hll">set service dns forwarding name-server 8.8.8.8
</span><span class="hll">set service dns forwarding name-server 8.8.4.4
</span><span class="hll">set service dns forwarding name-server &#39;2001:4860:4860::8888&#39;
</span><span class="hll">set service dns forwarding name-server &#39;2001:4860:4860::8844&#39;
</span><span class="hll">set service dns forwarding cache-size 400
</span># Clients on eth1 &amp; eth2 DNS forwarded to localhost then to 1 of forwarding list above
<span class="hll">set service dns forwarding listen-on eth1
</span><span class="hll">set service dns forwarding listen-on eth2
</span>
# Get IP, default route, but not DNS from ISP
<span class="hll">set interfaces ethernet eth0 dhcp-options default-route update
</span><span class="hll">set interfaces ethernet eth0 dhcp-options default-route-distance 210
</span><span class="hll">set interfaces ethernet eth0 dhcp-options name-server no-update
</span>
# DHCP server updates hostfile (so names available to internal network)
<span class="hll">set service dhcp-server disabled false
</span># DHCP server updates /etc/hosts for client leases.
<span class="hll">set service dhcp-server hostfile-update enable
</span>
# GUEST DHCP configuration (unifi-controller is DHCP option 43 to locate unifi controller)
<span class="hll">set service dhcp-server shared-network-name GUEST authoritative enable
</span><span class="hll">set service dhcp-server shared-network-name GUEST subnet 192.168.2.0/24 default-router 192.168.2.1
</span><span class="hll">set service dhcp-server shared-network-name GUEST subnet 192.168.2.0/24 dns-server 192.168.2.1
</span><span class="hll">set service dhcp-server shared-network-name GUEST subnet 192.168.2.0/24 ntp-server 192.168.2.1
</span><span class="hll">set service dhcp-server shared-network-name GUEST subnet 192.168.2.0/24 domain-name bitbender.org
</span><span class="hll">set service dhcp-server shared-network-name GUEST subnet 192.168.2.0/24 lease 86400
</span><span class="hll">set service dhcp-server shared-network-name GUEST subnet 192.168.2.0/24 start 192.168.2.38 stop 192.168.2.243
</span><span class="hll">set service dhcp-server shared-network-name GUEST subnet 192.168.2.0/24 static-mapping ubiquiti ip-address 192.168.2.2
</span><span class="hll">set service dhcp-server shared-network-name GUEST subnet 192.168.2.0/24 static-mapping ubiquiti mac-address &#39;44:d9:e7:f6:48:f2&#39;
</span><span class="hll">set service dhcp-server shared-network-name GUEST subnet 192.168.2.0/24 unifi-controller 192.168.1.29
</span>
# LAN DHCP configuration (unifi-controller is DHCP option 43 to locate unifi controller)
<span class="hll">set service dhcp-server shared-network-name LAN authoritative enable
</span><span class="hll">set service dhcp-server shared-network-name LAN subnet 192.168.1.0/24 default-router 192.168.1.1
</span><span class="hll">set service dhcp-server shared-network-name LAN subnet 192.168.1.0/24 dns-server 192.168.1.1
</span><span class="hll">set service dhcp-server shared-network-name LAN subnet 192.168.1.0/24 ntp-server 192.168.1.1
</span><span class="hll">set service dhcp-server shared-network-name LAN subnet 192.168.1.0/24 domain-name bitbender.org
</span><span class="hll">set service dhcp-server shared-network-name LAN subnet 192.168.1.0/24 lease 86400
</span><span class="hll">set service dhcp-server shared-network-name LAN subnet 192.168.1.0/24 start 192.168.1.101 stop 192.168.1.200
</span><span class="hll">set service dhcp-server shared-network-name LAN subnet 192.168.1.0/24 unifi-controller 192.168.1.29
</span></pre></div>
</div>
</div>
<div class="section" id="dnsmasq-dhcp-ipv4">
<h5>11.6.1.4.2.2. dnsmasq DHCP IPv4<a class="headerlink" href="#dnsmasq-dhcp-ipv4" title="Permalink to this headline">¶</a></h5>
<p><a class="reference external" href="http://www.thekelleys.org.uk/dnsmasq/doc.html">dnsmasq</a> combines both DHCP and DNS for IPv4 &amp; IPv6 in a single daemon that registers DHCP leases in DNS. You’ll be lost without the <a class="reference external" href="http://www.thekelleys.org.uk/dnsmasq/docs/dnsmasq-man.html">dnsmasq manpage</a> and the commands <code class="docutils literal"><span class="pre">dnsmasq</span> <span class="pre">--help</span> <span class="pre">dhcp</span></code> &amp; <code class="docutils literal"><span class="pre">dnsmasq</span> <span class="pre">--help</span> <span class="pre">dhcp6</span></code> listing the availble DHCP options.</p>
<p>Each time you make a dnsmasq configuration change you must remember to restart dnsmasq:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo service dnsmasq force-reload
</pre></div>
</div>
<p>To change the above ISC DHCP configuration to use <a class="reference external" href="http://www.thekelleys.org.uk/dnsmasq/doc.html">dnsmasq</a> requires these changes:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span># Remove the existing DHCP configuration (and more).
<span class="hll">delete service dns forwarding
</span><span class="hll">delete service dhcp-server
</span>
# Disable ISC DHCP
<span class="hll">set service dhcp-server disabled true
</span># These options are strangely enough disable
<span class="hll">set service dhcp-server use-dnsmasq disable
</span><span class="hll">set service dhcp-server hostfile-update disable
</span># Don&#39;t bind to all interfaces, only those specifically identified.
<span class="hll">set service dns forwarding options bind-interfaces
</span># Add domain to simple names in /etc/hosts
<span class="hll">set service dns forwarding options expand-hosts
</span># Do not forward reverse lookups for private addresses.
<span class="hll">set service dns forwarding options bogus-priv
</span># Return DNS lookups matching the interface&#39;s IP
<span class="hll">set service dns forwarding options localise-queries
</span># Change firewall&#39;s IP in /etc/hosts to the give IP (instead of 127.0.0.1)
<span class="hll">set system ip override-hostname-ip 192.168.1.1
</span><span class="hll">set system static-host-mapping host-name fw inet 192.168.2.1
</span># DHCP server is only DHCP on network.
<span class="hll">set service dns forwarding options dhcp-authoritative
</span><span class="hll">set service dns forwarding options domain=bitbender.org
</span>
# dnsmasq is caching server so needs to forward to real DNS.
<span class="hll">set service dns forwarding name-server 8.8.8.8
</span><span class="hll">set service dns forwarding name-server 8.8.4.4
</span><span class="hll">set service dns forwarding name-server &#39;2001:4860:4860::8888&#39;
</span><span class="hll">set service dns forwarding name-server &#39;2001:4860:4860::8844&#39;
</span><span class="hll">set service dns forwarding cache-size 400
</span># Clients on eth1 &amp; eth2 DNS forwarded to localhost then to 1 of forwarding list above
<span class="hll">set service dns forwarding listen-on eth1
</span><span class="hll">set service dns forwarding listen-on eth2
</span><span class="hll">set service dns forwarding options &#39;interface=eth1,eth2&#39;
</span># DHCP domain name option set to bitbender.org
<span class="hll">set service dns forwarding options &#39;dhcp-option=option:domain-name,bitbender.org&#39;
</span># DNS requests for plain names (without dots) are never forwarded.
<span class="hll">set service dns forwarding options &#39;domain-needed&#39;
</span># Add dnsnames matching the interfaces IPv4/6 address.
<span class="hll">set service dns forwarding options &#39;interface-name=lan.bitbender.org,eth1&#39;
</span><span class="hll">set service dns forwarding options &#39;interface-name=guest.bitbender.org,eth2&#39;
</span>
# Give unifi AP the second address in subnet
<span class="hll">set service dns forwarding options &#39;dhcp-host=set:unifi,44:d9:e7:f6:48:f2,ubiquiti,192.168.2.2&#39;
</span>
# DHCP option 43 to specify unifi-controller
<span class="hll">set service dns forwarding options &#39;dhcp-option=tag:unifi,43,192.168.1.29&#39;
</span># The above replaces the following:
# set service dhcp-server shared-network-name LAN subnet 192.168.1.0/24 unifi-controller

# 192.168.1.0 subnet
<span class="hll">set service dns forwarding options &#39;dhcp-range=set:eth1,192.168.1.101,192.168.1.200,255.255.255.0,12h&#39;
</span><span class="hll">set service dns forwarding options &#39;dhcp-option=tag:eth1,option:dns-server,192.168.1.1&#39;
</span><span class="hll">set service dns forwarding options &#39;dhcp-option=tag:eth1,option:ntp-server,192.168.1.1&#39;
</span><span class="hll">set service dns forwarding options &#39;dhcp-option=tag:eth1,option:router,192.168.1.1&#39;
</span>
# 192.168.2.0 subnet
<span class="hll">set service dns forwarding options &#39;dhcp-range=set:eth2,192.168.2.38,192.168.2.243,255.255.255.0,12h&#39;
</span><span class="hll">set service dns forwarding options &#39;dhcp-option=tag:eth2,option:dns-server,192.168.2.1&#39;
</span><span class="hll">set service dns forwarding options &#39;dhcp-option=tag:eth2,option:ntp-server,192.168.2.1&#39;
</span><span class="hll">set service dns forwarding options &#39;dhcp-option=tag:eth2,option:router,192.168.2.1&#39;
</span></pre></div>
</div>
</div>
<div class="section" id="dnsmasq-dhcp-ipv6">
<h5>11.6.1.4.2.3. dnsmasq DHCP IPv6<a class="headerlink" href="#dnsmasq-dhcp-ipv6" title="Permalink to this headline">¶</a></h5>
<p>Finally we get to Stateless DHCPv6 using dnsmasq, relying on SLAAC for IPv6 and default gateway settings, with dnsmasq giving the DNS servers. From <a class="reference external" href="https://weirdfellow.wordpress.com/2014/09/05/dhcpv6-and-ra-with-dnsmasq/">DHCPv6 and RA with dnsmasq</a>, dnsmasq option combination <code class="docutils literal"><span class="pre">ra-stateless,ra-names</span></code> means “DNS will try to guess the auto-configured addresses.” According to the article Microsoft doesn’t follow EUI-64 so the “ra-names option will have no effect – DNS will not guess correctly the IPv6 address of those machines, so no entry in DNS will be populated. This behaviour can be changed and revert to EUI-64 by executing <code class="docutils literal"><span class="pre">netsh</span> <span class="pre">interface</span> <span class="pre">ipv6</span> <span class="pre">set</span> <span class="pre">privacy</span> <span class="pre">state=disabled</span></code> command.”</p>
<p>The additional configuration modifications are:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span># dnsmasq provides dhcpv6-stateless (DHCP options only - SLAAC provides address &amp; gateway).
<span class="hll">set interfaces ethernet eth0 dhcpv6-pd pd 0 interface eth1 service dhcpv6-stateless
</span><span class="hll">set interfaces ethernet eth0 dhcpv6-pd pd 0 interface eth2 service dhcpv6-stateless
</span>
# Turn on ra-stateless providing IPv6 DNS &amp; NTP servers
<span class="hll">set service dns forwarding options &#39;dhcp-range=set:eth1v6,::,constructor:eth1,ra-stateless,ra-names,12h&#39;
</span><span class="hll">set service dns forwarding options &#39;dhcp-option=tag:eth1v6,option6:dns-server,[::]&#39;
</span><span class="hll">set service dns forwarding options &#39;dhcp-option=tag:eth1v6,option6:ntp-server,[::]&#39;
</span>
<span class="hll">set service dns forwarding options &#39;dhcp-range=set:eth2v6,::,constructor:eth2,ra-stateless,ra-names,12h&#39;
</span><span class="hll">set service dns forwarding options &#39;dhcp-option=tag:eth2v6,option6:dns-server,[::]&#39;
</span><span class="hll">set service dns forwarding options &#39;dhcp-option=tag:eth2v6,option6:ntp-server,[::]&#39;
</span></pre></div>
</div>
</div>
</div>
<div class="section" id="firewall-system-configuration">
<h4>11.6.1.4.3. Firewall system configuration<a class="headerlink" href="#firewall-system-configuration" title="Permalink to this headline">¶</a></h4>
<p>Here are the general configuration options:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>set firewall all-ping enable
set firewall broadcast-ping disable
set firewall receive-redirects disable
set firewall send-redirects enable
set firewall source-validation disable
set firewall syn-cookies enable
set interfaces ethernet eth0 address dhcp
set interfaces ethernet eth0 description Internet

set interfaces ethernet eth0 duplex auto
set interfaces ethernet eth0 mac &#39;00:24:54:57:8e:55&#39;
set interfaces ethernet eth0 speed auto
set interfaces ethernet eth1 address 192.168.1.1/24
set interfaces ethernet eth1 description Local
set interfaces ethernet eth1 duplex auto
set interfaces ethernet eth1 speed auto
set interfaces ethernet eth2 address 192.168.2.1/24
set interfaces ethernet eth2 description &#39;Local 2&#39;
set interfaces ethernet eth2 duplex auto
set interfaces ethernet eth2 speed auto
set interfaces loopback lo

set service gui http-port 80
set service gui https-port 443
set service gui older-ciphers disable
set service nat rule 5010 description &#39;masquerade for WAN&#39;
set service nat rule 5010 outbound-interface eth0
set service nat rule 5010 type masquerade
set service ssh port 22
set service ssh protocol-version v2
set system domain-name bitbender.org
set system host-name fw
set system ip override-hostname-ip 192.168.1.1
set system login banner pre-login &#39;********************************************************************\n*                                                                  *\n* * * *                      bitbender                       * * * *\n* * * *                   WARNING NOTICE:                    * * * *\n*   This system is restricted solely to bitbender authorized       *\n*   users for legitimate business purposes only. The actual or     *\n*   attempted unauthorized access, use, or modification of this    *\n*   system is strictly prohibited by bitbender. Unauthorized       *\n*   users are subject to disciplinary proceedings and/or           *\n*   criminal and civil penalties under state, federal, or other    *\n*   domestic and foreign laws. The use of this system may be       *\n*   monitored and recorded for administrative and security reasons.*\n*   Anyone accessing this system expressly consents to such        *\n*   monitoring and is advised that if monitoring reveals possible  *\n*   evidence of criminal activity, bitbender may provide the       *\n*   evidence of such activity to law enforcement officials. All    *\n*   users must comply with bitbender instructions regarding the    *\n*   protection of bitbender information assets.                    *\n*                                                                  *\n********************************************************************\n&#39;
set system login user someone authentication encrypted-password &#39;$6$aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#39;
set system login user someone authentication plaintext-password &#39;&#39;
set system login user someone full-name &#39;&#39;
set system login user someone level admin

set system ntp server 0.ubnt.pool.ntp.org
set system ntp server 1.ubnt.pool.ntp.org
set system ntp server 2.ubnt.pool.ntp.org
set system ntp server 3.ubnt.pool.ntp.org
set system offload hwnat disable
set system offload ipsec enable
set system offload ipv4 forwarding enable
set system offload ipv6 forwarding enable
set system syslog global facility all level notice
set system syslog global facility protocols level debug
set system time-zone UTC
set system traffic-analysis dpi enable
set system traffic-analysis export enable
</pre></div>
</div>
</div>
<div class="section" id="zone-configurations">
<h4>11.6.1.4.4. zone configurations<a class="headerlink" href="#zone-configurations" title="Permalink to this headline">¶</a></h4>
<p>Here is boilerplate for applying the zone configurations. Zone ruleset lan-guest-6 is for IPv6 traffic from zone lan to zone guest (with “-6” dropped for IPv4). Each zone is associated with an interface (eth0, eth1, eth2, and local for the firewall itself).</p>
<div class="highlight-text"><div class="highlight"><pre><span></span><span class="hll">set zone-policy zone GUEST default-action drop
</span>set zone-policy zone GUEST from LAN firewall ipv6-name lan-guest-6
set zone-policy zone GUEST from LAN firewall name lan-guest
set zone-policy zone GUEST from WAN firewall ipv6-name wan-guest-6
set zone-policy zone GUEST from WAN firewall name wan-guest
set zone-policy zone GUEST from local firewall ipv6-name local-guest-6
set zone-policy zone GUEST from local firewall name local-guest
set zone-policy zone GUEST interface eth2
<span class="hll">set zone-policy zone LAN default-action drop
</span>set zone-policy zone LAN from GUEST firewall ipv6-name guest-lan-6
set zone-policy zone LAN from GUEST firewall name guest-lan
set zone-policy zone LAN from WAN firewall ipv6-name wan-lan-6
set zone-policy zone LAN from WAN firewall name wan-lan
set zone-policy zone LAN from local firewall ipv6-name local-lan-6
set zone-policy zone LAN from local firewall name local-lan
set zone-policy zone LAN interface eth1
<span class="hll">set zone-policy zone WAN default-action drop
</span>set zone-policy zone WAN from GUEST firewall ipv6-name guest-wan-6
set zone-policy zone WAN from GUEST firewall name guest-wan
set zone-policy zone WAN from LAN firewall ipv6-name lan-wan-6
set zone-policy zone WAN from LAN firewall name lan-wan
set zone-policy zone WAN from local firewall ipv6-name local-wan-6
set zone-policy zone WAN from local firewall name local-wan
set zone-policy zone WAN interface eth0
<span class="hll">set zone-policy zone local default-action drop
</span>set zone-policy zone local from GUEST firewall ipv6-name guest-local-6
set zone-policy zone local from GUEST firewall name guest-local
set zone-policy zone local from LAN firewall ipv6-name lan-local-6
set zone-policy zone local from LAN firewall name lan-local
set zone-policy zone local from WAN firewall ipv6-name wan-local-6
set zone-policy zone local from WAN firewall name wan-local
set zone-policy zone local local-zone
</pre></div>
</div>
<p>We’re not providing all the firewall rules as they generally differ too much. But as an example, if you wanted to allow all IPv4 traffic in a given zone:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>set firewall name allow-all default-action accept
set firewall name allow-all description &#39;IPv4 allow all, drop invalid&#39;
set firewall name allow-all rule 1 action accept
set firewall name allow-all rule 1 state established enable
set firewall name allow-all rule 1 state related enable
set firewall name allow-all rule 2 action drop
set firewall name allow-all rule 2 log enable
set firewall name allow-all rule 2 state invalid enable
</pre></div>
</div>
<p>Another snippet is to drop traffic except for continuation of already allowed traffic.</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>set firewall name allow-est-drop-inv default-action drop
set firewall name allow-est-drop-inv description &#39;IPv4 allow established, drop invalid&#39;
set firewall name allow-est-drop-inv enable-default-log
set firewall name allow-est-drop-inv rule 1 action accept
set firewall name allow-est-drop-inv rule 1 state established enable
set firewall name allow-est-drop-inv rule 1 state related enable
set firewall name allow-est-drop-inv rule 2 action drop
set firewall name allow-est-drop-inv rule 2 log enable
set firewall name allow-est-drop-inv rule 2 state invalid enable
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="20170826_presentation.html" class="btn btn-neutral" title="11.5. 2017-08-26 Complexity, Cookies vs Tokens" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, bitbender.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>