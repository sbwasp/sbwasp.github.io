

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta content="default-src 'none'; script-src 'self' https://cdnjs.cloudflare.com 'unsafe-inline'; connect-src 'self'; img-src 'self'; style-src 'self'; font-src 'self'; form-action 'self'; frame-ancestors 'none'; base-uri 'self'" http-equiv="Content-Security-Policy" />
<meta content="nosniff" http-equiv="X-Content-Type-Options" />
<meta content="deny" http-equiv="X-Frame-Options" />
<meta content="1; mode=block" http-equiv="X-XSS-Protection" />
<meta content="strict-origin" http-equiv="Referrer-Policy" />
<meta content="max-age=31536000; includeSubDomains" http-equiv="Strict-Transport-Security" />
<meta content="'*'" http-equiv="Access-Control-Allow-Origin" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>11.24. 2018-02-24 Links, Cloud VMs, Let’s Encrypt, Metasploit Framework &mdash; South Bay WASP 1.0.3 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="11.25. 2018-02-17 Links, Web frontend, and Malware C2" href="20180217_presentation.html" />
    <link rel="prev" title="11.23. 2018-03-03 Links, Cloud VMs, OpenSSL, Metasploit Framework" href="20180303_presentation.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> South Bay WASP
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pentest_intro.html">1. South Bay WASP Meetup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_kali.html">2. Kali Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_challenges.html">3. Pentest Challenges</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_encryption.html">4. Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_html.html">5. HTML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_network_tools.html">6. Pentest Network Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_recon.html">7. Pentest Reconnaisance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_study.html">8. Pentest Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_buffer_overflow.html">9. Pentest Buffer Overflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_scripting.html">10. Pentest scripting</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../pentest_presentations.html">11. Pentest Presentations</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="20180825_presentation.html">11.1. 2018-08-25 Links, AWS IAM</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180818_presentation.html">11.2. 2018-08-18 Links, flaws.cloud</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180811_presentation.html">11.3. 2018-08-11 Links, flaws.cloud</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180804_presentation.html">11.4. 2018-08-04 Links, AWS S3</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180728_presentation.html">11.5. 2018-07-28 Links, AWS VPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180721_presentation.html">11.6. 2018-07-21 Links, HTML vs HTTPS, AWS Training and Certification</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180714_presentation.html">11.7. 2018-07-14 Links, jq, and MoinMoin code execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180707_presentation.html">11.8. 2018-07-07 Links, cloud logging, PentesterLab SQLi II</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180630_presentation.html">11.9. 2018-06-30 Links, home routers, PentesterLab SQLi</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180623_presentation.html">11.10. 2018-06-23 Links, PentesterLab, AWS EC2</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180616_presentation.html">11.11. 2018-06-16 Links, VMs/Containers, and AES/SHA</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180609_presentation.html">11.12. 2018-06-09 Links, VMs/Containers, and Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180602_presentation.html">11.13. 2018-06-02 Links, Containers, and Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180526_presentation.html">11.14. 2018-05-26 Links, Containers, and Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180519_presentation.html">11.15. 2018-05-19 Links, Containers, and Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180512_presentation.html">11.16. 2018-05-12 Links, Containers, and Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180505_presentation.html">11.17. 2018-05-05 Links, Containers, and Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180428_presentation.html">11.18. 2018-04-28 Links, Containers, and Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180421_presentation.html">11.19. 2018-04-21 Links, 2FA, and Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180414_presentation.html">11.20. 2018-04-14 Links and Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180407_presentation.html">11.21. 2018-04-07 Links, nmap, and Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180331_presentation.html">11.22. 2018-03-31 Links, TLS 1.3, and Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180303_presentation.html">11.23. 2018-03-03 Links, Cloud VMs, OpenSSL, Metasploit Framework</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">11.24. 2018-02-24 Links, Cloud VMs, Let’s Encrypt, Metasploit Framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#links-and-updates-this-week">11.24.1. Links and updates this week</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#links-around-the-web">11.24.1.1. Links around the web</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reasons-to-use-cloud-vms">11.24.1.2. Reasons to use cloud VMs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#study-this-week">11.24.2. Study this week</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ssl-tls-using-self-signed-and-let-s-encrypt-certificates">11.24.2.1. SSL/TLS using self-signed and Let’s Encrypt certificates</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installing-metasploit-framework">11.24.2.2. Installing Metasploit Framework</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="20180217_presentation.html">11.25. 2018-02-17 Links, Web frontend, and Malware C2</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180210_presentation.html">11.26. 2018-02-10 Links, memory issues, and WAF</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180203_presentation.html">11.27. 2018-02-03 Links and more ROP</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180127_presentation.html">11.28. 2018-01-27 Links and ROP</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180120_presentation.html">11.29. 2018-01-20 Links and yet more Meltdown/Spectre</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180113_presentation.html">11.30. 2018-01-13 Links and more Meltdown/Spectre</a></li>
<li class="toctree-l2"><a class="reference internal" href="20170812_presentation.html">11.31. 2017-08-12 VRT, cryptography, TLS 1.3, Broadpwn, cURL, and phishing</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180106_presentation.html">11.32. 2018-01-06 Invisibly fingerprinting text, Samsung no-SOP, Meltdown/Spectre</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171230_presentation.html">11.33. 2017-12-30 gohttp, hardening C/C++, Linux waitid() exploit</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171223_presentation.html">11.34. 2017-12-23 Haven, Observatory, and Janus</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171216_presentation.html">11.35. 2017-12-16 Mozilla Observatory</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171209_presentation.html">11.36. 2017-12-09 Phone tracking, AWS leaks, macOS root, exim</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171202_presentation.html">11.37. 2017-12-02 Static websites, IME follow-up</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171125_presentation.html">11.38. 2017-11-25 Not getting hacked, keystrokes, tracking, Fancy Bear, Intel ME</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171118_presentation.html">11.39. 2017-11-18 Privacy, safe languages, Linux networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171111_presentation.html">11.40. 2017-11-11 PKP removal, exploits galore</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171104_presentation.html">11.41. 2017-11-04 Cloud providers other than AWS</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171028_presentation.html">11.42. 2017-10-28 IPv6 ULA, DHCPv6, /64 prefixes, Bad Rabbit</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171021_presentation.html">11.43. 2017-10-21 IPv6 addressing, KRACK, Infineon RSA</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171014_presentation.html">11.44. 2017-10-14 Firewalls, building vulnerable hosts</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171007_presentation.html">11.45. 2017-10-07 QEMU virtualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="20170930_presentation.html">11.46. 2017-09-30 virtualization and bridges</a></li>
<li class="toctree-l2"><a class="reference internal" href="20170923_presentation.html">11.47. 2017-09-23 nftables</a></li>
<li class="toctree-l2"><a class="reference internal" href="20170916_presentation.html">11.48. 2017-09-16 “VPN”</a></li>
<li class="toctree-l2"><a class="reference internal" href="20170909_presentation.html">11.49. 2017-09-09 Adding IPv6 on the EdgeRouter Lite</a></li>
<li class="toctree-l2"><a class="reference internal" href="20170826_presentation.html">11.50. 2017-08-26 Complexity, Cookies vs Tokens</a></li>
<li class="toctree-l2"><a class="reference internal" href="20170819_presentation.html">11.51. 2017-08-19 Forcing HTTPS, HTTP forwarding</a></li>
<li class="toctree-l2"><a class="reference internal" href="http_headers.html">11.52. 2017-08-05 Attacking via HTTP Headers</a></li>
<li class="toctree-l2"><a class="reference internal" href="mitm.html">11.53. MitM Presentation</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">South Bay WASP</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../pentest_presentations.html">11. Pentest Presentations</a> &raquo;</li>
        
      <li>11.24. 2018-02-24 Links, Cloud VMs, Let’s Encrypt, Metasploit Framework</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/presentations/20180224_presentation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="links-cloud-vms-let-s-encrypt-metasploit-framework">
<h1>11.24. 2018-02-24 Links, Cloud VMs, Let’s Encrypt, Metasploit Framework<a class="headerlink" href="#links-cloud-vms-let-s-encrypt-metasploit-framework" title="Permalink to this headline">¶</a></h1>
<div class="section" id="links-and-updates-this-week">
<h2>11.24.1. Links and updates this week<a class="headerlink" href="#links-and-updates-this-week" title="Permalink to this headline">¶</a></h2>
<div class="section" id="links-around-the-web">
<h3>11.24.1.1. Links around the web<a class="headerlink" href="#links-around-the-web" title="Permalink to this headline">¶</a></h3>
<div class="section" id="cloud">
<h4>11.24.1.1.1. Cloud<a class="headerlink" href="#cloud" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="tech">
<h4>11.24.1.1.2. Tech<a class="headerlink" href="#tech" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><a class="reference external" href="https://no-csp-css-keylogger.badsite.io/">no-csp-css-keylogger.badsite.io</a> - type password here and watch network log</li>
<li><a class="reference external" href="https://iotscanner.bullguard.com/">Internet of Things Scanner</a> - add yourself to the list if you’re vulnerable and not there</li>
<li><a class="reference external" href="https://www.troyhunt.com/ive-just-launched-pwned-passwords-version-2/">I’ve Just Launched “Pwned Passwords” V2 With Half a Billion Passwords for Download</a></li>
<li><a class="reference external" href="https://betanews.com/2018/02/21/intel-spectre-patch-number-two/">Intel has a new Spectre firmware patch for you to try out</a> and <a class="reference external" href="https://arstechnica.com/gadgets/2018/02/intel-ships-hopefully-stable-microcode-for-skylake-kaby-lake-coffee-lake/">Intel ships (hopefully stable) microcode for Skylake, Kaby Lake, Coffee Lake</a></li>
<li><a class="reference external" href="https://source.android.com/devices/architecture/treble">Treble</a> - “a major re-architect of the Android OS framework designed to make it easier, faster, and less costly for manufacturers to update devices to a new version of Android.”</li>
<li><a class="reference external" href="https://github.com/dkhuuthe/MADLIRA">MADLIRA</a> - MADLIRA is a tool for Android malware detection</li>
<li><a class="reference external" href="https://www.bleepingcomputer.com/news/linux/botched-npm-update-crashes-linux-systems-forces-users-to-reinstall/">Botched npm Update Crashes Linux Systems, Forces Users to Reinstall</a> and <a class="reference external" href="https://github.com/npm/npm/issues/19883">Critical Linux filesystem permissions are being changed by latest version</a></li>
<li><a class="reference external" href="https://undeadly.org/cgi?action=article;sid=20180221201856">Meltdown fix committed by guenther&#64;</a></li>
<li><a class="reference external" href="https://githubengineering.com/crypto-removal-notice/">Weak cryptographic standards removal notice</a> - GitHub to remove several weak cryptographic standards</li>
<li><a class="reference external" href="https://cure53.de/browser-security-whitepaper.pdf">Cure53 Browser Security White Paper</a> (very long)</li>
<li><a class="reference external" href="https://bombich.com/blog/2018/02/15/macos-may-lose-data-on-apfs-formatted-disk-images">macOS may lose data on APFS-formatted disk images</a></li>
</ol>
</div>
<div class="section" id="tools">
<h4>11.24.1.1.3. Tools<a class="headerlink" href="#tools" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><a class="reference external" href="https://github.com/zricethezav/gitleaks">GitLeaks</a> - Check git repos for secrets and keys</li>
<li><a class="reference external" href="https://github.com/LloydLabs/elf-strings">elf-string</a> - The better <code class="docutils literal notranslate"><span class="pre">strings</span></code> utility for the reverse engineer.</li>
<li><a class="reference external" href="https://github.com/danielbohannon/Revoke-Obfuscation">Revoke-Obfuscation v1.0</a> - an open-source PowerShell v3.0+ framework for detecting obfuscated PowerShell commands and scripts at scale</li>
</ol>
</div>
<div class="section" id="study-links">
<h4>11.24.1.1.4. Study links<a class="headerlink" href="#study-links" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><a class="reference external" href="https://www.owasp.org/images/3/33/Automated-threat-handbook.pdf">OWASP Automated Threat Handbook - Web Applications</a></li>
<li><a class="reference external" href="https://blog.cloudflare.com/how-developers-got-password-security-so-wrong/">How Developers got Password Security so Wrong</a></li>
<li><a class="reference external" href="http://blog.ptsecurity.com/2018/02/new-bypass-and-protection-techniques.html?m=1">New bypass and protection techniques for ASLR on Linux</a></li>
<li><a class="reference external" href="https://littlemaninmyhead.wordpress.com/2018/02/18/secure-coding-understanding-input-validation/">Secure Coding: Understanding Input Validation</a></li>
<li><a class="reference external" href="https://github.com/blackzert/aslur/raw/master/offensivecon-talk.pdf">Linux ASLR and GNU Libc: Address space layout computing and defence, and “stack canary” protection bypass</a></li>
<li><a class="reference external" href="https://hackernoon.com/securing-your-linux-web-server-2be683c223eb">Securing your Linux web server</a></li>
<li><a class="reference external" href="https://lwn.net/SubscriberLink/747551/7b37e1ce398c30c0/">BPF comes to firewalls</a> - “The Linux kernel currently supports two separate network packet-filtering mechanisms: iptables and nftables. For the last few years, it has been generally assumed that nftables would eventually replace the older iptables implementation; few people expected that the kernel developers would, instead, add a third packet filter. But that would appear to be what is happening with the newly announced bpfilter mechanism. Bpfilter may eventually replace both iptables and nftables … . The end result is that we’ll probably not see bpfilter in the mainline kernel in the immediate future. Given the developers who have worked on it, though, bpfilter is clearly a serious initiative that is firmly aimed at getting into the mainline eventually.”</li>
<li><a class="reference external" href="https://software.intel.com/sites/default/files/managed/1d/46/Retpoline-A-Branch-Target-Injection-Mitigation.pdf">Retpoline: A Branch Target Injection Mitigation</a></li>
<li><a class="reference external" href="https://github.com/maxchehab/CSS-Keylogging">CSS Keylogger</a></li>
<li><a class="reference external" href="http://cert.europa.eu/static/WhitePapers/CERT-EU_SWP_17-002_Lateral_Movements.pdf">Detecting Lateral Movements in Windows Infrastructure</a></li>
<li><a class="reference external" href="https://0x00sec.org/t/userland-api-monitoring-and-code-injection-detection/5565">Userland API Monitoring and Code Injection Detection</a></li>
<li><a class="reference external" href="http://www.msreverseengineering.com/blog/2018/1/23/a-walk-through-tutorial-with-code-on-statically-unpacking-the-finspy-vm-part-one-x86-deobfuscation">A Walk-Through Tutorial, with Code, on Statically Unpacking the FinSpy VM: Part One, x86 Deobfuscation</a> - first of a multi-part series …</li>
</ol>
</div>
<div class="section" id="privacy-links">
<h4>11.24.1.1.5. Privacy links<a class="headerlink" href="#privacy-links" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><a class="reference external" href="http://daynebatten.com/2018/02/google-should-prevent-calendar-spam/">Google Calendar should prevent spam by default</a></li>
<li><a class="reference external" href="https://sec.eff.org/articles/web-browsing-security">An Overview of Web Browsing Security</a></li>
<li><a class="reference external" href="https://www.engadget.com/2018/02/22/china-xinjiang-surveillance-tech-spread/">China’s Xinjiang surveillance is the dystopian future nobody wants</a></li>
<li><a class="reference external" href="https://blog.machinebox.io/face-verify-js-monitoring-who-is-looking-at-a-website-for-additional-security-1d6025a8fedd">face-verify.js: Monitoring who is physically looking at a website for additional security</a> and <a class="reference external" href="https://github.com/machinebox/toys/tree/master/faceverify">Face Verify</a></li>
<li><a class="reference external" href="https://torrentfreak.com/flight-sim-company-embeds-malware-to-steal-pirates-passwords-180219/">Flight Sim Company Embeds Malware to Steal Pirates’ Passwords</a></li>
<li><a class="reference external" href="https://www.wired.co.uk/article/linkuk-bt-google-free-wifi-and-calls-london">Stop replacing London’s phone boxes with corporate surveillance</a></li>
</ol>
</div>
<div class="section" id="cultural-legal-political">
<h4>11.24.1.1.6. Cultural/Legal/Political<a class="headerlink" href="#cultural-legal-political" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><a class="reference external" href="https://www.xkcd.com/1957/">2018 CVE List</a></li>
<li><a class="reference external" href="https://krebsonsecurity.com/2018/02/money-laundering-via-author-impersonation-on-amazon/">Money Laundering Via Author Impersonation on Amazon?</a></li>
</ol>
</div>
<div class="section" id="hacking-links">
<h4>11.24.1.1.7. Hacking links<a class="headerlink" href="#hacking-links" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p class="first"><a class="reference external" href="https://www.peew.pw/blog/2018/2/22/how-i-identified-93k-domain-frontable-cloudfront-domains">How I Identified 93k Domain-Frontable CloudFront Domains</a> - make a request for a resource on CloudFront, then change the target domain while leaving the host header the same</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl -s -H <span class="s2">&quot;Host: images-na.ssl-images-amazon.com&quot;</span> -H <span class="s2">&quot;Connection: close&quot;</span> <span class="s2">&quot;https://cdn.atlassian.com/images/I/01rgQ3jqo7L.css&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first"><a class="reference external" href="https://blogs.technet.microsoft.com/motiba/2018/02/23/detecting-kerberoasting-activity-using-azure-security-center/">Detecting Kerberoasting activity using Azure Security Center</a></p>
</li>
<li><p class="first"><a class="reference external" href="https://twitter.com/GossiTheDog/status/966748041897299968">Bingo. It’s happening. LA Times is serving cryptomining, their S3 bucket with their JavaScript code was world writable and even contains this file (4th screenshot). H/T &#64;bad_packets</a> and <a class="reference external" href="https://www.itwire.com/security/81860-la-times-serving-cryptocurrency-mining-script.html">LA Times serving cryptocurrency mining script</a></p>
</li>
<li><p class="first"><a class="reference external" href="https://www.recordedfuture.com/code-signing-certificates/">The Use of Counterfeit Code Signing Certificates Is on the Rise</a> and <a class="reference external" href="https://arstechnica.com/information-technology/2018/02/counterfeit-certificates-sold-online-make-digitally-signed-malware-a-snap/">One-stop counterfeit certificate shops for all your malware-signing needs</a></p>
</li>
<li><p class="first"><a class="reference external" href="https://www.sec-consult.com/en/blog/2018/02/internet-of-babies-when-baby-monitors-fail-to-be-smart/index.html">Internet of Babies – When baby monitors fail to be smart</a></p>
</li>
<li><p class="first"><a class="reference external" href="https://github.com/brthor/docker-layer2-icc">Docker Layer 2 ICC Bug</a></p>
</li>
<li><p class="first"><a class="reference external" href="https://rhinosecuritylabs.com/application-security/xxe-zeroday-vulnerability-in-hp-project/">Hiding in Plain Sight: XXE Vulnerability in HP Project &amp; Portfolio Mgmt Center</a></p>
</li>
<li><p class="first"><a class="reference external" href="https://www.coresecurity.com/advisories/trend-micro-email-encryption-gateway-multiple-vulnerabilities">Trend Micro Email Encryption Gateway Multiple Vulnerabilities</a></p>
</li>
<li><p class="first"><a class="reference external" href="http://riscy.business/2018/02/ida-remote-execution/">IDA text Execution</a></p>
</li>
<li><p class="first"><a class="reference external" href="https://blog.malwarebytes.com/threat-analysis/2018/02/chinese-criminal-experiments-with-exploits-in-drive-by-download-campaign/">Drive-by download campaign targets Chinese websites, experiments with exploits</a></p>
</li>
<li><p class="first"><a class="reference external" href="https://www.fidusinfosec.com/nomachine-road-code-execution-without-fuzzing-cve-2018-6947/">NoMachine Un-initialised Variable Privilege Escalation – A fuzz-less exploit tutorial – CVE-2018-6947</a></p>
</li>
<li><p class="first"><a class="reference external" href="https://bugs.chromium.org/p/project-zero/issues/detail?id=1428">Windows: StorSvc SvcMoveFileInheritSecurity Arbitrary File Security Descriptor Overwrite EoP</a></p>
</li>
<li><p class="first"><a class="reference external" href="https://bugs.chromium.org/p/project-zero/issues/detail?id=1524">utorrent: various JSON-RPC issues resulting in remote code execution, information disclosure, etc.</a> and <a class="reference external" href="https://arstechnica.com/information-technology/2018/02/utorrent-bugs-let-websites-control-your-computer-and-steal-your-downloads/">uTorrent bugs let websites control your computer and steal your downloads</a></p>
</li>
<li><p class="first"><a class="reference external" href="https://fabricegrinda.com/hacked-cryptocurrencies-stolen/">How I was hacked, and all my cryptocurrencies were stolen!</a></p>
</li>
<li><p class="first"><a class="reference external" href="https://bugs.chromium.org/p/project-zero/issues/detail?id=1524">utorrent: various JSON-RPC issues resulting in remote code execution, information disclosure, etc.</a></p>
</li>
<li><p class="first"><a class="reference external" href="http://fortune.com/2018/02/20/tesla-hack-amazon-cloud-cryptocurrency-mining/">Tesla Hackers Hijacked Amazon Cloud Account to Mine Cryptocurrency</a> and <a class="reference external" href="https://blog.redlock.io/cryptojacking-tesla">Lessons from the Cryptojacking Attack at Tesla</a></p>
</li>
<li><p class="first"><a class="reference external" href="https://arstechnica.com/information-technology/2018/02/cryptocurrency-mining-criminals-that-netted-3-million-gear-up-for-more/">Cryptocurrency-mining criminals that netted $3 million gear up for more</a> - “has been running the XMRig miner on many versions of Windows and …  has now upped his game by targeting the powerful Jenkins CI server …`as many as 20 percent of Jenkins servers are misconfigured &lt;<a class="reference external" href="https://emtunc.org/blog/01/2018/research-misconfigured-jenkins-servers/">https://emtunc.org/blog/01/2018/research-misconfigured-jenkins-servers/</a>&gt;`_ in ways that make serious hacks possible … exploiting <a class="reference external" href="https://jenkins.io/security/advisory/2017-04-26/">CVE-2017-1000353</a>”</p>
</li>
<li><p class="first"><a class="reference external" href="https://secrary.com/Random/BypassUserHooks/">Bypass User-Mode Hooks</a></p>
</li>
</ol>
</div>
</div>
<div class="section" id="reasons-to-use-cloud-vms">
<h3>11.24.1.2. Reasons to use cloud VMs<a class="headerlink" href="#reasons-to-use-cloud-vms" title="Permalink to this headline">¶</a></h3>
<div class="section" id="benefits-of-cloud-vms">
<h4>11.24.1.2.1. Benefits of cloud VMs<a class="headerlink" href="#benefits-of-cloud-vms" title="Permalink to this headline">¶</a></h4>
<p>This author is gradually moving processing to cloud servers for several reasons:</p>
<ul>
<li><p class="first">Proof of concept</p>
<p>Demonstrate what can and cannot be moved to the cloud. You’re probably not moving your gaming to the cloud nor scanning documents from a local printer/scanner, but you can move your tax computation and lots of computer security testing.</p>
</li>
<li><p class="first">Reduce local device count, costs, and maintenance</p>
<p>The goal is to use Chromebox/Chromebook devices from anywhere. Then you can use fewer, simpler computers. And they require far less sysadmin work.</p>
</li>
<li><p class="first">Acquire cloud configuration knowledge and skills</p>
<p>Choose your cloud providers based on your needs: low cost providers vs needed job skills (think AWS).</p>
</li>
<li><p class="first">Immensely faster cloud VM Internet connection speeds</p>
<p><code class="docutils literal notranslate"><span class="pre">speedtest-cli</span></code> on the 512 MB GCE instance just showed 238/195 Mbps download/upload speeds. However, please remember that the smaller VMs do have limited processing power.</p>
</li>
<li><p class="first">Increase security with improved disaster recovery</p>
<p>Cloud VMs are based on server-class hardware with increased reliability. And their creation can be automated (outside of the data). Two cloud VMs can serve as backups for each other’s data.</p>
</li>
</ul>
<p>The author first migrated the processing for this website: it comfortably fit on the free Google Compute Engine 512MB VM instance. The author can now work from anywhere (allowing SSH outbound access) using a Chromebook. No more configuring every machine to run the proper web authoring software - it’s all done from the already-configured GCE instance.</p>
</div>
<div class="section" id="persistent-vms-persistent-disks-vs-non-persistent-vms">
<h4>11.24.1.2.2. Persistent VMs, persistent disks, vs non-persistent VMs<a class="headerlink" href="#persistent-vms-persistent-disks-vs-non-persistent-vms" title="Permalink to this headline">¶</a></h4>
<p>Here are some cloud VM options from more to less expensive:</p>
<dl class="docutils">
<dt>Persistent VM - $5/10/20 per month for 1/2/4 GB memory VMs</dt>
<dd><p class="first">Here the VM runs 7x24 with the advantage of permanent IP, immediate availability, significant persistent storage, and even easy access from a Chromebook.</p>
<p class="last">The author uses a free (tiny 512 MB) Google Compute Engine instance for authoring this website and accessing other cloud services from a Chromebook (and other Linux devices). A 1 GB Linode or Digital Ocean VM would cost $5/month.</p>
</dd>
<dt>Persistent OS Disk - $2/month for a 20GB disk + 3/4 cents/hour run costs</dt>
<dd><p class="first">Not all providers support this, but with some configuration effort the persistent disk can be booted using possibly different memory size configurations each boot.</p>
<p class="last">So the OS doesn’t need configuration each boot (all needed packages are already installed), only the IP changes each usage and there is some effort to start the VM. But the memory flexibility can be a big advantage. And not having it running when not needed can be a security advantage.</p>
</dd>
<dt>Persistent Data Disk - $1/month for a 10 GB disk + 3/4 cents/hour run costs</dt>
<dd><p class="first">This one assumes your OS image needs are either generic or can be scripted.</p>
<p>For example, the cloud VM to author this website would require scripting to:</p>
<ul class="simple">
<li>VM security hardening: create a non-root user with SSH-only access; turn off SSH root login; disable password-based SSH login.</li>
<li>Install the Sphinx-based authoring software for this website: <strong class="program">conda</strong> for Python environments; Sphinx authoring software; Google Cloud SDK; AWS CLI.</li>
</ul>
<p class="last">This can be a real option when the cloud provider allows boot-time configuration scripts and your VM can be configured quickly using one of these scripts.</p>
</dd>
<dt>Non-persistent VMs - least expensive alternative</dt>
<dd>Here the VM is created/destroyed as needed. This can work if the cloud provider allows boot-time configuration scripts that quickly configure your VM (including downloading the needed data).</dd>
</dl>
</div>
<div class="section" id="energy-savings-less-hardware-offset-some-vm-costs">
<h4>11.24.1.2.3. Energy savings &amp; less hardware offset some VM costs<a class="headerlink" href="#energy-savings-less-hardware-offset-some-vm-costs" title="Permalink to this headline">¶</a></h4>
<p>The real cost savings of cloud VMs come when less local hardware is needed. If you can save $600 or more by not purchasing a machine (with a lifespan of 5 years), that would roughly pay for 2 7x24 1 GB RAM VMs over those 5 years. Or many more non-persistent cloud VMs.</p>
<p>However, just energy savings alone can offset the cost of VMs. Compare using a mid-2011 iMac (135W idle, 170W max) vs a Chromebox (15W max) + 27” monitor (30W max) + cloud VM. The local electric rates are roughly $0.23/kWh. The extra 100W+ an iMac consumes costs roughly 100/1000 * $0.23 = $0.023/hour. Running the desktop 8 hours/day costs an additional $5/month, enough to pay for a 1 GB VM at Linode or Digital Ocean. In other words, running a Chromebox can pay for a $5 Linode 1 GB VM.</p>
</div>
</div>
</div>
<div class="section" id="study-this-week">
<h2>11.24.2. Study this week<a class="headerlink" href="#study-this-week" title="Permalink to this headline">¶</a></h2>
<div class="section" id="ssl-tls-using-self-signed-and-let-s-encrypt-certificates">
<h3>11.24.2.1. SSL/TLS using self-signed and Let’s Encrypt certificates<a class="headerlink" href="#ssl-tls-using-self-signed-and-let-s-encrypt-certificates" title="Permalink to this headline">¶</a></h3>
<p>We’ll be doing this demo from a Debian 9 cloud VM resolvable via sbwasp.bitbender.org.</p>
<div class="section" id="generating-and-using-self-signed-certificates">
<h4>11.24.2.1.1. Generating and using self-signed certificates<a class="headerlink" href="#generating-and-using-self-signed-certificates" title="Permalink to this headline">¶</a></h4>
<p>We’ll mostly follow <a class="reference external" href="http://www.dest-unreach.org/socat/doc/socat-openssltunnel.html">Securing Traffic Between two Socat Instances Using SSL</a> to illustrate both creating self-signed certificates then using them to mutually verify both ends of a TLS connection.</p>
<p>We’ll start by creating a server and client self-signed certificte:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># Do this in $HOME/tmp</span>
</span><span class="nv">CERTDIR</span><span class="o">=</span><span class="nv">$HOME</span>/tmp
mkdir -p <span class="nv">$CERTDIR</span>
<span class="nb">cd</span> <span class="nv">$CERTDIR</span>

<span class="hll"><span class="c1"># Server certificate</span>
</span><span class="nv">FILENAME</span><span class="o">=</span>server
<span class="nv">SUBJ</span><span class="o">=</span><span class="s2">&quot;/C=US/ST=California/L=Redondo Beach/O=SBWASP/OU=Meetup/CN=sbwasp.bitbender.org&quot;</span>
<span class="hll"><span class="c1"># Create PEM format private key</span>
</span><span class="hll"><span class="c1">#   = base64 encoded DER format (compatible with PKCS#10) with header/footer lines.</span>
</span><span class="hll"><span class="c1"># Private key is 2048 bit RSA, not encrypted.</span>
</span>openssl genrsa -out <span class="nv">$FILENAME</span>.key <span class="m">2048</span>
openssl rsa -in <span class="nv">$FILENAME</span>.key -text
<span class="hll"><span class="c1"># Generate self-signed certificate using just-generated private key.</span>
</span>openssl req -new -key <span class="nv">$FILENAME</span>.key -x509 -days <span class="m">3653</span> -out <span class="nv">$FILENAME</span>.crt -subj <span class="s2">&quot;</span><span class="nv">$SUBJ</span><span class="s2">&quot;</span>
openssl x509 -in <span class="nv">$FILENAME</span>.crt -text
cat <span class="nv">$FILENAME</span>.key <span class="nv">$FILENAME</span>.crt &gt;<span class="nv">$FILENAME</span>.pem
chmod <span class="m">600</span> <span class="nv">$FILENAME</span>.key <span class="nv">$FILENAME</span>.pem

<span class="hll"><span class="c1"># Client certificate</span>
</span><span class="nv">FILENAME</span><span class="o">=</span>client
<span class="nv">SUBJ</span><span class="o">=</span><span class="s2">&quot;/C=US/ST=California/L=Redondo Beach/O=SBWASP/OU=Meetup/CN=oresama@bitbender.org&quot;</span>
openssl genrsa -out <span class="nv">$FILENAME</span>.key  <span class="m">2048</span>
openssl req -new -key <span class="nv">$FILENAME</span>.key -x509 -days <span class="m">3653</span> -out <span class="nv">$FILENAME</span>.crt -subj <span class="s2">&quot;</span><span class="nv">$SUBJ</span><span class="s2">&quot;</span>
cat <span class="nv">$FILENAME</span>.key <span class="nv">$FILENAME</span>.crt &gt;<span class="nv">$FILENAME</span>.pem
chmod <span class="m">600</span> <span class="nv">$FILENAME</span>.key <span class="nv">$FILENAME</span>.pem
</pre></div>
</div>
<p>Now that we have the certificates, fire up the server in it’s own terminal window. It will just echo back the request:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># Server listens to 1 client at a time (use fork for more)</span>
</span><span class="nv">CERTDIR</span><span class="o">=</span><span class="nv">$HOME</span>/tmp
<span class="nb">cd</span> <span class="nv">$CERTDIR</span>
sudo apt install socat -y  &lt; /dev/null
<span class="hll">socat openssl-listen:8080,reuseaddr,cert<span class="o">=</span><span class="nv">$CERTDIR</span>/server.pem,cafile<span class="o">=</span><span class="nv">$CERTDIR</span>/client.crt <span class="nb">echo</span>
</span><span class="c1"># Alternatively a shell command could be run</span>
<span class="c1"># socat openssl-listen:8080,fork,reuseaddr,cert=$CERTDIR/server.pem,cafile=$CERTDIR/client.crt exec:&quot;ip addr show&quot;</span>
</pre></div>
</div>
<p>In another window fire up the client:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># Client connects by running any old shell command to get echo&#39;ed back</span>
</span><span class="nv">CERTDIR</span><span class="o">=</span><span class="nv">$HOME</span>/tmp
<span class="nb">cd</span> <span class="nv">$CERTDIR</span>
<span class="hll">ls <span class="p">|</span> <span class="se">\</span>
</span><span class="hll">  socat stdio openssl-connect:sbwasp.bitbender.org:8080,cert<span class="o">=</span><span class="nv">$CERTDIR</span>/client.pem,cafile<span class="o">=</span><span class="nv">$CERTDIR</span>/server.crt
</span></pre></div>
</div>
<p>The client will see whatever was generated by <code class="docutils literal notranslate"><span class="pre">ls</span></code> echoed back, or the results of the <code class="docutils literal notranslate"><span class="pre">ip</span> <span class="pre">addr</span> <span class="pre">show</span></code> command if that was selected. Terminate any running processes in the 2 terminal windows.</p>
<p>Now we’ll demonstrate how to use the certificate just generated to serve web pages:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># Try website TLS1.2 encryption using the server certificate</span>
</span><span class="c1">#   Any web content will do.</span>
<span class="c1"># Fire up the HTTP server on port 8000 (it could be restricted to localhost).</span>
<span class="nv">CERTDIR</span><span class="o">=</span><span class="nv">$HOME</span>/tmp
<span class="nv">WEBSITE</span><span class="o">=</span><span class="nv">$CERTDIR</span>/web
mkdir -p <span class="nv">$WEBSITE</span>
<span class="nb">echo</span> <span class="s2">&quot;hello&quot;</span> &gt; <span class="nv">$WEBSITE</span>/index.html
<span class="hll"><span class="o">(</span><span class="nb">cd</span> <span class="nv">$WEBSITE</span><span class="p">;</span> python3 -m http.server <span class="m">8000</span><span class="o">)</span> <span class="p">&amp;</span>
</span><span class="hll"><span class="c1"># Now fire up socat to provide the TLS1.2</span>
</span><span class="hll">socat -s openssl-listen:8080,method<span class="o">=</span>TLS1.2,fork,reuseaddr,keepalive,verify<span class="o">=</span><span class="m">0</span>,cert<span class="o">=</span><span class="nv">$CERTDIR</span>/server.pem tcp:localhost:8000
</span></pre></div>
</div>
<p>Now fire up any web browser or use <code class="docutils literal notranslate"><span class="pre">curl</span></code> to test the TLS1.2 encryption:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># Show curl fails when certificate checked (the default)</span>
</span>curl https://sbwasp.bitbender.org:8080
<span class="hll"><span class="c1"># Show curl succeeds using TLS1.2 when certificate not verified</span>
</span>curl --insecure --verbose --output /dev/null  https://sbwasp.bitbender.org:8080
</pre></div>
</div>
<p>Alternatives <code class="docutils literal notranslate"><span class="pre">curl</span></code> to check the certificate details are a browser or <code class="docutils literal notranslate"><span class="pre">openssl</span> <span class="pre">s_client</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="nb">echo</span> -ne <span class="s2">&quot;HEAD / HTTP/1.1\n\nHost: sbwasp.bitbender.org\n\n\n\n&quot;</span> <span class="p">|</span> <span class="se">\</span>
</span><span class="hll">    openssl s_client -connect sbwasp.bitbender.org:8080
</span></pre></div>
</div>
<p>Kill the extra listenting processes (<code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">ss</span> <span class="pre">-tnlp</span></code> will show the PIDs to <code class="docutils literal notranslate"><span class="pre">kill</span></code>).</p>
</div>
<div class="section" id="let-s-encrypt-certificate-via-dehydrated">
<h4>11.24.2.1.2. Let’s Encrypt certificate via <strong class="program">dehydrated</strong><a class="headerlink" href="#let-s-encrypt-certificate-via-dehydrated" title="Permalink to this headline">¶</a></h4>
<div class="section" id="installing-dehydrated">
<h5>11.24.2.1.2.1. Installing <strong class="program">dehydrated</strong><a class="headerlink" href="#installing-dehydrated" title="Permalink to this headline">¶</a></h5>
<p><a class="reference external" href="https://github.com/lukas2511/dehydrated">dehydrated</a> depends on <code class="docutils literal notranslate"><span class="pre">openssl</span></code>, <code class="docutils literal notranslate"><span class="pre">curl</span></code>, <code class="docutils literal notranslate"><span class="pre">sed</span></code>, <code class="docutils literal notranslate"><span class="pre">grep</span></code>, and <code class="docutils literal notranslate"><span class="pre">mktemp</span></code>. It can be installed manually or via a Debian package. For Debian 9 it’s best to use stretch-backports but we don’t do that today:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="hll">cat <span class="s">&lt;&lt;&#39;EOF&#39; | sudo tee /etc/apt/sources.list.d/backport.list</span>
</span><span class="s">deb http://deb.debian.org/debian/ stretch-backports main</span>
<span class="s">deb-src http://deb.debian.org/debian/ stretch-backports main</span>
<span class="s">EOF</span>
<span class="hll">sudo apt update  &lt; /dev/null
</span><span class="hll">sudo apt -t stretch-backports dehydrated -y  &lt; /dev/null
</span></pre></div>
</div>
<p>Since the demo install is a throw-away, we’ll used a temporary directory (easy to clean up) and clone from GitHub:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pick a configuration directory based on who is running it</span>
<span class="nv">CDIR</span><span class="o">=</span><span class="nv">$HOME</span>/tmp
<span class="nb">cd</span> <span class="nv">$CDIR</span>/
sudo apt install git -y  &lt; /dev/null
<span class="hll">git clone https://github.com/lukas2511/dehydrated.git
</span></pre></div>
</div>
<p>Configuring <code class="docutils literal notranslate"><span class="pre">dehydrated</span></code> involves modifying 3 files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># Create a website</span>
</span><span class="nv">WEBSITE</span><span class="o">=</span><span class="nv">$CDIR</span>/web
mkdir -p <span class="nv">$WEBSITE</span>
<span class="nb">echo</span> <span class="s2">&quot;hello&quot;</span> &gt; <span class="nv">$WEBSITE</span>/index.html
<span class="hll"><span class="c1"># Pick a configuration directory based on who is running it</span>
</span><span class="nb">cd</span> <span class="nv">$CDIR</span>/
cp <span class="nv">$CDIR</span>/dehydrated/docs/examples/<span class="o">{</span>config,domains.txt,hook.sh<span class="o">}</span> <span class="nv">$CDIR</span>/
<span class="hll"><span class="c1"># domains.txt</span>
</span><span class="hll"><span class="c1">#   Each line is a certificate, first domain is cert name, rest are aliases.</span>
</span><span class="hll"><span class="nb">echo</span> <span class="s2">&quot;sbwasp.bitbender.org&quot;</span> &gt; domains.txt
</span><span class="hll"><span class="c1"># config used for command defaults - likely make these changes:</span>
</span>sed -i <span class="s1">&#39;s|^#BASEDIR.*$|BASEDIR=&#39;</span><span class="nv">$CDIR</span><span class="s1">&#39;|&#39;</span> config
sed -i <span class="s1">&#39;s/^#CHALLENGETYPE=&quot;http-01&quot;/CHALLENGETYPE=&quot;http-01&quot;/&#39;</span> config
<span class="c1"># Note - for AWS CloudFront set KEYSIZE=&quot;2048&quot;</span>
sed -i <span class="s1">&#39;s|^#WELLKNOWN=.*$|WELLKNOWN=&#39;</span><span class="nv">$WEBSITE</span><span class="s1">&#39;/.well-known/acme-challenge|&#39;</span> config
mkdir -p <span class="nv">$WEBSITE</span>/.well-known/acme-challenge
sed -i <span class="s1">&#39;s|^#HOOK=.*$|HOOK=&quot;$BASEDIR/hook.sh&quot;|&#39;</span> config
sed -i <span class="s1">&#39;s/^#PRIVATE_KEY_RENEW=.*$/PRIVATE_KEY_RENEW=&quot;no&quot;/&#39;</span> config

<span class="hll"><span class="c1"># The most significant part is hooks.sh configuration of:</span>
</span><span class="hll"><span class="c1">#   deploy_challenge() - copy challenge to $WEBSITE/.well-known/acme-challenge/...</span>
</span><span class="hll"><span class="c1">#   deploy_cert() - socat -s openssl-listen:8080,...,cert=NEWCERT,...</span>
</span>
<span class="hll">cat &gt; hook.sh <span class="s">&lt;&lt;&#39;EOF&#39;</span>
</span><span class="s">#!/usr/bin/env bash</span>

<span class="s">deploy_challenge() {</span>
<span class="s">    local DOMAIN=&quot;${1}&quot; TOKEN_FILENAME=&quot;${2}&quot; TOKEN_VALUE=&quot;${3}&quot;</span>
<span class="s">    echo &quot;$TOKEN_VALUE&quot; &gt; $WELLKNOWN/$TOKEN_FILENAME</span>
<span class="s">}</span>

<span class="s">clean_challenge() {</span>
<span class="s">    local DOMAIN=&quot;${1}&quot; TOKEN_FILENAME=&quot;${2}&quot; TOKEN_VALUE=&quot;${3}&quot;</span>
<span class="s">    rm -f $WELLKNOWN/$TOKEN_FILENAME</span>
<span class="s">}</span>

<span class="s">deploy_cert() {</span>
<span class="s">    local DOMAIN=&quot;${1}&quot; KEYFILE=&quot;${2}&quot; CERTFILE=&quot;${3}&quot; FULLCHAINFILE=&quot;${4}&quot; CHAINFILE=&quot;${5}&quot; TIMESTAMP=&quot;${6}&quot;</span>
<span class="s">    # Deploying a cert using socat is just creating a new server cert:</span>
<span class="s">    # cat $KEYFILE $CERTFILE $CHAINFILE &gt; $CERTDIR/server_le.pem</span>
<span class="s">    # To use it restart socat something like</span>
<span class="s">    # ( sudo socat openssl-listen:443,fork,reuseaddr,keepalive,method=TLS1.2,cert=$CERTDIR/server_le.pem,verify=0 tcp:localhost:8000 )&amp;</span>
<span class="s">}</span>

<span class="s">unchanged_cert() {</span>
<span class="s">    local DOMAIN=&quot;${1}&quot; KEYFILE=&quot;${2}&quot; CERTFILE=&quot;${3}&quot; FULLCHAINFILE=&quot;${4}&quot; CHAINFILE=&quot;${5}&quot;</span>
<span class="s">}</span>

<span class="s">invalid_challenge() {</span>
<span class="s">    local DOMAIN=&quot;${1}&quot; RESPONSE=&quot;${2}&quot;</span>
<span class="s">    echo &quot;Subject: Validation of ${DOMAIN} failed!\n\nOh noez!&quot;</span>
<span class="s">}</span>

<span class="s">request_failure() {</span>
<span class="s">    local STATUSCODE=&quot;${1}&quot; REASON=&quot;${2}&quot; REQTYPE=&quot;${3}&quot; HEADERS=&quot;${4}&quot;</span>
<span class="s">    echo &quot;Subject: HTTP request failed failed!\n\nA http request failed with status ${STATUSCODE}!&quot;</span>
<span class="s">}</span>

<span class="s">generate_csr() {</span>
<span class="s">    local DOMAIN=&quot;${1}&quot; CERTDIR=&quot;${2}&quot; ALTNAMES=&quot;${3}&quot;</span>
<span class="s">    echo &quot;generater_csr() call&quot;</span>
<span class="s">}</span>

<span class="s">startup_hook() {</span>
<span class="s">  :</span>
<span class="s">}</span>

<span class="s">exit_hook() {</span>
<span class="s">  :</span>
<span class="s">}</span>

<span class="s">HANDLER=&quot;$1&quot;; shift</span>
<span class="s">if [[ &quot;${HANDLER}&quot; =~ ^(deploy_challenge|clean_challenge|deploy_cert|unchanged_cert|invalid_challenge|request_failure|generate_csr|startup_hook|exit_hook)$ ]]; then</span>
<span class="s">  &quot;$HANDLER&quot; &quot;$@&quot;</span>
<span class="s">fi</span>
<span class="hll"><span class="s">EOF</span>
</span>
<span class="hll"><span class="c1"># Use staging server</span>
</span>sed -i <span class="s1">&#39;s|^#*CA=.*$|CA=&quot;https://acme-staging.api.letsencrypt.org/directory&quot;|&#39;</span> config

<span class="hll"><span class="c1"># Redirect port 80 to 8000</span>
</span><span class="o">(</span><span class="nb">cd</span> <span class="nv">$WEBSITE</span><span class="p">;</span> python3 -m http.server <span class="m">8000</span><span class="o">)</span><span class="p">&amp;</span>
<span class="o">(</span>sudo socat tcp-listen:80,fork,reuseaddr,keepalive tcp:localhost:8000<span class="o">)</span><span class="p">&amp;</span>

<span class="hll">dehydrated/dehydrated -c --config ./config --accept-terms --ipv4
</span>
<span class="hll"><span class="c1"># Now ready for operational server</span>
</span>sed -i <span class="s1">&#39;s|^#*CA=.*$|CA=&quot;https://acme-v01.api.letsencrypt.org/directory&quot;|&#39;</span> config

<span class="hll">dehydrated/dehydrated -c --config ./config --accept-terms --ipv4
</span></pre></div>
</div>
<p>Assuming the cert request succeeds you can test it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="nv">LEDIR</span><span class="o">=</span><span class="nv">$CERTDIR</span>/certs/sbwasp.bitbender.org
</span><span class="hll">cat <span class="nv">$LEDIR</span>/privkey.pem <span class="nv">$LEDIR</span>/cert.pem <span class="nv">$LEDIR</span>/chain.pem &gt; server_le.pem
</span><span class="hll"><span class="o">(</span>sudo socat openssl-listen:443,fork,reuseaddr,keepalive,method<span class="o">=</span>TLS1.2,cert<span class="o">=</span><span class="nv">$CERTDIR</span>/server_le.pem tcp:localhost:8000<span class="o">)</span><span class="p">&amp;</span>
</span><span class="hll">curl --verbose --output /dev/null  https://sbwasp.bitbender.org
</span></pre></div>
</div>
<p>When done use <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">ss</span> <span class="pre">-tnlp</span></code> and <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">kill</span></code> to cleanup background processes.</p>
</div>
</div>
</div>
<div class="section" id="installing-metasploit-framework">
<h3>11.24.2.2. Installing Metasploit Framework<a class="headerlink" href="#installing-metasploit-framework" title="Permalink to this headline">¶</a></h3>
<div class="section" id="metasploit-framework-vs-metasploit">
<h4>11.24.2.2.1. Metasploit Framework vs Metasploit<a class="headerlink" href="#metasploit-framework-vs-metasploit" title="Permalink to this headline">¶</a></h4>
<p>If you go to <a class="reference external" href="https://www.rapid7.com/products/metasploit/download/editions/">Metasploit compare features</a> you’ll currently see 4 versions with decreasing capability: Pro (paid), Express (paid), Community (free but signup required), and Framework (command line, open source version we’ll install here).</p>
</div>
<div class="section" id="installation-instructions">
<h4>11.24.2.2.2. Installation instructions<a class="headerlink" href="#installation-instructions" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="http://www.metasploit.com/">Metasploit</a> is based on the open source BSD licensed <a class="reference external" href="https://github.com/rapid7/metasploit-framework">Metasploit Framework</a>. It can be installed in Linux, OS X, and Windows following the <a class="reference external" href="https://github.com/rapid7/metasploit-framework/wiki/Nightly-Installers">Metasploit Framework Open Source Nightly Installers</a>. To keep the Metasploit Framework updated use <strong class="program">apt</strong> or <strong class="program">msfupdate</strong>.</p>
</div>
<div class="section" id="cloud-vm-installation-details">
<h4>11.24.2.2.3. Cloud VM installation details<a class="headerlink" href="#cloud-vm-installation-details" title="Permalink to this headline">¶</a></h4>
<p>Here are the steps to provision a Linode 1 GB RAM Debian 9 VM.</p>
<p>First create a Linode Stackscript to configure the Metasploit Framework VM:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="nv">STACKSCRIPT</span><span class="o">=</span>msf-setup.sh
</span><span class="hll">cat &gt; <span class="nv">$STACKSCRIPT</span> <span class="s">&lt;&lt;&#39;EOF&#39;</span>
</span><span class="s">#!/usr/bin/env bash</span>
<span class="s">apt update  &lt; /dev/null</span>
<span class="s">apt full-upgrade -y  &lt; /dev/null</span>
<span class="s">apt autoremove -y  &lt; /dev/null</span>
<span class="s">apt install unattended-upgrades -y  &lt; /dev/null</span>

<span class="s"># sudo NOPASSWD</span>
<span class="s">sed -i &#39;/^%sudo/s/ ALL$/ NOPASSWD:ALL/&#39; /etc/sudoers</span>

<span class="s">U=oresama</span>
<span class="s">useradd -c &quot;oresama&quot; -G sudo -m -s /bin/bash -U $U</span>

<span class="s">mkdir -p /home/$U/.ssh</span>
<span class="s">chmod 700 /home/$U/.ssh</span>
<span class="s">chown oresama.oresama /home/$U/.ssh</span>
<span class="s">cp $HOME/.ssh/authorized_keys /home/$U/.ssh/</span>
<span class="s">chmod 600 /home/$U/.ssh/authorized_keys</span>
<span class="s">chown oresama.oresama /home/$U/.ssh/authorized_keys</span>

<span class="s">SSHD=/etc/ssh/sshd_config</span>
<span class="s">sed -i &#39;s/^PermitRootLogin yes/PermitRootLogin no/&#39; $SSHD</span>
<span class="s">sed -i &#39;s/^PasswordAuthentication yes/PasswordAuthentication no/&#39; $SSHD</span>

<span class="s">sudo su - oresama</span>

<span class="s">curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb &gt; msfinstall &amp;&amp; \</span>
<span class="s">  chmod 755 msfinstall &amp;&amp; \</span>
<span class="s">  ./msfinstall</span>

<span class="s">sudo reboot</span>
<span class="hll"><span class="s">EOF</span>
</span>chmod +x <span class="nv">$STACKSCRIPT</span>

<span class="hll"><span class="c1"># Create the post-install script at Linode</span>
</span>linode stackscript create <span class="se">\</span>
  --label <span class="si">${</span><span class="nv">STACKSCRIPT</span><span class="p">%.sh</span><span class="si">}</span> <span class="se">\</span>
  --distribution <span class="s1">&#39;Debian 9&#39;</span> <span class="se">\</span>
  --codefile ./<span class="nv">$STACKSCRIPT</span> <span class="se">\</span>
  --description <span class="s1">&#39;Update packages, create users, no root login, no passwd login, install metasploit framework.&#39;</span>
</pre></div>
</div>
<p>Next create the VM using the existing Stackscript to configure the Metasploit Framework VM:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="nv">VM</span><span class="o">=</span>msf
</span><span class="nv">PASSWORD</span><span class="o">=</span>sbwasp-meetup
<span class="nv">SSHKEY</span><span class="o">=</span>~/.ssh/id_linode
<span class="nv">SSHPUBKEY</span><span class="o">=</span><span class="si">${</span><span class="nv">SSHKEY</span><span class="si">}</span>.pub
<span class="nv">SCRIPTNAME</span><span class="o">=</span><span class="si">${</span><span class="nv">STACKSCRIPT</span><span class="p">%.sh</span><span class="si">}</span>
<span class="hll">linode linode create <span class="se">\</span>
</span><span class="hll">  --label <span class="nv">$VM</span> <span class="se">\</span>
</span><span class="hll">  --distribution <span class="s1">&#39;Debian 9&#39;</span> <span class="se">\</span>
</span><span class="hll">  --plan linode1024 <span class="se">\</span>
</span><span class="hll">  --password <span class="s2">&quot;</span><span class="nv">$PASSWORD</span><span class="s2">&quot;</span> <span class="se">\</span>
</span><span class="hll">  --group <span class="s1">&#39;SBWASP&#39;</span> <span class="se">\</span>
</span><span class="hll">  --pubkey-file <span class="s2">&quot;</span><span class="nv">$SSHPUBKEY</span><span class="s2">&quot;</span> <span class="se">\</span>
</span><span class="hll">  --stackscript <span class="s2">&quot;</span><span class="si">${</span><span class="nv">STACKSCRIPT</span><span class="p">%.sh</span><span class="si">}</span><span class="s2">&quot;</span> <span class="se">\</span>
</span><span class="hll">  --stackscriptjson <span class="s1">&#39;{ }&#39;</span>
</span></pre></div>
</div>
<p>Next connect to the VM (which requires a little waiting):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># Get the server&#39;s IP address</span>
</span>linode list
linode show <span class="nv">$VM</span>
<span class="nv">IP</span><span class="o">=</span><span class="k">$(</span>linode show <span class="nv">$VM</span> <span class="p">|</span> grep ips <span class="p">|</span> sed <span class="s1">&#39;s/^.*: *//;s/ *$//&#39;</span><span class="k">)</span>

<span class="hll"><span class="c1"># Wait a bit</span>
</span><span class="hll">ssh -i <span class="nv">$SSHKEY</span> <span class="nv">$U</span>@<span class="nv">$IP</span>
</span><span class="hll">msfconsole
</span><span class="hll"><span class="c1"># msfdb status</span>
</span><span class="hll"><span class="c1"># search samba</span>
</span><span class="hll"><span class="c1"># exit</span>
</span></pre></div>
</div>
<p>At this point use <strong class="program">msfvenom</strong> to generate shellcode:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># Generating payloads using msfvenom and msfconsole.</span>
</span><span class="hll"><span class="c1"># To see available payloads, encoders, formats, platforms:</span>
</span>msfvenom --list payloads
msfvenom --list encoders
msfvenom --help-formats
msfvenom --help-platforms
<span class="hll"><span class="c1"># For our example we decide on:</span>
</span><span class="hll"><span class="c1">#   payload = linux/x86/exec</span>
</span><span class="hll"><span class="c1">#   encoder = x86/shikata_ga_nai</span>
</span><span class="hll"><span class="c1">#   platform = linux</span>
</span><span class="hll"><span class="c1"># NOTE: if specify &quot;--bad-chars&quot; then get encoder even without &quot;--encoder&quot;.</span>
</span><span class="hll"><span class="c1"># To see payload variables/options, fire up msfconsole to show the payload options:</span>
</span>
cat <span class="s">&lt;&lt;EOF | sudo msfconsole -r -</span>
<span class="s">use payload/linux/x86/exec</span>
<span class="s">show options</span>
<span class="s">quit</span>
<span class="s">EOF</span>
<span class="hll"><span class="c1"># This shows we need to set CMD=&quot;command string to execute&quot;.</span>
</span><span class="hll"><span class="c1"># We choose a very simple CMD, merely &quot;echo hello &gt; /tmp/hello&quot;.</span>
</span><span class="hll"><span class="c1"># Use &quot;ls -al&quot; afterwards to show that the CMD ran.</span>
</span>
<span class="hll"><span class="c1"># Here&#39;s the code to generate a python payload:</span>
</span>msfvenom --payload linux/x86/exec <span class="nv">CMD</span><span class="o">=</span><span class="s1">&#39;echo hello &gt; /tmp/hello&#39;</span> <span class="se">\</span>
         --encoder x86/shikata_ga_nai <span class="se">\</span>
         --bad-chars <span class="s2">&quot;\x00\x0a\x0d&quot;</span> <span class="se">\</span>
         --platform linux --arch x86 <span class="se">\</span>
         --format python <span class="se">\</span>
         --out shellcode.py

<span class="hll"><span class="c1"># Same shellcode without encoding (has null characters in it).</span>
</span>msfvenom --payload linux/x86/exec <span class="nv">CMD</span><span class="o">=</span><span class="s1">&#39;echo hello &gt; /tmp/hello&#39;</span> <span class="se">\</span>
         --platform linux --arch x86 <span class="se">\</span>
         --format python <span class="se">\</span>
         --out shellcode_nulls.py
<span class="hll"><span class="c1"># This time as raw bytes.</span>
</span>msfvenom --payload linux/x86/exec <span class="nv">CMD</span><span class="o">=</span><span class="s1">&#39;echo hello &gt; /tmp/hello&#39;</span> <span class="se">\</span>
         --platform linux --arch x86 <span class="se">\</span>
         --format raw <span class="se">\</span>
         --out shellcode_nulls.raw

<span class="hll"><span class="c1"># More advanced options:</span>
</span>msfvenom --help
</pre></div>
</div>
<p>At this point logout and destroy the VM:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># After logging out of the VM</span>
</span><span class="hll">linode stop <span class="nv">$VM</span>
</span><span class="hll">linode delete <span class="nv">$VM</span>
</span></pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="20180217_presentation.html" class="btn btn-neutral float-right" title="11.25. 2018-02-17 Links, Web frontend, and Malware C2" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="20180303_presentation.html" class="btn btn-neutral" title="11.23. 2018-03-03 Links, Cloud VMs, OpenSSL, Metasploit Framework" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, bitbender.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.3',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>