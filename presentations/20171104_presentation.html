

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta content="default-src 'none'; script-src 'self' https://cdnjs.cloudflare.com 'unsafe-inline'; connect-src 'self'; img-src 'self'; style-src 'self'; font-src 'self'; form-action 'self'; frame-ancestors 'none'; base-uri 'self'" http-equiv="Content-Security-Policy" />
<meta content="nosniff" http-equiv="X-Content-Type-Options" />
<meta content="deny" http-equiv="X-Frame-Options" />
<meta content="1; mode=block" http-equiv="X-XSS-Protection" />
<meta content="strict-origin" http-equiv="Referrer-Policy" />
<meta content="max-age=31536000; includeSubDomains" http-equiv="Strict-Transport-Security" />
<meta content="'*'" http-equiv="Access-Control-Allow-Origin" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>11.29. 2017-11-04 Cloud providers other than AWS &mdash; South Bay WASP 1.0.3 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="11.30. 2017-10-28 IPv6 ULA, DHCPv6, /64 prefixes, Bad Rabbit" href="20171028_presentation.html" />
    <link rel="prev" title="11.28. 2017-11-11 PKP removal, exploits galore" href="20171111_presentation.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> South Bay WASP
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pentest_intro.html">1. South Bay WASP Meetup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_kali.html">2. Kali Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_challenges.html">3. Pentest Challenges</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_encryption.html">4. Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_html.html">5. HTML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_network_tools.html">6. Pentest Network Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_recon.html">7. Pentest Reconnaisance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_study.html">8. Pentest Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_buffer_overflow.html">9. Pentest Buffer Overflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_scripting.html">10. Pentest scripting</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../pentest_presentations.html">11. Pentest Presentations</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="20180605_presentation.html">11.1. 2018-06-05 Links, Containers, and Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180526_presentation.html">11.2. 2018-05-26 Links, Containers, and Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180519_presentation.html">11.3. 2018-05-19 Links, Containers, and Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180512_presentation.html">11.4. 2018-05-12 Links, Containers, and Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180505_presentation.html">11.5. 2018-05-05 Links, Containers, and Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180428_presentation.html">11.6. 2018-04-28 Links, Containers, and Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180421_presentation.html">11.7. 2018-04-21 Links, 2FA, and Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180414_presentation.html">11.8. 2018-04-14 Links and Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180407_presentation.html">11.9. 2018-04-07 Links, nmap, and Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180331_presentation.html">11.10. 2018-03-31 Links, TLS 1.3, and Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180303_presentation.html">11.11. 2018-03-03 Links, Cloud VMs, OpenSSL, Metasploit Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180224_presentation.html">11.12. 2018-02-24 Links, Cloud VMs, Let’s Encrypt, Metasploit Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180217_presentation.html">11.13. 2018-02-17 Links, Web frontend, and Malware C2</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180210_presentation.html">11.14. 2018-02-10 Links, memory issues, and WAF</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180203_presentation.html">11.15. 2018-02-03 Links and more ROP</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180127_presentation.html">11.16. 2018-01-27 Links and ROP</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180120_presentation.html">11.17. 2018-01-20 Links and yet more Meltdown/Spectre</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180113_presentation.html">11.18. 2018-01-13 Links and more Meltdown/Spectre</a></li>
<li class="toctree-l2"><a class="reference internal" href="20170812_presentation.html">11.19. 2017-08-12 VRT, cryptography, TLS 1.3, Broadpwn, cURL, and phishing</a></li>
<li class="toctree-l2"><a class="reference internal" href="20180106_presentation.html">11.20. 2018-01-06 Invisibly fingerprinting text, Samsung no-SOP, Meltdown/Spectre</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171230_presentation.html">11.21. 2017-12-30 gohttp, hardening C/C++, Linux waitid() exploit</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171223_presentation.html">11.22. 2017-12-23 Haven, Observatory, and Janus</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171216_presentation.html">11.23. 2017-12-16 Mozilla Observatory</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171209_presentation.html">11.24. 2017-12-09 Phone tracking, AWS leaks, macOS root, exim</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171202_presentation.html">11.25. 2017-12-02 Static websites, IME follow-up</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171125_presentation.html">11.26. 2017-11-25 Not getting hacked, keystrokes, tracking, Fancy Bear, Intel ME</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171118_presentation.html">11.27. 2017-11-18 Privacy, safe languages, Linux networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171111_presentation.html">11.28. 2017-11-11 PKP removal, exploits galore</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">11.29. 2017-11-04 Cloud providers other than AWS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#links-and-updates-this-week">11.29.1. Links and updates this week</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#linode-digitalocean-google-and-microsoft-azure">11.29.1.1. Linode, DigitalOcean, Google, and Microsoft Azure</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="20171028_presentation.html">11.30. 2017-10-28 IPv6 ULA, DHCPv6, /64 prefixes, Bad Rabbit</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171021_presentation.html">11.31. 2017-10-21 IPv6 addressing, KRACK, Infineon RSA</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171014_presentation.html">11.32. 2017-10-14 Firewalls, building vulnerable hosts</a></li>
<li class="toctree-l2"><a class="reference internal" href="20171007_presentation.html">11.33. 2017-10-07 QEMU virtualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="20170930_presentation.html">11.34. 2017-09-30 virtualization and bridges</a></li>
<li class="toctree-l2"><a class="reference internal" href="20170923_presentation.html">11.35. 2017-09-23 nftables</a></li>
<li class="toctree-l2"><a class="reference internal" href="20170916_presentation.html">11.36. 2017-09-16 “VPN”</a></li>
<li class="toctree-l2"><a class="reference internal" href="20170909_presentation.html">11.37. 2017-09-09 Adding IPv6 on the EdgeRouter Lite</a></li>
<li class="toctree-l2"><a class="reference internal" href="20170826_presentation.html">11.38. 2017-08-26 Complexity, Cookies vs Tokens</a></li>
<li class="toctree-l2"><a class="reference internal" href="20170819_presentation.html">11.39. 2017-08-19 Forcing HTTPS, HTTP forwarding</a></li>
<li class="toctree-l2"><a class="reference internal" href="http_headers.html">11.40. 2017-08-05 Attacking via HTTP Headers</a></li>
<li class="toctree-l2"><a class="reference internal" href="mitm.html">11.41. MitM Presentation</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">South Bay WASP</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../pentest_presentations.html">11. Pentest Presentations</a> &raquo;</li>
        
      <li>11.29. 2017-11-04 Cloud providers other than AWS</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/presentations/20171104_presentation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cloud-providers-other-than-aws">
<h1>11.29. 2017-11-04 Cloud providers other than AWS<a class="headerlink" href="#cloud-providers-other-than-aws" title="Permalink to this headline">¶</a></h1>
<div class="section" id="links-and-updates-this-week">
<h2>11.29.1. Links and updates this week<a class="headerlink" href="#links-and-updates-this-week" title="Permalink to this headline">¶</a></h2>
<div class="section" id="linode-digitalocean-google-and-microsoft-azure">
<h3>11.29.1.1. Linode, DigitalOcean, Google, and Microsoft Azure<a class="headerlink" href="#linode-digitalocean-google-and-microsoft-azure" title="Permalink to this headline">¶</a></h3>
<p>This is not a comprehensive review or comparison of the providers - more a light introduction related to some of the things we’ve covered before.</p>
<p>It’s really hard to compare these vastly different offerings as even pricing varies within a provider depending on a number of factors including location, performance, … .</p>
<p>At the low end Google provides a free tier VM; additional VMs are available for $3.88/month ($0.0076/hour) for a 512MB RAM VM. Also, when a Google VM is shut down only the disk storage is applied (assuming no fixed IP).</p>
<p>Linode offers a 1GB RAM VM for $5/month ($0.0075/hour). Again, as you go up in size the prices rise dramatically and we suspect the performance for similarly spec’ed offerings can have wildly varying performance.</p>
<div class="section" id="linode">
<h4>11.29.1.1.1. Linode<a class="headerlink" href="#linode" title="Permalink to this headline">¶</a></h4>
<p>Here are some useful links:</p>
<ul class="simple">
<li><a class="reference external" href="https://www.linode.com/pricing">Linode pricing</a></li>
<li><a class="reference external" href="https://www.linode.com/docs/platform/billing-and-payments">Linode Billing and Payments</a> (hourly billing to monthly cap)<ul>
<li><a class="reference external" href="https://www.linode.com/docs/platform/billing-and-payments#if-my-linode-is-powered-off-will-i-be-billed">If My Linode is Powered Off, Will I Be Billed?</a> (yes, you must delete services to stop billing)</li>
<li><a class="reference external" href="https://www.linode.com/docs/platform/billing-and-payments#transfer-overages">Linode Transfer Overages</a> ($0.02/GB)</li>
<li><a class="reference external" href="https://www.linode.com/docs/platform/billing-and-payments#transfer-proration">Linode Transfer Proration</a></li>
</ul>
</li>
<li><a class="reference external" href="https://www.linode.com/docs/">Linode Guides &amp; Tutorials</a><ul>
<li><a class="reference external" href="https://www.linode.com/docs/getting-started">Getting Started with Linode</a></li>
<li><a class="reference external" href="https://www.linode.com/docs/search?q=firewall">Linode firewall search</a></li>
<li><a class="reference external" href="https://www.linode.com/docs/networking">IPs, Networking &amp; Domains</a></li>
<li><a class="reference external" href="https://www.linode.com/docs/networking/linux-static-ip-configuration">Linux Static IP Configuration</a></li>
<li><a class="reference external" href="https://www.linode.com/docs/networking/an-overview-of-ipv6-on-linode">An Overview of IPv6 on Linode</a></li>
<li><a class="reference external" href="https://www.linode.com/docs/networking/create-a-socks5-proxy-server-with-shadowsocks-on-ubuntu-and-centos7">Create a SOCKS5 Proxy Server with Shadowsocks on Ubuntu and CentOS 7</a></li>
<li><a class="reference external" href="https://www.linode.com/docs/networking/dns/configure-your-linode-for-reverse-dns">Configure Your Linode for Reverse DNS (rDNS)</a></li>
<li><a class="reference external" href="https://www.linode.com/docs/networking/dns/common-dns-configurations">Linode Common DNS Configurations</a></li>
</ul>
</li>
</ul>
<p>To create an ssh key for login:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="nv">EMAIL</span><span class="o">=</span><span class="s2">&quot;user@example.org&quot;</span>
</span><span class="hll">ssh-keygen -a <span class="m">50</span> -t ed25519 -C <span class="s2">&quot;</span><span class="nv">$EMAIL</span><span class="s2">&quot;</span> -f id_linode
</span></pre></div>
</div>
</div>
<div class="section" id="digitalocean">
<h4>11.29.1.1.2. DigitalOcean<a class="headerlink" href="#digitalocean" title="Permalink to this headline">¶</a></h4>
<p>Here are some useful links:</p>
<ul class="simple">
<li><a class="reference external" href="https://www.digitalocean.com/pricing/#droplet">DigitalOcean</a></li>
<li><a class="reference external" href="https://www.digitalocean.com/help/">DigitalOcean Help Topics</a><ul>
<li><a class="reference external" href="https://www.digitalocean.com/help/pricing-and-billing/general/">DigitalOcean Pricing &amp; Billing</a> (hourly billing to monthly cap, billed when VM off, floating IPs cost when not used)</li>
<li><a class="reference external" href="https://www.digitalocean.com/help/policy/">DigitalOcean Do you charge for bandwidth?</a> ($0.01/GB over 1 TB monthly limit)</li>
<li><a class="reference external" href="https://www.digitalocean.com/help/getting-started/setting-up-your-server/">DigitalOcean Setting Up Your Server</a></li>
<li><a class="reference external" href="https://www.digitalocean.com/help/getting-started/learn-more-about-linux/">DigitalOcean Learn More About Linux</a></li>
</ul>
</li>
<li>Other setup<ul>
<li><a class="reference external" href="https://www.digitalocean.com/products/load-balancer/">DigitalOcean Load Balancer</a> is $0.03/hour or $20/month.</li>
<li><a class="reference external" href="https://www.digitalocean.com/community/tutorials/an-introduction-to-digitalocean-cloud-firewalls">An Introduction To DigitalOcean Cloud Firewalls</a></li>
<li><a class="reference external" href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-host-name-with-digitalocean">How To Set Up a Host Name with DigitalOcean</a></li>
<li><a class="reference external" href="https://www.digitalocean.com/community/tutorials/an-introduction-to-digitalocean-spaces">An Introduction to DigitalOcean Spaces</a><ul>
<li><a class="reference external" href="https://www.digitalocean.com/community/tutorials/object-storage-vs-block-storage-services">Object Storage vs. Block Storage Services</a>.</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="google-compute-engine">
<h4>11.29.1.1.3. Google Compute Engine<a class="headerlink" href="#google-compute-engine" title="Permalink to this headline">¶</a></h4>
<p>Google Compute Engine is part of Google’s extensive cloud offerings (though less extensive than Amazon Web Services).</p>
<p>Here are some useful links:</p>
<ul class="simple">
<li><a class="reference external" href="https://cloud.google.com/compute/">Compute Engine Features</a> beyond Linode and DigitalOcean (custom machine types, transparent maintenance, global load balancing, Linux &amp; Windows support, preemptible VMs, compliance, per-second billing, sustained use discounts, committed use discounts, container)</li>
<li><a class="reference external" href="https://cloud.google.com/compute/pricing#freeusage">Google Always Free Usage Limits</a><ul>
<li><a class="reference external" href="https://cloud.google.com/free/">Google Cloud Platform Free Tier</a></li>
<li><a class="reference external" href="https://cloud.google.com/products/calculator/">Google Cloud Platform Pricing Calculator</a></li>
</ul>
</li>
<li><a class="reference external" href="https://cloud.google.com/sdk/downloads">Installing Cloud SDK</a></li>
<li><a class="reference external" href="https://cloudplatform.googleblog.com/2017/07/TCP-BBR-congestion-control-comes-to-GCP-your-Internet-just-got-faster.html">TCP BBR congestion control comes to GCP – your Internet just got faster</a><ul>
<li><a class="reference external" href="https://github.com/google/bbr">google/bbr</a></li>
<li><a class="reference external" href="https://www.cyberciti.biz/cloud-computing/increase-your-linux-server-internet-speed-with-tcp-bbr-congestion-control/">Increase your Linux server Internet speed with TCP BBR congestion control</a></li>
</ul>
</li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">EMAIL</span><span class="o">=</span><span class="s2">&quot;user@example.org&quot;</span>
<span class="nv">SSHKEYFILE</span><span class="o">=</span><span class="s2">&quot;id_gce&quot;</span>
<span class="hll">ssh-keygen <span class="se">\</span>
</span>    -t ed25519 <span class="se">\</span>
    -a <span class="m">50</span> <span class="se">\</span>
    -C <span class="s2">&quot;</span><span class="nv">$EMAIL</span><span class="s2">&quot;</span> <span class="se">\</span>
    -f ~/.ssh/<span class="nv">$SSHKEYFILE</span> <span class="se">\</span>
    -N <span class="s1">&#39;wouldntyouliketoknow&#39;</span>
chmod <span class="m">600</span> ~/.ssh/<span class="nv">$SSHKEYFILE</span>
chmod <span class="m">644</span> ~/.ssh/<span class="si">${</span><span class="nv">SSHKEYFILE</span><span class="si">}</span>.pub
<span class="c1"># To change the passphrase:</span>
<span class="c1"># ssh-keygen -p -f ~/.ssh/$SSHKEYFILE</span>

<span class="c1"># *********************************************</span>
<span class="c1"># *********************************************</span>
<span class="hll"><span class="c1"># Setup meetup GCE instance using Debian 9</span>
</span><span class="c1"># *********************************************</span>
<span class="c1"># *********************************************</span>

<span class="c1"># *********************************************</span>
<span class="hll"><span class="c1"># Setup GCE info prior to creating instance</span>
</span><span class="c1"># *********************************************</span>
<span class="hll"><span class="c1"># login to Google cloud</span>
</span>gcloud auth list
gcloud config <span class="nb">set</span> account <span class="s1">&#39;user@example.org&#39;</span>
gcloud auth login --no-launch-browser
<span class="hll"><span class="c1"># select PROJECT for billing purposes</span>
</span><span class="nv">PROJECT</span><span class="o">=</span><span class="s2">&quot;example.org:bitbender&quot;</span>
gcloud config <span class="nb">set</span> project <span class="s2">&quot;</span><span class="nv">$PROJECT</span><span class="s2">&quot;</span>
<span class="hll"><span class="c1"># select REGION/ZONE for right geographic region</span>
</span>gcloud compute regions list
<span class="nv">REGION</span><span class="o">=</span>us-west1
gcloud config <span class="nb">set</span> compute/region <span class="nv">$REGION</span>
gcloud compute zones list
<span class="nv">ZONE</span><span class="o">=</span>us-west1-b
gcloud config <span class="nb">set</span> compute/zone <span class="nv">$ZONE</span>

<span class="c1"># *********************************************</span>
<span class="hll"><span class="c1"># Set VM image, machine type, bootdisk</span>
</span><span class="c1"># *********************************************</span>
<span class="hll"><span class="c1"># choose image</span>
</span>gcloud compute images list
<span class="nv">IMAGEPROJECT</span><span class="o">=</span><span class="s2">&quot;debian-cloud&quot;</span>
<span class="nv">IMAGEFAMILY</span><span class="o">=</span><span class="s2">&quot;debian-9&quot;</span>
<span class="hll"><span class="c1"># choose machine-type</span>
</span>gcloud compute machine-types list <span class="p">|</span> grep <span class="s2">&quot; </span><span class="nv">$ZONE</span><span class="s2"> &quot;</span>
<span class="nv">MACHINE</span><span class="o">=</span><span class="s2">&quot;f1-micro&quot;</span>
<span class="c1"># MACHINE=&quot;g1-small&quot;</span>
<span class="c1"># MACHINE=&quot;n1-standard-1&quot;</span>
<span class="hll"><span class="c1"># show current firewall rules - below will use the default but you can add rules</span>
</span>gcloud compute firewall-rules list
<span class="c1"># BOOTDISK=&quot;pd-ssd&quot;</span>
<span class="nv">BOOTDISK</span><span class="o">=</span><span class="s2">&quot;pd-standard&quot;</span>
<span class="nv">DSIZE</span><span class="o">=</span><span class="m">15</span>

<span class="c1"># *********************************************</span>
<span class="hll"><span class="c1"># ssh keys here</span>
</span><span class="c1"># *********************************************</span>
<span class="nv">SSHUSERID</span><span class="o">=</span><span class="s2">&quot;hacker&quot;</span>
<span class="nv">SSHKEYS</span><span class="o">=</span><span class="s2">&quot;ssh-keys=</span><span class="si">${</span><span class="nv">SSHUSERID</span><span class="si">}</span><span class="s2">:</span><span class="k">$(</span>cat ~/.ssh/<span class="si">${</span><span class="nv">SSHKEYFILE</span><span class="si">}</span>.pub<span class="k">)</span><span class="s2">&quot;</span>

<span class="c1"># *********************************************</span>
<span class="hll"><span class="c1"># Can create static ip prior or make ephemeral address.</span>
</span><span class="c1"># *********************************************</span>
<span class="c1"># Here create a static address incuring charges when it is not used.</span>
gcloud compute addresses list
<span class="c1"># gcloud compute addresses create meetup --addresses --region $REGION</span>
<span class="c1"># gcloud compute addresses delete meetup --region $REGION</span>
<span class="c1"># ADDRESS=&quot;--address meetup&quot;</span>
<span class="c1"># Or just get an emphemeral address that can be made static later.</span>
<span class="nv">ADDRESS</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

<span class="c1"># *********************************************</span>
<span class="hll"><span class="c1"># Create non-preemptible images.</span>
</span><span class="c1"># *********************************************</span>
<span class="nv">H</span><span class="o">=</span><span class="s2">&quot;meetup&quot;</span>
<span class="c1"># tags from &quot;gcloud compute firewall-rules list&quot; define firewall settings</span>
<span class="nv">TAGS</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="nv">MAINT</span><span class="o">=</span><span class="s2">&quot;MIGRATE&quot;</span>
<span class="nv">RESTART</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="hll">gcloud compute instances create <span class="s2">&quot;</span><span class="nv">$H</span><span class="s2">&quot;</span> --project <span class="s2">&quot;</span><span class="nv">$PROJECT</span><span class="s2">&quot;</span> --zone <span class="s2">&quot;</span><span class="nv">$ZONE</span><span class="s2">&quot;</span> --machine-type <span class="s2">&quot;</span><span class="nv">$MACHINE</span><span class="s2">&quot;</span> --network <span class="s2">&quot;default&quot;</span> --maintenance-policy <span class="s2">&quot;</span><span class="nv">$MAINT</span><span class="s2">&quot;</span> <span class="nv">$TAGS</span> <span class="nv">$ADDRESS</span> --image-project <span class="s2">&quot;</span><span class="nv">$IMAGEPROJECT</span><span class="s2">&quot;</span> --image-family <span class="s2">&quot;</span><span class="nv">$IMAGEFAMILY</span><span class="s2">&quot;</span> --boot-disk-size <span class="s2">&quot;</span><span class="nv">$DSIZE</span><span class="s2">&quot;</span> --boot-disk-type <span class="s2">&quot;</span><span class="nv">$BOOTDISK</span><span class="s2">&quot;</span> --boot-disk-device-name <span class="s2">&quot;</span><span class="nv">$H</span><span class="s2">&quot;</span> --no-scopes --metadata <span class="s2">&quot;</span><span class="nv">$SSHKEYS</span><span class="s2">&quot;</span>
</span>
<span class="c1"># *********************************************</span>
<span class="hll"><span class="c1"># Manipulate VM</span>
</span><span class="c1"># *********************************************</span>
gcloud compute instances list  <span class="c1"># or stop start delete</span>
<span class="c1"># wait for instance to start and get EXTERNAL_IP</span>
<span class="nv">EXTERNAL_IP</span><span class="o">=</span><span class="m">35</span>.185.225.172

<span class="c1"># *********************************************</span>
<span class="hll"><span class="c1"># Login</span>
</span><span class="c1"># *********************************************</span>
ssh -i ~/.ssh/<span class="si">${</span><span class="nv">SSHKEYFILE</span><span class="si">}</span> hacker@<span class="nv">$EXTERNAL_IP</span>

<span class="c1"># *********************************************</span>
<span class="c1"># Play around</span>
<span class="c1"># *********************************************</span>
uname -a
cat /proc/meminfo <span class="p">|</span> grep MemTotal
cat /proc/cpuinfo <span class="p">|</span> grep <span class="s1">&#39;model name&#39;</span>
df -h
cat /etc/fstab
cat /etc/<span class="o">{</span>deb_version,os-release<span class="o">}</span>
python -V
cat /etc/hosts
cat /etc/resolv.conf
sudo apt update<span class="p">;</span> sudo apt upgrade -y<span class="p">;</span> sudo apt auto-remove -y
sudo apt install speedtest-cli -y
speedtest-cli  <span class="c1"># &gt; 600 Mbps down, &gt; 300 Mbps up</span>

<span class="c1"># *********************************************</span>
<span class="hll"><span class="c1"># Shutdown</span>
</span><span class="c1"># *********************************************</span>
sudo shutdown -h now<span class="p">;</span> <span class="nb">exit</span>

<span class="c1"># *********************************************</span>
<span class="hll"><span class="c1"># Make sure it terminates</span>
</span><span class="c1"># *********************************************</span>
gcloud compute instances list
<span class="c1"># …</span>
gcloud compute instances delete
</pre></div>
</div>
</div>
<div class="section" id="microsoft-azure">
<h4>11.29.1.1.4. Microsoft Azure<a class="headerlink" href="#microsoft-azure" title="Permalink to this headline">¶</a></h4>
<p>We mention Microsoft Azure more for completeness than recomendation due to pricing. See <a class="reference external" href="https://azure.microsoft.com/en-us/pricing/calculator/">Microsoft Azure Pricing calculator</a>. The smallest Linux VM available is a 0.75GB RAM for $0.02/hour or $14.88/month, about 3X the cost of a 1GB Linode VM.</p>
<p>Here is the scripting to create an Ubuntu VM for a UniFi Controller:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>

<span class="hll"><span class="c1"># VM needs:</span>
</span><span class="nv">RG</span><span class="o">=</span><span class="s2">&quot;unifi-rg&quot;</span>
<span class="nv">REGION</span><span class="o">=</span><span class="s2">&quot;westus2&quot;</span>
<span class="nv">VNET</span><span class="o">=</span><span class="s2">&quot;unifi-vnet&quot;</span>
<span class="nv">SUBNET</span><span class="o">=</span><span class="s2">&quot;unifi&quot;</span>
<span class="nv">NIC</span><span class="o">=</span><span class="s2">&quot;unifi-nic&quot;</span>
<span class="nv">PIP</span><span class="o">=</span><span class="s2">&quot;unifi-pip&quot;</span>
<span class="nv">DNSNAME</span><span class="o">=</span><span class="s2">&quot;unifi-dns&quot;</span>
<span class="nv">NSG</span><span class="o">=</span><span class="s2">&quot;unifi-nsg&quot;</span>

<span class="hll"><span class="c1"># VM is Ubuntu UniFi Controller</span>
</span><span class="nv">VM</span><span class="o">=</span><span class="s2">&quot;unifi&quot;</span>
<span class="nv">IMAGE</span><span class="o">=</span><span class="s2">&quot;UbuntuLTS&quot;</span>

<span class="hll"><span class="c1"># function to add a security rule to network security group</span>
</span><span class="hll"><span class="c1">#   addrule NAME PRIORITY PROTOCOL DEST_PORT SOURCE RESOURCE_GROUP NETWORK_SERCURITY_GROUP</span>
</span><span class="k">function</span> addrule<span class="o">()</span> <span class="o">{</span>
  az network nsg rule create -g <span class="nv">$6</span> --nsg-name <span class="nv">$7</span> <span class="se">\</span>
      --name <span class="nv">$1</span> --protocol <span class="nv">$3</span> --direction inbound --priority <span class="nv">$2</span> <span class="se">\</span>
      --source-address-prefix <span class="nv">$5</span> --source-port-range <span class="s1">&#39;*&#39;</span> <span class="se">\</span>
      --destination-address-prefix <span class="s1">&#39;*&#39;</span> --destination-port-range <span class="nv">$4</span> --access allow
<span class="o">}</span>

<span class="hll"><span class="c1"># Login</span>
</span>az login
az account list
<span class="c1"># NAME=&quot;Microsoft Azure Sponsorship&quot;</span>
<span class="c1"># ID=&quot;9547f0f312345678-abcd-efab-cdef-123456789abc&quot;</span>
<span class="c1"># az account set --subscription &quot;$NAME&quot;</span>

<span class="hll"><span class="c1"># Create region for UniFi Controller</span>
</span>az group create -n <span class="nv">$RG</span> -l <span class="nv">$REGION</span>

<span class="hll"><span class="c1"># Create virtual network and subnet - default would have been OK</span>
</span>az network vnet create --resource-group <span class="nv">$RG</span> <span class="se">\</span>
    --name <span class="nv">$VNET</span> --address-prefix <span class="m">10</span>.0.0.0/16 <span class="se">\</span>
    --subnet-name <span class="nv">$SUBNET</span> --subnet-prefix <span class="m">10</span>.0.0.0/24

<span class="hll"><span class="c1"># Grab a public IP resource - first 5 in a region are free</span>
</span><span class="c1">#   52.111.222.123</span>
az network public-ip create -g <span class="nv">$RG</span> -n <span class="nv">$PIP</span> <span class="se">\</span>
    --allocation-method Static <span class="se">\</span>
    --dns-name <span class="nv">$DNSNAME</span> --reverse-fqdn unifi.example.org.

<span class="hll"><span class="c1"># Create network security group</span>
</span>az network nsg create -g <span class="nv">$RG</span> -n <span class="nv">$NSG</span>

<span class="hll"><span class="c1"># Create nic and set addressing</span>
</span>az network nic create -g <span class="nv">$RG</span> -n <span class="nv">$NIC</span> <span class="se">\</span>
    --vnet-name <span class="nv">$VNET</span> --subnet <span class="nv">$SUBNET</span> <span class="se">\</span>
    --network-security-group <span class="nv">$NSG</span> <span class="se">\</span>
    --public-ip-address <span class="nv">$PIP</span> --private-ip-address <span class="m">10</span>.0.0.4

<span class="hll"><span class="c1"># Set the VM incoming firewall rules</span>
</span><span class="hll"><span class="c1">#   addrule NAME PRIORITY PROTOCOL DEST_PORT SOURCE RESOURCE_GROUP NETWORK_SERCURITY_GROUP</span>
</span><span class="nv">HQ</span><span class="o">=</span><span class="s2">&quot;1.2.3.4/29&quot;</span>
<span class="nv">REMOTE</span><span class="o">=</span><span class="s2">&quot;2.3.4.5/29&quot;</span>
<span class="nv">ADMIN</span><span class="o">=</span><span class="s2">&quot;3.4.5.6/24&quot;</span>
<span class="c1"># SSH from Internet</span>
addrule AllowSSHInBound <span class="m">200</span> tcp <span class="m">22</span> Internet <span class="nv">$RG</span> <span class="nv">$NSG</span>
<span class="c1"># AP inform from sites</span>
addrule Allow8080HQInBound <span class="m">300</span> tcp <span class="m">8080</span> <span class="nv">$HQ</span> <span class="nv">$RG</span> <span class="nv">$NSG</span>
addrule Allow8080RemoteInBound <span class="m">310</span> tcp <span class="m">8080</span> <span class="nv">$REMOTE</span> <span class="nv">$RG</span> <span class="nv">$NSG</span>
<span class="c1"># AP STUN from sites</span>
addrule Allow3478HQInBound <span class="m">320</span> udp <span class="m">3478</span> <span class="nv">$HQ</span> <span class="nv">$RG</span> <span class="nv">$NSG</span>
addrule Allow3478RemoteInBound <span class="m">330</span> udp <span class="m">3478</span> <span class="nv">$REMOTE</span> <span class="nv">$RG</span> <span class="nv">$NSG</span>
<span class="c1"># Mgmt port 8443 from sites and admin</span>
addrule Allow8443HQInBound <span class="m">400</span> tcp <span class="m">8443</span> <span class="nv">$HQ</span> <span class="nv">$RG</span> <span class="nv">$NSG</span>
addrule Allow8443RemoteInBound <span class="m">410</span> tcp <span class="m">8443</span> <span class="nv">$REMOTE</span> <span class="nv">$RG</span> <span class="nv">$NSG</span>
addrule Allow8443AdminInBound <span class="m">420</span> tcp <span class="m">8443</span> <span class="nv">$ADMIN</span> <span class="nv">$RG</span> <span class="nv">$NSG</span>
<span class="c1"># Mgmt port 8880 from sites and admin</span>
addrule Allow8880HQInBound <span class="m">500</span> tcp <span class="m">8880</span> <span class="nv">$HQ</span> <span class="nv">$RG</span> <span class="nv">$NSG</span>
addrule Allow8880RemoteInBound <span class="m">510</span> tcp <span class="m">8880</span> <span class="nv">$REMOTE</span> <span class="nv">$RG</span> <span class="nv">$NSG</span>
addrule Allow8880AdminInBound <span class="m">520</span> tcp <span class="m">8880</span> <span class="nv">$ADMIN</span> <span class="nv">$RG</span> <span class="nv">$NSG</span>
<span class="c1"># Mgmt port 8843 from sites and admin</span>
addrule Allow8843HQInBound <span class="m">600</span> tcp <span class="m">8843</span> <span class="nv">$HQ</span> <span class="nv">$RG</span> <span class="nv">$NSG</span>
addrule Allow8843RemoteInBound <span class="m">610</span> tcp <span class="m">8843</span> <span class="nv">$REMOTE</span> <span class="nv">$RG</span> <span class="nv">$NSG</span>
addrule Allow8843AdminInBound <span class="m">620</span> tcp <span class="m">8843</span> <span class="nv">$ADMIN</span> <span class="nv">$RG</span> <span class="nv">$NSG</span>
<span class="c1"># Let&#39;s Encrypt port 443 from everywhere</span>
<span class="c1">#   Let&#39;s Encrypt --standalone uses port 443 for cert gen and renewal</span>
<span class="c1">#   Otherwise there&#39;s no listener on the port</span>
az network nsg rule create -g unifi-rg --nsg-name unifi-nsg <span class="se">\</span>
    --name Allow443InBound --protocol tcp --direction inbound <span class="se">\</span>
    --priority <span class="m">700</span> <span class="se">\</span>
    --source-address-prefix <span class="s1">&#39;*&#39;</span> --source-port-range <span class="s1">&#39;*&#39;</span> <span class="se">\</span>
    --destination-address-prefix <span class="s1">&#39;*&#39;</span> --destination-port-range <span class="m">443</span> <span class="se">\</span>
    --access allow

<span class="hll"><span class="c1"># Now create the VM</span>
</span>
<span class="c1"># See &quot;How to create and use an SSH public and private key pair for Linux VMs in Azure&quot;</span>
<span class="c1">#   https://docs.microsoft.com/en-us/azure/virtual-machines/linux/mac-create-ssh-keys#create-a-vm-with-your-public-key-file</span>
<span class="c1"># See &quot;Detailed walk through to create an SSH key pair and additional certificates for a Linux VM in Azure&quot;</span>
<span class="c1">#   https://docs.microsoft.com/en-us/azure/virtual-machines/linux/create-ssh-keys-detailed</span>
ssh-keygen <span class="se">\</span>
    -t ed25519 <span class="se">\</span>
    -a <span class="m">50</span> <span class="se">\</span>
    -C <span class="s2">&quot;user@unifi.example.org&quot;</span> <span class="se">\</span>
    -f ~/.ssh/id_unifi <span class="se">\</span>
    -N <span class="s1">&#39;wouldntyouliketoknow&#39;</span>
<span class="c1"># To change the passphrase:</span>
<span class="c1"># ssh-keygen -p -f ~/.ssh/id_unifi</span>

<span class="hll">az vm create --resource-group <span class="nv">$RG</span> --name <span class="nv">$VM</span> --image <span class="nv">$IMAGE</span> --size Basic_A1 <span class="se">\</span>
</span>    --nics <span class="nv">$NIC</span> --storage-sku Standard_LRS <span class="se">\</span>
    --ssh-key-value ~/.ssh/id_unifi.pub --admin-username oresama <span class="se">\</span>
    --public-ip-address-dns-name unifi.example.org <span class="se">\</span>
    --validate
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="20171028_presentation.html" class="btn btn-neutral float-right" title="11.30. 2017-10-28 IPv6 ULA, DHCPv6, /64 prefixes, Bad Rabbit" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="20171111_presentation.html" class="btn btn-neutral" title="11.28. 2017-11-11 PKP removal, exploits galore" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, bitbender.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.3',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>