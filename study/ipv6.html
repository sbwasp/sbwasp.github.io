

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta content="default-src 'none'; script-src 'self' https://cdnjs.cloudflare.com 'unsafe-inline'; connect-src 'self'; img-src 'self'; style-src 'self'; font-src 'self'; form-action 'self'; frame-ancestors 'none'; base-uri 'self'" http-equiv="Content-Security-Policy" />
<meta content="nosniff" http-equiv="X-Content-Type-Options" />
<meta content="deny" http-equiv="X-Frame-Options" />
<meta content="1; mode=block" http-equiv="X-XSS-Protection" />
<meta content="strict-origin" http-equiv="Referrer-Policy" />
<meta content="max-age=31536000; includeSubDomains" http-equiv="Strict-Transport-Security" />
<meta content="'*'" http-equiv="Access-Control-Allow-Origin" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>8.7. IPv6 &mdash; South Bay WASP 1.0.3 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="South Bay WASP 1.0.3 documentation" href="../index.html"/>
        <link rel="up" title="8. Pentest Study" href="../pentest_study.html"/>
        <link rel="next" title="8.8. loadlibrary" href="loadlibrary.html"/>
        <link rel="prev" title="8.6. Firewalls" href="fw.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> South Bay WASP
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pentest_intro.html">1. South Bay WASP Meetup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_kali.html">2. Kali Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_challenges.html">3. Pentest Challenges</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_encryption.html">4. Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_html.html">5. HTML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_network_tools.html">6. Pentest Network Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_recon.html">7. Pentest Reconnaisance</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../pentest_study.html">8. Pentest Study</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="2factor.html">8.1. 2 Factor Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="dnssec.html">8.2. DNSSEC, DANE, and DNS encryption</a></li>
<li class="toctree-l2"><a class="reference internal" href="email_security.html">8.3. Email Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="exfiltration.html">8.4. Exfiltration</a></li>
<li class="toctree-l2"><a class="reference internal" href="exiftool.html">8.5. <strong class="program">exiftool</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="fw.html">8.6. Firewalls</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">8.7. IPv6</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ipv6-background">8.7.1. IPv6 background</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-ipv6-not-replacing-ipv4">8.7.2. Adding IPv6, not replacing IPv4</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dual-stack-implementation">8.7.2.1. Dual Stack Implementation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ipv4-is-not-going-away-anytime-soon">8.7.2.2. IPv4 is not going away anytime soon</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ipv6-is-not-ready-everywhere">8.7.2.3. IPv6 is not ready everywhere</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ipv4-is-not-available-everywhere">8.7.2.4. IPv4 is not available everywhere</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ipv6-differences">8.7.3. IPv6 differences</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#no-broadcast">8.7.3.1. No broadcast</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ipv6-discourages-nat">8.7.3.2. IPv6 discourages NAT</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bits-for-a-subnet">8.7.3.3. 64 bits for a subnet</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id22">8.7.3.4. Prefix delegation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#lots-of-ipv6-addresses-per-interface">8.7.3.5. Lots of (IPv6) addresses per interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#icmpv6-messages-are-critical-to-the-proper-functioning-of-ipv6">8.7.3.6. ICMPv6 messages are critical to the proper functioning of IPv6</a></li>
<li class="toctree-l4"><a class="reference internal" href="#options-for-getting-ipv6-addresses">8.7.3.7. Options for getting IPv6 addresses</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id23">8.7.3.8. Stateless address autoconfiguration (SLAAC)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dnsmasq-populates-dns-from-dhcp">8.7.3.9. dnsmasq populates DNS from DHCP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ipv6-on-link-hosts-based-on-ra-prefixes-not-subnet">8.7.3.10. IPv6 “on-link” hosts based on RA prefixes, not subnet</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ipv6-ula-addressing">8.7.3.11. IPv6 ULA addressing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dhcpv6">8.7.3.12. DHCPv6</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-64-prefixes">8.7.3.13. Using &gt; /64 prefixes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="loadlibrary.html">8.8. loadlibrary</a></li>
<li class="toctree-l2"><a class="reference internal" href="linux_exploitation_tricks.html">8.9. Linux Exploitation Tricks</a></li>
<li class="toctree-l2"><a class="reference internal" href="linux_networking.html">8.10. Linux networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="llmnr.html">8.11. Windows broadcast name resolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="nftables.html">8.12. nftables</a></li>
<li class="toctree-l2"><a class="reference internal" href="not_getting_hacked.html">8.13. Not getting hacked</a></li>
<li class="toctree-l2"><a class="reference internal" href="ntlm.html">8.14. NTLM</a></li>
<li class="toctree-l2"><a class="reference internal" href="passwords.html">8.15. Password Cracking Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="php.html">8.16. PHP &amp; MySQL Shortcomings</a></li>
<li class="toctree-l2"><a class="reference internal" href="pkcs.html">8.17. PKCS standards</a></li>
<li class="toctree-l2"><a class="reference internal" href="static_websites.html">8.18. Static websites</a></li>
<li class="toctree-l2"><a class="reference internal" href="virtualization_networking.html">8.19. Virtualization &amp; networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="vulnerabilities.html">8.20. Vulnerabilites</a></li>
<li class="toctree-l2"><a class="reference internal" href="waf.html">8.21. WAF Evasion</a></li>
<li class="toctree-l2"><a class="reference internal" href="wifi.html">8.22. WiFi Tutorial</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_buffer_overflow.html">9. Pentest Buffer Overflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_scripting.html">10. Pentest scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_presentations.html">11. Pentest Presentations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">South Bay WASP</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../pentest_study.html">8. Pentest Study</a> &raquo;</li>
        
      <li>8.7. IPv6</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/study/ipv6.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ipv6-setup">
<span id="id21"></span><h1>8.7. IPv6<a class="headerlink" href="#ipv6-setup" title="Permalink to this headline">¶</a></h1>
<p>The focus here is providing enough information to illustrate how to set up IPv6 in homes or smaller organizations.</p>
<div class="section" id="ipv6-background">
<h2>8.7.1. IPv6 background<a class="headerlink" href="#ipv6-background" title="Permalink to this headline">¶</a></h2>
<p>Wikipedia has many IPv6 articles (which reference the relevant RFCs):</p>
<ul class="simple">
<li>First priority are: <a class="reference external" href="https://en.wikipedia.org/wiki/IPv6">IPv6</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/IPv6_address">IPv6 address</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/IPv6_packet">IPv6 packet</a>, and <a class="reference external" href="https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing#IPv6_CIDR_blocks">IPv6 subnetting</a>.</li>
<li>Next priority are: <a class="reference external" href="https://en.wikipedia.org/wiki/Unique_local_address">Unique local addresses</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/Internet_Control_Message_Protocol_version_6">Internet Control Message Protocol version 6</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/Neighbor_Discovery_Protocol">Neighbor Discovery Protocol</a>, and optionally <a class="reference external" href="https://en.wikipedia.org/wiki/Secure_Neighbor_Discovery">Secure Neighbor Discovery</a>.</li>
<li>For IP address allocation: <a class="reference external" href="https://en.wikipedia.org/wiki/Prefix_delegation">Prefix delegation</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/IPv6#Stateless_address_autoconfiguration_.28SLAAC.29">Stateless address autoconfiguration (SLAAC)</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/DHCPv6">Dynamic Host Configuration Protocol version 6</a>, and optionally <strong class="program">dnsmasq</strong> with <a class="reference external" href="http://www.thekelleys.org.uk/dnsmasq/docs/dnsmasq-man.html">dnsmasq manpage</a> if using <strong class="program">dnsmasq</strong> to implement DNS &amp; DHCP.</li>
<li>Finally of lesser initial value are: <a class="reference external" href="https://en.wikipedia.org/wiki/IPv6_deployment">IPv6 deployment</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/Comparison_of_IPv6_support_in_operating_systems">Comparison of IPv6 support in operating systems</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/User_Datagram_Protocol#IPv6PH">IPv6 pseudo header</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/IPv6_rapid_deployment">IPv6 rapid deployment</a>, and <a class="reference external" href="https://en.wikipedia.org/wiki/IPv6_transition_mechanisms">IPv6 transition mechanism</a>.</li>
</ul>
<p>Use <a class="reference external" href="http://test-ipv6.com/">test-ipv6.com</a> for IPv6 connectivity testing. If for some reason your ISP does not support IPv6, <a class="reference external" href="http://simpledns.com/private-ipv6.aspx">Simple DNS Plus</a> generates unique private IPv6 address ranges for testing.</p>
</div>
<div class="section" id="adding-ipv6-not-replacing-ipv4">
<h2>8.7.2. Adding IPv6, not replacing IPv4<a class="headerlink" href="#adding-ipv6-not-replacing-ipv4" title="Permalink to this headline">¶</a></h2>
<div class="section" id="dual-stack-implementation">
<h3>8.7.2.1. Dual Stack Implementation<a class="headerlink" href="#dual-stack-implementation" title="Permalink to this headline">¶</a></h3>
<p>The current goal should be to create a dual stack implementation, realizing that IPv4 cannot be avoided for the time being but will eventually fade away. All relevant hardware and software should support both IPv4 and IPv6 simultaneously, usually without additional configuration (for at least the consumer devices). The most important exception to that is firewalls.</p>
</div>
<div class="section" id="ipv4-is-not-going-away-anytime-soon">
<h3>8.7.2.2. IPv4 is not going away anytime soon<a class="headerlink" href="#ipv4-is-not-going-away-anytime-soon" title="Permalink to this headline">¶</a></h3>
<p>IPv6 has an extensive <a class="reference external" href="https://en.wikipedia.org/wiki/IPv6_transition_mechanisms">IPv6 transition mechanism</a> allowing IPv6 and IPv4 to interoperate. The massive IPv4 network infrastructure will provide a financial incentive to allow IPv4 hosts to access content for a long time to come, even when not configured for IPv6.</p>
</div>
<div class="section" id="ipv6-is-not-ready-everywhere">
<h3>8.7.2.3. IPv6 is not ready everywhere<a class="headerlink" href="#ipv6-is-not-ready-everywhere" title="Permalink to this headline">¶</a></h3>
<p>Even if you wanted to go IPv6 only that’s not possible in all cases. For example, Google Compute Engine comes with IPv6 disabled by default and IPv6 is not currently supported.</p>
</div>
<div class="section" id="ipv4-is-not-available-everywhere">
<h3>8.7.2.4. IPv4 is not available everywhere<a class="headerlink" href="#ipv4-is-not-available-everywhere" title="Permalink to this headline">¶</a></h3>
<p>From <a class="reference external" href="https://www.arin.net/resources/request/ipv4_countdown.html">IPv4 Address Status at ARIN</a>:</p>
<blockquote>
<div><p>ARIN’s free pool of IPv4 address space was depleted on 24 September 2015. As a result, we no longer can fulfill requests for IPv4 addresses unless you meet certain policy requirements that reserved blocks of IPv4 addresses for special cases …</p>
<p><a class="reference external" href="https://www.arin.net/resources/request.html">Submit an IPv4 request</a> and go on the <a class="reference external" href="https://www.arin.net/resources/request/waiting_list.html">Waiting List for Unmet Requests</a>. Requests on the waiting list can only be filled when ARIN adds IPv4 address space to its available IPv4 inventory. This usually occurs after: a registrant returns IPv4 address; a revocation by ARIN (typically for non-payment of annual fees); IPv4 address space distribution to ARIN by Internet Assigned Numbers Authority (IANA); or otherwise made available to be re-issued.</p>
</div></blockquote>
<p><a class="reference external" href="https://www.reddit.com/r/networking/comments/5y92le/psa_verizon_wireless_to_stop_issuing_public/">PSA: Verizon Wireless to stop issuing Public Static IPv4 addresses</a>:</p>
<blockquote>
<div>On June 30, 2017, Verizon will stop issuing new Public Static IPv4 addresses due to a shortage of available addresses. Customers that currently have active Public Static IPv4 addresses will retain those addresses, and Verizon will continue to fully support existing Public Static IPv4 addresses. In order to reserve new IP addresses, your company will need to convert to the Persistent Prefix IPv6 requirements and implement new Verizon-certified IPv6 devices.</div></blockquote>
<p>See <a class="reference external" href="https://en.wikipedia.org/wiki/IPv6_deployment">IPv6 deployment</a> and <a class="reference external" href="https://www.google.com/intl/en/ipv6/statistics.html#tab=per-country-ipv6-adoption&amp;tab=per-country-ipv6-adoption">Google IPv6 Per-Country IPv6 adoption</a> for a glimpse into IPv6 adoption worldwide.</p>
</div>
</div>
<div class="section" id="ipv6-differences">
<h2>8.7.3. IPv6 differences<a class="headerlink" href="#ipv6-differences" title="Permalink to this headline">¶</a></h2>
<p>There are a few key IPv6 differences to be aware of to successfully implement IPv6.</p>
<div class="section" id="no-broadcast">
<h3>8.7.3.1. No broadcast<a class="headerlink" href="#no-broadcast" title="Permalink to this headline">¶</a></h3>
<p>From <a class="reference external" href="https://en.wikipedia.org/wiki/IPv6_address">IPv6 address</a>:</p>
<blockquote>
<div>IPv6 does not implement broadcast addressing. Broadcast’s traditional role is subsumed by multicast addressing to the all-nodes link-local multicast group ff02::1.</div></blockquote>
<p>See <a class="reference external" href="https://www.iana.org/assignments/ipv6-multicast-addresses/ipv6-multicast-addresses.xhtml">IPv6 Multicast Address Space Registry</a> and <a class="reference external" href="https://en.wikipedia.org/wiki/Multicast_address">Wikipedia - Multicast address</a>.</p>
</div>
<div class="section" id="ipv6-discourages-nat">
<h3>8.7.3.2. IPv6 discourages NAT<a class="headerlink" href="#ipv6-discourages-nat" title="Permalink to this headline">¶</a></h3>
<p>From <a class="reference external" href="https://tools.ietf.org/html/rfc4864">RFC 4864</a> Local Network Protection for IPv6:</p>
<blockquote>
<div>IPv6 was designed with the intention of making NAT unnecessary, and this document shows how Local Network Protection (LNP) using IPv6 can provide the same or more benefits without the need for address translation.</div></blockquote>
</div>
<div class="section" id="bits-for-a-subnet">
<h3>8.7.3.3. 64 bits for a subnet<a class="headerlink" href="#bits-for-a-subnet" title="Permalink to this headline">¶</a></h3>
<p>There are 3 separate fields in the IPv6 address: routing prefix (delegated by the ISP), subnet id (managed by the customer), and interface identifier (a whole 64 bits per subnet).</p>
<table border="1" class="colwidths-given docutils align-center" id="id26">
<caption><span class="caption-text">IPv6 Address</span><a class="headerlink" href="#id26" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="15%" />
<col width="30%" />
<col width="13%" />
<col width="43%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><th class="stub">bits (128)</th>
<td>48 - 64</td>
<td>16 - 0</td>
<td>64</td>
</tr>
<tr class="row-even"><th class="stub">field</th>
<td>routing prefix</td>
<td>subnet id</td>
<td>interface identifier</td>
</tr>
</tbody>
</table>
<p>From <a class="reference external" href="https://tools.ietf.org/html/rfc5375#section-3">RFC 5375 IPv6 Unicast Address Assignment Considerations - 3. Subnet Prefix Considerations</a>:</p>
<blockquote>
<div><p>Using a subnet prefix length other than a /64 will break many features of IPv6, including Neighbor Discovery (ND), Secure Neighbor Discovery (SEND) [RFC3971], privacy extensions [RFC4941], parts of Mobile IPv6 [RFC4866], Protocol Independent Multicast - Sparse Mode (PIM-SM) with Embedded-RP [RFC3956], and Site Multihoming by IPv6 Intermediation (SHIM6) [SHIM6], among others.  A number of other features currently in development, or being proposed, also rely on /64 subnet prefixes.</p>
<p>Using /64 subnets is strongly recommended, also for links connecting  only routers.  A deployment compliant with the current IPv6 specifications cannot use other prefix lengths.</p>
</div></blockquote>
<p>The article <a class="reference external" href="https://www.netsecblog.info/yes-its-a-lot-of-bits-but/">Yes it’s a lot of bits but…</a> is an interesting read.</p>
</div>
<div class="section" id="id22">
<h3>8.7.3.4. Prefix delegation<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h3>
<p>ISPs typically provide both:</p>
<dl class="docutils">
<dt>Publically routable IPv6 address</dt>
<dd>Generally the firewall’s external interface.</dd>
<dt>Publically routable IPv6 prefix delegation</dt>
<dd>IPv6 address block for internal use. See <a class="reference external" href="https://en.wikipedia.org/wiki/Prefix_delegation">Prefix delegation</a>.</dd>
</dl>
<p>How big should the prefix delegation be? From <a class="reference external" href="https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing#IPv6_CIDR_blocks">IPv6 subnetting</a>, /64 is “Single LAN (default prefix size for SLAAC)” while /56 is “Minimal end sites assignment (e.g. Home network) (/56 = 256 /64).” From <a class="reference external" href="https://en.wikipedia.org/wiki/IPv6_address">IPv6 address</a> “addresses are typically distributed in /48 to /56 sized blocks to the end users.” The upshot is that your ISP prefix delegation <strong>should be /56</strong> or better, though some ISPs delegate /64.</p>
</div>
<div class="section" id="lots-of-ipv6-addresses-per-interface">
<h3>8.7.3.5. Lots of (IPv6) addresses per interface<a class="headerlink" href="#lots-of-ipv6-addresses-per-interface" title="Permalink to this headline">¶</a></h3>
<p>Here are the Debian Linux addresses for an Ethernet interface:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">hacker@meetup:~$</span> ip addr show dev enp5s0
<span class="go">2: enp5s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span>
<span class="go">    link/ether 00:30:67:bc:41:d0 brd ff:ff:ff:ff:ff:ff</span>
<span class="hll"><span class="go">    inet 192.168.1.117/24 brd 192.168.1.255 scope global dynamic enp5s0</span>
</span><span class="go">       valid_lft 64823sec preferred_lft 64823sec</span>
<span class="hll"><span class="go">    inet6 2605:e000:9343:8400:7175:9e30:84a4:2682/64 scope global temporary dynamic</span>
</span><span class="go">       valid_lft 85883sec preferred_lft 13883sec</span>
<span class="hll"><span class="go">    inet6 2605:e000:9343:8400:230:67ff:febc:41d0/64 scope global mngtmpaddr noprefixroute dynamic</span>
</span><span class="go">       valid_lft 85883sec preferred_lft 13883sec</span>
<span class="hll"><span class="go">    inet6 fe80::230:67ff:febc:41d0/64 scope link</span>
</span><span class="go">       valid_lft forever preferred_lft forever</span>
</pre></div>
</div>
<ul>
<li><p class="first">192.168.1.117/24 scope global dynamic enp5s0</p>
<p>This is an IPv4 <a class="reference external" href="https://tools.ietf.org/html/rfc1918">RFC 1918</a> address (Address Allocation for Private Internets).</p>
</li>
<li><p class="first">2605:e000:9343:8400:7175:9e30:84a4:2682/64 scope global temporary dynamic</p>
<p>This is the currently valid <a class="reference external" href="https://tools.ietf.org/html/rfc4941">RFC 4941</a> address (Privacy Extensions for Stateless Address Autoconfiguration in IPv6). These addresses are regenerated at configurable intervals, deprecating the previous address. The non-deprecated addresses are used for new outgoing connections and provide some security with the ever-changing address drawn from a /64 block.</p>
</li>
<li><p class="first">2605:e000:9343:8400:230:67ff:febc:41d0/64 scope global mngtmpaddr noprefixroute dynamic</p>
<p>This is an <a class="reference external" href="https://tools.ietf.org/html/rfc7217">RFC 7217</a> address (A Method for Generating Semantically Opaque Interface Identifiers with IPv6 Stateless Address Autoconfiguration (SLAAC)). These addresses are published in global DNS and used for incoming connections. They are “random” but remain that same for a given IPv6 prefix, only changing when the host it moved to a different IPv6 prefix. When moved back to the original prefix the address reverts back.</p>
</li>
<li><p class="first">fe80::230:67ff:febc:41d0/64 scope link</p>
<p>This is the non-routable link-local address. See <a class="reference external" href="https://tools.ietf.org/html/rfc4193">RFC 4193</a> (Unique Local IPv6 Unicast Addresses). From <a class="reference external" href="https://en.wikipedia.org/wiki/IPv6_address">IPv6 address</a>:</p>
<blockquote>
<div><p>All interfaces of IPv6 hosts require a link-local address. A link-local address is derived from the MAC address of the interface and the prefix fe80::/10.</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="icmpv6-messages-are-critical-to-the-proper-functioning-of-ipv6">
<h3>8.7.3.6. ICMPv6 messages are critical to the proper functioning of IPv6<a class="headerlink" href="#icmpv6-messages-are-critical-to-the-proper-functioning-of-ipv6" title="Permalink to this headline">¶</a></h3>
<p>From <a class="reference external" href="https://en.wikipedia.org/wiki/IPv6_address">IPv6 address</a>:</p>
<blockquote>
<div>The assignment of a unicast IPv6 address to an interface involves an internal test for the uniqueness of that address using <em>Neighbor Solicitation</em> and <em>Neighbor Advertisement</em> (ICMPv6 type 135 and 136) messages. … The node joins the solicited-node multicast address for the tentative address (if not already done so) and sends neighbor solicitations, with the tentative address as target address and the unspecified address (::/128) as source address. The node also joins the all-hosts multicast address ff02::1, so it will be able to receive <em>Neighbor Advertisements</em>.</div></blockquote>
<p>See <a class="reference external" href="https://en.wikipedia.org/wiki/Neighbor_Discovery_Protocol">Neighbor Discovery Protocol</a> (NDP) for the ICMPv6 packet types: Router Solicitation (Type 133), Router Advertisement (Type 134), Neighbor Solicitation (Type 135), Neighbor Advertisement (Type 136), and Redirect (Type 137).</p>
<p>See <a class="reference external" href="https://tools.ietf.org/html/rfc4890">RFC 4890</a> Recommendations for Filtering ICMPv6 Messages in Firewalls for information on firewalling ICMPv6.</p>
</div>
<div class="section" id="options-for-getting-ipv6-addresses">
<h3>8.7.3.7. Options for getting IPv6 addresses<a class="headerlink" href="#options-for-getting-ipv6-addresses" title="Permalink to this headline">¶</a></h3>
<p>From <a class="reference external" href="https://thenetworkway.wordpress.com/2014/07/02/ipv6-address-assignment-stateless-stateful-dhcp-oh-my/">IPv6 address assignment – stateless, stateful, DHCP… oh my!</a>:</p>
<blockquote>
<div><dl class="docutils">
<dt>Static (manual) address assignment</dt>
<dd>exactly like with IPv4, you can go on and apply the address yourself.</dd>
<dt>Stateless Address Auto Configuration (SLAAC)</dt>
<dd>nodes listen for ICMPv6 Router Advertisements (RA) messages periodically sent out by routers on the local link, or requested by the node using an RA solicitation message. … By default, SLAAC does not provide anything to the client outside of an IPv6 address and a default gateway.</dd>
<dt>Stateless DHCPv6</dt>
<dd>with this option SLAAC is still used to get the IP address, but DHCP is used to obtain “other” configuration options, usually things like DNS, NTP, etc.</dd>
<dt>Stateful DHCPv6</dt>
<dd>functions exactly the same as IPv4 DHCP in which hosts receive both their IPv6 address and additional parameters from the DHCP server. … <strong>NOTE: The only way to get a default gateway in IPv6 is via a RA message. DHCPv6 does not carry default route information at this time.</strong></dd>
</dl>
</div></blockquote>
<p>RA determine the client’s IPv6 behavior. <a class="reference external" href="https://tools.ietf.org/html/rfc5075">RFC 5075</a> IPv6 Router Advertisement Flags Option describes the key flags:</p>
<dl class="docutils">
<dt>M - Managed Address Configuration Flag</dt>
<dd>addresses are available via DHCP.</dd>
<dt>O - Other Configuration Flag</dt>
<dd>other configuration info is available (DNS, NTP, …).</dd>
<dt>A - autonomous address-configuration flag</dt>
<dd>part of a Prefix Information option field (see <a class="reference external" href="https://tools.ietf.org/html/rfc4861#section-4.6.2">RFC 4861 - Prefix Information</a>). Indicates prefix can be used for stateless address configuration.</dd>
</dl>
<p>O &amp; A lets the client pick it’s own addresses yet still get DNS, NTP, … information from the DHCP server.</p>
<p>It’s pretty common to have both SLAAC and DHCPv6 for a couple of reasons. Android does not support DHCPv6 and <strong>must</strong> use SLAAC. RA can be used to configure DNS servers (see <a class="reference external" href="https://tools.ietf.org/html/rfc6106">RFC 6106</a> IPv6 Router Advertisement Options for DNS Configuration) but not other settings, thus at least stateless DHCPv6 may be needed. Given that DHCP is used for IPv4, adding IPv6 is not uncommon.</p>
<p>Many smaller sites use <strong class="program">dnsmasq</strong> to integrate DNS &amp; DHCP, allowing DNS to be updated with DHCP name/address information.</p>
<p>The presentation <a class="reference external" href="http://www.rmv6tf.org/wp-content/uploads/2013/04/2-End-Station-Addressing.pdf">IPv6 End Station Addressing: Choosing SLAAC or DHCP</a> is an interesting read. Also see <a class="reference external" href="https://community.infoblox.com/t5/IPv6-CoE-Blog/Why-You-Must-Use-ICMPv6-Router-Advertisements-RAs/ba-p/3416">Why You Must Use ICMPv6 Router Advertisements (RAs)</a> for the importance of RA.</p>
</div>
<div class="section" id="id23">
<h3>8.7.3.8. <a class="reference external" href="https://en.wikipedia.org/wiki/IPv6#Stateless_address_autoconfiguration_.28SLAAC.29">Stateless address autoconfiguration (SLAAC)</a><a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h3>
<p>IPv6 hosts can autoconfigure themselves automatically when connected to an IPv6 network using the <a class="reference external" href="https://en.wikipedia.org/wiki/Neighbor_Discovery_Protocol">Neighbor Discovery Protocol</a> via <a class="reference external" href="https://en.wikipedia.org/wiki/Internet_Control_Message_Protocol_version_6">Internet Control Message Protocol version 6</a> (ICMPv6) router discovery messages. When first connected to a network, a host sends a link-local router solicitation multicast request for its configuration parameters; routers respond to such a request with a router advertisement packet that contains Internet Layer configuration parameters.</p>
<p>If IPv6 stateless address auto-configuration is unsuitable for an application, a network may use stateful configuration with the <a class="reference external" href="https://en.wikipedia.org/wiki/DHCPv6">Dynamic Host Configuration Protocol version 6</a> (DHCPv6) or hosts may be configured manually using static methods.</p>
</div>
<div class="section" id="dnsmasq-populates-dns-from-dhcp">
<h3>8.7.3.9. <a class="reference external" href="http://www.thekelleys.org.uk/dnsmasq/doc.html">dnsmasq</a> populates DNS from DHCP<a class="headerlink" href="#dnsmasq-populates-dns-from-dhcp" title="Permalink to this headline">¶</a></h3>
<div class="section" id="dnsmasq-configuration-options">
<h4>8.7.3.9.1. <a class="reference external" href="http://www.thekelleys.org.uk/dnsmasq/doc.html">dnsmasq</a> configuration options<a class="headerlink" href="#dnsmasq-configuration-options" title="Permalink to this headline">¶</a></h4>
<p><strong class="program">dnsmasq</strong> can populate DNS with client names and addresses from both DHCP and SLAAC-addressed clients. There are some complications, mainly from Windows that requires some explanation.</p>
<p><a class="reference external" href="http://www.thekelleys.org.uk/dnsmasq/docs/dnsmasq-man.html">dnsmasq manpage</a> shows there are 2 ways to use DHCPv6:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--dhcp-range=::1,::400,constructor:eth0</span></code></p>
<p>This is full DHCPv6 like DHCPv4.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">--dhcp-range=::,constructor:eth0,MODE</span></code></p>
<p>This uses stateless DHCP (not providing an IPv6 address, but providing configuration options) and/or SLAAC. MODE can be among:</p>
<dl class="docutils">
<dt>ra-only</dt>
<dd><p class="first last">Router advertisement only, no DHCP.</p>
</dd>
<dt>slaac</dt>
<dd><p class="first last">Router advertisement with SLAAC.</p>
</dd>
<dt>ra-stateless</dt>
<dd><p class="first last">Router advertisement, stateless DHCP options, and SLAAC.</p>
</dd>
<dt>ra-names</dt>
<dd><p class="first last">Uses host IPv4 lease to get hostname &amp; makes a guess at IPv6 address, which is added to DNS if a ping reply is received. This fails with out-of-the-box Windows, but can be rectified (see below).</p>
</dd>
<dt>ra-advrouter</dt>
<dd><p class="first last">Used in mobile IPv6.</p>
</dd>
<dt>off-link</dt>
<dd><p class="first last">See <a class="reference external" href="https://tools.ietf.org/html/rfc5942">RFC 5942</a> IPv6 Subnet Model: The Relationship between Links and Subnet Prefixes. An IPv6 host keeps a prefix list of “on link” prefixes, and using off-link keeps the advertised prefix from the “on link” prefixes list. When sending to addresses not in the “on link” prefixes the routing table is used.</p>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="dnsmasq-configuration-results">
<h4>8.7.3.9.2. <a class="reference external" href="http://www.thekelleys.org.uk/dnsmasq/doc.html">dnsmasq</a> configuration results<a class="headerlink" href="#dnsmasq-configuration-results" title="Permalink to this headline">¶</a></h4>
<p>As was discussed above, <a class="reference external" href="https://tools.ietf.org/html/rfc5075">RFC 5075</a> IPv6 Router Advertisement Flags Option describes the key flags used by <strong class="program">dnsmasq</strong>:</p>
<dl class="docutils">
<dt>M - Managed Address Configuration Flag</dt>
<dd>addresses are available via DHCP. This is set for DHCPv6 actually distributing IPv6 addresses via something like <code class="docutils literal notranslate"><span class="pre">--dhcp-range=::1,::400,constructor:eth0</span></code> (stateful), and not for <code class="docutils literal notranslate"><span class="pre">--dhcp-range=::,constructor:eth0,MODE</span></code> (stateless).</dd>
<dt>O - Other Configuration Flag</dt>
<dd>other configuration info is available (DNS, NTP, …). This is set for <code class="docutils literal notranslate"><span class="pre">ra-stateless</span></code>.</dd>
<dt>A - autonomous address-configuration flag</dt>
<dd>part of a Prefix Information option field (see <a class="reference external" href="https://tools.ietf.org/html/rfc4861#section-4.6.2">RFC 4861 - Prefix Information</a>). Indicates prefix can be used for stateless address configuration. This is set for <code class="docutils literal notranslate"><span class="pre">slaac</span></code> and <code class="docutils literal notranslate"><span class="pre">ra-stateless</span></code>.</dd>
</dl>
<p>Here is are the <strong class="program">dnsmasq</strong> behavior when stateful DHCPv6 is not used:</p>
<table border="1" class="colwidths-given docutils align-center" id="id27">
<caption><span class="caption-text">dnsmasq without stateful DHCPv6 (M unset, A set)</span><a class="headerlink" href="#id27" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="38%" />
<col width="4%" />
<col width="6%" />
<col width="13%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><th class="stub">dnsmasq options</th>
<td>O flag</td>
<td>==&gt;</td>
<td>SLAAC</td>
<td>stateless DHCPv6</td>
<td>DNS EUI-64 guess</td>
</tr>
<tr class="row-even"><th class="stub">slaac</th>
<td>N</td>
<td>==&gt;</td>
<td>Y</td>
<td>N</td>
<td>N</td>
</tr>
<tr class="row-odd"><th class="stub">ra-only</th>
<td>N</td>
<td>==&gt;</td>
<td>Y</td>
<td>N</td>
<td>N</td>
</tr>
<tr class="row-even"><th class="stub">ra-names</th>
<td>N</td>
<td>==&gt;</td>
<td>Y</td>
<td>N</td>
<td>Y</td>
</tr>
<tr class="row-odd"><th class="stub">ra-names,slaac</th>
<td>N</td>
<td>==&gt;</td>
<td>Y</td>
<td>N</td>
<td>Y</td>
</tr>
<tr class="row-even"><th class="stub">ra-stateless</th>
<td>Y</td>
<td>==&gt;</td>
<td>Y</td>
<td>Y</td>
<td>N</td>
</tr>
<tr class="row-odd"><th class="stub">ra-names,ra-stateless</th>
<td>Y</td>
<td>==&gt;</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
</tr>
</tbody>
</table>
<p>The above “DNS EUI-64 guess” means that <strong class="program">dnsmasq</strong> will use the DHCPv4 host name and compute the IEEE EUI-64 IPv6 address (see <a class="reference external" href="https://tools.ietf.org/html/rfc4291#appendix-A">Appendix A: Creating Modified EUI-64 Format Interface Identifiers</a>)  and <code class="docutils literal notranslate"><span class="pre">ping6</span></code> that address to verify it. DNS is updated for verified addresses. This doesn’t work on all clients, specifically not for Chromebooks and Windows. Chromebooks don’t have a name and this is a security feature.</p>
<p>Windows generates random addresses (not IEEE EUI-64 addresses). To fix this on Windows 10 and allow <code class="docutils literal notranslate"><span class="pre">ra-names</span></code> <code class="docutils literal notranslate"><span class="pre">ping6</span></code> to work, follow <a class="reference external" href="http://lists.thekelleys.org.uk/pipermail/dnsmasq-discuss/2016q4/011026.html">Windows ipv6 hostname</a>:</p>
<div class="highlight-bat notranslate"><div class="highlight"><pre><span></span>netsh interface ipv6 set global randomizeidentifiers=disabled
netsh advfirewall firewall add rule name=<span class="s2">&quot;ICMPv4 8&quot;</span> protocol=icmpv4:8,any dir=in action=allow
netsh advfirewall firewall add rule name=<span class="s2">&quot;ICMPv6 128&quot;</span> protocol=icmpv6:128,any dir=in action=allow
</pre></div>
</div>
</div>
</div>
<div class="section" id="ipv6-on-link-hosts-based-on-ra-prefixes-not-subnet">
<span id="ipv6-routing"></span><h3>8.7.3.10. IPv6 “on-link” hosts based on RA prefixes, not subnet<a class="headerlink" href="#ipv6-on-link-hosts-based-on-ra-prefixes-not-subnet" title="Permalink to this headline">¶</a></h3>
<p>The IPv6 process is described in <a class="reference external" href="https://tools.ietf.org/html/rfc5942">RFC 5942</a> IPv6 Subnet Model: The Relationship between Links and Subnet Prefixes:</p>
<blockquote>
<div>IPv4 implementations typically associate a netmask with an address when an IPv4 address is assigned to an interface. That netmask together with the IPv4 address designates an on-link prefix. Nodes consider addresses covered by an on-link prefix to be directly attached to the same link as the sending node, i.e., they send traffic for such addresses directly rather than to a router.</div></blockquote>
<p>However, IPv6 works differently. Continuing on with <a class="reference external" href="https://tools.ietf.org/html/rfc5942">RFC 5942</a>:</p>
<blockquote>
<div><p>A host can have IPv6 addresses without any related on-link prefixes or can have on-link prefixes that are not related to any IPv6 addresses that are assigned to the host.</p>
<p>…</p>
<p>In IPv6, by default, a host treats only the link-local prefix as on-link.</p>
<p>The reception of a Prefix Information Option (PIO) with the L-bit set [RFC4861] and a non-zero valid lifetime creates (or updates) an entry in the Prefix List. All prefixes on a host’s Prefix List (i.e., those prefixes that have not yet timed out) are considered to be on-link by that host.</p>
</div></blockquote>
<p>What this means is that IPv6 hosts must save the Router Advertisement prefixes and use them to decide if a destination host is on-link. From <a class="reference external" href="https://tools.ietf.org/html/rfc5942">RFC 5942</a>:</p>
<blockquote>
<div>It should be noted that ND does not have a way to indicate a destination is “off-link”. Rather, a destination is assumed to be off-link, unless there is explicit information indicating that it is on-link.</div></blockquote>
</div>
<div class="section" id="ipv6-ula-addressing">
<span id="ipv6-ula"></span><h3>8.7.3.11. IPv6 ULA addressing<a class="headerlink" href="#ipv6-ula-addressing" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://tools.ietf.org/html/rfc4193">RFC 4193</a> <em>Unique Local IPv6 Unicast Addresses</em> are discussed in <a class="reference external" href="https://en.wikipedia.org/wiki/Unique_local_address">Wikipedia - Unique local address</a>:</p>
<blockquote>
<div><p>… an IPv6 address in the block fc00::/7 … They are routable within the scope of a certain private-owned network, but not in the global IPv6 Internet.</p>
<ul class="simple">
<li>They are not allocated by an address registry and may be used in networks by anyone without outside involvement.</li>
<li>They are not guaranteed to be globally unique.</li>
<li>Reverse Domain Name System (DNS) entries (under ip6.arpa) for fd00::/8 ULAs cannot be delegated in the global DNS.</li>
</ul>
</div></blockquote>
<p>Follow <a class="reference external" href="https://tools.ietf.org/html/rfc4193#section-3.2.2">RFC 4193 - 3.2.2. Sample code for Pseudo-Random Global ID Algorithm</a> to reduce the chance of collisions.</p>
<p><a class="reference external" href="https://tools.ietf.org/html/rfc7368#section-2.4">RFC 7368 2.4 Unique Local Addresses (ULAs)</a> says:</p>
<blockquote>
<div>A home network running IPv6 should deploy ULAs alongside its globally unique prefix(es) to allow stable communication between devices (on different subnets) within the homenet where that externally allocated globally unique prefix may change over time, e.g., due to renumbering within the subscriber’s ISP, or where external connectivity may be temporarily unavailable.</div></blockquote>
<p>Remember that ULA should not be the source or destination address for Internet traffic. And that it is one of many possible addresses for an interface, including link local and prefix delegated addresses.</p>
</div>
<div class="section" id="dhcpv6">
<h3>8.7.3.12. DHCPv6<a class="headerlink" href="#dhcpv6" title="Permalink to this headline">¶</a></h3>
<div class="section" id="a-few-terms">
<h4>8.7.3.12.1. A few terms<a class="headerlink" href="#a-few-terms" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>DUID (DHCP Unique IDentifier)</dt>
<dd>Unique identifier for every DHCP client and server.</dd>
<dt>IA (Identity Association)</dt>
<dd>Collection of a client’s leases, assigned an IAID (Identity Assocation IDentifier). For each interface there would be an IA_TA (temporary addresses), IA_PD (delegated prefix), and IA_NA (non-temporary addresses).</dd>
<dt>ff02::1:2</dt>
<dd>All DHCP servers and relay agents on the local network.</dd>
<dt>ff05::1:3</dt>
<dd>All DHCP server on local network site.</dd>
</dl>
</div>
<div class="section" id="operational-models">
<h4>8.7.3.12.2. Operational models<a class="headerlink" href="#operational-models" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>Stateless DHCP</dt>
<dd>DHCP does not provide address, but other configuration parameters.</dd>
<dt>DHCP for Non-Temporary Address Assignment</dt>
<dd>DHCP server provides IA_NA client addresses with a lifetime to clients, along with other configuration parameters.</dd>
<dt>DHCP for Prefix Delegation</dt>
<dd>A delegating DHCP server provides an IA_PD block of addresses with a lifetime to a requesting DHCP server.</dd>
<dt>DHCP for Customer Edge Routers</dt>
<dd>Customer edge routers get both an IA_NA WAN interface client address and an IA_PD block for customer network use.</dd>
<dt>DHCP for Temporary Addresses</dt>
<dd>Like non-temporary addresses, except lifetime is short and lifetime is not intended to be extended. These would be the addresses used to initiate Internet communication (thus not revealing persistent internal addresses).</dd>
<dt>Multiple Addresses and Prefixes</dt>
<dd><p class="first">Each IA_NA client request assigns up to 1 address for each of the link’s prefixes. Similary, IA_TA request assigns temporary addresses. Clients can make multiple IA_NA and/or IA_TA requests. Note that multiple prefixes are useful during network renumbering.</p>
<p class="last">Similary, multiple IA_PD requests can be made but server policy may not grant additional prefixes. It’s best to request a maximal IA_PD prefix initially.</p>
</dd>
</dl>
</div>
<div class="section" id="dhcp-rfcs">
<h4>8.7.3.12.3. DHCP RFCs<a class="headerlink" href="#dhcp-rfcs" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt><a class="reference external" href="https://datatracker.ietf.org/doc/draft-ietf-dhc-rfc3315bis/">RFC 3315bis</a> <em>Dynamic Host Configuration Protocol for IPv6 (DHCPv6) bis draft-ietf-dhc-rfc3315bis-10</em></dt>
<dd>“describes the Dynamic Host Configuration Protocol for IPv6 (DHCPv6): an extensible mechanism for configuring nodes with network configuration parameters, IP addresses, and prefixes. Parameters can be provided statelessly, or in combination with stateful assignment of one or more IPv6 addresses and/or IPv6 prefixes. DHCPv6 can operate either in place of or in addition to stateless address autoconfiguration (SLAAC).”</dd>
<dt><a class="reference external" href="https://tools.ieft.org/html/rfc3315">RFC 3315</a> <em>Dynamic Host Configuration Protocol for IPv6 (DHCPv6)</em></dt>
<dd>“enables DHCP servers to pass configuration parameters such as IPv6 network addresses to IPv6 nodes.  It offers the capability of automatic allocation of reusable network addresses and additional configuration flexibility  This protocol is a stateful counterpart to “IPv6 Stateless Address Autoconfiguration” (RFC 2462), and can be used separately or concurrently with the latter to obtain configuration parameters.”</dd>
<dt><a class="reference external" href="https://tools.ietf.org/html/rfc3633">RFC 3633</a> <em>IPv6 Prefix Options for Dynamic Host Configuration Protocol (DHCP) version 6</em></dt>
<dd>“provide a mechanism for automated delegation of IPv6 prefixes using the Dynamic Host Configuration Protocol (DHCP). This mechanism is intended for delegating a long-lived prefix from a delegating router to a requesting router, across an administrative boundary, where the delegating router does not require knowledge about the topology of the links in the network to which the prefixes will be assigned.” This defines the IA_PD (Identity Association for Prefix Delegation) as “a collection of prefixes assigned to the requesting router. Each IA_PD has an associated IAID. A requesting router may have more than one IA_PD assigned to it; for example, one for each of its interfaces.”</dd>
<dt><a class="reference external" href="https://tools.ietf.org/html/rfc3646">RFC 3646</a> <em>DNS Configuration options for Dynamic Host Configuration Protocol for IPv6 (DHCPv6)</em></dt>
<dd>“describes Dynamic Host Configuration Protocol for IPv6 (DHCPv6) options for passing a list of available DNS recursive name servers and a domain search list to a client.”</dd>
<dt><a class="reference external" href="https://tools.ietf.org/html/rfc3736">RFC 3736</a> <em>Stateless Dynamic Host Configuration Protocol (DHCP) Service for IPv6</em></dt>
<dd>“Stateless Dynamic Host Configuration Protocol service for IPv6 (DHCPv6) is used by nodes to obtain configuration information, such as the addresses of DNS recursive name servers, that does not require the maintenance of any dynamic state for individual clients.  A node that uses stateless DHCP must have obtained its IPv6 addresses through some other mechanism, typically stateless address autoconfiguration.”</dd>
<dt><a class="reference external" href="https://tools.ietf.org/html/rfc4704">RFC 4704</a> <em>The Dynamic Host Configuration Protocol for IPv6 (DHCPv6) Client Fully Qualified Domain Name (FQDN) Option</em></dt>
<dd>“specifies a new Dynamic Host Configuration Protocol for IPv6 (DHCPv6) option that can be used to exchange information about a DHCPv6 client’s Fully Qualified Domain Name (FQDN) and about responsibility for updating DNS resource records (RRs) related to the client’s address assignments.”</dd>
<dt><a class="reference external" href="https://tools.ietf.org/html/rfc6221">RFC 6221</a> <em>Lightweight DHCPv6 Relay Agent</em></dt>
<dd>“proposes a Lightweight DHCPv6 Relay Agent (LDRA) that is used to insert relay agent options in DHCPv6 message exchanges identifying client-facing interfaces.”</dd>
<dt><a class="reference external" href="https://tools.ietf.org/html/rfc6939">RFC 6939</a> <em>Client Link-Layer Address Option in DHCPv6</em></dt>
<dd>“specifies the format and mechanism that is to be used for encoding the client link-layer address in DHCPv6 Relay-Forward messages by defining a new DHCPv6 Client Link-Layer Address option.”</dd>
</dl>
</div>
<div class="section" id="android-s-lack-of-dhcpv6">
<h4>8.7.3.12.4. Android’s lack of DHCPv6<a class="headerlink" href="#android-s-lack-of-dhcpv6" title="Permalink to this headline">¶</a></h4>
<p>From <a class="reference external" href="https://en.wikipedia.org/wiki/DHCPv6#Implementation">Wikipedia - DHCPv6 - Implementation</a>, why DHCPv6 has not been implemented in Android:</p>
<blockquote>
<div><p>I think that that wide deployment of one-address-per-device IPv6 might actually do more harm than good, and I expect that many operators who are going to require stateful DHCPv6 addressing are going to use it for one-address-per-device IPv6.</p>
<p>Supporting DHCPv6-only networks will eventually force OS manufacturers to implement IPv6 NAT. This is because there are many features inside a mobile OS that require multiple IP addresses. One example is 464xlat. Another example is tethering.</p>
<p>In IPv4 we use NAT for all that, and that’s unavoidable due to lack of IPv4 space. That reason does not apply in IPv6 though. With SLAAC or DHCPv6 PD, these functions can use their own IPv6 addresses. With stateful DHCPv6 addressing, we’re back to using NAT again. That means application flakiness, battery impact due to NAT keepalives, and so on. It also means that things that don’t work behind NAT (e.g., 464xlat, which requires its own IPv6 address) cannot be made to work at all.</p>
<p>If there were consensus that delegating a prefix of sufficient size via DHCPv6 PD of a sufficient size is an acceptable substitute for stateful IPv6 addressing in the environments that currently insist on stateful DHCPv6 addressing, then it would make sense to implement it. In that scenario, Android would still not implement DHCPv6 NA, but it would implement DHCPv6 PD.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="using-64-prefixes">
<h3>8.7.3.13. Using &gt; /64 prefixes<a class="headerlink" href="#using-64-prefixes" title="Permalink to this headline">¶</a></h3>
<p>No SLAAC, yes DHCPv6.</p>
<p>From <a class="reference external" href="https://tools.ietf.org/html/rfc5375#section-3">RFC 5375 IPv6 Unicast Address Assignment Considerations 3. Subnet Prefix considerations</a>:</p>
<blockquote>
<div><p>Using a subnet prefix length other than a /64 will break many features of IPv6, including Neighbor Discovery (ND), Secure Neighbor Discovery (SEND) [RFC3971], privacy extensions [RFC4941], parts of Mobile IPv6 [RFC4866], Protocol Independent Multicast - Sparse Mode (PIM-SM) with Embedded-RP [RFC3956], and Site Multihoming by IPv6 Intermediation (SHIM6) [SHIM6], among others.  A number of other features currently in development, or being proposed, also rely on /64 subnet prefixes.</p>
<p>However, some network administrators have used prefixes longer than /64 for links connecting routers, usually just two routers on a point-to-point link.  On links where all the addresses are assigned by manual configuration, and all nodes on the link are routers (not end hosts) that are known by the network, administrators do not need any of the IPv6 features that rely on /64 subnet prefixes, this can work.  Using subnet prefixes longer than /64 is not recommended for general use, and using them for links containing end hosts would be an especially bad idea, as it is difficult to predict what IPv6 features the hosts will use in the future.</p>
</div></blockquote>
<p>From <a class="reference external" href="https://tools.ietf.org/html/rfc7421">RFC 7421</a> <em>Analysis of the 64-bit Boundary in IPv6 Addressing</em>:</p>
<blockquote>
<div>The notion of a /64 boundary in the address was introduced after the initial design of IPv6, following a period when it was expected to be at /80.  There were two motivations for setting it at /64. One was the original “8+8” proposal [ODELL] that eventually led to the Identifier-Locator Network Protocol (ILNP) [RFC6741], which required a fixed point for the split between local and wide-area parts of the address.  The other was the expectation that 64-bit Extended Unique Identifier (EUI-64) Media Access Control (MAC) addresses would become widespread in place of 48-bit addresses, coupled with the plan at that time that auto-configured addresses would normally be based on interface identifiers derived from MAC addresses.</div></blockquote>
<p>However, there are exceptions. From <a class="reference external" href="https://tools.ietf.org/html/rfc6164">RFC 6164</a> <em>Using 127-Bit IPv6 Prefixes on Inter-Router Links</em>:</p>
<blockquote>
<div>This document provides a rationale for using 127-bit prefix lengths, reevaluates the reasons why doing so was considered harmful, and specifies how /127 prefixes can be used on inter-router links configured for use as point-to-point links.</div></blockquote>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="loadlibrary.html" class="btn btn-neutral float-right" title="8.8. loadlibrary" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="fw.html" class="btn btn-neutral" title="8.6. Firewalls" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, bitbender.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.3',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>