

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta content="default-src 'none'; script-src 'self' https://cdnjs.cloudflare.com 'unsafe-inline'; connect-src 'self'; img-src 'self'; style-src 'self'; font-src 'self'; form-action 'self'; frame-ancestors 'none'; base-uri 'self'" http-equiv="Content-Security-Policy" />
<meta content="nosniff" http-equiv="X-Content-Type-Options" />
<meta content="deny" http-equiv="X-Frame-Options" />
<meta content="1; mode=block" http-equiv="X-XSS-Protection" />
<meta content="strict-origin" http-equiv="Referrer-Policy" />
<meta content="max-age=31536000; includeSubDomains" http-equiv="Strict-Transport-Security" />
<meta content="'*'" http-equiv="Access-Control-Allow-Origin" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>8.1. 2 Factor Authentication &mdash; South Bay WASP 1.0.3 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="South Bay WASP 1.0.3 documentation" href="../index.html"/>
        <link rel="up" title="8. Pentest Study" href="../pentest_study.html"/>
        <link rel="next" title="8.2. Cryptography" href="crypto.html"/>
        <link rel="prev" title="8. Pentest Study" href="../pentest_study.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> South Bay WASP
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pentest_intro.html">1. South Bay WASP Meetup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_kali.html">2. Kali Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_challenges.html">3. Pentest Challenges</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_encryption.html">4. Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_html.html">5. HTML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_network_tools.html">6. Pentest Network Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_recon.html">7. Pentest Reconnaisance</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../pentest_study.html">8. Pentest Study</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">8.1. 2 Factor Authentication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fido-u2f">8.1.1. FIDO U2F</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#what-is-a-security-key">8.1.1.1. What is a security key?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-was-the-security-key-set-up">8.1.1.2. How was the security key set up?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-does-it-work">8.1.1.3. How does it work?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#what-are-the-shortcomings">8.1.1.4. What are the shortcomings?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#will-it-be-near-universally-adopted">8.1.1.5. Will it be near-universally adopted?</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="crypto.html">8.2. Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="dnssec.html">8.3. DNSSEC, DANE, and DNS encryption</a></li>
<li class="toctree-l2"><a class="reference internal" href="email_security.html">8.4. Email Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="exfiltration.html">8.5. Exfiltration</a></li>
<li class="toctree-l2"><a class="reference internal" href="exiftool.html">8.6. <strong class="program">exiftool</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="fw.html">8.7. Firewalls</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipv6.html">8.8. IPv6</a></li>
<li class="toctree-l2"><a class="reference internal" href="loadlibrary.html">8.9. loadlibrary</a></li>
<li class="toctree-l2"><a class="reference internal" href="linux_exploitation_tricks.html">8.10. Linux Exploitation Tricks</a></li>
<li class="toctree-l2"><a class="reference internal" href="linux_networking.html">8.11. Linux networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="llmnr.html">8.12. Windows broadcast name resolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="nftables.html">8.13. nftables</a></li>
<li class="toctree-l2"><a class="reference internal" href="not_getting_hacked.html">8.14. Not getting hacked</a></li>
<li class="toctree-l2"><a class="reference internal" href="ntlm.html">8.15. NTLM</a></li>
<li class="toctree-l2"><a class="reference internal" href="passwords.html">8.16. Password Cracking Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="php.html">8.17. PHP &amp; MySQL Shortcomings</a></li>
<li class="toctree-l2"><a class="reference internal" href="static_websites.html">8.18. Static websites</a></li>
<li class="toctree-l2"><a class="reference internal" href="virtualization_networking.html">8.19. Virtualization &amp; networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="vulnerabilities.html">8.20. Vulnerabilites</a></li>
<li class="toctree-l2"><a class="reference internal" href="waf.html">8.21. WAF Evasion</a></li>
<li class="toctree-l2"><a class="reference internal" href="wifi.html">8.22. WiFi Tutorial</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_buffer_overflow.html">9. Pentest Buffer Overflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_scripting.html">10. Pentest scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_presentations.html">11. Pentest Presentations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">South Bay WASP</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../pentest_study.html">8. Pentest Study</a> &raquo;</li>
        
      <li>8.1. 2 Factor Authentication</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/study/2factor.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="factor-authentication">
<h1>8.1. 2 Factor Authentication<a class="headerlink" href="#factor-authentication" title="Permalink to this headline">¶</a></h1>
<p>Pentesters need security, too.</p>
<div class="section" id="fido-u2f">
<h2>8.1.1. <a class="reference external" href="https://fidoalliance.org/about">FIDO</a> <a class="reference external" href="https://fidoalliance.org/specs/fido-u2f-overview-v1.0-rd-20141008.pdf">U2F</a><a class="headerlink" href="#fido-u2f" title="Permalink to this headline">¶</a></h2>
<p>This started with notice of <a class="reference external" href="https://fidoalliance.org/news/item/google-launches-security-key">Google Launches Security Key, World’s First Deployment of Fast Identity Online Universal Second Factor (FIDO U2F) Authentication</a> announcing Google’s <a class="reference external" href="http://googleonlinesecurity.blogspot.com/2014/10/strengthening-2-step-verification-with.html">Strengthening 2-Step Verification with Security Key</a>. Basically, Google’s 2-step verification added support for the FIDO (Fast IDentity Online) U2F (Universal 2nd Factor) security keys, a simple USB hardware device. Currently only Google supports FIDO U2F and it requires the Google Chrome browser version 38+. For details consult <a class="reference external" href="https://fidoalliance.org/specifications/download/">FIDO technical specifications</a>; the detailed overview <a class="reference external" href="https://fidoalliance.org/specs/fido-u2f-overview-v1.0-rd-20141008.pdf">FIDO U2F Architectural Overview</a> is freely quoted below without attribution.</p>
<div class="section" id="what-is-a-security-key">
<h3>8.1.1.1. What is a security key?<a class="headerlink" href="#what-is-a-security-key" title="Permalink to this headline">¶</a></h3>
<p>For actual devices see <a class="reference external" href="http://www.amazon.com/s/?field-keywords=%22FIDO%20U2F%20Security%20Key%22">Amazon FIDO U2F Security Key search</a>.</p>
</div>
<div class="section" id="how-was-the-security-key-set-up">
<h3>8.1.1.2. How was the security key set up?<a class="headerlink" href="#how-was-the-security-key-set-up" title="Permalink to this headline">¶</a></h3>
<p>A pentest-meetup member purchased 2 <a class="reference external" href="http://sk.plug-up.com/">Plug-Up International security keys</a> and set up their Google account to use 2 factor authentication. Since a security key is a USB device it cannot support devices like smart phones lacking USB ports, but Google  has multiple choices for <a class="reference external" href="https://www.google.com/landing/2step/features.html">Google account 2-factor authentication</a> that handle desktops, tablets, and mobile phones.</p>
<ul class="simple">
<li>Google Chrome 38+ is available via standard packages on Debian Jessie but not Kali, requiring uninstalling the official Kali package and manually downloading and installing the latest Chrome browser from Google.</li>
<li>The security key works out-of-the-box on Windows but on Linux udev had to be configured to allow normal user access to the usb device. On both Debian Jessie and Kali the file /etc/udev/rules.d/10-security-key.rules was added. The file content for Debian Jessie was <em>SUBSYSTEMS==”usb”, ATTRS{idVendor}==”2581”, ATTRS{idProduct}==”f1d0”, MODE=”0660”, GROUP=”plugdev”</em> where plugdev should be the group containing the U2F users. On Kali the file content was <em>SUBSYSTEMS==”usb”, ATTRS{idVendor}==”2581”, TAG+=’uaccess”, TAG+=”udev-acl”</em>. After configuring the file run the command <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">udevadm</span> <span class="pre">trigger</span></code> and Chrome will be able to access the security key. Running <code class="docutils literal notranslate"><span class="pre">dmesg</span> <span class="pre">|</span> <span class="pre">tail</span></code> should verify the security key USB insertion.</li>
<li>The target account’s Google 2-factor authentication was enabled using these options:<ul>
<li>Security keys: this option was enabled and the 2 keys were registered.</li>
<li>Verification codes: the primary option for verification codes was set up to default to Google Authenticator (for the mobile phone), which was installed and configured on the mobile phone. Two backup options were selected: the mobile phone’s number was configured as a backup number, and 10 backup one-use codes were generated in case all the other methods failed.</li>
<li>Registered computers: when first logging into Google using the security key, an option is presented to register the computer to avoid further security key use on that computer. All such computers will be listed under registered computers (which starts off as an empty list).</li>
</ul>
</li>
</ul>
<p>The net effect is that Google login from a desktop computer would ask for the security key, but the mobile phone would default to the Google Authenticator app. If these were not available the backup phone or one of the backup codes could be used to login.</p>
<p>Linux KVM virtual machines were not able to access the security key from Google Chrome, forcing use of a verification code (Google Authenticator in this case).</p>
<p>Note that there is a many-to-many mapping between security keys and accounts; multiple security keys can be used with any one account account, and any one security key can be used with multiple accounts. So the 2 purchased security keys can be backups to each other for all of the user’s accounts. The first security key usage on a computer will ask if the computer should be registered to not require the security key in the future.</p>
</div>
<div class="section" id="how-does-it-work">
<h3>8.1.1.3. How does it work?<a class="headerlink" href="#how-does-it-work" title="Permalink to this headline">¶</a></h3>
<p>Here is an overview of security key functionality:</p>
<blockquote>
<div><p>The U2F device and protocol need to guarantee user privacy and security. At the core of the protocol, the U2F device has a capability (ideally, embodied in a secure element) which mints an origin-specific public/private key pair. The U2F device gives the public key and a Key Handle to the origin online service or website during the user registration step.</p>
<p>Later, when the user performs an authentication, the origin online service or website sends the Key Handle back to the U2F device via the browser. The U2F device uses the Key Handle to identify the user’s private key, and creates a signature which is sent back to the origin to verify the presence of the U2F device. Thus, the Key Handle is simply an identifier of a particular key on the U2F device.</p>
</div></blockquote>
</div>
<div class="section" id="what-are-the-shortcomings">
<h3>8.1.1.4. What are the shortcomings?<a class="headerlink" href="#what-are-the-shortcomings" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://fidoalliance.org/specs/fido-security-ref-v1.0-rd-20141008.pdf">FIDO Security Reference</a> provides security details including preventing MITM and phishing attacks. Here we add a couple of points:</p>
<ul>
<li><p class="first">Currently it requires a USB interface, but future implementations will address this issue.</p>
</li>
<li><p class="first">The security key is a tiny, limited computer with much of the actual hardware &amp; software implementation and crypto algorithms unspecified, allowing potentially weak vendor implementations.</p>
<p>The actual security key implementations are unknown and unspecified. What crypto algorithms does the key use? What is done in software vs. hardware? Can the firmware/software be updated? (There’s no winning answer to that question: yes implies a security risk for malware updating the security key, no implies bugs can’t be fixed without buying a new security key.) Can you verify the security key has not been tampered with?</p>
<p>And since organizations have obtained certificates to impersonate legitimate sites, there exists the distinct possibility of such organizations issuing fake security keys that not only don’t provide good security, but actually are attack vectors into the user’s computers. Additionally, malware on the computer can freely access the security key when inserted, creating further attack opportunities (though having such malware is itself a “game over” problem).</p>
</li>
<li><p class="first">Additionally, to allow for cheap devices with fixed, limited storage, the Key Handle issued by a U2F device:</p>
<blockquote>
<div><p>“can ‘store’ (i.e., contain) the private key for the origin and the hash of the origin encrypted with a ‘wrapping’ key known only to the U2F device secure element. When the Key Handle goes back to the secure element it ‘unwraps’ it to ‘retrieve’ the private key and the origin that it was generated for.</p>
</div></blockquote>
<p>So cheap devices can actually hand the encoded private key to authenticating web sites. Done poorly, this provides an attack vector.</p>
</li>
<li><p class="first">Should a web site want to discriminate between “good” and “bad” security keys, the standard allows the following:</p>
<blockquote>
<div><p>Every U2F device device has a shared ‘Attestation’ key pair which is present on it – this key is shared across a large number of U2F device units made by the same vendor (this is to prevent individual identifiability of the U2F device). Every public key output by the U2F device during the registration step is signed with the attestation private key.</p>
<p>The intention is that the public keys of all the ‘Attestation’ key pairs used by each vendor will be available in the public domain – this could be implemented by certificates chaining to a root public key or literally as a list. We will work within FIDO to decide the details on how certified vendors can publish their attestation public keys.</p>
<p>When such an infrastructure is available, a particular relying party – say, a bank – might choose to accept only U2F devices from certain vendors which have the appropriate published certifications. To enforce this policy, it can verify that the public key from a U2F device presented by the user is from a vendor it trusts.</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="will-it-be-near-universally-adopted">
<h3>8.1.1.5. Will it be near-universally adopted?<a class="headerlink" href="#will-it-be-near-universally-adopted" title="Permalink to this headline">¶</a></h3>
<p>The big question is will it be near-universally adopted with a smart phone implementation? If so, it may strenghten user identification to the pint that the biggest weak point might be social engineering the account recovery process.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="crypto.html" class="btn btn-neutral float-right" title="8.2. Cryptography" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../pentest_study.html" class="btn btn-neutral" title="8. Pentest Study" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, bitbender.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.3',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>