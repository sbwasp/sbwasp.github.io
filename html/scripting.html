

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>5.4. Scripting &mdash; South Bay WASP 1.0.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="South Bay WASP 1.0.2 documentation" href="../index.html"/>
        <link rel="up" title="5. HTML" href="../pentest_html.html"/>
        <link rel="next" title="5.5. Data" href="data.html"/>
        <link rel="prev" title="5.3. Parsing &amp; Rendering HTML" href="parsing.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> South Bay WASP
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pentest_intro.html">1. South Bay WASP Meetup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_kali.html">2. Kali Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_challenges.html">3. Pentest Challenges</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_encryption.html">4. Encryption</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../pentest_html.html">5. HTML</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="standards.html">5.1. Standards</a></li>
<li class="toctree-l2"><a class="reference internal" href="http.html">5.2. HTTP(S) vs HTML</a></li>
<li class="toctree-l2"><a class="reference internal" href="parsing.html">5.3. Parsing &amp; Rendering HTML</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">5.4. Scripting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#scripts-sources-enabling-and-environments">5.4.1. Scripts: Sources, Enabling, and Environments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#sources">5.4.1.1. Sources</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enabling">5.4.1.2. Enabling</a></li>
<li class="toctree-l4"><a class="reference internal" href="#environments">5.4.1.3. Environments</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#web-workers">5.4.2. Web Workers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sandboxing">5.4.3. Sandboxing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="data.html">5.5. Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="html_security.html">5.6. HTML security</a></li>
<li class="toctree-l2"><a class="reference internal" href="messaging.html">5.7. HTML Web Messaging</a></li>
<li class="toctree-l2"><a class="reference internal" href="html_exploits.html">5.8. HTML exploits</a></li>
<li class="toctree-l2"><a class="reference internal" href="hsts.html">5.9. HSTS Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="xss.html">5.10. XSS Tutorial</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_network_tools.html">6. Pentest Network Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_recon.html">7. Pentest Reconnaisance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_study.html">8. Pentest Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_buffer_overflow.html">9. Pentest Buffer Overflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_scripting.html">10. Pentest scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_presentations.html">11. Pentest Presentations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">South Bay WASP</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../pentest_html.html">5. HTML</a> &raquo;</li>
        
      <li>5.4. Scripting</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/html/scripting.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="scripting">
<h1>5.4. Scripting<a class="headerlink" href="#scripting" title="Permalink to this headline">¶</a></h1>
<div class="section" id="scripts-sources-enabling-and-environments">
<h2>5.4.1. Scripts: Sources, Enabling, and Environments<a class="headerlink" href="#scripts-sources-enabling-and-environments" title="Permalink to this headline">¶</a></h2>
<div class="section" id="sources">
<h3>5.4.1.1. Sources<a class="headerlink" href="#sources" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://html.spec.whatwg.org/multipage/webappapis.html#scripting">WHATWG Scripting</a> defines the various methods providing code to run:</p>
<ul>
<li><p class="first">&lt;script&gt; elements</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">javascript:</span></code> URLs</p>
</li>
<li><p class="first">event handlers</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;alert(&#39;hello&#39;)&quot;</span> <span class="p">/&gt;</span>
</pre></div>
</div>
<p>Here’s an example from the standard of multiple even listeners registered for one event:</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;test&quot;</span><span class="p">&gt;</span>Start Demo<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
 <span class="kd">var</span> <span class="nx">button</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">);</span>
 <span class="nx">button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;ONE&#39;</span><span class="p">)</span> <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
 <span class="nx">button</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;onclick&#39;</span><span class="p">,</span> <span class="s2">&quot;alert(&#39;NOT CALLED&#39;)&quot;</span><span class="p">);</span> <span class="c1">// event handler listener is registered here</span>
 <span class="nx">button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;THREE&#39;</span><span class="p">)</span> <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
 <span class="nx">button</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;TWO&#39;</span><span class="p">);</span> <span class="p">};</span>
 <span class="nx">button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;FOUR&#39;</span><span class="p">)</span> <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>    button.onclick = function () { alert(&#39;hello&#39;); };
</pre></div>
</div>
</li>
<li><p class="first">processing technologies like SVG, … that have their own scripting</p>
</li>
</ul>
</div>
<div class="section" id="enabling">
<h3>5.4.1.2. Enabling<a class="headerlink" href="#enabling" title="Permalink to this headline">¶</a></h3>
<p>Scripting is enabled in the browsing context when these conditions are true: the user agent supports scripting (<code class="docutils literal"><span class="pre">curl</span></code> doesn’t), the user has not disabled scripting, and the browsing context’s active document’s active sandboxing flag allows scripting (does not have the “sandboxed scripts browsing context flag” set).</p>
</div>
<div class="section" id="environments">
<h3>5.4.1.3. Environments<a class="headerlink" href="#environments" title="Permalink to this headline">¶</a></h3>
<p>The ECMAScript specification defines a global environments. HTML has 3 kinds of JavaScript global environments: document environment (the default), the dedicated worker environment, and the shared worker environment. The dedicated and shared worker environments are discussed below in <a class="reference internal" href="#web-workers"><span class="std std-ref">Web Workers</span></a> and are executed in the background concurrent with the document environment.</p>
</div>
</div>
<div class="section" id="web-workers">
<span id="id1"></span><h2>5.4.2. Web Workers<a class="headerlink" href="#web-workers" title="Permalink to this headline">¶</a></h2>
<p>Web workers are defined both in <a class="reference external" href="http://www.w3.org/TR/workers/">W3C Web Workers</a> and <a class="reference external" href="https://html.spec.whatwg.org/multipage/#toc-workers">WHATWG Web Workers</a>. From <a class="reference external" href="http://en.wikipedia.org/wiki/Web_worker">Web worker</a>:</p>
<blockquote>
<div><p>As envisioned by WHATWG, web workers are relatively heavy-weight. They are expected to be long-lived, have a high start-up performance cost, and a high per-instance memory cost.</p>
<p>Web workers are not intended or expected to be used in large numbers as they could hog system resources.</p>
<p>Web Workers allow for concurrent execution of the browser threads and one or more JavaScript threads running in the background. The browser which follows a single thread of execution will have to wait on JavaScript programs to finish executing before proceeding and this may take significant time which the programmer may like to hide from the user. It allows for the browser to continue with normal operation while running in the background.The web worker specification is a separate specification from the HTML5 specification and can be used with HTML5.</p>
<p>There are two types of web workers: dedicated and shared workers.</p>
<p>When web workers run in the background, they do not have direct access to the DOM but communicate with the document by message passing. This allows for multi-threaded execution of JavaScript programs.</p>
</div></blockquote>
<p>From <a class="reference external" href="https://html.spec.whatwg.org/multipage/#toc-workers">WHATWG Web Workers</a>:</p>
<blockquote>
<div>There are two kinds of workers; dedicated workers, and shared workers. Dedicated workers, once created, are linked to their creator; but message ports can be used to communicate from a dedicated worker to multiple other browsing contexts or workers. Shared workers, on the other hand, are named, and once created any script running in the same origin can obtain a reference to that worker and communicate with it.</div></blockquote>
<p>See <a class="reference external" href="http://www.w3schools.com/html/html5_webworkers.asp">HTML5 Web Workers</a> for a short web workers example. Here is the script for the background dedicated worker:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~$</span> curl -s http://www.w3schools.com/html/demo_workers.js
<span class="go">var i=0;</span>

<span class="go">function timedCount() {</span>
<span class="go">    i=i+1;</span>
<span class="go">    postMessage(i);</span>
<span class="go">    setTimeout(&quot;timedCount()&quot;, 500);</span>
<span class="go">}</span>

<span class="go">timedCount();</span>
</pre></div>
</div>
<p>And here is the code for the client side to start the backgroudn dedicate worker:</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="hll"><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Count numbers: <span class="p">&lt;</span><span class="nt">output</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;result&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">output</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span class="hll"><span class="p">&lt;</span><span class="nt">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;startWorker()&quot;</span><span class="p">&gt;</span>Start Worker<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span><span class="hll"><span class="p">&lt;</span><span class="nt">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;stopWorker()&quot;</span><span class="p">&gt;</span>Stop Worker<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>Note:<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span> Internet Explorer 9 and earlier versions do not support Web Workers.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="kd">var</span> <span class="nx">w</span><span class="p">;</span>

<span class="hll"><span class="kd">function</span> <span class="nx">startWorker</span><span class="p">()</span> <span class="p">{</span>
</span><span class="hll">    <span class="k">if</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">Worker</span><span class="p">)</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">        <span class="k">if</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">w</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">            <span class="nx">w</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Worker</span><span class="p">(</span><span class="s2">&quot;demo_workers.js&quot;</span><span class="p">);</span>
</span><span class="hll">        <span class="p">}</span>
</span><span class="hll">        <span class="nx">w</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">            <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
</span><span class="hll">        <span class="p">};</span>
</span><span class="hll">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class="hll">        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&quot;Sorry, your browser does not support Web Workers...&quot;</span><span class="p">;</span>
</span><span class="hll">    <span class="p">}</span>
</span><span class="hll"><span class="p">}</span>
</span>
<span class="hll"><span class="kd">function</span> <span class="nx">stopWorker</span><span class="p">()</span> <span class="p">{</span>
</span><span class="hll">    <span class="nx">w</span><span class="p">.</span><span class="nx">terminate</span><span class="p">();</span>
</span><span class="hll">    <span class="nx">w</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
</span><span class="hll"><span class="p">}</span>
</span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Security-wise, web workers can use XMLHttpRequest for in-domain and CORS requests, creating a vector for exploitation.</p>
</div>
<div class="section" id="sandboxing">
<span id="id2"></span><h2>5.4.3. Sandboxing<a class="headerlink" href="#sandboxing" title="Permalink to this headline">¶</a></h2>
<p>The idea behind sandboxing is to include content from other origins in a sandboxed iframe, whitelisting only the capabilities it needs. <a class="reference external" href="http://www.html5rocks.com/en/tutorials/security/sandboxed-iframes/">Play safely in sandboxed IFrames</a> provides the demo <a class="reference external" href="http://www.html5rocks.com/static/demos/evalbox/index.html">Evalbox</a> showing iframe unsandboxed &amp; sandboxed execution. Here is the trivial difference between the 2 iframes:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">hacker@kali:~$</span> curl -s http://www.html5rocks.com/static/demos/evalbox/index.html <span class="p">|</span> <span class="se">\</span>
  sed -n -e  <span class="s1">&#39;/&lt;iframe/,/\/iframe&gt;/p&#39;</span>
<span class="go">    &lt;iframe id=&#39;unsandboxed&#39;</span>
<span class="go">            src=&#39;frame.html&#39;&gt;&lt;/iframe&gt;</span>
<span class="go">    &lt;iframe sandbox=&#39;allow-scripts&#39;</span>
<span class="go">            id=&#39;sandboxed&#39;</span>
<span class="go">            src=&#39;frame.html&#39;&gt;&lt;/iframe&gt;</span>
</pre></div>
</div>
<p>Here is a twitter button is included in an iframe, being granted only the rights to allow-scripts, allow-popups, and allow-forms:</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">sandbox</span><span class="o">=</span><span class="s">&quot;allow-same-origin allow-scripts allow-popups allow-forms&quot;</span>
    <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://platform.twitter.com/widgets/tweet_button.html&quot;</span>
    <span class="na">style</span><span class="o">=</span><span class="s">&quot;border: 0; width:130px; height:20px;&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">iframe</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>The default restrictions include:</p>
<blockquote>
<div><p>No JavaScript, no forms, no plugins, no automatic event triggering (autofocus, autoplay, …), no navigation to other parts of the page, and no seamless attribute.</p>
<p>The iframe is loaded into it’s own origin, meaning no access to other origin’s data (cookies, DOM, IndexedDB, localStorage, sessionStorage, …).</p>
</div></blockquote>
<p>While sanboxed iframes can never run plugins (which are inherently unsandboxed), the CSP can allow-forms, allow-popups, allow-pointer-lock, allow-same-origin, allow-scripts, allow-top-navigation.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="data.html" class="btn btn-neutral float-right" title="5.5. Data" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="parsing.html" class="btn btn-neutral" title="5.3. Parsing &amp; Rendering HTML" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, bitbender.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>