

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta content="default-src 'none'; script-src 'self' https://cdnjs.cloudflare.com 'unsafe-inline'; connect-src 'self'; img-src 'self'; style-src 'self'; font-src 'self'; form-action 'self'; frame-ancestors 'none'; base-uri 'self'" http-equiv="Content-Security-Policy" />
<meta content="nosniff" http-equiv="X-Content-Type-Options" />
<meta content="deny" http-equiv="X-Frame-Options" />
<meta content="1; mode=block" http-equiv="X-XSS-Protection" />
<meta content="strict-origin" http-equiv="Referrer-Policy" />
<meta content="max-age=31536000; includeSubDomains" http-equiv="Strict-Transport-Security" />
<meta content="'*'" http-equiv="Access-Control-Allow-Origin" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>5.7. HTML Web Messaging &mdash; South Bay WASP 1.0.3 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5.8. HTML exploits" href="html_exploits.html" />
    <link rel="prev" title="5.6. HTML security" href="html_security.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> South Bay WASP
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pentest_intro.html">1. South Bay WASP Meetup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_kali.html">2. Kali Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_challenges.html">3. Pentest Challenges</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_encryption.html">4. Encryption</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../pentest_html.html">5. HTML</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="standards.html">5.1. Standards</a></li>
<li class="toctree-l2"><a class="reference internal" href="http.html">5.2. HTTP(S) vs HTML</a></li>
<li class="toctree-l2"><a class="reference internal" href="parsing.html">5.3. Parsing &amp; Rendering HTML</a></li>
<li class="toctree-l2"><a class="reference internal" href="scripting.html">5.4. Scripting</a></li>
<li class="toctree-l2"><a class="reference internal" href="data.html">5.5. Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="html_security.html">5.6. HTML security</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">5.7. HTML Web Messaging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#xmlhttprequest2-xhr2">5.7.1. XMLHttpRequest2 (XHR2)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#web-messaging-messageevent">5.7.2. Web Messaging (MessageEvent)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#server-sent-events">5.7.3. Server-sent events</a></li>
<li class="toctree-l3"><a class="reference internal" href="#web-sockets">5.7.4. Web sockets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id25">5.7.5. Web Messaging</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id26">5.7.5.1. Cross-document messaging</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id28">5.7.5.2. Channel messaging</a></li>
<li class="toctree-l4"><a class="reference internal" href="#broadcast-messaging">5.7.5.3. Broadcast messaging</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="html_exploits.html">5.8. HTML exploits</a></li>
<li class="toctree-l2"><a class="reference internal" href="hsts.html">5.9. HSTS Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="xss.html">5.10. XSS Tutorial</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_network_tools.html">6. Pentest Network Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_recon.html">7. Pentest Reconnaisance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_study.html">8. Pentest Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_buffer_overflow.html">9. Pentest Buffer Overflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_scripting.html">10. Pentest scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pentest_presentations.html">11. Pentest Presentations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">South Bay WASP</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../pentest_html.html">5. HTML</a> &raquo;</li>
        
      <li>5.7. HTML Web Messaging</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/html/messaging.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="html-web-messaging">
<h1>5.7. HTML Web Messaging<a class="headerlink" href="#html-web-messaging" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://www.owasp.org/index.php/HTML5_Security_Cheat_Sheet">OWASP HTML5 Security Cheat Sheet</a> has security suggestions for HTML web messaging.</p>
<div class="section" id="xmlhttprequest2-xhr2">
<h2>5.7.1. XMLHttpRequest2 (XHR2)<a class="headerlink" href="#xmlhttprequest2-xhr2" title="Permalink to this headline">¶</a></h2>
<p>Note: for additional changes in XMLHttpRequest2, see <a class="reference external" href="http://www.html5rocks.com/en/tutorials/file/xhr2/">New Tricks in XMLHttpRequest2</a>.</p>
<p>Recent updates to <a class="reference external" href="https://en.wikipedia.org/wiki/XMLHttpRequest">XMLHttpRequest</a> have added CORS (<a class="reference external" href="http://en.wikipedia.org/wiki/Cross-origin_resource_sharing">Cross-origin resource sharing</a>) support which helps overcome the restrictions of the <a class="reference external" href="https://en.wikipedia.org/wiki/Same-origin_policy">Same-origin policy</a>. What does this mean?</p>
<p>From <a class="reference external" href="https://en.wikipedia.org/wiki/XMLHttpRequest">XMLHttpRequest</a>:</p>
<blockquote>
<div><p>XMLHttpRequest (XHR) is an API available to web browser scripting languages such as JavaScript. It is used to send HTTP or HTTPS requests to a web server and load the server response data back into the script.</p>
<p>For security reasons, XMLHttpRequest requests follow the browser’s same-origin policy, and will therefore only succeed if they are made to the host that served the original web page.</p>
<p>The CORS protocol has several restrictions, with two models of support. The simple model does not allow setting custom request headers and omits cookies. Further, only the GET and POST request methods are supported, and POST only allows the following MIME types: “text/plain”, “application/x-www-urlencoded” and “multipart/form-data”. Only “text/plain” was initially supported. The other model detects when one of the non-simple features are requested and sends a pre-flight request to the server to negotiate the feature.</p>
</div></blockquote>
<p>The point is that the latest XHR allows using CORS (<a class="reference external" href="http://en.wikipedia.org/wiki/Cross-origin_resource_sharing">Cross-origin resource sharing</a>) to circumvent the <a class="reference external" href="https://en.wikipedia.org/wiki/Same-origin_policy">Same-origin policy</a>. From the <a class="reference external" href="https://en.wikipedia.org/wiki/Same-origin_policy">Same-origin policy</a>:</p>
<blockquote>
<div><p>The policy permits scripts running on pages originating from the same site – a combination of scheme, hostname, and port number – to access each other’s DOM with no specific restrictions, but prevents access to DOM on different sites. The same-origin policy also applies to XMLHttpRequests unless the server provides an Access-Control-Allow-Origin (CORS) header.</p>
<p>The same-origin policy restricts which network messages one origin can send to another. For example, the same-origin policy allows inter-origin HTTP requests with GET and POST methods but denies inter-origin PUT and DELETE requests. Additionally, origins can use custom HTTP headers when sending requests to themselves but cannot use custom headers when sending requests to other origins.</p>
</div></blockquote>
</div>
<div class="section" id="web-messaging-messageevent">
<span id="id21"></span><h2>5.7.2. Web Messaging (MessageEvent)<a class="headerlink" href="#web-messaging-messageevent" title="Permalink to this headline">¶</a></h2>
<p>The MessageEvent interface is the foundation of HTML web messaging. From <a class="reference external" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent">MessageEvent</a>:</p>
<blockquote>
<div><dl class="docutils">
<dt>event.data</dt>
<dd>Returns the data of the message.</dd>
<dt>event.origin</dt>
<dd>Returns the origin of the message, for server-sent events and cross-document messaging.</dd>
<dt>event.lastEventId</dt>
<dd>Returns the last event ID string, for server-sent events.</dd>
<dt>event.source</dt>
<dd>Returns the WindowProxy of the source window, for cross-document messaging, and the MessagePort being attached, in the connect event fired at SharedWorkerGlobalScope objects.</dd>
<dt>event.ports</dt>
<dd>Returns the MessagePort array sent with the message, for cross-document messaging and channel messaging.</dd>
</dl>
</div></blockquote>
<p>From <a class="reference external" href="https://dev.opera.com/articles/window-postmessage-messagechannel/">An Introduction to HTML5 Web Messaging</a>:</p>
<blockquote>
<div><p>Before we get into the nitty-gritty of web messaging, let’s take a look at the message event object. Cross-document messaging, channel messaging, server-sent events and web sockets all fire message events, so understanding it is helpful. Message events, defined by the MessageEvent interface, contain five read-only attributes …</p>
<p>In the case of cross-document messaging events and channel messaging, the value of lastEventId is always an empty string; lastEventId applies to server-sent events. If no ports are sent with the message, the value of the ports attribute will be an array whose length is zero.</p>
</div></blockquote>
</div>
<div class="section" id="server-sent-events">
<h2>5.7.3. Server-sent events<a class="headerlink" href="#server-sent-events" title="Permalink to this headline">¶</a></h2>
<p>This section is based on <a class="reference external" href="https://html.spec.whatwg.org/multipage/comms.html#server-sent-events">Server-sent events</a>. See <a class="reference external" href="http://www.w3schools.com/html/html5_serversentevents.asp">HTML5 Server-Sent Events</a> for an example.</p>
<p>Server-sent events are one-way messages from the server to the client. Let’s suppose a server generates two different event types: add and remove. The actual message is a text/event-stream MIME type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">event</span><span class="p">:</span> <span class="n">add</span>
<span class="n">data</span><span class="p">:</span> <span class="n">something</span>

<span class="n">event</span><span class="p">:</span> <span class="n">remove</span>
<span class="n">data</span><span class="p">:</span> <span class="n">somethingelse</span>
</pre></div>
</div>
<p>The client side would register listeners to receive &amp; process the server-sent events:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">source</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventSource</span><span class="p">(</span><span class="s1">&#39;updates.cgi&#39;</span><span class="p">);</span>
<span class="nx">source</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="nx">addHandler</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">source</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;remove&#39;</span><span class="p">,</span> <span class="nx">removeHandler</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="web-sockets">
<h2>5.7.4. Web sockets<a class="headerlink" href="#web-sockets" title="Permalink to this headline">¶</a></h2>
<p>For an online WebSockets example see <a class="reference external" href="http://flask-chat.herokuapp.com/">Python WebSockets Chat Demo</a>.</p>
<p>From <a class="reference external" href="http://www.html5rocks.com/en/tutorials/websockets/basics/">Introducing WebSockets: Bringing Sockets to the Web</a>:</p>
<blockquote>
<div><p>The WebSocket specification defines an API establishing “socket” connections between a web browser and a server. In plain words: There is an persistent connection between the client and the server and both parties can start sending data at any time.</p>
<p>…</p>
<p>Being a modern protocol, cross origin communication is baked right into WebSocket. While you should still make sure only to communicate with clients and servers that you trust, WebSocket enables communication between parties on any domain. The server decides whether to make its service available to all clients or only those that reside on a set of well defined domains.</p>
</div></blockquote>
<p>From <a class="reference external" href="http://en.wikipedia.org/wiki/WebSocket">WebSocket</a>:</p>
<blockquote>
<div><p>WebSocket is a protocol providing full-duplex communications channels over a single TCP connection. The WebSocket protocol was standardized by the IETF as RFC 6455 in 2011, and the WebSocket API in Web IDL is being standardized by the W3C.</p>
<p>WebSocket is designed to be implemented in web browsers and web servers, but it can be used by any client or server application. The WebSocket Protocol is an independent TCP-based protocol. Its only relationship to HTTP is that its handshake is interpreted by HTTP servers as an Upgrade request. The WebSocket protocol makes more interaction between a browser and a web site possible, facilitating live content and the creation of real-time games. This is made possible by providing a standardized way for the server to send content to the browser without being solicited by the client, and allowing for messages to be passed back and forth while keeping the connection open. In this way a two-way (bi-directional) ongoing conversation can take place between a browser and the server.</p>
</div></blockquote>
<p>From <a class="reference external" href="http://en.wikipedia.org/wiki/WebSocket">WebSocket</a> the client request looks like:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/chat</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">server.example.com</span>
<span class="na">Upgrade</span><span class="o">:</span> <span class="l">websocket</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">Upgrade</span>
<span class="na">Sec-WebSocket-Key</span><span class="o">:</span> <span class="l">x3JJHMbDL1EzLkh9GBhXDw==</span>
<span class="na">Sec-WebSocket-Protocol</span><span class="o">:</span> <span class="l">chat, superchat</span>
<span class="na">Sec-WebSocket-Version</span><span class="o">:</span> <span class="l">13</span>
<span class="na">Origin</span><span class="o">:</span> <span class="l">http://example.com</span>
</pre></div>
</div>
<p>and the server response would look like:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">101</span> <span class="ne">Switching Protocols</span>
<span class="na">Upgrade</span><span class="o">:</span> <span class="l">websocket</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">Upgrade</span>
<span class="na">Sec-WebSocket-Accept</span><span class="o">:</span> <span class="l">HSmrc0sMlYUkAGmm5OPpG2HaGWk=</span>
<span class="na">Sec-WebSocket-Protocol</span><span class="o">:</span> <span class="l">chat</span>
</pre></div>
</div>
<p>For more details consult <a class="reference external" href="http://www.html5rocks.com/en/tutorials/websockets/basics/">Introducing WebSockets: Bringing Sockets to the Web</a>, <a class="reference external" href="https://www.websocket.org/">WebSocket.org</a>, and <a class="reference external" href="https://html.spec.whatwg.org/multipage/comms.html#network">Web sockets</a>.</p>
</div>
<div class="section" id="id25">
<h2>5.7.5. Web Messaging<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://www.w3.org/TR/webmessaging/">W3C HTML5 Web Messaging</a> section defines both cross-document messaging and channel messaging. WHATWG skips web messaging and separately defines <a class="reference external" href="https://html.spec.whatwg.org/multipage/comms.html#web-messaging">Cross-document messaging</a> and <a class="reference external" href="https://html.spec.whatwg.org/multipage/comms.html#channel-messaging">Channel messaging</a>. Wikipedia equates web messaging with cross-document messaging and does not cover channel messaging.</p>
<p>The difference for sending messages is that cross-document messaging uses <code class="docutils literal notranslate"><span class="pre">window.postMessage()</span></code> while channel messaging use a MessageChannel via <code class="docutils literal notranslate"><span class="pre">channel.port1.postMessage()</span></code></p>
<div class="section" id="id26">
<h3>5.7.5.1. Cross-document messaging<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference external" href="http://codepen.io/matt-west/pen/lpExI">CODEPEN’s Receiver Window</a> (or <a class="reference external" href="http://codepen.io/matt-west/full/lpExI">Receiver Window</a> without the code) for an example of cross-document messaging.</p>
<blockquote>
<div><p>So <a class="reference external" href="http://en.wikipedia.org/wiki/Web_Messaging">Web Messaging</a> is the WHATWG <a class="reference external" href="https://html.spec.whatwg.org/multipage/comms.html#web-messaging">Cross-document messaging</a> and <a class="reference external" href="http://www.w3.org/TR/webmessaging/#web-messaging">W3C Cross-document messaging</a>. From <a class="reference external" href="http://en.wikipedia.org/wiki/Web_Messaging">Web Messaging</a> (relating to cross-document messaging):</p>
<blockquote>
<div>Web Messaging or cross-document messaging, is an API introduced in the WHATWG HTML5 draft specification, allowing documents to communicate with one another across different origins, or source domains. Prior to HTML5, web browsers disallowed cross-site scripting, to protect against security attacks. This practice barred communication between non-hostile pages as well, making document interaction of any kind difficult. Cross-document messaging allows scripts to interact across these boundaries, while providing a rudimentary level of security.</div></blockquote>
</div></blockquote>
<p>The example from <a class="reference external" href="http://en.wikipedia.org/wiki/Web_Messaging">Web Messaging</a>:</p>
<blockquote>
<div><p>Consider we want document A located on example.net to communicate with document B located on example.com, which is contained within an iframe or popup window.[1] The JavaScript for document A will look as follows:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">o</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;iframe&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
<span class="nx">o</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s1">&#39;Hello B&#39;</span><span class="p">,</span> <span class="s1">&#39;http://example.com/&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>The origin of our contentWindow object is passed to postMessage. It must match the origin of the document we wish to communicate with (in this case, document B). Otherwise, a security error will be thrown and the script will stop. The JavaScript for document B will look as follows:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">receiver</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">origin</span> <span class="o">==</span> <span class="s1">&#39;http://example.net&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span> <span class="o">==</span> <span class="s1">&#39;Hello B&#39;</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">event</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s1">&#39;Hello A, how are you?&#39;</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">origin</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="p">{</span>
                        <span class="nx">alert</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
                <span class="p">}</span>
        <span class="p">}</span>
<span class="p">}</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="nx">receiver</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</pre></div>
</div>
<p>An event listener is set up to receive messages from document A. Using the origin property, it then checks that the domain of the sender is the expected domain. Document B then looks at the message, either displaying it to the user, or responding in turn with a message of its own for document A.</p>
</div></blockquote>
</div>
<div class="section" id="id28">
<h3>5.7.5.2. Channel messaging<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h3>
<p>There are 2 good examples of channel messaging: <a class="reference external" href="https://github.com/mdn/channel-messaging-basic-demo">mdn/channel-messaging-basic-demo</a> (<a class="reference external" href="http://mdn.github.io/channel-messaging-basic-demo/">Channel messaging basic demo</a>) and <a class="reference external" href="https://github.com/mdn/channel-messaging-multimessage">mdn/channel-messaging-multimessage</a> (<a class="reference external" href="http://mdn.github.io/channel-messaging-multimessage/">Channel messaging multi-message demo</a>).</p>
<p>From <a class="reference external" href="http://www.w3.org/TR/webmessaging/#channel-messaging">W3C Channel messaging</a>:</p>
<blockquote>
<div><p>To enable independent pieces of code (e.g. running in different browsing contexts) to communicate directly, authors can use channel messaging.</p>
<p>Communication channels in this mechanisms are implemented as two-ways pipes, with a port at each end. Messages sent in one port are delivered at the other port, and vice-versa. Messages are asynchronous, and delivered as DOM events.</p>
<p>To create a connection (two “entangled” ports), the MessageChannel() constructor is called:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">channel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MessageChannel</span><span class="p">();</span>
</pre></div>
</div>
<p>One of the ports is kept as the local port, and the other port is sent to the remote code, e.g. using postMessage():</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">otherWindow</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="s1">&#39;http://example.com&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">channel</span><span class="p">.</span><span class="nx">port2</span><span class="p">]);</span>
</pre></div>
</div>
<p>To send messages, the postMessage() method on the port is used:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">channel</span><span class="p">.</span><span class="nx">port1</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>To receive messages, one listens to message events:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">channel</span><span class="p">.</span><span class="nx">port1</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="nx">handleMessage</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">handleMessage</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// message is in event.data</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Data sent on a port can be structured data; for example here an array of strings is passed:</p>
<p>port1.postMessage([‘hello’, ‘world’], ‘<a class="reference external" href="http://example.com">http://example.com</a>’);</p>
</div></blockquote>
</div>
<div class="section" id="broadcast-messaging">
<h3>5.7.5.3. Broadcast messaging<a class="headerlink" href="#broadcast-messaging" title="Permalink to this headline">¶</a></h3>
<p>From <a class="reference external" href="https://html.spec.whatwg.org/multipage/comms.html#broadcasting-to-other-browsing-contexts">Broadcasting to other browsing contexts</a>:</p>
<blockquote>
<div><p>Pages on a single origin opened by the same user in the same user agent but in different unrelated browsing contexts sometimes need to send notifications to each other, for example “hey, the user logged in over here, check your credentials again”.</p>
<p>For elaborate cases, e.g. to manage locking of shared state, to manage synchronisation of resources between a server and multiple local clients, to share a WebSocket connection with a remote host, and so forth, shared workers are the most appropriate solution.</p>
<p>For simple cases, though, where a shared worker would be an unreasonable overhead, authors can use the simple channel-based broadcast mechanism described in this section.</p>
</div></blockquote>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">authChannel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BroadcastChannel</span><span class="p">(</span><span class="s1">&#39;auth&#39;</span><span class="p">);</span>
<span class="nx">authChannel</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span> <span class="o">==</span> <span class="s1">&#39;logout&#39;</span><span class="p">)</span>
    <span class="nx">showLogout</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">logoutRequested</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// called when the user asks us to log them out</span>
  <span class="nx">doLogout</span><span class="p">();</span>
  <span class="nx">showLogout</span><span class="p">();</span>
  <span class="nx">authChannel</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s1">&#39;logout&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">doLogout</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// actually log the user out (e.g. clearing cookies)</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">showLogout</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// update the UI to indicate we&#39;re logged out</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="html_exploits.html" class="btn btn-neutral float-right" title="5.8. HTML exploits" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="html_security.html" class="btn btn-neutral" title="5.6. HTML security" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, bitbender.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.3',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>